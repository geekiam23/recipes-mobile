bcef97cb2ddee210e6c98fadead0b1c0
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getElementError = getElementError;
exports.getMultipleElementsFoundError = getMultipleElementsFoundError;
exports.queryAllByAttribute = queryAllByAttribute;
exports.queryByAttribute = queryByAttribute;
exports.makeSingleQuery = makeSingleQuery;
exports.makeGetAllQuery = makeGetAllQuery;
exports.makeFindQuery = makeFindQuery;
exports.buildQueries = buildQueries;
exports.wrapSingleQueryWithSuggestion = exports.wrapAllByQueryWithSuggestion = void 0;

var _suggestions = require("./suggestions");

var _matches = require("./matches");

var _waitFor = require("./wait-for");

var _config = require("./config");

function getElementError(message, container) {
  return (0, _config.getConfig)().getElementError(message, container);
}

function getMultipleElementsFoundError(message, container) {
  return getElementError(message + "\n\n(If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).", container);
}

function queryAllByAttribute(attribute, container, text) {
  var _ref = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {},
      _ref$exact = _ref.exact,
      exact = _ref$exact === void 0 ? true : _ref$exact,
      collapseWhitespace = _ref.collapseWhitespace,
      trim = _ref.trim,
      normalizer = _ref.normalizer;

  var matcher = exact ? _matches.matches : _matches.fuzzyMatches;
  var matchNormalizer = (0, _matches.makeNormalizer)({
    collapseWhitespace: collapseWhitespace,
    trim: trim,
    normalizer: normalizer
  });
  return Array.from(container.querySelectorAll("[" + attribute + "]")).filter(function (node) {
    return matcher(node.getAttribute(attribute), node, text, matchNormalizer);
  });
}

function queryByAttribute(attribute, container, text) {
  for (var _len = arguments.length, args = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {
    args[_key - 3] = arguments[_key];
  }

  var els = queryAllByAttribute.apply(void 0, [attribute, container, text].concat(args));

  if (els.length > 1) {
    throw getMultipleElementsFoundError("Found multiple elements by [" + attribute + "=" + text + "]", container);
  }

  return els[0] || null;
}

function makeSingleQuery(allQuery, getMultipleError) {
  return function (container) {
    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
      args[_key2 - 1] = arguments[_key2];
    }

    var els = allQuery.apply(void 0, [container].concat(args));

    if (els.length > 1) {
      var elementStrings = els.map(function (element) {
        return getElementError(null, element).message;
      }).join('\n\n');
      throw getMultipleElementsFoundError(getMultipleError.apply(void 0, [container].concat(args)) + "\n\nHere are the matching elements:\n\n" + elementStrings, container);
    }

    return els[0] || null;
  };
}

function getSuggestionError(suggestion, container) {
  return (0, _config.getConfig)().getElementError("A better query is available, try this:\n" + suggestion.toString() + "\n", container);
}

function makeGetAllQuery(allQuery, getMissingError) {
  return function (container) {
    for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {
      args[_key3 - 1] = arguments[_key3];
    }

    var els = allQuery.apply(void 0, [container].concat(args));

    if (!els.length) {
      throw (0, _config.getConfig)().getElementError(getMissingError.apply(void 0, [container].concat(args)), container);
    }

    return els;
  };
}

function makeFindQuery(getter) {
  return function (container, text, options, waitForOptions) {
    return (0, _waitFor.waitFor)(function () {
      return getter(container, text, options);
    }, (0, _extends2.default)({
      container: container
    }, waitForOptions));
  };
}

var wrapSingleQueryWithSuggestion = function wrapSingleQueryWithSuggestion(query, queryAllByName, variant) {
  return function (container) {
    for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {
      args[_key4 - 1] = arguments[_key4];
    }

    var element = query.apply(void 0, [container].concat(args));

    var _args$slice = args.slice(-1),
        _args$slice2 = (0, _slicedToArray2.default)(_args$slice, 1),
        _args$slice2$ = _args$slice2[0];

    _args$slice2$ = _args$slice2$ === void 0 ? {} : _args$slice2$;
    var _args$slice2$$suggest = _args$slice2$.suggest,
        suggest = _args$slice2$$suggest === void 0 ? (0, _config.getConfig)().throwSuggestions : _args$slice2$$suggest;

    if (element && suggest) {
      var suggestion = (0, _suggestions.getSuggestedQuery)(element, variant);

      if (suggestion && !queryAllByName.endsWith(suggestion.queryName)) {
        throw getSuggestionError(suggestion.toString(), container);
      }
    }

    return element;
  };
};

exports.wrapSingleQueryWithSuggestion = wrapSingleQueryWithSuggestion;

var wrapAllByQueryWithSuggestion = function wrapAllByQueryWithSuggestion(query, queryAllByName, variant) {
  return function (container) {
    for (var _len5 = arguments.length, args = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {
      args[_key5 - 1] = arguments[_key5];
    }

    var els = query.apply(void 0, [container].concat(args));

    var _args$slice3 = args.slice(-1),
        _args$slice4 = (0, _slicedToArray2.default)(_args$slice3, 1),
        _args$slice4$ = _args$slice4[0];

    _args$slice4$ = _args$slice4$ === void 0 ? {} : _args$slice4$;
    var _args$slice4$$suggest = _args$slice4$.suggest,
        suggest = _args$slice4$$suggest === void 0 ? (0, _config.getConfig)().throwSuggestions : _args$slice4$$suggest;

    if (els.length && suggest) {
      var uniqueSuggestionMessages = (0, _toConsumableArray2.default)(new Set(els.map(function (element) {
        var _getSuggestedQuery;

        return (_getSuggestedQuery = (0, _suggestions.getSuggestedQuery)(element, variant)) == null ? void 0 : _getSuggestedQuery.toString();
      })));

      if (uniqueSuggestionMessages.length === 1 && !queryAllByName.endsWith((0, _suggestions.getSuggestedQuery)(els[0], variant).queryName)) {
        throw getSuggestionError(uniqueSuggestionMessages[0], container);
      }
    }

    return els;
  };
};

exports.wrapAllByQueryWithSuggestion = wrapAllByQueryWithSuggestion;

function buildQueries(queryAllBy, getMultipleError, getMissingError) {
  var queryBy = wrapSingleQueryWithSuggestion(makeSingleQuery(queryAllBy, getMultipleError), queryAllBy.name, 'query');
  var getAllBy = makeGetAllQuery(queryAllBy, getMissingError);
  var getBy = makeSingleQuery(getAllBy, getMultipleError);
  var getByWithSuggestions = wrapSingleQueryWithSuggestion(getBy, queryAllBy.name, 'get');
  var getAllWithSuggestions = wrapAllByQueryWithSuggestion(getAllBy, queryAllBy.name.replace('query', 'get'), 'getAll');
  var findAllBy = makeFindQuery(wrapAllByQueryWithSuggestion(getAllBy, queryAllBy.name, 'findAll'));
  var findBy = makeFindQuery(wrapSingleQueryWithSuggestion(getBy, queryAllBy.name, 'find'));
  return [queryBy, getAllWithSuggestions, getByWithSuggestions, findAllBy, findBy];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInF1ZXJ5LWhlbHBlcnMuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJnZXRFbGVtZW50RXJyb3IiLCJnZXRNdWx0aXBsZUVsZW1lbnRzRm91bmRFcnJvciIsInF1ZXJ5QWxsQnlBdHRyaWJ1dGUiLCJxdWVyeUJ5QXR0cmlidXRlIiwibWFrZVNpbmdsZVF1ZXJ5IiwibWFrZUdldEFsbFF1ZXJ5IiwibWFrZUZpbmRRdWVyeSIsImJ1aWxkUXVlcmllcyIsIndyYXBTaW5nbGVRdWVyeVdpdGhTdWdnZXN0aW9uIiwid3JhcEFsbEJ5UXVlcnlXaXRoU3VnZ2VzdGlvbiIsIl9zdWdnZXN0aW9ucyIsInJlcXVpcmUiLCJfbWF0Y2hlcyIsIl93YWl0Rm9yIiwiX2NvbmZpZyIsIm1lc3NhZ2UiLCJjb250YWluZXIiLCJnZXRDb25maWciLCJhdHRyaWJ1dGUiLCJ0ZXh0IiwiZXhhY3QiLCJjb2xsYXBzZVdoaXRlc3BhY2UiLCJ0cmltIiwibm9ybWFsaXplciIsIm1hdGNoZXIiLCJtYXRjaGVzIiwiZnV6enlNYXRjaGVzIiwibWF0Y2hOb3JtYWxpemVyIiwibWFrZU5vcm1hbGl6ZXIiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiZmlsdGVyIiwibm9kZSIsImdldEF0dHJpYnV0ZSIsImFyZ3MiLCJlbHMiLCJsZW5ndGgiLCJhbGxRdWVyeSIsImdldE11bHRpcGxlRXJyb3IiLCJlbGVtZW50U3RyaW5ncyIsIm1hcCIsImVsZW1lbnQiLCJqb2luIiwiZ2V0U3VnZ2VzdGlvbkVycm9yIiwic3VnZ2VzdGlvbiIsInRvU3RyaW5nIiwiZ2V0TWlzc2luZ0Vycm9yIiwiZ2V0dGVyIiwib3B0aW9ucyIsIndhaXRGb3JPcHRpb25zIiwid2FpdEZvciIsInF1ZXJ5IiwicXVlcnlBbGxCeU5hbWUiLCJ2YXJpYW50Iiwic2xpY2UiLCJzdWdnZXN0IiwidGhyb3dTdWdnZXN0aW9ucyIsImdldFN1Z2dlc3RlZFF1ZXJ5IiwiZW5kc1dpdGgiLCJxdWVyeU5hbWUiLCJ1bmlxdWVTdWdnZXN0aW9uTWVzc2FnZXMiLCJTZXQiLCJfZ2V0U3VnZ2VzdGVkUXVlcnkiLCJxdWVyeUFsbEJ5IiwicXVlcnlCeSIsIm5hbWUiLCJnZXRBbGxCeSIsImdldEJ5IiwiZ2V0QnlXaXRoU3VnZ2VzdGlvbnMiLCJnZXRBbGxXaXRoU3VnZ2VzdGlvbnMiLCJyZXBsYWNlIiwiZmluZEFsbEJ5IiwiZmluZEJ5Il0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7OztBQUVBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQzNDQyxFQUFBQSxLQUFLLEVBQUU7QUFEb0MsQ0FBN0M7QUFHQUQsT0FBTyxDQUFDRSxlQUFSLEdBQTBCQSxlQUExQjtBQUNBRixPQUFPLENBQUNHLDZCQUFSLEdBQXdDQSw2QkFBeEM7QUFDQUgsT0FBTyxDQUFDSSxtQkFBUixHQUE4QkEsbUJBQTlCO0FBQ0FKLE9BQU8sQ0FBQ0ssZ0JBQVIsR0FBMkJBLGdCQUEzQjtBQUNBTCxPQUFPLENBQUNNLGVBQVIsR0FBMEJBLGVBQTFCO0FBQ0FOLE9BQU8sQ0FBQ08sZUFBUixHQUEwQkEsZUFBMUI7QUFDQVAsT0FBTyxDQUFDUSxhQUFSLEdBQXdCQSxhQUF4QjtBQUNBUixPQUFPLENBQUNTLFlBQVIsR0FBdUJBLFlBQXZCO0FBQ0FULE9BQU8sQ0FBQ1UsNkJBQVIsR0FBd0NWLE9BQU8sQ0FBQ1csNEJBQVIsR0FBdUMsS0FBSyxDQUFwRjs7QUFFQSxJQUFJQyxZQUFZLEdBQUdDLE9BQU8saUJBQTFCOztBQUVBLElBQUlDLFFBQVEsR0FBR0QsT0FBTyxhQUF0Qjs7QUFFQSxJQUFJRSxRQUFRLEdBQUdGLE9BQU8sY0FBdEI7O0FBRUEsSUFBSUcsT0FBTyxHQUFHSCxPQUFPLFlBQXJCOztBQUVBLFNBQVNYLGVBQVQsQ0FBeUJlLE9BQXpCLEVBQWtDQyxTQUFsQyxFQUE2QztBQUMzQyxTQUFPLENBQUMsR0FBR0YsT0FBTyxDQUFDRyxTQUFaLElB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QTdDO0FBQ0EsTUFBTUMsUUFBUSxHQUFHOUQsZUFBZSxDQUFDMkQsVUFBRCxFQUFhakIsZUFBYixDQUFoQztBQUNBLE1BQU1xQixLQUFLLEdBQUdoRSxlQUFlLENBQUMrRCxRQUFELEVBQVc1QixnQkFBWCxDQUE3QjtBQUNBLE1BQU04QixvQkFBb0IsR0FBRzdELDZCQUE2QixDQUFDNEQsS0FBRCxFQUFRSixVQUFVLENBQUNFLElBQW5CLEVBQXlCLEtBQXpCLENBQTFEO0FBQ0EsTUFBTUkscUJBQXFCLEdBQUc3RCw0QkFBNEIsQ0FBQzBELFFBQUQsRUFBV0gsVUFBVSxDQUFDRSxJQUFYLENBQWdCSyxPQUFoQixDQUF3QixPQUF4QixFQUFpQyxLQUFqQyxDQUFYLEVBQW9ELFFBQXBELENBQTFEO0FBQ0EsTUFBTUMsU0FBUyxHQUFHbEUsYUFBYSxDQUFDRyw0QkFBNEIsQ0FBQzBELFFBQUQsRUFBV0gsVUFBVSxDQUFDRSxJQUF0QixFQUE0QixTQUE1QixDQUE3QixDQUEvQjtBQUNBLE1BQU1PLE1BQU0sR0FBR25FLGFBQWEsQ0FBQ0UsNkJBQTZCLENBQUM0RCxLQUFELEVBQVFKLFVBQVUsQ0FBQ0UsSUFBbkIsRUFBeUIsTUFBekIsQ0FBOUIsQ0FBNUI7QUFDQSxTQUFPLENBQUNELE9BQUQsRUFBVUsscUJBQVYsRUFBaUNELG9CQUFqQyxFQUF1REcsU0FBdkQsRUFBa0VDLE1BQWxFLENBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5nZXRFbGVtZW50RXJyb3IgPSBnZXRFbGVtZW50RXJyb3I7XG5leHBvcnRzLmdldE11bHRpcGxlRWxlbWVudHNGb3VuZEVycm9yID0gZ2V0TXVsdGlwbGVFbGVtZW50c0ZvdW5kRXJyb3I7XG5leHBvcnRzLnF1ZXJ5QWxsQnlBdHRyaWJ1dGUgPSBxdWVyeUFsbEJ5QXR0cmlidXRlO1xuZXhwb3J0cy5xdWVyeUJ5QXR0cmlidXRlID0gcXVlcnlCeUF0dHJpYnV0ZTtcbmV4cG9ydHMubWFrZVNpbmdsZVF1ZXJ5ID0gbWFrZVNpbmdsZVF1ZXJ5O1xuZXhwb3J0cy5tYWtlR2V0QWxsUXVlcnkgPSBtYWtlR2V0QWxsUXVlcnk7XG5leHBvcnRzLm1ha2VGaW5kUXVlcnkgPSBtYWtlRmluZFF1ZXJ5O1xuZXhwb3J0cy5idWlsZFF1ZXJpZXMgPSBidWlsZFF1ZXJpZXM7XG5leHBvcnRzLndyYXBTaW5nbGVRdWVyeVdpdGhTdWdnZXN0aW9uID0gZXhwb3J0cy53cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uID0gdm9pZCAwO1xuXG52YXIgX3N1Z2dlc3Rpb25zID0gcmVxdWlyZShcIi4vc3VnZ2VzdGlvbnNcIik7XG5cbnZhciBfbWF0Y2hlcyA9IHJlcXVpcmUoXCIuL21hdGNoZXNcIik7XG5cbnZhciBfd2FpdEZvciA9IHJlcXVpcmUoXCIuL3dhaXQtZm9yXCIpO1xuXG52YXIgX2NvbmZpZyA9IHJlcXVpcmUoXCIuL2NvbmZpZ1wiKTtcblxuZnVuY3Rpb24gZ2V0RWxlbWVudEVycm9yKG1lc3NhZ2UsIGNvbnRhaW5lcikge1xuICByZXR1cm4gKDAsIF9jb25maWcuZ2V0Q29uZmlnKSgpLmdldEVsZW1lbnRFcnJvcihtZXNzYWdlLCBjb250YWluZXIpO1xufVxuXG5mdW5jdGlvbiBnZXRNdWx0aXBsZUVsZW1lbnRzRm91bmRFcnJvcihtZXNzYWdlLCBjb250YWluZXIpIHtcbiAgcmV0dXJuIGdldEVsZW1lbnRFcnJvcihgJHttZXNzYWdlfVxcblxcbihJZiB0aGlzIGlzIGludGVudGlvbmFsLCB0aGVuIHVzZSB0aGUgXFxgKkFsbEJ5KlxcYCB2YXJpYW50IG9mIHRoZSBxdWVyeSAobGlrZSBcXGBxdWVyeUFsbEJ5VGV4dFxcYCwgXFxgZ2V0QWxsQnlUZXh0XFxgLCBvciBcXGBmaW5kQWxsQnlUZXh0XFxgKSkuYCwgY29udGFpbmVyKTtcbn1cblxuZnVuY3Rpb24gcXVlcnlBbGxCeUF0dHJpYnV0ZShhdHRyaWJ1dGUsIGNvbnRhaW5lciwgdGV4dCwge1xuICBleGFjdCA9IHRydWUsXG4gIGNvbGxhcHNlV2hpdGVzcGFjZSxcbiAgdHJpbSxcbiAgbm9ybWFsaXplclxufSA9IHt9KSB7XG4gIGNvbnN0IG1hdGNoZXIgPSBleGFjdCA/IF9tYXRjaGVzLm1hdGNoZXMgOiBfbWF0Y2hlcy5mdXp6eU1hdGNoZXM7XG4gIGNvbnN0IG1hdGNoTm9ybWFsaXplciA9ICgwLCBfbWF0Y2hlcy5tYWtlTm9ybWFsaXplcikoe1xuICAgIGNvbGxhcHNlV2hpdGVzcGFjZSxcbiAgICB0cmltLFxuICAgIG5vcm1hbGl6ZXJcbiAgfSk7XG4gIHJldHVybiBBcnJheS5mcm9tKGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKGBbJHthdHRyaWJ1dGV9XWApKS5maWx0ZXIobm9kZSA9PiBtYXRjaGVyKG5vZGUuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSksIG5vZGUsIHRleHQsIG1hdGNoTm9ybWFsaXplcikpO1xufVxuXG5mdW5jdGlvbiBxdWVyeUJ5QXR0cmlidXRlKGF0dHJpYnV0ZSwgY29udGFpbmVyLCB0ZXh0LCAuLi5hcmdzKSB7XG4gIGNvbnN0IGVscyA9IHF1ZXJ5QWxsQnlBdHRyaWJ1dGUoYXR0cmlidXRlLCBjb250YWluZXIsIHRleHQsIC4uLmFyZ3MpO1xuXG4gIGlmIChlbHMubGVuZ3RoID4gMSkge1xuICAgIHRocm93IGdldE11bHRpcGxlRWxlbWVudHNGb3VuZEVycm9yKGBGb3VuZCBtdWx0aXBsZSBlbGVtZW50cyBieSBbJHthdHRyaWJ1dGV9PSR7dGV4dH1dYCwgY29udGFpbmVyKTtcbiAgfVxuXG4gIHJldHVybiBlbHNbMF0gfHwgbnVsbDtcbn0gLy8gdGhpcyBhY2NlcHRzIGEgcXVlcnkgZnVuY3Rpb24gYW5kIHJldHVybnMgYSBmdW5jdGlvbiB3aGljaCB0aHJvd3MgYW4gZXJyb3Jcbi8vIGlmIG1vcmUgdGhhbiBvbmUgZWxlbWVudHMgaXMgcmV0dXJuZWQsIG90aGVyd2lzZSBpdCByZXR1cm5zIHRoZSBmaXJzdFxuLy8gZWxlbWVudCBvciBudWxsXG5cblxuZnVuY3Rpb24gbWFrZVNpbmdsZVF1ZXJ5KGFsbFF1ZXJ5LCBnZXRNdWx0aXBsZUVycm9yKSB7XG4gIHJldHVybiAoY29udGFpbmVyLCAuLi5hcmdzKSA9PiB7XG4gICAgY29uc3QgZWxzID0gYWxsUXVlcnkoY29udGFpbmVyLCAuLi5hcmdzKTtcblxuICAgIGlmIChlbHMubGVuZ3RoID4gMSkge1xuICAgICAgY29uc3QgZWxlbWVudFN0cmluZ3MgPSBlbHMubWFwKGVsZW1lbnQgPT4gZ2V0RWxlbWVudEVycm9yKG51bGwsIGVsZW1lbnQpLm1lc3NhZ2UpLmpvaW4oJ1xcblxcbicpO1xuICAgICAgdGhyb3cgZ2V0TXVsdGlwbGVFbGVtZW50c0ZvdW5kRXJyb3IoYCR7Z2V0TXVsdGlwbGVFcnJvcihjb250YWluZXIsIC4uLmFyZ3MpfVxuXG5IZXJlIGFyZSB0aGUgbWF0Y2hpbmcgZWxlbWVudHM6XG5cbiR7ZWxlbWVudFN0cmluZ3N9YCwgY29udGFpbmVyKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZWxzWzBdIHx8IG51bGw7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25FcnJvcihzdWdnZXN0aW9uLCBjb250YWluZXIpIHtcbiAgcmV0dXJuICgwLCBfY29uZmlnLmdldENvbmZpZykoKS5nZXRFbGVtZW50RXJyb3IoYEEgYmV0dGVyIHF1ZXJ5IGlzIGF2YWlsYWJsZSwgdHJ5IHRoaXM6XG4ke3N1Z2dlc3Rpb24udG9TdHJpbmcoKX1cbmAsIGNvbnRhaW5lcik7XG59IC8vIHRoaXMgYWNjZXB0cyBhIHF1ZXJ5IGZ1bmN0aW9uIGFuZCByZXR1cm5zIGEgZnVuY3Rpb24gd2hpY2ggdGhyb3dzIGFuIGVycm9yXG4vLyBpZiBhbiBlbXB0eSBsaXN0IG9mIGVsZW1lbnRzIGlzIHJldHVybmVkXG5cblxuZnVuY3Rpb24gbWFrZUdldEFsbFF1ZXJ5KGFsbFF1ZXJ5LCBnZXRNaXNzaW5nRXJyb3IpIHtcbiAgcmV0dXJuIChjb250YWluZXIsIC4uLmFyZ3MpID0+IHtcbiAgICBjb25zdCBlbHMgPSBhbGxRdWVyeShjb250YWluZXIsIC4uLmFyZ3MpO1xuXG4gICAgaWYgKCFlbHMubGVuZ3RoKSB7XG4gICAgICB0aHJvdyAoMCwgX2NvbmZpZy5nZXRDb25maWcpKCkuZ2V0RWxlbWVudEVycm9yKGdldE1pc3NpbmdFcnJvcihjb250YWluZXIsIC4uLmFyZ3MpLCBjb250YWluZXIpO1xuICAgIH1cblxuICAgIHJldHVybiBlbHM7XG4gIH07XG59IC8vIHRoaXMgYWNjZXB0cyBhIGdldHRlciBxdWVyeSBmdW5jdGlvbiBhbmQgcmV0dXJucyBhIGZ1bmN0aW9uIHdoaWNoIGNhbGxzXG4vLyB3YWl0Rm9yIGFuZCBwYXNzaW5nIGEgZnVuY3Rpb24gd2hpY2ggaW52b2tlcyB0aGUgZ2V0dGVyLlxuXG5cbmZ1bmN0aW9uIG1ha2VGaW5kUXVlcnkoZ2V0dGVyKSB7XG4gIHJldHVybiAoY29udGFpbmVyLCB0ZXh0LCBvcHRpb25zLCB3YWl0Rm9yT3B0aW9ucykgPT4ge1xuICAgIHJldHVybiAoMCwgX3dhaXRGb3Iud2FpdEZvcikoKCkgPT4ge1xuICAgICAgcmV0dXJuIGdldHRlcihjb250YWluZXIsIHRleHQsIG9wdGlvbnMpO1xuICAgIH0sIHtcbiAgICAgIGNvbnRhaW5lcixcbiAgICAgIC4uLndhaXRGb3JPcHRpb25zXG4gICAgfSk7XG4gIH07XG59XG5cbmNvbnN0IHdyYXBTaW5nbGVRdWVyeVdpdGhTdWdnZXN0aW9uID0gKHF1ZXJ5LCBxdWVyeUFsbEJ5TmFtZSwgdmFyaWFudCkgPT4gKGNvbnRhaW5lciwgLi4uYXJncykgPT4ge1xuICBjb25zdCBlbGVtZW50ID0gcXVlcnkoY29udGFpbmVyLCAuLi5hcmdzKTtcbiAgY29uc3QgW3tcbiAgICBzdWdnZXN0ID0gKDAsIF9jb25maWcuZ2V0Q29uZmlnKSgpLnRocm93U3VnZ2VzdGlvbnNcbiAgfSA9IHt9XSA9IGFyZ3Muc2xpY2UoLTEpO1xuXG4gIGlmIChlbGVtZW50ICYmIHN1Z2dlc3QpIHtcbiAgICBjb25zdCBzdWdnZXN0aW9uID0gKDAsIF9zdWdnZXN0aW9ucy5nZXRTdWdnZXN0ZWRRdWVyeSkoZWxlbWVudCwgdmFyaWFudCk7XG5cbiAgICBpZiAoc3VnZ2VzdGlvbiAmJiAhcXVlcnlBbGxCeU5hbWUuZW5kc1dpdGgoc3VnZ2VzdGlvbi5xdWVyeU5hbWUpKSB7XG4gICAgICB0aHJvdyBnZXRTdWdnZXN0aW9uRXJyb3Ioc3VnZ2VzdGlvbi50b1N0cmluZygpLCBjb250YWluZXIpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBlbGVtZW50O1xufTtcblxuZXhwb3J0cy53cmFwU2luZ2xlUXVlcnlXaXRoU3VnZ2VzdGlvbiA9IHdyYXBTaW5nbGVRdWVyeVdpdGhTdWdnZXN0aW9uO1xuXG5jb25zdCB3cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uID0gKHF1ZXJ5LCBxdWVyeUFsbEJ5TmFtZSwgdmFyaWFudCkgPT4gKGNvbnRhaW5lciwgLi4uYXJncykgPT4ge1xuICBjb25zdCBlbHMgPSBxdWVyeShjb250YWluZXIsIC4uLmFyZ3MpO1xuICBjb25zdCBbe1xuICAgIHN1Z2dlc3QgPSAoMCwgX2NvbmZpZy5nZXRDb25maWcpKCkudGhyb3dTdWdnZXN0aW9uc1xuICB9ID0ge31dID0gYXJncy5zbGljZSgtMSk7XG5cbiAgaWYgKGVscy5sZW5ndGggJiYgc3VnZ2VzdCkge1xuICAgIC8vIGdldCBhIHVuaXF1ZSBsaXN0IG9mIGFsbCBzdWdnZXN0aW9uIG1lc3NhZ2VzLiAgV2UgYXJlIG9ubHkgZ29pbmcgdG8gbWFrZSBhIHN1Z2dlc3Rpb24gaWZcbiAgICAvLyBhbGwgdGhlIHN1Z2dlc3Rpb25zIGFyZSB0aGUgc2FtZVxuICAgIGNvbnN0IHVuaXF1ZVN1Z2dlc3Rpb25NZXNzYWdlcyA9IFsuLi5uZXcgU2V0KGVscy5tYXAoZWxlbWVudCA9PiB7XG4gICAgICB2YXIgX2dldFN1Z2dlc3RlZFF1ZXJ5O1xuXG4gICAgICByZXR1cm4gKF9nZXRTdWdnZXN0ZWRRdWVyeSA9ICgwLCBfc3VnZ2VzdGlvbnMuZ2V0U3VnZ2VzdGVkUXVlcnkpKGVsZW1lbnQsIHZhcmlhbnQpKSA9PSBudWxsID8gdm9pZCAwIDogX2dldFN1Z2dlc3RlZFF1ZXJ5LnRvU3RyaW5nKCk7XG4gICAgfSkpXTtcblxuICAgIGlmICggLy8gb25seSB3YW50IHRvIHN1Z2dlc3QgaWYgYWxsIHRoZSBlbHMgaGF2ZSB0aGUgc2FtZSBzdWdnZXN0aW9uLlxuICAgIHVuaXF1ZVN1Z2dlc3Rpb25NZXNzYWdlcy5sZW5ndGggPT09IDEgJiYgIXF1ZXJ5QWxsQnlOYW1lLmVuZHNXaXRoKCgwLCBfc3VnZ2VzdGlvbnMuZ2V0U3VnZ2VzdGVkUXVlcnkpKGVsc1swXSwgdmFyaWFudCkucXVlcnlOYW1lKSkge1xuICAgICAgdGhyb3cgZ2V0U3VnZ2VzdGlvbkVycm9yKHVuaXF1ZVN1Z2dlc3Rpb25NZXNzYWdlc1swXSwgY29udGFpbmVyKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZWxzO1xufTtcblxuZXhwb3J0cy53cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uID0gd3JhcEFsbEJ5UXVlcnlXaXRoU3VnZ2VzdGlvbjtcblxuZnVuY3Rpb24gYnVpbGRRdWVyaWVzKHF1ZXJ5QWxsQnksIGdldE11bHRpcGxlRXJyb3IsIGdldE1pc3NpbmdFcnJvcikge1xuICBjb25zdCBxdWVyeUJ5ID0gd3JhcFNpbmdsZVF1ZXJ5V2l0aFN1Z2dlc3Rpb24obWFrZVNpbmdsZVF1ZXJ5KHF1ZXJ5QWxsQnksIGdldE11bHRpcGxlRXJyb3IpLCBxdWVyeUFsbEJ5Lm5hbWUsICdxdWVyeScpO1xuICBjb25zdCBnZXRBbGxCeSA9IG1ha2VHZXRBbGxRdWVyeShxdWVyeUFsbEJ5LCBnZXRNaXNzaW5nRXJyb3IpO1xuICBjb25zdCBnZXRCeSA9IG1ha2VTaW5nbGVRdWVyeShnZXRBbGxCeSwgZ2V0TXVsdGlwbGVFcnJvcik7XG4gIGNvbnN0IGdldEJ5V2l0aFN1Z2dlc3Rpb25zID0gd3JhcFNpbmdsZVF1ZXJ5V2l0aFN1Z2dlc3Rpb24oZ2V0QnksIHF1ZXJ5QWxsQnkubmFtZSwgJ2dldCcpO1xuICBjb25zdCBnZXRBbGxXaXRoU3VnZ2VzdGlvbnMgPSB3cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uKGdldEFsbEJ5LCBxdWVyeUFsbEJ5Lm5hbWUucmVwbGFjZSgncXVlcnknLCAnZ2V0JyksICdnZXRBbGwnKTtcbiAgY29uc3QgZmluZEFsbEJ5ID0gbWFrZUZpbmRRdWVyeSh3cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uKGdldEFsbEJ5LCBxdWVyeUFsbEJ5Lm5hbWUsICdmaW5kQWxsJykpO1xuICBjb25zdCBmaW5kQnkgPSBtYWtlRmluZFF1ZXJ5KHdyYXBTaW5nbGVRdWVyeVdpdGhTdWdnZXN0aW9uKGdldEJ5LCBxdWVyeUFsbEJ5Lm5hbWUsICdmaW5kJykpO1xuICByZXR1cm4gW3F1ZXJ5QnksIGdldEFsbFdpdGhTdWdnZXN0aW9ucywgZ2V0QnlXaXRoU3VnZ2VzdGlvbnMsIGZpbmRBbGxCeSwgZmluZEJ5XTtcbn0iXX0=