429ab0ac9ce270b621a6331cd33fb250
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _NativeStatusBarManagerAndroid = _interopRequireDefault(require("./NativeStatusBarManagerAndroid"));

var _NativeStatusBarManagerIOS = _interopRequireDefault(require("./NativeStatusBarManagerIOS"));

var _NativeStatusBarManag;

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var Platform = require("../../Utilities/Platform");

var React = require('react');

var invariant = require('invariant');

var processColor = require("../../StyleSheet/processColor");

function mergePropsStack(propsStack, defaultValues) {
  return propsStack.reduce(function (prev, cur) {
    for (var prop in cur) {
      if (cur[prop] != null) {
        prev[prop] = cur[prop];
      }
    }

    return prev;
  }, (0, _extends2.default)({}, defaultValues));
}

function createStackEntry(props) {
  return {
    backgroundColor: props.backgroundColor != null ? {
      value: props.backgroundColor,
      animated: props.animated
    } : null,
    barStyle: props.barStyle != null ? {
      value: props.barStyle,
      animated: props.animated
    } : null,
    translucent: props.translucent,
    hidden: props.hidden != null ? {
      value: props.hidden,
      animated: props.animated,
      transition: props.showHideTransition
    } : null,
    networkActivityIndicatorVisible: props.networkActivityIndicatorVisible
  };
}

var StatusBar = function (_React$Component) {
  (0, _inherits2.default)(StatusBar, _React$Component);

  var _super = _createSuper(StatusBar);

  function StatusBar() {
    var _this;

    (0, _classCallCheck2.default)(this, StatusBar);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));
    _this._stackEntry = null;
    return _this;
  }

  (0, _createClass2.default)(StatusBar, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this._stackEntry = StatusBar.pushStackEntry(this.props);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      StatusBar.popStackEntry(this._stackEntry);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      this._stackEntry = StatusBar.replaceStackEntry(this._stackEntry, this.props);
    }
  }, {
    key: "render",
    value: function render() {
      return null;
    }
  }], [{
    key: "setHidden",
    value: function setHidden(hidden, animation) {
      animation = animation || 'none';
      StatusBar._defaultProps.hidden.value = hidden;

      if (Platform.OS === 'ios') {
        _NativeStatusBarManagerIOS.default.setHidden(hidden, animation);
      } else if (Platform.OS === 'android') {
        _NativeStatusBarManagerAndroid.default.setHidden(hidden);
      }
    }
  }, {
    key: "setBarStyle",
    value: function setBarStyle(style, animated) {
      animated = animated || false;
      StatusBar._defaultProps.barStyle.value = style;

      if (Platform.OS === 'ios') {
        _NativeStatusBarManagerIOS.default.setStyle(style, animated);
      } else if (Platform.OS === 'android') {
        _NativeStatusBarManagerAndroid.default.setStyle(style);
      }
    }
  }, {
    key: "setNetworkActivityIndicatorVisible",
    value: function setNetworkActivityIndicatorVisible(visible) {
      if (Platform.OS !== 'ios') {
        console.warn('`setNetworkActivityIndicatorVisible` is only available on iOS');
        return;
      }

      StatusBar._defaultProps.networkActivityIndicatorVisible = visible;

      _NativeStatusBarManagerIOS.default.setNetworkActivityIndicatorVisible(visible);
    }
  }, {
    key: "setBackgroundColor",
    value: function setBackgroundColor(color, animated) {
      if (Platform.OS !== 'android') {
        console.warn('`setBackgroundColor` is only available on Android');
        return;
      }

      animated = animated || false;
      StatusBar._defaultProps.backgroundColor.value = color;
      var processedColor = processColor(color);

      if (processedColor == null) {
        console.warn("`StatusBar.setBackgroundColor`: Color " + color + " parsed to null or undefined");
        return;
      }

      invariant(typeof processedColor === 'number', 'Unexpected color given for StatusBar.setBackgroundColor');

      _NativeStatusBarManagerAndroid.default.setColor(processedColor, animated);
    }
  }, {
    key: "setTranslucent",
    value: function setTranslucent(translucent) {
      if (Platform.OS !== 'android') {
        console.warn('`setTranslucent` is only available on Android');
        return;
      }

      StatusBar._defaultProps.translucent = translucent;

      _NativeStatusBarManagerAndroid.default.setTranslucent(translucent);
    }
  }, {
    key: "pushStackEntry",
    value: function pushStackEntry(props) {
      var entry = createStackEntry(props);

      StatusBar._propsStack.push(entry);

      StatusBar._updatePropsStack();

      return entry;
    }
  }, {
    key: "popStackEntry",
    value: function popStackEntry(entry) {
      var index = StatusBar._propsStack.indexOf(entry);

      if (index !== -1) {
        StatusBar._propsStack.splice(index, 1);
      }

      StatusBar._updatePropsStack();
    }
  }, {
    key: "replaceStackEntry",
    value: function replaceStackEntry(entry, props) {
      var newEntry = createStackEntry(props);

      var index = StatusBar._propsStack.indexOf(entry);

      if (index !== -1) {
        StatusBar._propsStack[index] = newEntry;
      }

      StatusBar._updatePropsStack();

      return newEntry;
    }
  }]);
  return StatusBar;
}(React.Component);

StatusBar._propsStack = [];
StatusBar._defaultProps = createStackEntry({
  animated: false,
  showHideTransition: 'fade',
  backgroundColor: Platform.OS === 'android' ? (_NativeStatusBarManag = _NativeStatusBarManagerAndroid.default.getConstants().DEFAULT_BACKGROUND_COLOR) != null ? _NativeStatusBarManag : 'black' : 'black',
  barStyle: 'default',
  translucent: false,
  hidden: false,
  networkActivityIndicatorVisible: false
});
StatusBar._updateImmediate = null;
StatusBar._currentValues = null;
StatusBar.currentHeight = Platform.OS === 'android' ? _NativeStatusBarManagerAndroid.default.getConstants().HEIGHT : null;
StatusBar.defaultProps = {
  animated: false,
  showHideTransition: 'fade'
};

StatusBar._updatePropsStack = function () {
  clearImmediate(StatusBar._updateImmediate);
  StatusBar._updateImmediate = setImmediate(function () {
    var oldProps = StatusBar._currentValues;
    var mergedProps = mergePropsStack(StatusBar._propsStack, StatusBar._defaultProps);

    if (Platform.OS === 'ios') {
      if (!oldProps || oldProps.barStyle.value !== mergedProps.barStyle.value) {
        _NativeStatusBarManagerIOS.default.setStyle(mergedProps.barStyle.value, mergedProps.barStyle.animated || false);
      }

      if (!oldProps || oldProps.hidden.value !== mergedProps.hidden.value) {
        _NativeStatusBarManagerIOS.default.setHidden(mergedProps.hidden.value, mergedProps.hidden.animated ? mergedProps.hidden.transition : 'none');
      }

      if (!oldProps || oldProps.networkActivityIndicatorVisible !== mergedProps.networkActivityIndicatorVisible) {
        _NativeStatusBarManagerIOS.default.setNetworkActivityIndicatorVisible(mergedProps.networkActivityIndicatorVisible);
      }
    } else if (Platform.OS === 'android') {
      _NativeStatusBarManagerAndroid.default.setStyle(mergedProps.barStyle.value);

      var processedColor = processColor(mergedProps.backgroundColor.value);

      if (processedColor == null) {
        console.warn("`StatusBar._updatePropsStack`: Color " + mergedProps.backgroundColor.value + " parsed to null or undefined");
      } else {
        invariant(typeof processedColor === 'number', 'Unexpected color given in StatusBar._updatePropsStack');

        _NativeStatusBarManagerAndroid.default.setColor(processedColor, mergedProps.backgroundColor.animated);
      }

      if (!oldProps || oldProps.hidden.value !== mergedProps.hidden.value) {
        _NativeStatusBarManagerAndroid.default.setHidden(mergedProps.hidden.value);
      }

      if (!oldProps || oldProps.translucent !== mergedProps.translucent) {
        _NativeStatusBarManagerAndroid.default.setTranslucent(mergedProps.translucent);
      }
    }

    StatusBar._currentValues = mergedProps;
  });
};

module.exports = StatusBar;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN0YXR1c0Jhci5qcyJdLCJuYW1lcyI6WyJQbGF0Zm9ybSIsInJlcXVpcmUiLCJSZWFjdCIsImludmFyaWFudCIsInByb2Nlc3NDb2xvciIsIm1lcmdlUHJvcHNTdGFjayIsInByb3BzU3RhY2siLCJkZWZhdWx0VmFsdWVzIiwicmVkdWNlIiwicHJldiIsImN1ciIsInByb3AiLCJjcmVhdGVTdGFja0VudHJ5IiwicHJvcHMiLCJiYWNrZ3JvdW5kQ29sb3IiLCJ2YWx1ZSIsImFuaW1hdGVkIiwiYmFyU3R5bGUiLCJ0cmFuc2x1Y2VudCIsImhpZGRlbiIsInRyYW5zaXRpb24iLCJzaG93SGlkZVRyYW5zaXRpb24iLCJuZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlIiwiU3RhdHVzQmFyIiwiX3N0YWNrRW50cnkiLCJwdXNoU3RhY2tFbnRyeSIsInBvcFN0YWNrRW50cnkiLCJyZXBsYWNlU3RhY2tFbnRyeSIsImFuaW1hdGlvbiIsIl9kZWZhdWx0UHJvcHMiLCJPUyIsIk5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJJT1MiLCJzZXRIaWRkZW4iLCJOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZCIsInN0eWxlIiwic2V0U3R5bGUiLCJ2aXNpYmxlIiwiY29uc29sZSIsIndhcm4iLCJzZXROZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlIiwiY29sb3IiLCJwcm9jZXNzZWRDb2xvciIsInNldENvbG9yIiwic2V0VHJhbnNsdWNlbnQiLCJlbnRyeSIsIl9wcm9wc1N0YWNrIiwicHVzaCIsIl91cGRhdGVQcm9wc1N0YWNrIiwiaW5kZXgiLCJpbmRleE9mIiwic3BsaWNlIiwibmV3RW50cnkiLCJDb21wb25lbnQiLCJnZXRDb25zdGFudHMiLCJERUZBVUxUX0JBQ0tHUk9VTkRfQ09MT1IiLCJfdXBkYXRlSW1tZWRpYXRlIiwiX2N1cnJlbnRWYWx1ZXMiLCJjdXJyZW50SGVpZ2h0IiwiSEVJR0hUIiwiZGVmYXVsdFByb3BzIiwiY2xlYXJJbW1lZGlhdGUi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LE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjFDLFNBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAZmxvd1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgUGxhdGZvcm0gPSByZXF1aXJlKCcuLi8uLi9VdGlsaXRpZXMvUGxhdGZvcm0nKTtcbmNvbnN0IFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnaW52YXJpYW50Jyk7XG5jb25zdCBwcm9jZXNzQ29sb3IgPSByZXF1aXJlKCcuLi8uLi9TdHlsZVNoZWV0L3Byb2Nlc3NDb2xvcicpO1xuaW1wb3J0IHR5cGUge0NvbG9yVmFsdWV9IGZyb20gJy4uLy4uL1N0eWxlU2hlZXQvU3R5bGVTaGVldCc7XG5cbmltcG9ydCBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZCBmcm9tICcuL05hdGl2ZVN0YXR1c0Jhck1hbmFnZXJBbmRyb2lkJztcbmltcG9ydCBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VySU9TIGZyb20gJy4vTmF0aXZlU3RhdHVzQmFyTWFuYWdlcklPUyc7XG5cbi8qKlxuICogU3RhdHVzIGJhciBzdHlsZVxuICovXG5leHBvcnQgdHlwZSBTdGF0dXNCYXJTdHlsZSA9ICRLZXlzPHtcbiAgLyoqXG4gICAqIERlZmF1bHQgc3RhdHVzIGJhciBzdHlsZSAoZGFyayBmb3IgaU9TLCBsaWdodCBmb3IgQW5kcm9pZClcbiAgICovXG4gIGRlZmF1bHQ6IHN0cmluZyxcbiAgLyoqXG4gICAqIERhcmsgYmFja2dyb3VuZCwgd2hpdGUgdGV4dHMgYW5kIGljb25zXG4gICAqL1xuICAnbGlnaHQtY29udGVudCc6IHN0cmluZyxcbiAgLyoqXG4gICAqIExpZ2h0IGJhY2tncm91bmQsIGRhcmsgdGV4dHMgYW5kIGljb25zXG4gICAqL1xuICAnZGFyay1jb250ZW50Jzogc3RyaW5nLFxuICAuLi5cbn0+O1xuXG4vKipcbiAqIFN0YXR1cyBiYXIgYW5pbWF0aW9uXG4gKi9cbmV4cG9ydCB0eXBlIFN0YXR1c0JhckFuaW1hdGlvbiA9ICRLZXlzPHtcbiAgLyoqXG4gICAqIE5vIGFuaW1hdGlvblxuICAgKi9cbiAgbm9uZTogc3RyaW5nLFxuICAvKipcbiAgICogRmFkZSBhbmltYXRpb25cbiAgICovXG4gIGZhZGU6IHN0cmluZyxcbiAgLyoqXG4gICAqIFNsaWRlIGFuaW1hdGlvblxuICAgKi9cbiAgc2xpZGU6IHN0cmluZyxcbiAgLi4uXG59PjtcblxudHlwZSBBbmRyb2lkUHJvcHMgPSAkUmVhZE9ubHk8e3xcbiAgLyoqXG4gICAqIFRoZSBiYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBzdGF0dXMgYmFyLlxuICAgKiBAcGxhdGZvcm0gYW5kcm9pZFxuICAgKi9cbiAgYmFja2dyb3VuZENvbG9yPzogP0NvbG9yVmFsdWUsXG4gIC8qKlxuICAgKiBJZiB0aGUgc3RhdHVzIGJhciBpcyB0cmFuc2x1Y2VudC5cbiAgICogV2hlbiB0cmFuc2x1Y2VudCBpcyBzZXQgdG8gdHJ1ZSwgdGhlIGFwcCB3aWxsIGRyYXcgdW5kZXIgdGhlIHN0YXR1cyBiYXIuXG4gICAqIFRoaXMgaXMgdXNlZnVsIHdoZW4gdXNpbmcgYSBzZW1pIHRyYW5zcGFyZW50IHN0YXR1cyBiYXIgY29sb3IuXG4gICAqXG4gICAqIEBwbGF0Zm9ybSBhbmRyb2lkXG4gICAqL1xuICB0cmFuc2x1Y2VudD86ID9ib29sZWFuLFxufH0+O1xuXG50eXBlIElPU1Byb3BzID0gJFJlYWRPbmx5PHt8XG4gIC8qKlxuICAgKiBJZiB0aGUgbmV0d29yayBhY3Rpdml0eSBpbmRpY2F0b3Igc2hvdWxkIGJlIHZpc2libGUuXG4gICAqXG4gICAqIEBwbGF0Zm9ybSBpb3NcbiAgICovXG4gIG5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGU/OiA/Ym9vbGVhbixcbiAgLyoqXG4gICAqIFRoZSB0cmFuc2l0aW9uIGVmZmVjdCB3aGVuIHNob3dpbmcgYW5kIGhpZGluZyB0aGUgc3RhdHVzIGJhciB1c2luZyB0aGUgYGhpZGRlbmBcbiAgICogcHJvcC4gRGVmYXVsdHMgdG8gJ2ZhZGUnLlxuICAgKlxuICAgKiBAcGxhdGZvcm0gaW9zXG4gICAqL1xuICBzaG93SGlkZVRyYW5zaXRpb24/OiA/KCdmYWRlJyB8ICdzbGlkZScgfCAnbm9uZScpLFxufH0+O1xuXG50eXBlIFByb3BzID0gJFJlYWRPbmx5PHt8XG4gIC4uLkFuZHJvaWRQcm9wcyxcbiAgLi4uSU9TUHJvcHMsXG4gIC8qKlxuICAgKiBJZiB0aGUgc3RhdHVzIGJhciBpcyBoaWRkZW4uXG4gICAqL1xuICBoaWRkZW4/OiA/Ym9vbGVhbixcbiAgLyoqXG4gICAqIElmIHRoZSB0cmFuc2l0aW9uIGJldHdlZW4gc3RhdHVzIGJhciBwcm9wZXJ0eSBjaGFuZ2VzIHNob3VsZCBiZSBhbmltYXRlZC5cbiAgICogU3VwcG9ydGVkIGZvciBiYWNrZ3JvdW5kQ29sb3IsIGJhclN0eWxlIGFuZCBoaWRkZW4uXG4gICAqL1xuICBhbmltYXRlZD86ID9ib29sZWFuLFxuICAvKipcbiAgICogU2V0cyB0aGUgY29sb3Igb2YgdGhlIHN0YXR1cyBiYXIgdGV4dC5cbiAgICovXG4gIGJhclN0eWxlPzogPygnZGVmYXVsdCcgfCAnbGlnaHQtY29udGVudCcgfCAnZGFyay1jb250ZW50JyksXG58fT47XG5cbi8qKlxuICogTWVyZ2VzIHRoZSBwcm9wIHN0YWNrIHdpdGggdGhlIGRlZmF1bHQgdmFsdWVzLlxuICovXG5mdW5jdGlvbiBtZXJnZVByb3BzU3RhY2soXG4gIHByb3BzU3RhY2s6IEFycmF5PE9iamVjdD4sXG4gIGRlZmF1bHRWYWx1ZXM6IE9iamVjdCxcbik6IE9iamVjdCB7XG4gIHJldHVybiBwcm9wc1N0YWNrLnJlZHVjZSgocHJldiwgY3VyKSA9PiB7XG4gICAgZm9yIChjb25zdCBwcm9wIGluIGN1cikge1xuICAgICAgaWYgKGN1cltwcm9wXSAhPSBudWxsKSB7XG4gICAgICAgIHByZXZbcHJvcF0gPSBjdXJbcHJvcF07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBwcmV2O1xuICB9LCBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0VmFsdWVzKSk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhbiBvYmplY3QgdG8gaW5zZXJ0IGluIHRoZSBwcm9wcyBzdGFjayBmcm9tIHRoZSBwcm9wc1xuICogYW5kIHRoZSB0cmFuc2l0aW9uL2FuaW1hdGlvbiBpbmZvLlxuICovXG5mdW5jdGlvbiBjcmVhdGVTdGFja0VudHJ5KHByb3BzOiBhbnkpOiBhbnkge1xuICByZXR1cm4ge1xuICAgIGJhY2tncm91bmRDb2xvcjpcbiAgICAgIHByb3BzLmJhY2tncm91bmRDb2xvciAhPSBudWxsXG4gICAgICAgID8ge1xuICAgICAgICAgICAgdmFsdWU6IHByb3BzLmJhY2tncm91bmRDb2xvcixcbiAgICAgICAgICAgIGFuaW1hdGVkOiBwcm9wcy5hbmltYXRlZCxcbiAgICAgICAgICB9XG4gICAgICAgIDogbnVsbCxcbiAgICBiYXJTdHlsZTpcbiAgICAgIHByb3BzLmJhclN0eWxlICE9IG51bGxcbiAgICAgICAgPyB7XG4gICAgICAgICAgICB2YWx1ZTogcHJvcHMuYmFyU3R5bGUsXG4gICAgICAgICAgICBhbmltYXRlZDogcHJvcHMuYW5pbWF0ZWQsXG4gICAgICAgICAgfVxuICAgICAgICA6IG51bGwsXG4gICAgdHJhbnNsdWNlbnQ6IHByb3BzLnRyYW5zbHVjZW50LFxuICAgIGhpZGRlbjpcbiAgICAgIHByb3BzLmhpZGRlbiAhPSBudWxsXG4gICAgICAgID8ge1xuICAgICAgICAgICAgdmFsdWU6IHByb3BzLmhpZGRlbixcbiAgICAgICAgICAgIGFuaW1hdGVkOiBwcm9wcy5hbmltYXRlZCxcbiAgICAgICAgICAgIHRyYW5zaXRpb246IHByb3BzLnNob3dIaWRlVHJhbnNpdGlvbixcbiAgICAgICAgICB9XG4gICAgICAgIDogbnVsbCxcbiAgICBuZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlOiBwcm9wcy5uZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlLFxuICB9O1xufVxuXG4vKipcbiAqIENvbXBvbmVudCB0byBjb250cm9sIHRoZSBhcHAgc3RhdHVzIGJhci5cbiAqXG4gKiAjIyMgVXNhZ2Ugd2l0aCBOYXZpZ2F0b3JcbiAqXG4gKiBJdCBpcyBwb3NzaWJsZSB0byBoYXZlIG11bHRpcGxlIGBTdGF0dXNCYXJgIGNvbXBvbmVudHMgbW91bnRlZCBhdCB0aGUgc2FtZVxuICogdGltZS4gVGhlIHByb3BzIHdpbGwgYmUgbWVyZ2VkIGluIHRoZSBvcmRlciB0aGUgYFN0YXR1c0JhcmAgY29tcG9uZW50cyB3ZXJlXG4gKiBtb3VudGVkLiBPbmUgdXNlIGNhc2UgaXMgdG8gc3BlY2lmeSBzdGF0dXMgYmFyIHN0eWxlcyBwZXIgcm91dGUgdXNpbmcgYE5hdmlnYXRvcmAuXG4gKlxuICogYGBgXG4gKiAgPFZpZXc+XG4gKiAgICA8U3RhdHVzQmFyXG4gKiAgICAgIGJhY2tncm91bmRDb2xvcj1cImJsdWVcIlxuICogICAgICBiYXJTdHlsZT1cImxpZ2h0LWNvbnRlbnRcIlxuICogICAgLz5cbiAqICAgIDxOYXZpZ2F0b3JcbiAqICAgICAgaW5pdGlhbFJvdXRlPXt7c3RhdHVzQmFySGlkZGVuOiB0cnVlfX1cbiAqICAgICAgcmVuZGVyU2NlbmU9eyhyb3V0ZSwgbmF2aWdhdG9yKSA9PlxuICogICAgICAgIDxWaWV3PlxuICogICAgICAgICAgPFN0YXR1c0JhciBoaWRkZW49e3JvdXRlLnN0YXR1c0JhckhpZGRlbn0gLz5cbiAqICAgICAgICAgIC4uLlxuICogICAgICAgIDwvVmlldz5cbiAqICAgICAgfVxuICogICAgLz5cbiAqICA8L1ZpZXc+XG4gKiBgYGBcbiAqXG4gKiAjIyMgSW1wZXJhdGl2ZSBBUElcbiAqXG4gKiBGb3IgY2FzZXMgd2hlcmUgdXNpbmcgYSBjb21wb25lbnQgaXMgbm90IGlkZWFsLCB0aGVyZSBhcmUgc3RhdGljIG1ldGhvZHNcbiAqIHRvIG1hbmlwdWxhdGUgdGhlIGBTdGF0dXNCYXJgIGRpc3BsYXkgc3RhY2suIFRoZXNlIG1ldGhvZHMgaGF2ZSB0aGUgc2FtZVxuICogYmVoYXZpb3IgYXMgbW91bnRpbmcgYW5kIHVubW91bnRpbmcgYSBgU3RhdHVzQmFyYCBjb21wb25lbnQuXG4gKlxuICogRm9yIGV4YW1wbGUsIHlvdSBjYW4gY2FsbCBgU3RhdHVzQmFyLnB1c2hTdGFja0VudHJ5YCB0byB1cGRhdGUgdGhlIHN0YXR1cyBiYXJcbiAqIGJlZm9yZSBsYXVuY2hpbmcgYSB0aGlyZC1wYXJ0eSBuYXRpdmUgVUkgY29tcG9uZW50LCBhbmQgdGhlbiBjYWxsXG4gKiBgU3RhdHVzQmFyLnBvcFN0YWNrRW50cnlgIHdoZW4gY29tcGxldGVkLlxuICpcbiAqIGBgYFxuICogY29uc3Qgb3BlblRoaXJkUGFydHlCdWdSZXBvcnRlciA9IGFzeW5jICgpID0+IHtcbiAqICAgLy8gVGhlIGJ1ZyByZXBvcnRlciBoYXMgYSBkYXJrIGJhY2tncm91bmQsIHNvIHdlIHB1c2ggYSBuZXcgc3RhdHVzIGJhciBzdHlsZS5cbiAqICAgY29uc3Qgc3RhY2tFbnRyeSA9IFN0YXR1c0Jhci5wdXNoU3RhY2tFbnRyeSh7YmFyU3R5bGU6ICdsaWdodC1jb250ZW50J30pO1xuICpcbiAqICAgLy8gYG9wZW5gIHJldHVybnMgYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgVUkgaXMgZGlzbWlzc2VkLlxuICogICBhd2FpdCBCdWdSZXBvcnRlci5vcGVuKCk7XG4gKlxuICogICAvLyBEb24ndCBmb3JnZXQgdG8gY2FsbCBgcG9wU3RhY2tFbnRyeWAgd2hlbiB5b3UncmUgZG9uZS5cbiAqICAgU3RhdHVzQmFyLnBvcFN0YWNrRW50cnkoc3RhY2tFbnRyeSk7XG4gKiB9O1xuICogYGBgXG4gKlxuICogVGhlcmUgaXMgYSBsZWdhY3kgaW1wZXJhdGl2ZSBBUEkgdGhhdCBlbmFibGVzIHlvdSB0byBtYW51YWxseSB1cGRhdGUgdGhlXG4gKiBzdGF0dXMgYmFyIHN0eWxlcy4gSG93ZXZlciwgdGhlIGxlZ2FjeSBBUEkgZG9lcyBub3QgdXBkYXRlIHRoZSBpbnRlcm5hbFxuICogYFN0YXR1c0JhcmAgZGlzcGxheSBzdGFjaywgd2hpY2ggbWVhbnMgdGhhdCBhbnkgY2hhbmdlcyB3aWxsIGJlIG92ZXJyaWRkZW5cbiAqIHdoZW5ldmVyIGEgYFN0YXR1c0JhcmAgY29tcG9uZW50IGlzIG1vdW50ZWQgb3IgdW5tb3VudGVkLlxuICpcbiAqIEl0IGlzIHN0cm9uZ2x5IGFkdmlzZWQgdGhhdCB5b3UgdXNlIGBwdXNoU3RhY2tFbnRyeWAsIGBwb3BTdGFja0VudHJ5YCwgb3JcbiAqIGByZXBsYWNlU3RhY2tFbnRyeWAgaW5zdGVhZCBvZiB0aGUgc3RhdGljIG1ldGhvZHMgYmVnaW5uaW5nIHdpdGggYHNldGAuXG4gKlxuICogIyMjIENvbnN0YW50c1xuICpcbiAqIGBjdXJyZW50SGVpZ2h0YCAoQW5kcm9pZCBvbmx5KSBUaGUgaGVpZ2h0IG9mIHRoZSBzdGF0dXMgYmFyLlxuICovXG5jbGFzcyBTdGF0dXNCYXIgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8UHJvcHM+IHtcbiAgc3RhdGljIF9wcm9wc1N0YWNrID0gW107XG5cbiAgc3RhdGljIF9kZWZhdWx0UHJvcHMgPSBjcmVhdGVTdGFja0VudHJ5KHtcbiAgICBhbmltYXRlZDogZmFsc2UsXG4gICAgc2hvd0hpZGVUcmFuc2l0aW9uOiAnZmFkZScsXG4gICAgYmFja2dyb3VuZENvbG9yOlxuICAgICAgUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJ1xuICAgICAgICA/IE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJBbmRyb2lkLmdldENvbnN0YW50cygpXG4gICAgICAgICAgICAuREVGQVVMVF9CQUNLR1JPVU5EX0NPTE9SID8/ICdibGFjaydcbiAgICAgICAgOiAnYmxhY2snLFxuICAgIGJhclN0eWxlOiAnZGVmYXVsdCcsXG4gICAgdHJhbnNsdWNlbnQ6IGZhbHNlLFxuICAgIGhpZGRlbjogZmFsc2UsXG4gICAgbmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZTogZmFsc2UsXG4gIH0pO1xuXG4gIC8vIFRpbWVyIGZvciB1cGRhdGluZyB0aGUgbmF0aXZlIG1vZHVsZSB2YWx1ZXMgYXQgdGhlIGVuZCBvZiB0aGUgZnJhbWUuXG4gIHN0YXRpYyBfdXBkYXRlSW1tZWRpYXRlID0gbnVsbDtcblxuICAvLyBUaGUgY3VycmVudCBtZXJnZWQgdmFsdWVzIGZyb20gdGhlIHByb3BzIHN0YWNrLlxuICBzdGF0aWMgX2N1cnJlbnRWYWx1ZXMgPSBudWxsO1xuXG4gIC8vIFRPRE8oamFuaWMpOiBQcm92aWRlIGEgcmVhbCBBUEkgdG8gZGVhbCB3aXRoIHN0YXR1cyBiYXIgaGVpZ2h0LiBTZWUgdGhlXG4gIC8vIGRpc2N1c3Npb24gaW4gIzYxOTUuXG4gIC8qKlxuICAgKiBUaGUgY3VycmVudCBoZWlnaHQgb2YgdGhlIHN0YXR1cyBiYXIgb24gdGhlIGRldmljZS5cbiAgICpcbiAgICogQHBsYXRmb3JtIGFuZHJvaWRcbiAgICovXG4gIHN0YXRpYyBjdXJyZW50SGVpZ2h0OiA/bnVtYmVyID1cbiAgICBQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnXG4gICAgICA/IE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJBbmRyb2lkLmdldENvbnN0YW50cygpLkhFSUdIVFxuICAgICAgOiBudWxsO1xuXG4gIC8vIFByb3ZpZGUgYW4gaW1wZXJhdGl2ZSBBUEkgYXMgc3RhdGljIGZ1bmN0aW9ucyBvZiB0aGUgY29tcG9uZW50LlxuICAvLyBTZWUgdGhlIGNvcnJlc3BvbmRpbmcgcHJvcCBmb3IgbW9yZSBkZXRhaWwuXG5cbiAgLyoqXG4gICAqIFNob3cgb3IgaGlkZSB0aGUgc3RhdHVzIGJhclxuICAgKiBAcGFyYW0gaGlkZGVuIEhpZGUgdGhlIHN0YXR1cyBiYXIuXG4gICAqIEBwYXJhbSBhbmltYXRpb24gT3B0aW9uYWwgYW5pbWF0aW9uIHdoZW5cbiAgICogICAgY2hhbmdpbmcgdGhlIHN0YXR1cyBiYXIgaGlkZGVuIHByb3BlcnR5LlxuICAgKi9cbiAgc3RhdGljIHNldEhpZGRlbihoaWRkZW46IGJvb2xlYW4sIGFuaW1hdGlvbj86IFN0YXR1c0JhckFuaW1hdGlvbikge1xuICAgIGFuaW1hdGlvbiA9IGFuaW1hdGlvbiB8fCAnbm9uZSc7XG4gICAgU3RhdHVzQmFyLl9kZWZhdWx0UHJvcHMuaGlkZGVuLnZhbHVlID0gaGlkZGVuO1xuICAgIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2lvcycpIHtcbiAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJJT1Muc2V0SGlkZGVuKGhpZGRlbiwgYW5pbWF0aW9uKTtcbiAgICB9IGVsc2UgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJBbmRyb2lkLnNldEhpZGRlbihoaWRkZW4pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIHN0YXR1cyBiYXIgc3R5bGVcbiAgICogQHBhcmFtIHN0eWxlIFN0YXR1cyBiYXIgc3R5bGUgdG8gc2V0XG4gICAqIEBwYXJhbSBhbmltYXRlZCBBbmltYXRlIHRoZSBzdHlsZSBjaGFuZ2UuXG4gICAqL1xuICBzdGF0aWMgc2V0QmFyU3R5bGUoc3R5bGU6IFN0YXR1c0JhclN0eWxlLCBhbmltYXRlZD86IGJvb2xlYW4pIHtcbiAgICBhbmltYXRlZCA9IGFuaW1hdGVkIHx8IGZhbHNlO1xuICAgIFN0YXR1c0Jhci5fZGVmYXVsdFByb3BzLmJhclN0eWxlLnZhbHVlID0gc3R5bGU7XG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlcklPUy5zZXRTdHlsZShzdHlsZSwgYW5pbWF0ZWQpO1xuICAgIH0gZWxzZSBpZiAoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJykge1xuICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlckFuZHJvaWQuc2V0U3R5bGUoc3R5bGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb250cm9sIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBuZXR3b3JrIGFjdGl2aXR5IGluZGljYXRvclxuICAgKiBAcGFyYW0gdmlzaWJsZSBTaG93IHRoZSBpbmRpY2F0b3IuXG4gICAqL1xuICBzdGF0aWMgc2V0TmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSh2aXNpYmxlOiBib29sZWFuKSB7XG4gICAgaWYgKFBsYXRmb3JtLk9TICE9PSAnaW9zJykge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAnYHNldE5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGVgIGlzIG9ubHkgYXZhaWxhYmxlIG9uIGlPUycsXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBTdGF0dXNCYXIuX2RlZmF1bHRQcm9wcy5uZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlID0gdmlzaWJsZTtcbiAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VySU9TLnNldE5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGUodmlzaWJsZSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBiYWNrZ3JvdW5kIGNvbG9yIGZvciB0aGUgc3RhdHVzIGJhclxuICAgKiBAcGFyYW0gY29sb3IgQmFja2dyb3VuZCBjb2xvci5cbiAgICogQHBhcmFtIGFuaW1hdGVkIEFuaW1hdGUgdGhlIHN0eWxlIGNoYW5nZS5cbiAgICovXG4gIHN0YXRpYyBzZXRCYWNrZ3JvdW5kQ29sb3IoY29sb3I6IHN0cmluZywgYW5pbWF0ZWQ/OiBib29sZWFuKSB7XG4gICAgaWYgKFBsYXRmb3JtLk9TICE9PSAnYW5kcm9pZCcpIHtcbiAgICAgIGNvbnNvbGUud2FybignYHNldEJhY2tncm91bmRDb2xvcmAgaXMgb25seSBhdmFpbGFibGUgb24gQW5kcm9pZCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBhbmltYXRlZCA9IGFuaW1hdGVkIHx8IGZhbHNlO1xuICAgIFN0YXR1c0Jhci5fZGVmYXVsdFByb3BzLmJhY2tncm91bmRDb2xvci52YWx1ZSA9IGNvbG9yO1xuXG4gICAgY29uc3QgcHJvY2Vzc2VkQ29sb3IgPSBwcm9jZXNzQ29sb3IoY29sb3IpO1xuICAgIGlmIChwcm9jZXNzZWRDb2xvciA9PSBudWxsKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBcXGBTdGF0dXNCYXIuc2V0QmFja2dyb3VuZENvbG9yXFxgOiBDb2xvciAke2NvbG9yfSBwYXJzZWQgdG8gbnVsbCBvciB1bmRlZmluZWRgLFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaW52YXJpYW50KFxuICAgICAgdHlwZW9mIHByb2Nlc3NlZENvbG9yID09PSAnbnVtYmVyJyxcbiAgICAgICdVbmV4cGVjdGVkIGNvbG9yIGdpdmVuIGZvciBTdGF0dXNCYXIuc2V0QmFja2dyb3VuZENvbG9yJyxcbiAgICApO1xuXG4gICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlckFuZHJvaWQuc2V0Q29sb3IocHJvY2Vzc2VkQ29sb3IsIGFuaW1hdGVkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb250cm9sIHRoZSB0cmFuc2x1Y2VuY3kgb2YgdGhlIHN0YXR1cyBiYXJcbiAgICogQHBhcmFtIHRyYW5zbHVjZW50IFNldCBhcyB0cmFuc2x1Y2VudC5cbiAgICovXG4gIHN0YXRpYyBzZXRUcmFuc2x1Y2VudCh0cmFuc2x1Y2VudDogYm9vbGVhbikge1xuICAgIGlmIChQbGF0Zm9ybS5PUyAhPT0gJ2FuZHJvaWQnKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ2BzZXRUcmFuc2x1Y2VudGAgaXMgb25seSBhdmFpbGFibGUgb24gQW5kcm9pZCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBTdGF0dXNCYXIuX2RlZmF1bHRQcm9wcy50cmFuc2x1Y2VudCA9IHRyYW5zbHVjZW50O1xuICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJBbmRyb2lkLnNldFRyYW5zbHVjZW50KHRyYW5zbHVjZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQdXNoIGEgU3RhdHVzQmFyIGVudHJ5IG9udG8gdGhlIHN0YWNrLlxuICAgKiBUaGUgcmV0dXJuIHZhbHVlIHNob3VsZCBiZSBwYXNzZWQgdG8gYHBvcFN0YWNrRW50cnlgIHdoZW4gY29tcGxldGUuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyBPYmplY3QgY29udGFpbmluZyB0aGUgU3RhdHVzQmFyIHByb3BzIHRvIHVzZSBpbiB0aGUgc3RhY2sgZW50cnkuXG4gICAqL1xuICBzdGF0aWMgcHVzaFN0YWNrRW50cnkocHJvcHM6IGFueSk6IGFueSB7XG4gICAgY29uc3QgZW50cnkgPSBjcmVhdGVTdGFja0VudHJ5KHByb3BzKTtcbiAgICBTdGF0dXNCYXIuX3Byb3BzU3RhY2sucHVzaChlbnRyeSk7XG4gICAgU3RhdHVzQmFyLl91cGRhdGVQcm9wc1N0YWNrKCk7XG4gICAgcmV0dXJuIGVudHJ5O1xuICB9XG5cbiAgLyoqXG4gICAqIFBvcCBhIFN0YXR1c0JhciBlbnRyeSBmcm9tIHRoZSBzdGFjay5cbiAgICpcbiAgICogQHBhcmFtIGVudHJ5IEVudHJ5IHJldHVybmVkIGZyb20gYHB1c2hTdGFja0VudHJ5YC5cbiAgICovXG4gIHN0YXRpYyBwb3BTdGFja0VudHJ5KGVudHJ5OiBhbnkpIHtcbiAgICBjb25zdCBpbmRleCA9IFN0YXR1c0Jhci5fcHJvcHNTdGFjay5pbmRleE9mKGVudHJ5KTtcbiAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICBTdGF0dXNCYXIuX3Byb3BzU3RhY2suc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG4gICAgU3RhdHVzQmFyLl91cGRhdGVQcm9wc1N0YWNrKCk7XG4gIH1cblxuICAvKipcbiAgICogUmVwbGFjZSBhbiBleGlzdGluZyBTdGF0dXNCYXIgc3RhY2sgZW50cnkgd2l0aCBuZXcgcHJvcHMuXG4gICAqXG4gICAqIEBwYXJhbSBlbnRyeSBFbnRyeSByZXR1cm5lZCBmcm9tIGBwdXNoU3RhY2tFbnRyeWAgdG8gcmVwbGFjZS5cbiAgICogQHBhcmFtIHByb3BzIE9iamVjdCBjb250YWluaW5nIHRoZSBTdGF0dXNCYXIgcHJvcHMgdG8gdXNlIGluIHRoZSByZXBsYWNlbWVudCBzdGFjayBlbnRyeS5cbiAgICovXG4gIHN0YXRpYyByZXBsYWNlU3RhY2tFbnRyeShlbnRyeTogYW55LCBwcm9wczogYW55KTogYW55IHtcbiAgICBjb25zdCBuZXdFbnRyeSA9IGNyZWF0ZVN0YWNrRW50cnkocHJvcHMpO1xuICAgIGNvbnN0IGluZGV4ID0gU3RhdHVzQmFyLl9wcm9wc1N0YWNrLmluZGV4T2YoZW50cnkpO1xuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgIFN0YXR1c0Jhci5fcHJvcHNTdGFja1tpbmRleF0gPSBuZXdFbnRyeTtcbiAgICB9XG4gICAgU3RhdHVzQmFyLl91cGRhdGVQcm9wc1N0YWNrKCk7XG4gICAgcmV0dXJuIG5ld0VudHJ5O1xuICB9XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wczoge3xcbiAgICBhbmltYXRlZDogYm9vbGVhbixcbiAgICBzaG93SGlkZVRyYW5zaXRpb246ICRURU1QT1JBUlkkc3RyaW5nPCdmYWRlJz4sXG4gIHx9ID0ge1xuICAgIGFuaW1hdGVkOiBmYWxzZSxcbiAgICBzaG93SGlkZVRyYW5zaXRpb246ICdmYWRlJyxcbiAgfTtcblxuICBfc3RhY2tFbnRyeSA9IG51bGw7XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgLy8gRXZlcnkgdGltZSBhIFN0YXR1c0JhciBjb21wb25lbnQgaXMgbW91bnRlZCwgd2UgcHVzaCBpdCdzIHByb3AgdG8gYSBzdGFja1xuICAgIC8vIGFuZCBhbHdheXMgdXBkYXRlIHRoZSBuYXRpdmUgc3RhdHVzIGJhciB3aXRoIHRoZSBwcm9wcyBmcm9tIHRoZSB0b3Agb2YgdGhlblxuICAgIC8vIHN0YWNrLiBUaGlzIGFsbG93cyBoYXZpbmcgbXVsdGlwbGUgU3RhdHVzQmFyIGNvbXBvbmVudHMgYW5kIHRoZSBvbmUgdGhhdCBpc1xuICAgIC8vIGFkZGVkIGxhc3Qgb3IgaXMgZGVlcGVyIGluIHRoZSB2aWV3IGhpZXJhcmNoeSB3aWxsIGhhdmUgcHJpb3JpdHkuXG4gICAgdGhpcy5fc3RhY2tFbnRyeSA9IFN0YXR1c0Jhci5wdXNoU3RhY2tFbnRyeSh0aGlzLnByb3BzKTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIC8vIFdoZW4gYSBTdGF0dXNCYXIgaXMgdW5tb3VudGVkLCByZW1vdmUgaXRzZWxmIGZyb20gdGhlIHN0YWNrIGFuZCB1cGRhdGVcbiAgICAvLyB0aGUgbmF0aXZlIGJhciB3aXRoIHRoZSBuZXh0IHByb3BzLlxuICAgIFN0YXR1c0Jhci5wb3BTdGFja0VudHJ5KHRoaXMuX3N0YWNrRW50cnkpO1xuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgIHRoaXMuX3N0YWNrRW50cnkgPSBTdGF0dXNCYXIucmVwbGFjZVN0YWNrRW50cnkoXG4gICAgICB0aGlzLl9zdGFja0VudHJ5LFxuICAgICAgdGhpcy5wcm9wcyxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIG5hdGl2ZSBzdGF0dXMgYmFyIHdpdGggdGhlIHByb3BzIGZyb20gdGhlIHN0YWNrLlxuICAgKi9cbiAgc3RhdGljIF91cGRhdGVQcm9wc1N0YWNrID0gKCkgPT4ge1xuICAgIC8vIFNlbmQgdGhlIHVwZGF0ZSB0byB0aGUgbmF0aXZlIG1vZHVsZSBvbmx5IG9uY2UgYXQgdGhlIGVuZCBvZiB0aGUgZnJhbWUuXG4gICAgY2xlYXJJbW1lZGlhdGUoU3RhdHVzQmFyLl91cGRhdGVJbW1lZGlhdGUpO1xuICAgIFN0YXR1c0Jhci5fdXBkYXRlSW1tZWRpYXRlID0gc2V0SW1tZWRpYXRlKCgpID0+IHtcbiAgICAgIGNvbnN0IG9sZFByb3BzID0gU3RhdHVzQmFyLl9jdXJyZW50VmFsdWVzO1xuICAgICAgY29uc3QgbWVyZ2VkUHJvcHMgPSBtZXJnZVByb3BzU3RhY2soXG4gICAgICAgIFN0YXR1c0Jhci5fcHJvcHNTdGFjayxcbiAgICAgICAgU3RhdHVzQmFyLl9kZWZhdWx0UHJvcHMsXG4gICAgICApO1xuXG4gICAgICAvLyBVcGRhdGUgdGhlIHByb3BzIHRoYXQgaGF2ZSBjaGFuZ2VkIHVzaW5nIHRoZSBtZXJnZWQgdmFsdWVzIGZyb20gdGhlIHByb3BzIHN0YWNrLlxuICAgICAgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgIW9sZFByb3BzIHx8XG4gICAgICAgICAgb2xkUHJvcHMuYmFyU3R5bGUudmFsdWUgIT09IG1lcmdlZFByb3BzLmJhclN0eWxlLnZhbHVlXG4gICAgICAgICkge1xuICAgICAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJJT1Muc2V0U3R5bGUoXG4gICAgICAgICAgICBtZXJnZWRQcm9wcy5iYXJTdHlsZS52YWx1ZSxcbiAgICAgICAgICAgIG1lcmdlZFByb3BzLmJhclN0eWxlLmFuaW1hdGVkIHx8IGZhbHNlLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFvbGRQcm9wcyB8fCBvbGRQcm9wcy5oaWRkZW4udmFsdWUgIT09IG1lcmdlZFByb3BzLmhpZGRlbi52YWx1ZSkge1xuICAgICAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJJT1Muc2V0SGlkZGVuKFxuICAgICAgICAgICAgbWVyZ2VkUHJvcHMuaGlkZGVuLnZhbHVlLFxuICAgICAgICAgICAgbWVyZ2VkUHJvcHMuaGlkZGVuLmFuaW1hdGVkXG4gICAgICAgICAgICAgID8gbWVyZ2VkUHJvcHMuaGlkZGVuLnRyYW5zaXRpb25cbiAgICAgICAgICAgICAgOiAnbm9uZScsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAhb2xkUHJvcHMgfHxcbiAgICAgICAgICBvbGRQcm9wcy5uZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlICE9PVxuICAgICAgICAgICAgbWVyZ2VkUHJvcHMubmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZVxuICAgICAgICApIHtcbiAgICAgICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VySU9TLnNldE5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGUoXG4gICAgICAgICAgICBtZXJnZWRQcm9wcy5uZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJykge1xuICAgICAgICAvL3RvZG8oVDYwNjg0Nzg3KTogQWRkIGJhY2sgb3B0aW1pemF0aW9uIHRvIG9ubHkgdXBkYXRlIGJhciBzdHlsZSBhbmRcbiAgICAgICAgLy9iYWNrZ3JvdW5kIGNvbG9yIGlmIHRoZSBuZXcgdmFsdWUgaXMgZGlmZmVyZW50IGZyb20gdGhlIG9sZCB2YWx1ZS5cbiAgICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlckFuZHJvaWQuc2V0U3R5bGUobWVyZ2VkUHJvcHMuYmFyU3R5bGUudmFsdWUpO1xuICAgICAgICBjb25zdCBwcm9jZXNzZWRDb2xvciA9IHByb2Nlc3NDb2xvcihtZXJnZWRQcm9wcy5iYWNrZ3JvdW5kQ29sb3IudmFsdWUpO1xuICAgICAgICBpZiAocHJvY2Vzc2VkQ29sb3IgPT0gbnVsbCkge1xuICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgIGBcXGBTdGF0dXNCYXIuX3VwZGF0ZVByb3BzU3RhY2tcXGA6IENvbG9yICR7bWVyZ2VkUHJvcHMuYmFja2dyb3VuZENvbG9yLnZhbHVlfSBwYXJzZWQgdG8gbnVsbCBvciB1bmRlZmluZWRgLFxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaW52YXJpYW50KFxuICAgICAgICAgICAgdHlwZW9mIHByb2Nlc3NlZENvbG9yID09PSAnbnVtYmVyJyxcbiAgICAgICAgICAgICdVbmV4cGVjdGVkIGNvbG9yIGdpdmVuIGluIFN0YXR1c0Jhci5fdXBkYXRlUHJvcHNTdGFjaycsXG4gICAgICAgICAgKTtcbiAgICAgICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZC5zZXRDb2xvcihcbiAgICAgICAgICAgIHByb2Nlc3NlZENvbG9yLFxuICAgICAgICAgICAgbWVyZ2VkUHJvcHMuYmFja2dyb3VuZENvbG9yLmFuaW1hdGVkLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFvbGRQcm9wcyB8fCBvbGRQcm9wcy5oaWRkZW4udmFsdWUgIT09IG1lcmdlZFByb3BzLmhpZGRlbi52YWx1ZSkge1xuICAgICAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJBbmRyb2lkLnNldEhpZGRlbihtZXJnZWRQcm9wcy5oaWRkZW4udmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb2xkUHJvcHMgfHwgb2xkUHJvcHMudHJhbnNsdWNlbnQgIT09IG1lcmdlZFByb3BzLnRyYW5zbHVjZW50KSB7XG4gICAgICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlckFuZHJvaWQuc2V0VHJhbnNsdWNlbnQobWVyZ2VkUHJvcHMudHJhbnNsdWNlbnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBVcGRhdGUgdGhlIGN1cnJlbnQgcHJvcCB2YWx1ZXMuXG4gICAgICBTdGF0dXNCYXIuX2N1cnJlbnRWYWx1ZXMgPSBtZXJnZWRQcm9wcztcbiAgICB9KTtcbiAgfTtcblxuICByZW5kZXIoKTogUmVhY3QuTm9kZSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBTdGF0dXNCYXI7XG4iXX0=