677f1f7ed8d30efed4649b745d7eee10
'use strict';

function _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

var TEMPLATE_REGEX = /(?:\\(u[a-f\d]{4}|x[a-f\d]{2}|.))|(?:\{(~)?(\w+(?:\([^)]*\))?(?:\.\w+(?:\([^)]*\))?)*)(?:[ \t]|(?=\r?\n)))|(\})|((?:.|[\r\n\f])+?)/gi;
var STYLE_REGEX = /(?:^|\.)(\w+)(?:\(([^)]*)\))?/g;
var STRING_REGEX = /^(['"])((?:\\.|(?!\1)[^\\])*)\1$/;
var ESCAPE_REGEX = /\\(u[a-f\d]{4}|x[a-f\d]{2}|.)|([^\\])/gi;
var ESCAPES = new Map([['n', '\n'], ['r', '\r'], ['t', '\t'], ['b', '\b'], ['f', '\f'], ['v', '\v'], ['0', '\0'], ['\\', '\\'], ['e', "\x1B"], ['a', "\x07"]]);

function unescape(c) {
  if (c[0] === 'u' && c.length === 5 || c[0] === 'x' && c.length === 3) {
    return String.fromCharCode(parseInt(c.slice(1), 16));
  }

  return ESCAPES.get(c) || c;
}

function parseArguments(name, args) {
  var results = [];
  var chunks = args.trim().split(/\s*,\s*/g);
  var matches;

  for (var _iterator = _createForOfIteratorHelperLoose(chunks), _step; !(_step = _iterator()).done;) {
    var chunk = _step.value;

    if (!isNaN(chunk)) {
      results.push(Number(chunk));
    } else if (matches = chunk.match(STRING_REGEX)) {
      results.push(matches[2].replace(ESCAPE_REGEX, function (m, escape, chr) {
        return escape ? unescape(escape) : chr;
      }));
    } else {
      throw new Error("Invalid Chalk template style argument: " + chunk + " (in style '" + name + "')");
    }
  }

  return results;
}

function parseStyle(style) {
  STYLE_REGEX.lastIndex = 0;
  var results = [];
  var matches;

  while ((matches = STYLE_REGEX.exec(style)) !== null) {
    var name = matches[1];

    if (matches[2]) {
      var args = parseArguments(name, matches[2]);
      results.push([name].concat(args));
    } else {
      results.push([name]);
    }
  }

  return results;
}

function buildStyle(chalk, styles) {
  var enabled = {};

  for (var _iterator2 = _createForOfIteratorHelperLoose(styles), _step2; !(_step2 = _iterator2()).done;) {
    var layer = _step2.value;

    for (var _iterator3 = _createForOfIteratorHelperLoose(layer.styles), _step3; !(_step3 = _iterator3()).done;) {
      var style = _step3.value;
      enabled[style[0]] = layer.inverse ? null : style.slice(1);
    }
  }

  var current = chalk;

  for (var _i = 0, _Object$keys = Object.keys(enabled); _i < _Object$keys.length; _i++) {
    var styleName = _Object$keys[_i];

    if (Array.isArray(enabled[styleName])) {
      if (!(styleName in current)) {
        throw new Error("Unknown Chalk style: " + styleName);
      }

      if (enabled[styleName].length > 0) {
        current = current[styleName].apply(current, enabled[styleName]);
      } else {
        current = current[styleName];
      }
    }
  }

  return current;
}

module.exports = function (chalk, tmp) {
  var styles = [];
  var chunks = [];
  var chunk = [];
  tmp.replace(TEMPLATE_REGEX, function (m, escapeChar, inverse, style, close, chr) {
    if (escapeChar) {
      chunk.push(unescape(escapeChar));
    } else if (style) {
      var str = chunk.join('');
      chunk = [];
      chunks.push(styles.length === 0 ? str : buildStyle(chalk, styles)(str));
      styles.push({
        inverse: inverse,
        styles: parseStyle(style)
      });
    } else if (close) {
      if (styles.length === 0) {
        throw new Error('Found extraneous } in Chalk template literal');
      }

      chunks.push(buildStyle(chalk, styles)(chunk.join('')));
      chunk = [];
      styles.pop();
    } else {
      chunk.push(chr);
    }
  });
  chunks.push(chunk.join(''));

  if (styles.length > 0) {
    var errMsg = "Chalk template literal is missing " + styles.length + " closing bracket" + (styles.length === 1 ? '' : 's') + " (`}`)";
    throw new Error(errMsg);
  }

  return chunks.join('');
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlbXBsYXRlcy5qcyJdLCJuYW1lcyI6WyJURU1QTEFURV9SRUdFWCIsIlNUWUxFX1JFR0VYIiwiU1RSSU5HX1JFR0VYIiwiRVNDQVBFX1JFR0VYIiwiRVNDQVBFUyIsIk1hcCIsInVuZXNjYXBlIiwiYyIsImxlbmd0aCIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsInBhcnNlSW50Iiwic2xpY2UiLCJnZXQiLCJwYXJzZUFyZ3VtZW50cyIsIm5hbWUiLCJhcmdzIiwicmVzdWx0cyIsImNodW5rcyIsInRyaW0iLCJzcGxpdCIsIm1hdGNoZXMiLCJjaHVuayIsImlzTmFOIiwicHVzaCIsIk51bWJlciIsIm1hdGNoIiwicmVwbGFjZSIsIm0iLCJlc2NhcGUiLCJjaHIiLCJFcnJvciIsInBhcnNlU3R5bGUiLCJzdHlsZSIsImxhc3RJbmRleCIsImV4ZWMiLCJjb25jYXQiLCJidWlsZFN0eWxlIiwiY2hhbGsiLCJzdHlsZXMiLCJlbmFibGVkIiwibGF5ZXIiLCJpbnZlcnNlIiwiY3VycmVudCIsIk9iamVjdCIsImtleXMiLCJzdHlsZU5hbWUiLCJBcnJheSIsImlzQXJyYXkiLCJhcHBseSIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0bXAiLCJlc2NhcGVDaGFyIiwiY2xvc2UiLCJzdHIiLCJqb2luIiwicG9wIiwiZXJyTXNnIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7QUFDQSxJQUFNQSxjQUFjLEdBQUcsc0lBQXZCO0FBQ0EsSUFBTUMsV0FBVyxHQUFHLGdDQUFwQjtBQUNBLElBQU1DLFlBQVksR0FBRyxrQ0FBckI7QUFDQSxJQUFNQyxZQUFZLEdBQUcseUNBQXJCO0FBRUEsSUFBTUMsT0FBTyxHQUFHLElBQUlDLEdBQUosQ0FBUSxDQUN2QixDQUFDLEdBQUQsRUFBTSxJQUFOLENBRHVCLEVBRXZCLENBQUMsR0FBRCxFQUFNLElBQU4sQ0FGdUIsRUFHdkIsQ0FBQyxHQUFELEVBQU0sSUFBTixDQUh1QixFQUl2QixDQUFDLEdBQUQsRUFBTSxJQUFOLENBSnVCLEVB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a0IsR0FBUDtBQUNBLEtBUk0sTUFRQTtBQUNObkMsTUFBQUEsS0FBSyxDQUFDRSxJQUFOLENBQVdNLEdBQVg7QUFDQTtBQUNELEdBbkJEO0FBcUJBWixFQUFBQSxNQUFNLENBQUNNLElBQVAsQ0FBWUYsS0FBSyxDQUFDa0MsSUFBTixDQUFXLEVBQVgsQ0FBWjs7QUFFQSxNQUFJakIsTUFBTSxDQUFDL0IsTUFBUCxHQUFnQixDQUFwQixFQUF1QjtBQUN0QixRQUFNa0QsTUFBTSwwQ0FBd0NuQixNQUFNLENBQUMvQixNQUEvQyx5QkFBd0UrQixNQUFNLENBQUMvQixNQUFQLEtBQWtCLENBQWxCLEdBQXNCLEVBQXRCLEdBQTJCLEdBQW5HLFlBQVo7QUFDQSxVQUFNLElBQUl1QixLQUFKLENBQVUyQixNQUFWLENBQU47QUFDQTs7QUFFRCxTQUFPeEMsTUFBTSxDQUFDc0MsSUFBUCxDQUFZLEVBQVosQ0FBUDtBQUNBLENBbkNEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuY29uc3QgVEVNUExBVEVfUkVHRVggPSAvKD86XFxcXCh1W2EtZlxcZF17NH18eFthLWZcXGRdezJ9fC4pKXwoPzpcXHsofik/KFxcdysoPzpcXChbXildKlxcKSk/KD86XFwuXFx3Kyg/OlxcKFteKV0qXFwpKT8pKikoPzpbIFxcdF18KD89XFxyP1xcbikpKXwoXFx9KXwoKD86LnxbXFxyXFxuXFxmXSkrPykvZ2k7XG5jb25zdCBTVFlMRV9SRUdFWCA9IC8oPzpefFxcLikoXFx3KykoPzpcXCgoW14pXSopXFwpKT8vZztcbmNvbnN0IFNUUklOR19SRUdFWCA9IC9eKFsnXCJdKSgoPzpcXFxcLnwoPyFcXDEpW15cXFxcXSkqKVxcMSQvO1xuY29uc3QgRVNDQVBFX1JFR0VYID0gL1xcXFwodVthLWZcXGRdezR9fHhbYS1mXFxkXXsyfXwuKXwoW15cXFxcXSkvZ2k7XG5cbmNvbnN0IEVTQ0FQRVMgPSBuZXcgTWFwKFtcblx0WyduJywgJ1xcbiddLFxuXHRbJ3InLCAnXFxyJ10sXG5cdFsndCcsICdcXHQnXSxcblx0WydiJywgJ1xcYiddLFxuXHRbJ2YnLCAnXFxmJ10sXG5cdFsndicsICdcXHYnXSxcblx0WycwJywgJ1xcMCddLFxuXHRbJ1xcXFwnLCAnXFxcXCddLFxuXHRbJ2UnLCAnXFx1MDAxQiddLFxuXHRbJ2EnLCAnXFx1MDAwNyddXG5dKTtcblxuZnVuY3Rpb24gdW5lc2NhcGUoYykge1xuXHRpZiAoKGNbMF0gPT09ICd1JyAmJiBjLmxlbmd0aCA9PT0gNSkgfHwgKGNbMF0gPT09ICd4JyAmJiBjLmxlbmd0aCA9PT0gMykpIHtcblx0XHRyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShwYXJzZUludChjLnNsaWNlKDEpLCAxNikpO1xuXHR9XG5cblx0cmV0dXJuIEVTQ0FQRVMuZ2V0KGMpIHx8IGM7XG59XG5cbmZ1bmN0aW9uIHBhcnNlQXJndW1lbnRzKG5hbWUsIGFyZ3MpIHtcblx0Y29uc3QgcmVzdWx0cyA9IFtdO1xuXHRjb25zdCBjaHVua3MgPSBhcmdzLnRyaW0oKS5zcGxpdCgvXFxzKixcXHMqL2cpO1xuXHRsZXQgbWF0Y2hlcztcblxuXHRmb3IgKGNvbnN0IGNodW5rIG9mIGNodW5rcykge1xuXHRcdGlmICghaXNOYU4oY2h1bmspKSB7XG5cdFx0XHRyZXN1bHRzLnB1c2goTnVtYmVyKGNodW5rKSk7XG5cdFx0fSBlbHNlIGlmICgobWF0Y2hlcyA9IGNodW5rLm1hdGNoKFNUUklOR19SRUdFWCkpKSB7XG5cdFx0XHRyZXN1bHRzLnB1c2gobWF0Y2hlc1syXS5yZXBsYWNlKEVTQ0FQRV9SRUdFWCwgKG0sIGVzY2FwZSwgY2hyKSA9PiBlc2NhcGUgPyB1bmVzY2FwZShlc2NhcGUpIDogY2hyKSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBDaGFsayB0ZW1wbGF0ZSBzdHlsZSBhcmd1bWVudDogJHtjaHVua30gKGluIHN0eWxlICcke25hbWV9JylgKTtcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gcmVzdWx0cztcbn1cblxuZnVuY3Rpb24gcGFyc2VTdHlsZShzdHlsZSkge1xuXHRTVFlMRV9SRUdFWC5sYXN0SW5kZXggPSAwO1xuXG5cdGNvbnN0IHJlc3VsdHMgPSBbXTtcblx0bGV0IG1hdGNoZXM7XG5cblx0d2hpbGUgKChtYXRjaGVzID0gU1RZTEVfUkVHRVguZXhlYyhzdHlsZSkpICE9PSBudWxsKSB7XG5cdFx0Y29uc3QgbmFtZSA9IG1hdGNoZXNbMV07XG5cblx0XHRpZiAobWF0Y2hlc1syXSkge1xuXHRcdFx0Y29uc3QgYXJncyA9IHBhcnNlQXJndW1lbnRzKG5hbWUsIG1hdGNoZXNbMl0pO1xuXHRcdFx0cmVzdWx0cy5wdXNoKFtuYW1lXS5jb25jYXQoYXJncykpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXN1bHRzLnB1c2goW25hbWVdKTtcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gcmVzdWx0cztcbn1cblxuZnVuY3Rpb24gYnVpbGRTdHlsZShjaGFsaywgc3R5bGVzKSB7XG5cdGNvbnN0IGVuYWJsZWQgPSB7fTtcblxuXHRmb3IgKGNvbnN0IGxheWVyIG9mIHN0eWxlcykge1xuXHRcdGZvciAoY29uc3Qgc3R5bGUgb2YgbGF5ZXIuc3R5bGVzKSB7XG5cdFx0XHRlbmFibGVkW3N0eWxlWzBdXSA9IGxheWVyLmludmVyc2UgPyBudWxsIDogc3R5bGUuc2xpY2UoMSk7XG5cdFx0fVxuXHR9XG5cblx0bGV0IGN1cnJlbnQgPSBjaGFsaztcblx0Zm9yIChjb25zdCBzdHlsZU5hbWUgb2YgT2JqZWN0LmtleXMoZW5hYmxlZCkpIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShlbmFibGVkW3N0eWxlTmFtZV0pKSB7XG5cdFx0XHRpZiAoIShzdHlsZU5hbWUgaW4gY3VycmVudCkpIHtcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGBVbmtub3duIENoYWxrIHN0eWxlOiAke3N0eWxlTmFtZX1gKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGVuYWJsZWRbc3R5bGVOYW1lXS5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdGN1cnJlbnQgPSBjdXJyZW50W3N0eWxlTmFtZV0uYXBwbHkoY3VycmVudCwgZW5hYmxlZFtzdHlsZU5hbWVdKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGN1cnJlbnQgPSBjdXJyZW50W3N0eWxlTmFtZV07XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIGN1cnJlbnQ7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gKGNoYWxrLCB0bXApID0+IHtcblx0Y29uc3Qgc3R5bGVzID0gW107XG5cdGNvbnN0IGNodW5rcyA9IFtdO1xuXHRsZXQgY2h1bmsgPSBbXTtcblxuXHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuXHR0bXAucmVwbGFjZShURU1QTEFURV9SRUdFWCwgKG0sIGVzY2FwZUNoYXIsIGludmVyc2UsIHN0eWxlLCBjbG9zZSwgY2hyKSA9PiB7XG5cdFx0aWYgKGVzY2FwZUNoYXIpIHtcblx0XHRcdGNodW5rLnB1c2godW5lc2NhcGUoZXNjYXBlQ2hhcikpO1xuXHRcdH0gZWxzZSBpZiAoc3R5bGUpIHtcblx0XHRcdGNvbnN0IHN0ciA9IGNodW5rLmpvaW4oJycpO1xuXHRcdFx0Y2h1bmsgPSBbXTtcblx0XHRcdGNodW5rcy5wdXNoKHN0eWxlcy5sZW5ndGggPT09IDAgPyBzdHIgOiBidWlsZFN0eWxlKGNoYWxrLCBzdHlsZXMpKHN0cikpO1xuXHRcdFx0c3R5bGVzLnB1c2goe2ludmVyc2UsIHN0eWxlczogcGFyc2VTdHlsZShzdHlsZSl9KTtcblx0XHR9IGVsc2UgaWYgKGNsb3NlKSB7XG5cdFx0XHRpZiAoc3R5bGVzLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ0ZvdW5kIGV4dHJhbmVvdXMgfSBpbiBDaGFsayB0ZW1wbGF0ZSBsaXRlcmFsJyk7XG5cdFx0XHR9XG5cblx0XHRcdGNodW5rcy5wdXNoKGJ1aWxkU3R5bGUoY2hhbGssIHN0eWxlcykoY2h1bmsuam9pbignJykpKTtcblx0XHRcdGNodW5rID0gW107XG5cdFx0XHRzdHlsZXMucG9wKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNodW5rLnB1c2goY2hyKTtcblx0XHR9XG5cdH0pO1xuXG5cdGNodW5rcy5wdXNoKGNodW5rLmpvaW4oJycpKTtcblxuXHRpZiAoc3R5bGVzLmxlbmd0aCA+IDApIHtcblx0XHRjb25zdCBlcnJNc2cgPSBgQ2hhbGsgdGVtcGxhdGUgbGl0ZXJhbCBpcyBtaXNzaW5nICR7c3R5bGVzLmxlbmd0aH0gY2xvc2luZyBicmFja2V0JHtzdHlsZXMubGVuZ3RoID09PSAxID8gJycgOiAncyd9IChcXGB9XFxgKWA7XG5cdFx0dGhyb3cgbmV3IEVycm9yKGVyck1zZyk7XG5cdH1cblxuXHRyZXR1cm4gY2h1bmtzLmpvaW4oJycpO1xufTtcbiJdfQ==