677bf1888dc3ba64d33f272a57b6f793
var _includes = require("./_includes");

var _Set = function () {
  function _Set() {
    this._nativeSet = typeof Set === 'function' ? new Set() : null;
    this._items = {};
  }

  _Set.prototype.add = function (item) {
    return !hasOrAdd(item, true, this);
  };

  _Set.prototype.has = function (item) {
    return hasOrAdd(item, false, this);
  };

  return _Set;
}();

function hasOrAdd(item, shouldAdd, set) {
  var type = typeof item;
  var prevSize, newSize;

  switch (type) {
    case 'string':
    case 'number':
      if (item === 0 && 1 / item === -Infinity) {
        if (set._items['-0']) {
          return true;
        } else {
          if (shouldAdd) {
            set._items['-0'] = true;
          }

          return false;
        }
      }

      if (set._nativeSet !== null) {
        if (shouldAdd) {
          prevSize = set._nativeSet.size;

          set._nativeSet.add(item);

          newSize = set._nativeSet.size;
          return newSize === prevSize;
        } else {
          return set._nativeSet.has(item);
        }
      } else {
        if (!(type in set._items)) {
          if (shouldAdd) {
            set._items[type] = {};
            set._items[type][item] = true;
          }

          return false;
        } else if (item in set._items[type]) {
          return true;
        } else {
          if (shouldAdd) {
            set._items[type][item] = true;
          }

          return false;
        }
      }

    case 'boolean':
      if (type in set._items) {
        var bIdx = item ? 1 : 0;

        if (set._items[type][bIdx]) {
          return true;
        } else {
          if (shouldAdd) {
            set._items[type][bIdx] = true;
          }

          return false;
        }
      } else {
        if (shouldAdd) {
          set._items[type] = item ? [false, true] : [true, false];
        }

        return false;
      }

    case 'function':
      if (set._nativeSet !== null) {
        if (shouldAdd) {
          prevSize = set._nativeSet.size;

          set._nativeSet.add(item);

          newSize = set._nativeSet.size;
          return newSize === prevSize;
        } else {
          return set._nativeSet.has(item);
        }
      } else {
        if (!(type in set._items)) {
          if (shouldAdd) {
            set._items[type] = [item];
          }

          return false;
        }

        if (!_includes(item, set._items[type])) {
          if (shouldAdd) {
            set._items[type].push(item);
          }

          return false;
        }

        return true;
      }

    case 'undefined':
      if (set._items[type]) {
        return true;
      } else {
        if (shouldAdd) {
          set._items[type] = true;
        }

        return false;
      }

    case 'object':
      if (item === null) {
        if (!set._items['null']) {
          if (shouldAdd) {
            set._items['null'] = true;
          }

          return false;
        }

        return true;
      }

    default:
      type = Object.prototype.toString.call(item);

      if (!(type in set._items)) {
        if (shouldAdd) {
          set._items[type] = [item];
        }

        return false;
      }

      if (!_includes(item, set._items[type])) {
        if (shouldAdd) {
          set._items[type].push(item);
        }

        return false;
      }

      return true;
  }
}

module.exports = _Set;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9TZXQuanMiXSwibmFtZXMiOlsiX2luY2x1ZGVzIiwicmVxdWlyZSIsIl9TZXQiLCJfbmF0aXZlU2V0IiwiU2V0IiwiX2l0ZW1zIiwicHJvdG90eXBlIiwiYWRkIiwiaXRlbSIsImhhc09yQWRkIiwiaGFzIiwic2hvdWxkQWRkIiwic2V0IiwidHlwZSIsInByZXZTaXplIiwibmV3U2l6ZSIsIkluZmluaXR5Iiwic2l6ZSIsImJJZHgiLCJwdXNoIiwiT2JqZWN0IiwidG9TdHJpbmciLCJjYWxsIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsU0FBUyxHQUFnQkMsT0FBTyxlQUFwQzs7QUFFQSxJQUFJQyxJQUFJLEdBQWdCLFlBQVk7QUFFbEMsV0FBU0EsSUFBVCxHQUFnQjtBQUVkLFNBQUtDLFVBQUwsR0FBa0IsT0FBT0MsR0FBUCxLQUFlLFVBQWYsR0FBNEIsSUFBSUEsR0FBSixFQUE1QixHQUF3QyxJQUExRDtBQUNBLFNBQUtDLE1BQUwsR0FBYyxFQUFkO0FBQ0Q7O0FBTURILEVBQUFBLElBQUksQ0FBQ0ksU0FBTCxDQUFlQyxHQUFmLEdBQXFCLFVBQVVDLElBQVYsRUFBZ0I7QUFDbkMsV0FBTyxDQUFDQyxRQUFRLENBQUNELElBQUQsRUFBTyxJQUFQLEVBQWEsSUFBYixDQUFoQjtBQUNELEdBRkQ7O0FBUUFOLEVBQUFBLElBQUksQ0FBQ0ksU0FBTCxDQUFlSSxHQUFmLEdBQXFCLFVBQVVGLElBQVYsRUFBZ0I7QUFDbkMsV0FBT0MsUUFBUSxDQUFDRCxJQUFELEVBQU8sS0FBUCxFQUFjLElBQWQsQ0FBZjtBQUNELEdBRkQ7O0FBY0EsU0FBT04sSUFBUDtBQUNELENBbkN1QixFQUF4Qjs7QUFxQ0EsU0FBU08sUUFBVCxDQUFrQkQsSUFBbEIsRUFBd0JHLFNBQXhCLEVBQW1DQyxHQUFuQyxFQUF3QztBQUN0QyxNQUFJQyxJQUFJLEdBQUcsT0FBT0wsSUFBbEI7QUFDQSxNQUFJTSxRQUFKLEVBQWNDLE9BQWQ7O0FBQ0EsVUFB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QUFPLElBQVA7QUFDRDs7QUFFSDtBQUdFUSxNQUFBQSxJQUFJLEdBQUdPLE1BQU0sQ0FBQ2QsU0FBUCxDQUFpQmUsUUFBakIsQ0FBMEJDLElBQTFCLENBQStCZCxJQUEvQixDQUFQOztBQUNBLFVBQUksRUFBRUssSUFBSSxJQUFJRCxHQUFHLENBQUNQLE1BQWQsQ0FBSixFQUEyQjtBQUN6QixZQUFJTSxTQUFKLEVBQWU7QUFDYkMsVUFBQUEsR0FBRyxDQUFDUCxNQUFKLENBQVdRLElBQVgsSUFBbUIsQ0FBQ0wsSUFBRCxDQUFuQjtBQUNEOztBQUNELGVBQU8sS0FBUDtBQUNEOztBQUVELFVBQUksQ0FBQ1IsU0FBUyxDQUFDUSxJQUFELEVBQU9JLEdBQUcsQ0FBQ1AsTUFBSixDQUFXUSxJQUFYLENBQVAsQ0FBZCxFQUF3QztBQUN0QyxZQUFJRixTQUFKLEVBQWU7QUFDYkMsVUFBQUEsR0FBRyxDQUFDUCxNQUFKLENBQVdRLElBQVgsRUFBaUJNLElBQWpCLENBQXNCWCxJQUF0QjtBQUNEOztBQUNELGVBQU8sS0FBUDtBQUNEOztBQUNELGFBQU8sSUFBUDtBQTlISjtBQWdJRDs7QUFHRGUsTUFBTSxDQUFDQyxPQUFQLEdBQWlCdEIsSUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgX2luY2x1ZGVzID0gLyojX19QVVJFX18qL3JlcXVpcmUoJy4vX2luY2x1ZGVzJyk7XG5cbnZhciBfU2V0ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcblxuICBmdW5jdGlvbiBfU2V0KCkge1xuICAgIC8qIGdsb2JhbHMgU2V0ICovXG4gICAgdGhpcy5fbmF0aXZlU2V0ID0gdHlwZW9mIFNldCA9PT0gJ2Z1bmN0aW9uJyA/IG5ldyBTZXQoKSA6IG51bGw7XG4gICAgdGhpcy5faXRlbXMgPSB7fTtcbiAgfVxuXG4gIC8vIHVudGlsIHdlIGZpZ3VyZSBvdXQgd2h5IGpzZG9jIGNob2tlcyBvbiB0aGlzXG4gIC8vIEBwYXJhbSBpdGVtIFRoZSBpdGVtIHRvIGFkZCB0byB0aGUgU2V0XG4gIC8vIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoZSBpdGVtIGRpZCBub3QgZXhpc3QgcHJpb3IsIG90aGVyd2lzZSBmYWxzZVxuICAvL1xuICBfU2V0LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgIHJldHVybiAhaGFzT3JBZGQoaXRlbSwgdHJ1ZSwgdGhpcyk7XG4gIH07XG5cbiAgLy9cbiAgLy8gQHBhcmFtIGl0ZW0gVGhlIGl0ZW0gdG8gY2hlY2sgZm9yIGV4aXN0ZW5jZSBpbiB0aGUgU2V0XG4gIC8vIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoZSBpdGVtIGV4aXN0cyBpbiB0aGUgU2V0LCBvdGhlcndpc2UgZmFsc2VcbiAgLy9cbiAgX1NldC5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICByZXR1cm4gaGFzT3JBZGQoaXRlbSwgZmFsc2UsIHRoaXMpO1xuICB9O1xuXG4gIC8vXG4gIC8vIENvbWJpbmVzIHRoZSBsb2dpYyBmb3IgY2hlY2tpbmcgd2hldGhlciBhbiBpdGVtIGlzIGEgbWVtYmVyIG9mIHRoZSBzZXQgYW5kXG4gIC8vIGZvciBhZGRpbmcgYSBuZXcgaXRlbSB0byB0aGUgc2V0LlxuICAvL1xuICAvLyBAcGFyYW0gaXRlbSAgICAgICBUaGUgaXRlbSB0byBjaGVjayBvciBhZGQgdG8gdGhlIFNldCBpbnN0YW5jZS5cbiAgLy8gQHBhcmFtIHNob3VsZEFkZCAgSWYgdHJ1ZSwgdGhlIGl0ZW0gd2lsbCBiZSBhZGRlZCB0byB0aGUgc2V0IGlmIGl0IGRvZXNuJ3RcbiAgLy8gICAgICAgICAgICAgICAgICAgYWxyZWFkeSBleGlzdC5cbiAgLy8gQHBhcmFtIHNldCAgICAgICAgVGhlIHNldCBpbnN0YW5jZSB0byBjaGVjayBvciBhZGQgdG8uXG4gIC8vIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgdGhlIGl0ZW0gYWxyZWFkeSBleGlzdGVkLCBvdGhlcndpc2UgZmFsc2UuXG4gIC8vXG4gIHJldHVybiBfU2V0O1xufSgpO1xuXG5mdW5jdGlvbiBoYXNPckFkZChpdGVtLCBzaG91bGRBZGQsIHNldCkge1xuICB2YXIgdHlwZSA9IHR5cGVvZiBpdGVtO1xuICB2YXIgcHJldlNpemUsIG5ld1NpemU7XG4gIHN3aXRjaCAodHlwZSkge1xuICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgIC8vIGRpc3Rpbmd1aXNoIGJldHdlZW4gKzAgYW5kIC0wXG4gICAgICBpZiAoaXRlbSA9PT0gMCAmJiAxIC8gaXRlbSA9PT0gLUluZmluaXR5KSB7XG4gICAgICAgIGlmIChzZXQuX2l0ZW1zWyctMCddKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgICAgc2V0Ll9pdGVtc1snLTAnXSA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gdGhlc2UgdHlwZXMgY2FuIGFsbCB1dGlsaXNlIHRoZSBuYXRpdmUgU2V0XG4gICAgICBpZiAoc2V0Ll9uYXRpdmVTZXQgIT09IG51bGwpIHtcbiAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgIHByZXZTaXplID0gc2V0Ll9uYXRpdmVTZXQuc2l6ZTtcbiAgICAgICAgICBzZXQuX25hdGl2ZVNldC5hZGQoaXRlbSk7XG4gICAgICAgICAgbmV3U2l6ZSA9IHNldC5fbmF0aXZlU2V0LnNpemU7XG4gICAgICAgICAgcmV0dXJuIG5ld1NpemUgPT09IHByZXZTaXplO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBzZXQuX25hdGl2ZVNldC5oYXMoaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICghKHR5cGUgaW4gc2V0Ll9pdGVtcykpIHtcbiAgICAgICAgICBpZiAoc2hvdWxkQWRkKSB7XG4gICAgICAgICAgICBzZXQuX2l0ZW1zW3R5cGVdID0ge307XG4gICAgICAgICAgICBzZXQuX2l0ZW1zW3R5cGVdW2l0ZW1dID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKGl0ZW0gaW4gc2V0Ll9pdGVtc1t0eXBlXSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChzaG91bGRBZGQpIHtcbiAgICAgICAgICAgIHNldC5faXRlbXNbdHlwZV1baXRlbV0gPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgLy8gc2V0Ll9pdGVtc1snYm9vbGVhbiddIGhvbGRzIGEgdHdvIGVsZW1lbnQgYXJyYXlcbiAgICAgIC8vIHJlcHJlc2VudGluZyBbIGZhbHNlRXhpc3RzLCB0cnVlRXhpc3RzIF1cbiAgICAgIGlmICh0eXBlIGluIHNldC5faXRlbXMpIHtcbiAgICAgICAgdmFyIGJJZHggPSBpdGVtID8gMSA6IDA7XG4gICAgICAgIGlmIChzZXQuX2l0ZW1zW3R5cGVdW2JJZHhdKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgICAgc2V0Ll9pdGVtc1t0eXBlXVtiSWR4XSA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgIHNldC5faXRlbXNbdHlwZV0gPSBpdGVtID8gW2ZhbHNlLCB0cnVlXSA6IFt0cnVlLCBmYWxzZV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgY2FzZSAnZnVuY3Rpb24nOlxuICAgICAgLy8gY29tcGFyZSBmdW5jdGlvbnMgZm9yIHJlZmVyZW5jZSBlcXVhbGl0eVxuICAgICAgaWYgKHNldC5fbmF0aXZlU2V0ICE9PSBudWxsKSB7XG4gICAgICAgIGlmIChzaG91bGRBZGQpIHtcbiAgICAgICAgICBwcmV2U2l6ZSA9IHNldC5fbmF0aXZlU2V0LnNpemU7XG4gICAgICAgICAgc2V0Ll9uYXRpdmVTZXQuYWRkKGl0ZW0pO1xuICAgICAgICAgIG5ld1NpemUgPSBzZXQuX25hdGl2ZVNldC5zaXplO1xuICAgICAgICAgIHJldHVybiBuZXdTaXplID09PSBwcmV2U2l6ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gc2V0Ll9uYXRpdmVTZXQuaGFzKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoISh0eXBlIGluIHNldC5faXRlbXMpKSB7XG4gICAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgICAgc2V0Ll9pdGVtc1t0eXBlXSA9IFtpdGVtXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghX2luY2x1ZGVzKGl0ZW0sIHNldC5faXRlbXNbdHlwZV0pKSB7XG4gICAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgICAgc2V0Ll9pdGVtc1t0eXBlXS5wdXNoKGl0ZW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICBjYXNlICd1bmRlZmluZWQnOlxuICAgICAgaWYgKHNldC5faXRlbXNbdHlwZV0pIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoc2hvdWxkQWRkKSB7XG4gICAgICAgICAgc2V0Ll9pdGVtc1t0eXBlXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgIGlmIChpdGVtID09PSBudWxsKSB7XG4gICAgICAgIGlmICghc2V0Ll9pdGVtc1snbnVsbCddKSB7XG4gICAgICAgICAgaWYgKHNob3VsZEFkZCkge1xuICAgICAgICAgICAgc2V0Ll9pdGVtc1snbnVsbCddID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIC8qIGZhbGxzIHRocm91Z2ggKi9cbiAgICBkZWZhdWx0OlxuICAgICAgLy8gcmVkdWNlIHRoZSBzZWFyY2ggc2l6ZSBvZiBoZXRlcm9nZW5lb3VzIHNldHMgYnkgY3JlYXRpbmcgYnVja2V0c1xuICAgICAgLy8gZm9yIGVhY2ggdHlwZS5cbiAgICAgIHR5cGUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlbSk7XG4gICAgICBpZiAoISh0eXBlIGluIHNldC5faXRlbXMpKSB7XG4gICAgICAgIGlmIChzaG91bGRBZGQpIHtcbiAgICAgICAgICBzZXQuX2l0ZW1zW3R5cGVdID0gW2l0ZW1dO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIC8vIHNjYW4gdGhyb3VnaCBhbGwgcHJldmlvdXNseSBhcHBsaWVkIGl0ZW1zXG4gICAgICBpZiAoIV9pbmNsdWRlcyhpdGVtLCBzZXQuX2l0ZW1zW3R5cGVdKSkge1xuICAgICAgICBpZiAoc2hvdWxkQWRkKSB7XG4gICAgICAgICAgc2V0Ll9pdGVtc1t0eXBlXS5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICB9XG59XG5cbi8vIEEgc2ltcGxlIFNldCB0eXBlIHRoYXQgaG9ub3VycyBSLmVxdWFscyBzZW1hbnRpY3Ncbm1vZHVsZS5leHBvcnRzID0gX1NldDsiXX0=