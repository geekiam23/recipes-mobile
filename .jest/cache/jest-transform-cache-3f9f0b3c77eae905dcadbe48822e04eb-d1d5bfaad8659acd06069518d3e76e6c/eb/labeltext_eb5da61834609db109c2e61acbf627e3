a2d906737575fc81c6874f4292b6ef2a
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.findByLabelText = exports.findAllByLabelText = exports.getByLabelText = exports.getAllByLabelText = exports.queryByLabelText = exports.queryAllByLabelText = void 0;

var _config = require("../config");

var _helpers = require("../helpers");

var _labelHelpers = require("../label-helpers");

var _allUtils = require("./all-utils");

function queryAllLabels(container) {
  return Array.from(container.querySelectorAll('label,input')).map(function (node) {
    return {
      node: node,
      textToMatch: (0, _labelHelpers.getLabelContent)(node)
    };
  }).filter(function (_ref) {
    var textToMatch = _ref.textToMatch;
    return textToMatch !== null;
  });
}

var queryAllLabelsByText = function queryAllLabelsByText(container, text) {
  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
      _ref2$exact = _ref2.exact,
      exact = _ref2$exact === void 0 ? true : _ref2$exact,
      trim = _ref2.trim,
      collapseWhitespace = _ref2.collapseWhitespace,
      normalizer = _ref2.normalizer;

  var matcher = exact ? _allUtils.matches : _allUtils.fuzzyMatches;
  var matchNormalizer = (0, _allUtils.makeNormalizer)({
    collapseWhitespace: collapseWhitespace,
    trim: trim,
    normalizer: normalizer
  });
  var textToMatchByLabels = queryAllLabels(container);
  return textToMatchByLabels.filter(function (_ref3) {
    var node = _ref3.node,
        textToMatch = _ref3.textToMatch;
    return matcher(textToMatch, node, text, matchNormalizer);
  }).map(function (_ref4) {
    var node = _ref4.node;
    return node;
  });
};

var queryAllByLabelText = function queryAllByLabelText(container, text) {
  var _ref5 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
      _ref5$selector = _ref5.selector,
      selector = _ref5$selector === void 0 ? '*' : _ref5$selector,
      _ref5$exact = _ref5.exact,
      exact = _ref5$exact === void 0 ? true : _ref5$exact,
      collapseWhitespace = _ref5.collapseWhitespace,
      trim = _ref5.trim,
      normalizer = _ref5.normalizer;

  (0, _helpers.checkContainerType)(container);
  var matcher = exact ? _allUtils.matches : _allUtils.fuzzyMatches;
  var matchNormalizer = (0, _allUtils.makeNormalizer)({
    collapseWhitespace: collapseWhitespace,
    trim: trim,
    normalizer: normalizer
  });
  var matchingLabelledElements = Array.from(container.querySelectorAll('*')).filter(function (element) {
    return (0, _labelHelpers.getRealLabels)(element).length || element.hasAttribute('aria-labelledby');
  }).reduce(function (labelledElements, labelledElement) {
    var labelList = (0, _labelHelpers.getLabels)(container, labelledElement, {
      selector: selector
    });
    labelList.filter(function (label) {
      return Boolean(label.formControl);
    }).forEach(function (label) {
      if (matcher(label.content, label.formControl, text, matchNormalizer) && label.formControl) labelledElements.push(label.formControl);
    });
    var labelsValue = labelList.filter(function (label) {
      return Boolean(label.content);
    }).map(function (label) {
      return label.content;
    });
    if (matcher(labelsValue.join(' '), labelledElement, text, matchNormalizer)) labelledElements.push(labelledElement);

    if (labelsValue.length > 1) {
      labelsValue.forEach(function (labelValue, index) {
        if (matcher(labelValue, labelledElement, text, matchNormalizer)) labelledElements.push(labelledElement);
        var labelsFiltered = (0, _toConsumableArray2.default)(labelsValue);
        labelsFiltered.splice(index, 1);

        if (labelsFiltered.length > 1) {
          if (matcher(labelsFiltered.join(' '), labelledElement, text, matchNormalizer)) labelledElements.push(labelledElement);
        }
      });
    }

    return labelledElements;
  }, []).concat((0, _allUtils.queryAllByAttribute)('aria-label', container, text, {
    exact: exact,
    normalizer: matchNormalizer
  }));
  return Array.from(new Set(matchingLabelledElements)).filter(function (element) {
    return element.matches(selector);
  });
};

var getAllByLabelText = function getAllByLabelText(container, text) {
  for (var _len = arguments.length, rest = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
    rest[_key - 2] = arguments[_key];
  }

  var els = queryAllByLabelText.apply(void 0, [container, text].concat(rest));

  if (!els.length) {
    var labels = queryAllLabelsByText.apply(void 0, [container, text].concat(rest));

    if (labels.length) {
      var tagNames = labels.map(function (label) {
        return getTagNameOfElementAssociatedWithLabelViaFor(container, label);
      }).filter(function (tagName) {
        return !!tagName;
      });

      if (tagNames.length) {
        throw (0, _config.getConfig)().getElementError(tagNames.map(function (tagName) {
          return "Found a label with the text of: " + text + ", however the element associated with this label (<" + tagName + " />) is non-labellable [https://html.spec.whatwg.org/multipage/forms.html#category-label]. If you really need to label a <" + tagName + " />, you can use aria-label or aria-labelledby instead.";
        }).join('\n\n'), container);
      } else {
        throw (0, _config.getConfig)().getElementError("Found a label with the text of: " + text + ", however no form control was found associated to that label. Make sure you're using the \"for\" attribute or \"aria-labelledby\" attribute correctly.", container);
      }
    } else {
      throw (0, _config.getConfig)().getElementError("Unable to find a label with the text of: " + text, container);
    }
  }

  return els;
};

function getTagNameOfElementAssociatedWithLabelViaFor(container, label) {
  var htmlFor = label.getAttribute('for');

  if (!htmlFor) {
    return null;
  }

  var element = container.querySelector("[id=\"" + htmlFor + "\"]");
  return element ? element.tagName.toLowerCase() : null;
}

var getMultipleError = function getMultipleError(c, text) {
  return "Found multiple elements with the text of: " + text;
};

var queryByLabelText = (0, _allUtils.wrapSingleQueryWithSuggestion)((0, _allUtils.makeSingleQuery)(queryAllByLabelText, getMultipleError), queryAllByLabelText.name, 'query');
exports.queryByLabelText = queryByLabelText;
var getByLabelText = (0, _allUtils.makeSingleQuery)(getAllByLabelText, getMultipleError);
var findAllByLabelText = (0, _allUtils.makeFindQuery)((0, _allUtils.wrapAllByQueryWithSuggestion)(getAllByLabelText, getAllByLabelText.name, 'findAll'));
exports.findAllByLabelText = findAllByLabelText;
var findByLabelText = (0, _allUtils.makeFindQuery)((0, _allUtils.wrapSingleQueryWithSuggestion)(getByLabelText, getAllByLabelText.name, 'find'));
exports.findByLabelText = findByLabelText;
var getAllByLabelTextWithSuggestions = (0, _allUtils.wrapAllByQueryWithSuggestion)(getAllByLabelText, getAllByLabelText.name, 'getAll');
exports.getAllByLabelText = getAllByLabelTextWithSuggestions;
var getByLabelTextWithSuggestions = (0, _allUtils.wrapSingleQueryWithSuggestion)(getByLabelText, getAllByLabelText.name, 'get');
exports.getByLabelText = getByLabelTextWithSuggestions;
var queryAllByLabelTextWithSuggestions = (0, _allUtils.wrapAllByQueryWithSuggestion)(queryAllByLabelText, queryAllByLabelText.name, 'queryAll');
exports.queryAllByLabelText = queryAllByLabelTextWithSuggestions;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxhYmVsLXRleHQuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJmaW5kQnlMYWJlbFRleHQiLCJmaW5kQWxsQnlMYWJlbFRleHQiLCJnZXRCeUxhYmVsVGV4dCIsImdldEFsbEJ5TGFiZWxUZXh0IiwicXVlcnlCeUxhYmVsVGV4dCIsInF1ZXJ5QWxsQnlMYWJlbFRleHQiLCJfY29uZmlnIiwicmVxdWlyZSIsIl9oZWxwZXJzIiwiX2xhYmVsSGVscGVycyIsIl9hbGxVdGlscyIsInF1ZXJ5QWxsTGFiZWxzIiwiY29udGFpbmVyIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsIm1hcCIsIm5vZGUiLCJ0ZXh0VG9NYXRjaCIsImdldExhYmVsQ29udGVudCIsImZpbHRlciIsInF1ZXJ5QWxsTGFiZWxzQnlUZXh0IiwidGV4dCIsImV4YWN0IiwidHJpbSIsImNvbGxhcHNlV2hpdGVzcGFjZSIsIm5vcm1hbGl6ZXIiLCJtYXRjaGVyIiwibWF0Y2hlcyIsImZ1enp5TWF0Y2hlcyIsIm1hdGNoTm9ybWFsaXplciIsIm1ha2VOb3JtYWxpemVyIiwidGV4dFRvTWF0Y2hCeUxhYmVscyIsInNlbGVjdG9yIiwiY2hlY2tDb250YWluZXJUeXBlIiwibWF0Y2hpbmdMYWJlbGxlZEVsZW1lbnRzIiwiZWxlbWVudCIsImdldFJlYWxMYWJlbHMiLCJsZW5ndGgiLCJoYXNBdHRyaWJ1dGUiLCJyZWR1Y2UiLCJsYWJlbGxlZEVsZW1lbnRzIiwibGFiZWxsZWRFbGVtZW50IiwibGFiZWxMaXN0IiwiZ2V0TGFiZWxzIiwibGFiZWwiLCJCb29sZWFuIiwiZm9ybUNvbnRyb2wiLCJmb3JFYWNoIiwiY29udGVudCIsInB1c2giLCJsYWJlbHNWYWx1ZSIsImpvaW4iLCJsYWJlbFZhbHVlIiwiaW5kZXgiLCJsYWJlbHNGaWx0ZXJlZCIsInNwbGljZSIsImNvbmNhdCIsInF1ZXJ5QWxsQnlBdHRyaWJ1dGUiLCJTZXQiLCJyZXN0IiwiZWxzIiwibGFiZWxzIiwidGFnTmFtZXMiLCJnZXRUYWdOYW1lT2ZFbGVtZW50QXNzb2NpYXRlZFdpdGhMYWJlbFZpYUZvciIsInRhZ05hbWUiLCJnZXRDb25maWciLCJnZXRFbGVtZW50RXJyb3IiLCJodG1sRm9yIiwiZ2V0QXR0cmlidXRlIiwicXVlcnlTZWxlY3RvciIsInRvTG93ZXJDYXNlIiwiZ2V0TXVsdGlwbGVFcnJvciIsImMiLCJ3cmFwU2luZ2xlUXVlcnlXaXRoU3VnZ2VzdGlvbiIsIm1ha2VTaW5nbGVRdWVyeSIsIm5hbWUiLCJtYWtlRmluZFF1ZXJ5Iiwid3JhcEFsbEJ5UXVlcnlXaXRoU3VnZ2VzdGlvbiIsImdldEFsbEJ5TGFiZWxUZXh0V2l0aFN1Z2dlc3Rpb25zIiwiZ2V0QnlMYWJlbFRleHRXaXRoU3VnZ2VzdGlvbnMiLCJxdWVyeUFsbEJ5TGFiZWxUZXh0V2l0aFN1Z2dlc3Rpb25zIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBRUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLEVBQUFBLEtBQUssRUFBRTtBQURvQyxDQUE3QztBQUdBRCxPQUFPLENBQUNFLGVBQVIsR0FBMEJGLE9BQU8sQ0FBQ0csa0JBQVIsR0FBNkJILE9BQU8sQ0FBQ0ksY0FBUixHQUF5QkosT0FBTyxDQUFDSyxpQkFBUixHQUE0QkwsT0FBTyxDQUFDTSxnQkFBUixHQUEyQk4sT0FBTyxDQUFDTyxtQkFBUixHQUE4QixLQUFLLENBQTFLOztBQUVBLElBQUlDLE9BQU8sR0FBR0MsT0FBTyxhQUFyQjs7QUFFQSxJQUFJQyxRQUFRLEdBQUdELE9BQU8sY0FBdEI7O0FBRUEsSUFBSUUsYUFBYSxHQUFHRixPQUFPLG9CQUEzQjs7QUFFQSxJQUFJRyxTQUFTLEdBQUdILE9BQU8sZUFBdkI7O0FBRUEsU0FBU0ksY0FBVCxDQUF3QkMsU0FBeEIsRUFBbUM7QUFDakMsU0FBT0MsS0FBSyxDQUFDQyxJQUFOLENBQVdGLFNBQVMsQ0FBQ0csZ0JBQVYs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QjtBQUNBOUUsT0FBTyxDQUFDRyxrQkFBUixHQUE2QkEsa0JBQTdCO0FBQ0EsSUFBTUQsZUFBZSxHQUFHLENBQUMsR0FBR1UsU0FBUyxDQUFDbUUsYUFBZCxFQUE2QixDQUFDLEdBQUduRSxTQUFTLENBQUNnRSw2QkFBZCxFQUE2Q3hFLGNBQTdDLEVBQTZEQyxpQkFBaUIsQ0FBQ3lFLElBQS9FLEVBQXFGLE1BQXJGLENBQTdCLENBQXhCO0FBQ0E5RSxPQUFPLENBQUNFLGVBQVIsR0FBMEJBLGVBQTFCO0FBQ0EsSUFBTStFLGdDQUFnQyxHQUFHLENBQUMsR0FBR3JFLFNBQVMsQ0FBQ29FLDRCQUFkLEVBQTRDM0UsaUJBQTVDLEVBQStEQSxpQkFBaUIsQ0FBQ3lFLElBQWpGLEVBQXVGLFFBQXZGLENBQXpDO0FBQ0E5RSxPQUFPLENBQUNLLGlCQUFSLEdBQTRCNEUsZ0NBQTVCO0FBQ0EsSUFBTUMsNkJBQTZCLEdBQUcsQ0FBQyxHQUFHdEUsU0FBUyxDQUFDZ0UsNkJBQWQsRUFBNkN4RSxjQUE3QyxFQUE2REMsaUJBQWlCLENBQUN5RSxJQUEvRSxFQUFxRixLQUFyRixDQUF0QztBQUNBOUUsT0FBTyxDQUFDSSxjQUFSLEdBQXlCOEUsNkJBQXpCO0FBQ0EsSUFBTUMsa0NBQWtDLEdBQUcsQ0FBQyxHQUFHdkUsU0FBUyxDQUFDb0UsNEJBQWQsRUFBNEN6RSxtQkFBNUMsRUFBaUVBLG1CQUFtQixDQUFDdUUsSUFBckYsRUFBMkYsVUFBM0YsQ0FBM0M7QUFDQTlFLE9BQU8sQ0FBQ08sbUJBQVIsR0FBOEI0RSxrQ0FBOUIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZmluZEJ5TGFiZWxUZXh0ID0gZXhwb3J0cy5maW5kQWxsQnlMYWJlbFRleHQgPSBleHBvcnRzLmdldEJ5TGFiZWxUZXh0ID0gZXhwb3J0cy5nZXRBbGxCeUxhYmVsVGV4dCA9IGV4cG9ydHMucXVlcnlCeUxhYmVsVGV4dCA9IGV4cG9ydHMucXVlcnlBbGxCeUxhYmVsVGV4dCA9IHZvaWQgMDtcblxudmFyIF9jb25maWcgPSByZXF1aXJlKFwiLi4vY29uZmlnXCIpO1xuXG52YXIgX2hlbHBlcnMgPSByZXF1aXJlKFwiLi4vaGVscGVyc1wiKTtcblxudmFyIF9sYWJlbEhlbHBlcnMgPSByZXF1aXJlKFwiLi4vbGFiZWwtaGVscGVyc1wiKTtcblxudmFyIF9hbGxVdGlscyA9IHJlcXVpcmUoXCIuL2FsbC11dGlsc1wiKTtcblxuZnVuY3Rpb24gcXVlcnlBbGxMYWJlbHMoY29udGFpbmVyKSB7XG4gIHJldHVybiBBcnJheS5mcm9tKGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdsYWJlbCxpbnB1dCcpKS5tYXAobm9kZSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5vZGUsXG4gICAgICB0ZXh0VG9NYXRjaDogKDAsIF9sYWJlbEhlbHBlcnMuZ2V0TGFiZWxDb250ZW50KShub2RlKVxuICAgIH07XG4gIH0pLmZpbHRlcigoe1xuICAgIHRleHRUb01hdGNoXG4gIH0pID0+IHRleHRUb01hdGNoICE9PSBudWxsKTtcbn1cblxuY29uc3QgcXVlcnlBbGxMYWJlbHNCeVRleHQgPSAoY29udGFpbmVyLCB0ZXh0LCB7XG4gIGV4YWN0ID0gdHJ1ZSxcbiAgdHJpbSxcbiAgY29sbGFwc2VXaGl0ZXNwYWNlLFxuICBub3JtYWxpemVyXG59ID0ge30pID0+IHtcbiAgY29uc3QgbWF0Y2hlciA9IGV4YWN0ID8gX2FsbFV0aWxzLm1hdGNoZXMgOiBfYWxsVXRpbHMuZnV6enlNYXRjaGVzO1xuICBjb25zdCBtYXRjaE5vcm1hbGl6ZXIgPSAoMCwgX2FsbFV0aWxzLm1ha2VOb3JtYWxpemVyKSh7XG4gICAgY29sbGFwc2VXaGl0ZXNwYWNlLFxuICAgIHRyaW0sXG4gICAgbm9ybWFsaXplclxuICB9KTtcbiAgY29uc3QgdGV4dFRvTWF0Y2hCeUxhYmVscyA9IHF1ZXJ5QWxsTGFiZWxzKGNvbnRhaW5lcik7XG4gIHJldHVybiB0ZXh0VG9NYXRjaEJ5TGFiZWxzLmZpbHRlcigoe1xuICAgIG5vZGUsXG4gICAgdGV4dFRvTWF0Y2hcbiAgfSkgPT4gbWF0Y2hlcih0ZXh0VG9NYXRjaCwgbm9kZSwgdGV4dCwgbWF0Y2hOb3JtYWxpemVyKSkubWFwKCh7XG4gICAgbm9kZVxuICB9KSA9PiBub2RlKTtcbn07XG5cbmNvbnN0IHF1ZXJ5QWxsQnlMYWJlbFRleHQgPSAoY29udGFpbmVyLCB0ZXh0LCB7XG4gIHNlbGVjdG9yID0gJyonLFxuICBleGFjdCA9IHRydWUsXG4gIGNvbGxhcHNlV2hpdGVzcGFjZSxcbiAgdHJpbSxcbiAgbm9ybWFsaXplclxufSA9IHt9KSA9PiB7XG4gICgwLCBfaGVscGVycy5jaGVja0NvbnRhaW5lclR5cGUpKGNvbnRhaW5lcik7XG4gIGNvbnN0IG1hdGNoZXIgPSBleGFjdCA/IF9hbGxVdGlscy5tYXRjaGVzIDogX2FsbFV0aWxzLmZ1enp5TWF0Y2hlcztcbiAgY29uc3QgbWF0Y2hOb3JtYWxpemVyID0gKDAsIF9hbGxVdGlscy5tYWtlTm9ybWFsaXplcikoe1xuICAgIGNvbGxhcHNlV2hpdGVzcGFjZSxcbiAgICB0cmltLFxuICAgIG5vcm1hbGl6ZXJcbiAgfSk7XG4gIGNvbnN0IG1hdGNoaW5nTGFiZWxsZWRFbGVtZW50cyA9IEFycmF5LmZyb20oY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJyonKSkuZmlsdGVyKGVsZW1lbnQgPT4ge1xuICAgIHJldHVybiAoMCwgX2xhYmVsSGVscGVycy5nZXRSZWFsTGFiZWxzKShlbGVtZW50KS5sZW5ndGggfHwgZWxlbWVudC5oYXNBdHRyaWJ1dGUoJ2FyaWEtbGFiZWxsZWRieScpO1xuICB9KS5yZWR1Y2UoKGxhYmVsbGVkRWxlbWVudHMsIGxhYmVsbGVkRWxlbWVudCkgPT4ge1xuICAgIGNvbnN0IGxhYmVsTGlzdCA9ICgwLCBfbGFiZWxIZWxwZXJzLmdldExhYmVscykoY29udGFpbmVyLCBsYWJlbGxlZEVsZW1lbnQsIHtcbiAgICAgIHNlbGVjdG9yXG4gICAgfSk7XG4gICAgbGFiZWxMaXN0LmZpbHRlcihsYWJlbCA9PiBCb29sZWFuKGxhYmVsLmZvcm1Db250cm9sKSkuZm9yRWFjaChsYWJlbCA9PiB7XG4gICAgICBpZiAobWF0Y2hlcihsYWJlbC5jb250ZW50LCBsYWJlbC5mb3JtQ29udHJvbCwgdGV4dCwgbWF0Y2hOb3JtYWxpemVyKSAmJiBsYWJlbC5mb3JtQ29udHJvbCkgbGFiZWxsZWRFbGVtZW50cy5wdXNoKGxhYmVsLmZvcm1Db250cm9sKTtcbiAgICB9KTtcbiAgICBjb25zdCBsYWJlbHNWYWx1ZSA9IGxhYmVsTGlzdC5maWx0ZXIobGFiZWwgPT4gQm9vbGVhbihsYWJlbC5jb250ZW50KSkubWFwKGxhYmVsID0+IGxhYmVsLmNvbnRlbnQpO1xuICAgIGlmIChtYXRjaGVyKGxhYmVsc1ZhbHVlLmpvaW4oJyAnKSwgbGFiZWxsZWRFbGVtZW50LCB0ZXh0LCBtYXRjaE5vcm1hbGl6ZXIpKSBsYWJlbGxlZEVsZW1lbnRzLnB1c2gobGFiZWxsZWRFbGVtZW50KTtcblxuICAgIGlmIChsYWJlbHNWYWx1ZS5sZW5ndGggPiAxKSB7XG4gICAgICBsYWJlbHNWYWx1ZS5mb3JFYWNoKChsYWJlbFZhbHVlLCBpbmRleCkgPT4ge1xuICAgICAgICBpZiAobWF0Y2hlcihsYWJlbFZhbHVlLCBsYWJlbGxlZEVsZW1lbnQsIHRleHQsIG1hdGNoTm9ybWFsaXplcikpIGxhYmVsbGVkRWxlbWVudHMucHVzaChsYWJlbGxlZEVsZW1lbnQpO1xuICAgICAgICBjb25zdCBsYWJlbHNGaWx0ZXJlZCA9IFsuLi5sYWJlbHNWYWx1ZV07XG4gICAgICAgIGxhYmVsc0ZpbHRlcmVkLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAgICAgaWYgKGxhYmVsc0ZpbHRlcmVkLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBpZiAobWF0Y2hlcihsYWJlbHNGaWx0ZXJlZC5qb2luKCcgJyksIGxhYmVsbGVkRWxlbWVudCwgdGV4dCwgbWF0Y2hOb3JtYWxpemVyKSkgbGFiZWxsZWRFbGVtZW50cy5wdXNoKGxhYmVsbGVkRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBsYWJlbGxlZEVsZW1lbnRzO1xuICB9LCBbXSkuY29uY2F0KCAvLyBUT0RPOiBSZW1vdmUgaWdub3JlIGFmdGVyIGBxdWVyeUFsbEJ5QXR0cmlidXRlYCB3aWxsIGJlIG1vdmVkIHRvIFRTXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcbiAgLy8gQHRzLWV4cGVjdC1lcnJvclxuICAoMCwgX2FsbFV0aWxzLnF1ZXJ5QWxsQnlBdHRyaWJ1dGUpKCdhcmlhLWxhYmVsJywgY29udGFpbmVyLCB0ZXh0LCB7XG4gICAgZXhhY3QsXG4gICAgbm9ybWFsaXplcjogbWF0Y2hOb3JtYWxpemVyXG4gIH0pKTtcbiAgcmV0dXJuIEFycmF5LmZyb20obmV3IFNldChtYXRjaGluZ0xhYmVsbGVkRWxlbWVudHMpKS5maWx0ZXIoZWxlbWVudCA9PiBlbGVtZW50Lm1hdGNoZXMoc2VsZWN0b3IpKTtcbn07IC8vIHRoZSBnZXRBbGwqIHF1ZXJ5IHdvdWxkIG5vcm1hbGx5IGxvb2sgbGlrZSB0aGlzOlxuLy8gY29uc3QgZ2V0QWxsQnlMYWJlbFRleHQgPSBtYWtlR2V0QWxsUXVlcnkoXG4vLyAgIHF1ZXJ5QWxsQnlMYWJlbFRleHQsXG4vLyAgIChjLCB0ZXh0KSA9PiBgVW5hYmxlIHRvIGZpbmQgYSBsYWJlbCB3aXRoIHRoZSB0ZXh0IG9mOiAke3RleHR9YCxcbi8vIClcbi8vIGhvd2V2ZXIsIHdlIGNhbiBnaXZlIGEgbW9yZSBoZWxwZnVsIGVycm9yIG1lc3NhZ2UgdGhhbiB0aGUgZ2VuZXJpYyBvbmUsXG4vLyBzbyB3ZSdyZSB3cml0aW5nIHRoaXMgb25lIG91dCBieSBoYW5kLlxuXG5cbmNvbnN0IGdldEFsbEJ5TGFiZWxUZXh0ID0gKGNvbnRhaW5lciwgdGV4dCwgLi4ucmVzdCkgPT4ge1xuICBjb25zdCBlbHMgPSBxdWVyeUFsbEJ5TGFiZWxUZXh0KGNvbnRhaW5lciwgdGV4dCwgLi4ucmVzdCk7XG5cbiAgaWYgKCFlbHMubGVuZ3RoKSB7XG4gICAgY29uc3QgbGFiZWxzID0gcXVlcnlBbGxMYWJlbHNCeVRleHQoY29udGFpbmVyLCB0ZXh0LCAuLi5yZXN0KTtcblxuICAgIGlmIChsYWJlbHMubGVuZ3RoKSB7XG4gICAgICBjb25zdCB0YWdOYW1lcyA9IGxhYmVscy5tYXAobGFiZWwgPT4gZ2V0VGFnTmFtZU9mRWxlbWVudEFzc29jaWF0ZWRXaXRoTGFiZWxWaWFGb3IoY29udGFpbmVyLCBsYWJlbCkpLmZpbHRlcih0YWdOYW1lID0+ICEhdGFnTmFtZSk7XG5cbiAgICAgIGlmICh0YWdOYW1lcy5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgKDAsIF9jb25maWcuZ2V0Q29uZmlnKSgpLmdldEVsZW1lbnRFcnJvcih0YWdOYW1lcy5tYXAodGFnTmFtZSA9PiBgRm91bmQgYSBsYWJlbCB3aXRoIHRoZSB0ZXh0IG9mOiAke3RleHR9LCBob3dldmVyIHRoZSBlbGVtZW50IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGxhYmVsICg8JHt0YWdOYW1lfSAvPikgaXMgbm9uLWxhYmVsbGFibGUgW2h0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL2Zvcm1zLmh0bWwjY2F0ZWdvcnktbGFiZWxdLiBJZiB5b3UgcmVhbGx5IG5lZWQgdG8gbGFiZWwgYSA8JHt0YWdOYW1lfSAvPiwgeW91IGNhbiB1c2UgYXJpYS1sYWJlbCBvciBhcmlhLWxhYmVsbGVkYnkgaW5zdGVhZC5gKS5qb2luKCdcXG5cXG4nKSwgY29udGFpbmVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93ICgwLCBfY29uZmlnLmdldENvbmZpZykoKS5nZXRFbGVtZW50RXJyb3IoYEZvdW5kIGEgbGFiZWwgd2l0aCB0aGUgdGV4dCBvZjogJHt0ZXh0fSwgaG93ZXZlciBubyBmb3JtIGNvbnRyb2wgd2FzIGZvdW5kIGFzc29jaWF0ZWQgdG8gdGhhdCBsYWJlbC4gTWFrZSBzdXJlIHlvdSdyZSB1c2luZyB0aGUgXCJmb3JcIiBhdHRyaWJ1dGUgb3IgXCJhcmlhLWxhYmVsbGVkYnlcIiBhdHRyaWJ1dGUgY29ycmVjdGx5LmAsIGNvbnRhaW5lcik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93ICgwLCBfY29uZmlnLmdldENvbmZpZykoKS5nZXRFbGVtZW50RXJyb3IoYFVuYWJsZSB0byBmaW5kIGEgbGFiZWwgd2l0aCB0aGUgdGV4dCBvZjogJHt0ZXh0fWAsIGNvbnRhaW5lcik7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGVscztcbn07XG5cbmZ1bmN0aW9uIGdldFRhZ05hbWVPZkVsZW1lbnRBc3NvY2lhdGVkV2l0aExhYmVsVmlhRm9yKGNvbnRhaW5lciwgbGFiZWwpIHtcbiAgY29uc3QgaHRtbEZvciA9IGxhYmVsLmdldEF0dHJpYnV0ZSgnZm9yJyk7XG5cbiAgaWYgKCFodG1sRm9yKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBlbGVtZW50ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoYFtpZD1cIiR7aHRtbEZvcn1cIl1gKTtcbiAgcmV0dXJuIGVsZW1lbnQgPyBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA6IG51bGw7XG59IC8vIHRoZSByZWFzb24gbWVudGlvbmVkIGFib3ZlIGlzIHRoZSBzYW1lIHJlYXNvbiB3ZSdyZSBub3QgdXNpbmcgYnVpbGRRdWVyaWVzXG5cblxuY29uc3QgZ2V0TXVsdGlwbGVFcnJvciA9IChjLCB0ZXh0KSA9PiBgRm91bmQgbXVsdGlwbGUgZWxlbWVudHMgd2l0aCB0aGUgdGV4dCBvZjogJHt0ZXh0fWA7XG5cbmNvbnN0IHF1ZXJ5QnlMYWJlbFRleHQgPSAoMCwgX2FsbFV0aWxzLndyYXBTaW5nbGVRdWVyeVdpdGhTdWdnZXN0aW9uKSgoMCwgX2FsbFV0aWxzLm1ha2VTaW5nbGVRdWVyeSkocXVlcnlBbGxCeUxhYmVsVGV4dCwgZ2V0TXVsdGlwbGVFcnJvciksIHF1ZXJ5QWxsQnlMYWJlbFRleHQubmFtZSwgJ3F1ZXJ5Jyk7XG5leHBvcnRzLnF1ZXJ5QnlMYWJlbFRleHQgPSBxdWVyeUJ5TGFiZWxUZXh0O1xuY29uc3QgZ2V0QnlMYWJlbFRleHQgPSAoMCwgX2FsbFV0aWxzLm1ha2VTaW5nbGVRdWVyeSkoZ2V0QWxsQnlMYWJlbFRleHQsIGdldE11bHRpcGxlRXJyb3IpO1xuY29uc3QgZmluZEFsbEJ5TGFiZWxUZXh0ID0gKDAsIF9hbGxVdGlscy5tYWtlRmluZFF1ZXJ5KSgoMCwgX2FsbFV0aWxzLndyYXBBbGxCeVF1ZXJ5V2l0aFN1Z2dlc3Rpb24pKGdldEFsbEJ5TGFiZWxUZXh0LCBnZXRBbGxCeUxhYmVsVGV4dC5uYW1lLCAnZmluZEFsbCcpKTtcbmV4cG9ydHMuZmluZEFsbEJ5TGFiZWxUZXh0ID0gZmluZEFsbEJ5TGFiZWxUZXh0O1xuY29uc3QgZmluZEJ5TGFiZWxUZXh0ID0gKDAsIF9hbGxVdGlscy5tYWtlRmluZFF1ZXJ5KSgoMCwgX2FsbFV0aWxzLndyYXBTaW5nbGVRdWVyeVdpdGhTdWdnZXN0aW9uKShnZXRCeUxhYmVsVGV4dCwgZ2V0QWxsQnlMYWJlbFRleHQubmFtZSwgJ2ZpbmQnKSk7XG5leHBvcnRzLmZpbmRCeUxhYmVsVGV4dCA9IGZpbmRCeUxhYmVsVGV4dDtcbmNvbnN0IGdldEFsbEJ5TGFiZWxUZXh0V2l0aFN1Z2dlc3Rpb25zID0gKDAsIF9hbGxVdGlscy53cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uKShnZXRBbGxCeUxhYmVsVGV4dCwgZ2V0QWxsQnlMYWJlbFRleHQubmFtZSwgJ2dldEFsbCcpO1xuZXhwb3J0cy5nZXRBbGxCeUxhYmVsVGV4dCA9IGdldEFsbEJ5TGFiZWxUZXh0V2l0aFN1Z2dlc3Rpb25zO1xuY29uc3QgZ2V0QnlMYWJlbFRleHRXaXRoU3VnZ2VzdGlvbnMgPSAoMCwgX2FsbFV0aWxzLndyYXBTaW5nbGVRdWVyeVdpdGhTdWdnZXN0aW9uKShnZXRCeUxhYmVsVGV4dCwgZ2V0QWxsQnlMYWJlbFRleHQubmFtZSwgJ2dldCcpO1xuZXhwb3J0cy5nZXRCeUxhYmVsVGV4dCA9IGdldEJ5TGFiZWxUZXh0V2l0aFN1Z2dlc3Rpb25zO1xuY29uc3QgcXVlcnlBbGxCeUxhYmVsVGV4dFdpdGhTdWdnZXN0aW9ucyA9ICgwLCBfYWxsVXRpbHMud3JhcEFsbEJ5UXVlcnlXaXRoU3VnZ2VzdGlvbikocXVlcnlBbGxCeUxhYmVsVGV4dCwgcXVlcnlBbGxCeUxhYmVsVGV4dC5uYW1lLCAncXVlcnlBbGwnKTtcbmV4cG9ydHMucXVlcnlBbGxCeUxhYmVsVGV4dCA9IHF1ZXJ5QWxsQnlMYWJlbFRleHRXaXRoU3VnZ2VzdGlvbnM7Il19