3d38d27d2ab4984eff7c887147f9926e
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.TOUCHABLE_STATE = void 0;

var React = _interopRequireWildcard(require("react"));

var _reactNative = require("react-native");

var _State = require("../../State");

var _GestureButtons = require("../GestureButtons");

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _extends() {
  _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

var TOUCHABLE_STATE = {
  UNDETERMINED: 0,
  BEGAN: 1,
  MOVED_OUTSIDE: 2
};
exports.TOUCHABLE_STATE = TOUCHABLE_STATE;

var GenericTouchable = function (_React$Component) {
  (0, _inherits2.default)(GenericTouchable, _React$Component);

  var _super = _createSuper(GenericTouchable);

  function GenericTouchable() {
    var _this;

    (0, _classCallCheck2.default)(this, GenericTouchable);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));

    _defineProperty((0, _assertThisInitialized2.default)(_this), "pressInTimeout", void 0);

    _defineProperty((0, _assertThisInitialized2.default)(_this), "pressOutTimeout", void 0);

    _defineProperty((0, _assertThisInitialized2.default)(_this), "longPressTimeout", void 0);

    _defineProperty((0, _assertThisInitialized2.default)(_this), "longPressDetected", false);

    _defineProperty((0, _assertThisInitialized2.default)(_this), "pointerInside", true);

    _defineProperty((0, _assertThisInitialized2.default)(_this), "STATE", TOUCHABLE_STATE.UNDETERMINED);

    _defineProperty((0, _assertThisInitialized2.default)(_this), "onGestureEvent", function (_ref) {
      var pointerInside = _ref.nativeEvent.pointerInside;

      if (_this.pointerInside !== pointerInside) {
        if (pointerInside) {
          _this.onMoveIn();
        } else {
          _this.onMoveOut();
        }
      }

      _this.pointerInside = pointerInside;
    });

    _defineProperty((0, _assertThisInitialized2.default)(_this), "onHandlerStateChange", function (_ref2) {
      var nativeEvent = _ref2.nativeEvent;
      var state = nativeEvent.state;

      if (state === _State.State.CANCELLED || state === _State.State.FAILED) {
        _this.moveToState(TOUCHABLE_STATE.UNDETERMINED);
      } else if (state === (_reactNative.Platform.OS !== 'android' ? _State.State.ACTIVE : _State.State.BEGAN) && _this.STATE === TOUCHABLE_STATE.UNDETERMINED) {
        _this.handlePressIn();
      } else if (state === _State.State.END) {
        var shouldCallOnPress = !_this.longPressDetected && _this.STATE !== TOUCHABLE_STATE.MOVED_OUTSIDE && _this.pressOutTimeout === null;

        _this.handleGoToUndetermined();

        if (shouldCallOnPress) {
          var _this$props$onPress, _this$props;

          (_this$props$onPress = (_this$props = _this.props).onPress) === null || _this$props$onPress === void 0 ? void 0 : _this$props$onPress.call(_this$props);
        }
      }
    });

    _defineProperty((0, _assertThisInitialized2.default)(_this), "onLongPressDetected", function () {
      var _this$props$onLongPre, _this$props2;

      _this.longPressDetected = true;
      (_this$props$onLongPre = (_this$props2 = _this.props).onLongPress) === null || _this$props$onLongPre === void 0 ? void 0 : _this$props$onLongPre.call(_this$props2);
    });

    return _this;
  }

  (0, _createClass2.default)(GenericTouchable, [{
    key: "handlePressIn",
    value: function handlePressIn() {
      var _this2 = this;

      if (this.props.delayPressIn) {
        this.pressInTimeout = setTimeout(function () {
          _this2.moveToState(TOUCHABLE_STATE.BEGAN);

          _this2.pressInTimeout = null;
        }, this.props.delayPressIn);
      } else {
        this.moveToState(TOUCHABLE_STATE.BEGAN);
      }

      if (this.props.onLongPress) {
        var time = (this.props.delayPressIn || 0) + (this.props.delayLongPress || 0);
        this.longPressTimeout = setTimeout(this.onLongPressDetected, time);
      }
    }
  }, {
    key: "handleMoveOutside",
    value: function handleMoveOutside() {
      var _this3 = this;

      if (this.props.delayPressOut) {
        this.pressOutTimeout = this.pressOutTimeout || setTimeout(function () {
          _this3.moveToState(TOUCHABLE_STATE.MOVED_OUTSIDE);

          _this3.pressOutTimeout = null;
        }, this.props.delayPressOut);
      } else {
        this.moveToState(TOUCHABLE_STATE.MOVED_OUTSIDE);
      }
    }
  }, {
    key: "handleGoToUndetermined",
    value: function handleGoToUndetermined() {
      var _this4 = this;

      clearTimeout(this.pressOutTimeout);

      if (this.props.delayPressOut) {
        this.pressOutTimeout = setTimeout(function () {
          if (_this4.STATE === TOUCHABLE_STATE.UNDETERMINED) {
            _this4.moveToState(TOUCHABLE_STATE.BEGAN);
          }

          _this4.moveToState(TOUCHABLE_STATE.UNDETERMINED);

          _this4.pressOutTimeout = null;
        }, this.props.delayPressOut);
      } else {
        if (this.STATE === TOUCHABLE_STATE.UNDETERMINED) {
          this.moveToState(TOUCHABLE_STATE.BEGAN);
        }

        this.moveToState(TOUCHABLE_STATE.UNDETERMINED);
      }
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      this.reset();
    }
  }, {
    key: "reset",
    value: function reset() {
      this.longPressDetected = false;
      this.pointerInside = true;
      clearTimeout(this.pressInTimeout);
      clearTimeout(this.pressOutTimeout);
      clearTimeout(this.longPressTimeout);
      this.pressOutTimeout = null;
      this.longPressTimeout = null;
      this.pressInTimeout = null;
    }
  }, {
    key: "moveToState",
    value: function moveToState(newState) {
      var _this$props$onStateCh, _this$props6;

      if (newState === this.STATE) {
        return;
      }

      if (newState === TOUCHABLE_STATE.BEGAN) {
        var _this$props$onPressIn, _this$props3;

        (_this$props$onPressIn = (_this$props3 = this.props).onPressIn) === null || _this$props$onPressIn === void 0 ? void 0 : _this$props$onPressIn.call(_this$props3);
      } else if (newState === TOUCHABLE_STATE.MOVED_OUTSIDE) {
        var _this$props$onPressOu, _this$props4;

        (_this$props$onPressOu = (_this$props4 = this.props).onPressOut) === null || _this$props$onPressOu === void 0 ? void 0 : _this$props$onPressOu.call(_this$props4);
      } else if (newState === TOUCHABLE_STATE.UNDETERMINED) {
        this.reset();

        if (this.STATE === TOUCHABLE_STATE.BEGAN) {
          var _this$props$onPressOu2, _this$props5;

          (_this$props$onPressOu2 = (_this$props5 = this.props).onPressOut) === null || _this$props$onPressOu2 === void 0 ? void 0 : _this$props$onPressOu2.call(_this$props5);
        }
      }

      (_this$props$onStateCh = (_this$props6 = this.props).onStateChange) === null || _this$props$onStateCh === void 0 ? void 0 : _this$props$onStateCh.call(_this$props6, this.STATE, newState);
      this.STATE = newState;
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this.reset();
    }
  }, {
    key: "onMoveIn",
    value: function onMoveIn() {
      if (this.STATE === TOUCHABLE_STATE.MOVED_OUTSIDE) {
        this.moveToState(TOUCHABLE_STATE.BEGAN);
      }
    }
  }, {
    key: "onMoveOut",
    value: function onMoveOut() {
      clearTimeout(this.longPressTimeout);
      this.longPressTimeout = null;

      if (this.STATE === TOUCHABLE_STATE.BEGAN) {
        this.handleMoveOutside();
      }
    }
  }, {
    key: "render",
    value: function render() {
      var coreProps = {
        accessible: this.props.accessible !== false,
        accessibilityLabel: this.props.accessibilityLabel,
        accessibilityHint: this.props.accessibilityHint,
        accessibilityRole: this.props.accessibilityRole,
        accessibilityState: this.props.accessibilityState,
        nativeID: this.props.nativeID,
        onLayout: this.props.onLayout,
        hitSlop: this.props.hitSlop
      };
      return React.createElement(_GestureButtons.BaseButton, _extends({
        style: this.props.containerStyle,
        onHandlerStateChange: this.props.disabled ? undefined : this.onHandlerStateChange,
        onGestureEvent: this.onGestureEvent,
        hitSlop: this.props.hitSlop,
        shouldActivateOnStart: this.props.shouldActivateOnStart,
        disallowInterruption: this.props.disallowInterruption,
        testID: this.props.testID
      }, this.props.extraButtonProps), React.createElement(_reactNative.Animated.View, _extends({}, coreProps, {
        style: this.props.style
      }), this.props.children));
    }
  }]);
  return GenericTouchable;
}(React.Component);

exports.default = GenericTouchable;

_defineProperty(GenericTouchable, "defaultProps", {
  delayLongPress: 600,
  extraButtonProps: {
    rippleColor: 'transparent'
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkdlbmVyaWNUb3VjaGFibGUudHN4Il0sIm5hbWVzIjpbIlRPVUNIQUJMRV9TVEFURSIsIlVOREVURVJNSU5FRCIsIkJFR0FOIiwiTU9WRURfT1VUU0lERSIsIkdlbmVyaWNUb3VjaGFibGUiLCJDb21wb25lbnQiLCJkZWxheUxvbmdQcmVzcyIsImV4dHJhQnV0dG9uUHJvcHMiLCJyaXBwbGVDb2xvciIsImhhbmRsZVByZXNzSW4iLCJzZXRUaW1lb3V0IiwidGltZSIsImhhbmRsZU1vdmVPdXRzaWRlIiwiaGFuZGxlR29Ub1VuZGV0ZXJtaW5lZCIsImNsZWFyVGltZW91dCIsImNvbXBvbmVudERpZE1vdW50IiwicmVzZXQiLCJtb3ZlVG9TdGF0ZSIsIm5ld1N0YXRlIiwibmF0aXZlRXZlbnQiLCJwb2ludGVySW5zaWRlIiwic3RhdGUiLCJTdGF0ZSIsIlBsYXRmb3JtIiwic2hvdWxkQ2FsbE9uUHJlc3MiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsIm9uTW92ZUluIiwib25Nb3ZlT3V0IiwicmVuZGVyIiwiY29yZVByb3BzIiwiYWNjZXNzaWJsZSIsImFjY2Vzc2liaWxpdHlMYWJlbCIsImFjY2Vzc2liaWxpdHlIaW50IiwiYWNjZXNzaWJpbGl0eVJvbGUiLCJhY2Nlc3NpYmlsaXR5U3RhdGUiLCJuYXRpdmVJRCIsIm9uTGF5b3V0IiwiaGl0U2xvcCIsInRlc3RJRCIsInN0eWxlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBQSxLQUFBLEdBQUEsdUJBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7O0FBRUEsSUFBQSxZQUFBLEdBQUEsT0FBQSxDQUFBLGNBQUEsQ0FBQTs7QUFRQSxJQUFBLE1BQUEsR0FBQSxPQUFBLGVBQUE7O0FBQ0EsSUFBQSxlQUFBLEdBQUEsT0FBQSxxQkFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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RUUsUUFBQSxvQkFBb0IsRUFFbEIsS0FBQSxLQUFBLENBQUEsUUFBQSxHQUFBLFNBQUEsR0FBa0MsS0FKdEMsb0JBQUE7QUFNRSxRQUFBLGNBQWMsRUFBRSxLQU5sQixjQUFBO0FBT0UsUUFBQSxPQUFPLEVBQUUsS0FBQSxLQUFBLENBUFgsT0FBQTtBQVFFLFFBQUEscUJBQXFCLEVBQUUsS0FBQSxLQUFBLENBUnpCLHFCQUFBO0FBU0UsUUFBQSxvQkFBb0IsRUFBRSxLQUFBLEtBQUEsQ0FUeEIsb0JBQUE7QUFVRSxRQUFBLE1BQU0sRUFBRSxLQUFBLEtBQUEsQ0FBV0M7QUFWckIsT0FBQSxFQVdNLEtBQUEsS0FBQSxDQVhOLGdCQUFBLENBQUEsRUFZRSxLQUFBLENBQUEsYUFBQSxDQUFDLFlBQUEsQ0FBRCxRQUFDLENBQUQsSUFBQSxFQUFBLFFBQUEsQ0FBQSxFQUFBLEVBQUEsU0FBQSxFQUFBO0FBQThCLFFBQUEsS0FBSyxFQUFFLEtBQUEsS0FBQSxDQUFXQztBQUFoRCxPQUFBLENBQUEsRUFDRyxLQUFBLEtBQUEsQ0FkUCxRQWFJLENBWkYsQ0FERjtBQWtCRDs7O0VBeE4yQ2xDLEtBQUFBLENBQS9CLFM7Ozs7Z0JBQU1ELGdCLGtCQUdHO0FBQ3BCRSxFQUFBQSxjQUFjLEVBRE0sR0FBQTtBQUVwQkMsRUFBQUEsZ0JBQWdCLEVBQUU7QUFDaEJDLElBQUFBLFdBQVcsRUFBRTtBQURHO0FBRkUsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7XG4gIEFuaW1hdGVkLFxuICBQbGF0Zm9ybSxcbiAgU3R5bGVQcm9wLFxuICBWaWV3U3R5bGUsXG4gIFRvdWNoYWJsZVdpdGhvdXRGZWVkYmFja1Byb3BzLFxufSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuXG5pbXBvcnQgeyBTdGF0ZSB9IGZyb20gJy4uLy4uL1N0YXRlJztcbmltcG9ydCB7IEJhc2VCdXR0b24gfSBmcm9tICcuLi9HZXN0dXJlQnV0dG9ucyc7XG5cbmltcG9ydCB7XG4gIEdlc3R1cmVFdmVudCxcbiAgSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnQsXG59IGZyb20gJy4uLy4uL2hhbmRsZXJzL2dlc3R1cmVIYW5kbGVycyc7XG5pbXBvcnQgeyBOYXRpdmVWaWV3R2VzdHVyZUhhbmRsZXJQYXlsb2FkIH0gZnJvbSAnLi4vLi4vaGFuZGxlcnMvTmF0aXZlVmlld0dlc3R1cmVIYW5kbGVyJztcbmltcG9ydCB7IFRvdWNoYWJsZU5hdGl2ZUZlZWRiYWNrRXh0cmFQcm9wcyB9IGZyb20gJy4vVG91Y2hhYmxlTmF0aXZlRmVlZGJhY2suYW5kcm9pZCc7XG5cbi8qKlxuICogRWFjaCB0b3VjaGFibGUgaXMgYSBzdGF0ZXMnIG1hY2hpbmUgd2hpY2ggcHJlZm9ybXMgdHJhbnNpdGlvbnMuXG4gKiBPbiB2ZXJ5IGJlZ2lubmluZyAoYW5kIG9uIHRoZSB2ZXJ5IGVuZCBvciByZWNvZ25pdGlvbikgdG91Y2hhYmxlIGlzXG4gKiBVTkRFVEVSTUlORUQuIFRoZW4gaXQgbW92ZXMgdG8gQkVHQU4uIElmIHRvdWNoYWJsZSByZWNvZ25pemVzIHRoYXQgZmluZ2VyXG4gKiB0cmF2ZWwgb3V0c2lkZSBpdCB0cmFuc2l0cyB0byBzcGVjaWFsIE1PVkVEX09VVFNJREUgc3RhdGUuIEdlc3R1cmUgcmVjb2duaXRpb25cbiAqIGZpbmlzaGVzIGluIFVOREVURVJNSU5FRCBzdGF0ZS5cbiAqL1xuZXhwb3J0IGNvbnN0IFRPVUNIQUJMRV9TVEFURSA9IHtcbiAgVU5ERVRFUk1JTkVEOiAwLFxuICBCRUdBTjogMSxcbiAgTU9WRURfT1VUU0lERTogMixcbn0gYXMgY29uc3Q7XG5cbnR5cGUgVG91Y2hhYmxlU3RhdGUgPSB0eXBlb2YgVE9VQ0hBQkxFX1NUQVRFW2tleW9mIHR5cGVvZiBUT1VDSEFCTEVfU1RBVEVdO1xuXG5leHBvcnQgaW50ZXJmYWNlIEdlbmVyaWNUb3VjaGFibGVQcm9wcyBleHRlbmRzIFRvdWNoYWJsZVdpdGhvdXRGZWVkYmFja1Byb3BzIHtcbiAgLy8gRGVjaWRlZCB0byBkcm9wIG5vdCB1c2VkIGZpZWxkcyBmcm9tIFJOJ3MgaW1wbGVtZW50YXRpb24uXG4gIC8vIGUuZy4gb25CbHVyIGFuZCBvbkZvY3VzIGFzIHdlbGwgYXMgZGVwcmVjYXRlZCBwcm9wcy4gLSBUT0RPOiB0aGlzIGNvbW1lbnQgbWF5IGJlIHVudXNlZnVsIGluIHRoaXMgbW9tZW50XG5cbiAgLy8gVE9ETzogaW4gUk4gdGhlc2UgZXZlbnRzIGdldCBuYXRpdmUgZXZlbnQgcGFyYW1ldGVyLCB3aGljaCBwcm9sbHkgY291bGQgYmUgdXNlZCBpbiBvdXIgaW1wbGVtZW50YXRpb24gdG9vXG4gIG9uUHJlc3M/OiAoKSA9PiB2b2lkO1xuICBvblByZXNzSW4/OiAoKSA9PiB2b2lkO1xuICBvblByZXNzT3V0PzogKCkgPT4gdm9pZDtcbiAgb25Mb25nUHJlc3M/OiAoKSA9PiB2b2lkO1xuXG4gIG5hdGl2ZUlEPzogc3RyaW5nO1xuICBzaG91bGRBY3RpdmF0ZU9uU3RhcnQ/OiBib29sZWFuO1xuICBkaXNhbGxvd0ludGVycnVwdGlvbj86IGJvb2xlYW47XG5cbiAgY29udGFpbmVyU3R5bGU/OiBTdHlsZVByb3A8Vmlld1N0eWxlPjtcbn1cblxuaW50ZXJmYWNlIEludGVybmFsUHJvcHMge1xuICBleHRyYUJ1dHRvblByb3BzOiBUb3VjaGFibGVOYXRpdmVGZWVkYmFja0V4dHJhUHJvcHM7XG4gIG9uU3RhdGVDaGFuZ2U/OiAob2xkU3RhdGU6IFRvdWNoYWJsZVN0YXRlLCBuZXdTdGF0ZTogVG91Y2hhYmxlU3RhdGUpID0+IHZvaWQ7XG59XG5cbi8vIFRPRE86IG1heWJlIGNhbiBiZSBiZXR0ZXJcbi8vIFRPRE86IGFsbCBjbGVhclRpbWVvdXQgaGF2ZSAhIGFkZGVkLCBtYXliZSB0aGV5IHNob3VsZG4ndCA/XG50eXBlIFRpbWVvdXQgPSBSZXR1cm5UeXBlPHR5cGVvZiBzZXRUaW1lb3V0PiB8IG51bGwgfCB1bmRlZmluZWQ7XG5cbi8qKlxuICogR2VuZXJpY1RvdWNoYWJsZSBpcyBub3QgaW50ZW50ZWQgdG8gYmUgdXNlZCBhcyBpdCBpcy5cbiAqIFNob3VsZCBiZSB0cmVhdGVkIGFzIGEgc291cmNlIGZvciB0aGUgcmVzdCBvZiB0b3VjaGFibGVzXG4gKi9cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2VuZXJpY1RvdWNoYWJsZSBleHRlbmRzIENvbXBvbmVudDxcbiAgR2VuZXJpY1RvdWNoYWJsZVByb3BzICYgSW50ZXJuYWxQcm9wc1xuPiB7XG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgZGVsYXlMb25nUHJlc3M6IDYwMCxcbiAgICBleHRyYUJ1dHRvblByb3BzOiB7XG4gICAgICByaXBwbGVDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICB9LFxuICB9O1xuXG4gIC8vIHRpbWVvdXQgaGFuZGxlcnNcbiAgcHJlc3NJblRpbWVvdXQ6IFRpbWVvdXQ7XG4gIHByZXNzT3V0VGltZW91dDogVGltZW91dDtcbiAgbG9uZ1ByZXNzVGltZW91dDogVGltZW91dDtcblxuICAvLyBUaGlzIGZsYWcgaXMgcmVxdWlyZWQgc2luY2UgcmVjb2duaXRpb24gb2YgbG9uZ1ByZXNzIGltcGxpZXMgbm90LWludm9raW5nIG9uUHJlc3NcbiAgbG9uZ1ByZXNzRGV0ZWN0ZWQgPSBmYWxzZTtcblxuICBwb2ludGVySW5zaWRlID0gdHJ1ZTtcblxuICAvLyBTdGF0ZSBvZiB0b3VjaGFibGVcbiAgU1RBVEU6IFRvdWNoYWJsZVN0YXRlID0gVE9VQ0hBQkxFX1NUQVRFLlVOREVURVJNSU5FRDtcblxuICAvLyBoYW5kbGVQcmVzc0luIGluIGNhbGxlZCBvbiBmaXJzdCB0b3VjaCBvbiB0cmF2ZWxpbmcgaW5zaWRlIGNvbXBvbmVudC5cbiAgLy8gSGFuZGxlcyBzdGF0ZSB0cmFuc2l0aW9uIHdpdGggZGVsYXkuXG4gIGhhbmRsZVByZXNzSW4oKSB7XG4gICAgaWYgKHRoaXMucHJvcHMuZGVsYXlQcmVzc0luKSB7XG4gICAgICB0aGlzLnByZXNzSW5UaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMubW92ZVRvU3RhdGUoVE9VQ0hBQkxFX1NUQVRFLkJFR0FOKTtcbiAgICAgICAgdGhpcy5wcmVzc0luVGltZW91dCA9IG51bGw7XG4gICAgICB9LCB0aGlzLnByb3BzLmRlbGF5UHJlc3NJbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubW92ZVRvU3RhdGUoVE9VQ0hBQkxFX1NUQVRFLkJFR0FOKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucHJvcHMub25Mb25nUHJlc3MpIHtcbiAgICAgIGNvbnN0IHRpbWUgPVxuICAgICAgICAodGhpcy5wcm9wcy5kZWxheVByZXNzSW4gfHwgMCkgKyAodGhpcy5wcm9wcy5kZWxheUxvbmdQcmVzcyB8fCAwKTtcbiAgICAgIHRoaXMubG9uZ1ByZXNzVGltZW91dCA9IHNldFRpbWVvdXQodGhpcy5vbkxvbmdQcmVzc0RldGVjdGVkLCB0aW1lKTtcbiAgICB9XG4gIH1cbiAgLy8gaGFuZGxlTW92ZU91dHNpZGUgaW4gY2FsbGVkIG9uIHRyYXZlbGluZyBvdXRzaWRlIGNvbXBvbmVudC5cbiAgLy8gSGFuZGxlcyBzdGF0ZSB0cmFuc2l0aW9uIHdpdGggZGVsYXkuXG4gIGhhbmRsZU1vdmVPdXRzaWRlKCkge1xuICAgIGlmICh0aGlzLnByb3BzLmRlbGF5UHJlc3NPdXQpIHtcbiAgICAgIHRoaXMucHJlc3NPdXRUaW1lb3V0ID1cbiAgICAgICAgdGhpcy5wcmVzc091dFRpbWVvdXQgfHxcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5tb3ZlVG9TdGF0ZShUT1VDSEFCTEVfU1RBVEUuTU9WRURfT1VUU0lERSk7XG4gICAgICAgICAgdGhpcy5wcmVzc091dFRpbWVvdXQgPSBudWxsO1xuICAgICAgICB9LCB0aGlzLnByb3BzLmRlbGF5UHJlc3NPdXQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm1vdmVUb1N0YXRlKFRPVUNIQUJMRV9TVEFURS5NT1ZFRF9PVVRTSURFKTtcbiAgICB9XG4gIH1cblxuICAvLyBoYW5kbGVHb1RvVW5kZXRlcm1pbmVkIHRyYW5zaXRzIHRvIFVOREVURVJNSU5FRCBzdGF0ZSB3aXRoIHByb3BlciBkZWxheVxuICBoYW5kbGVHb1RvVW5kZXRlcm1pbmVkKCkge1xuICAgIGNsZWFyVGltZW91dCh0aGlzLnByZXNzT3V0VGltZW91dCEpOyAvLyBUT0RPOiBtYXliZSBpdCBjYW4gYmUgdW5kZWZpbmVkXG4gICAgaWYgKHRoaXMucHJvcHMuZGVsYXlQcmVzc091dCkge1xuICAgICAgdGhpcy5wcmVzc091dFRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuU1RBVEUgPT09IFRPVUNIQUJMRV9TVEFURS5VTkRFVEVSTUlORUQpIHtcbiAgICAgICAgICB0aGlzLm1vdmVUb1N0YXRlKFRPVUNIQUJMRV9TVEFURS5CRUdBTik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tb3ZlVG9TdGF0ZShUT1VDSEFCTEVfU1RBVEUuVU5ERVRFUk1JTkVEKTtcbiAgICAgICAgdGhpcy5wcmVzc091dFRpbWVvdXQgPSBudWxsO1xuICAgICAgfSwgdGhpcy5wcm9wcy5kZWxheVByZXNzT3V0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuU1RBVEUgPT09IFRPVUNIQUJMRV9TVEFURS5VTkRFVEVSTUlORUQpIHtcbiAgICAgICAgdGhpcy5tb3ZlVG9TdGF0ZShUT1VDSEFCTEVfU1RBVEUuQkVHQU4pO1xuICAgICAgfVxuICAgICAgdGhpcy5tb3ZlVG9TdGF0ZShUT1VDSEFCTEVfU1RBVEUuVU5ERVRFUk1JTkVEKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB0aGlzLnJlc2V0KCk7XG4gIH1cbiAgLy8gcmVzZXQgdGltZW91dCB0byBwcmV2ZW50IG1lbW9yeSBsZWFrcy5cbiAgcmVzZXQoKSB7XG4gICAgdGhpcy5sb25nUHJlc3NEZXRlY3RlZCA9IGZhbHNlO1xuICAgIHRoaXMucG9pbnRlckluc2lkZSA9IHRydWU7XG4gICAgY2xlYXJUaW1lb3V0KHRoaXMucHJlc3NJblRpbWVvdXQhKTtcbiAgICBjbGVhclRpbWVvdXQodGhpcy5wcmVzc091dFRpbWVvdXQhKTtcbiAgICBjbGVhclRpbWVvdXQodGhpcy5sb25nUHJlc3NUaW1lb3V0ISk7XG4gICAgdGhpcy5wcmVzc091dFRpbWVvdXQgPSBudWxsO1xuICAgIHRoaXMubG9uZ1ByZXNzVGltZW91dCA9IG51bGw7XG4gICAgdGhpcy5wcmVzc0luVGltZW91dCA9IG51bGw7XG4gIH1cblxuICAvLyBBbGwgc3RhdGVzJyB0cmFuc2l0aW9ucyBhcmUgZGVmaW5lZCBoZXJlLlxuICBtb3ZlVG9TdGF0ZShuZXdTdGF0ZTogVG91Y2hhYmxlU3RhdGUpIHtcbiAgICBpZiAobmV3U3RhdGUgPT09IHRoaXMuU1RBVEUpIHtcbiAgICAgIC8vIElnbm9yZSBkdW1teSB0cmFuc2l0aW9uc1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAobmV3U3RhdGUgPT09IFRPVUNIQUJMRV9TVEFURS5CRUdBTikge1xuICAgICAgLy8gRmlyc3QgdG91Y2ggYW5kIG1vdmluZyBpbnNpZGVcbiAgICAgIHRoaXMucHJvcHMub25QcmVzc0luPy4oKTtcbiAgICB9IGVsc2UgaWYgKG5ld1N0YXRlID09PSBUT1VDSEFCTEVfU1RBVEUuTU9WRURfT1VUU0lERSkge1xuICAgICAgLy8gTW92aW5nIG91dHNpZGVcbiAgICAgIHRoaXMucHJvcHMub25QcmVzc091dD8uKCk7XG4gICAgfSBlbHNlIGlmIChuZXdTdGF0ZSA9PT0gVE9VQ0hBQkxFX1NUQVRFLlVOREVURVJNSU5FRCkge1xuICAgICAgLy8gTmVlZCB0byByZXNldCBlYWNoIHRpbWUgb24gdHJhbnNpdGlvbiB0byBVTkRFVEVSTUlORURcbiAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgIGlmICh0aGlzLlNUQVRFID09PSBUT1VDSEFCTEVfU1RBVEUuQkVHQU4pIHtcbiAgICAgICAgLy8gLi4uIGFuZCBpZiBpdCBoYXBwZW5zIGluc2lkZSBidXR0b24uXG4gICAgICAgIHRoaXMucHJvcHMub25QcmVzc091dD8uKCk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIEZpbmFsbHkgY2FsbCBsaXN0ZXIgKHVzZWQgYnkgc3ViY2xhc3NlcylcbiAgICB0aGlzLnByb3BzLm9uU3RhdGVDaGFuZ2U/Lih0aGlzLlNUQVRFLCBuZXdTdGF0ZSk7XG4gICAgLy8gLi4uIGFuZCBtYWtlIHRyYW5zaXRpb24uXG4gICAgdGhpcy5TVEFURSA9IG5ld1N0YXRlO1xuICB9XG5cbiAgb25HZXN0dXJlRXZlbnQgPSAoe1xuICAgIG5hdGl2ZUV2ZW50OiB7IHBvaW50ZXJJbnNpZGUgfSxcbiAgfTogR2VzdHVyZUV2ZW50PE5hdGl2ZVZpZXdHZXN0dXJlSGFuZGxlclBheWxvYWQ+KSA9PiB7XG4gICAgaWYgKHRoaXMucG9pbnRlckluc2lkZSAhPT0gcG9pbnRlckluc2lkZSkge1xuICAgICAgaWYgKHBvaW50ZXJJbnNpZGUpIHtcbiAgICAgICAgdGhpcy5vbk1vdmVJbigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5vbk1vdmVPdXQoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5wb2ludGVySW5zaWRlID0gcG9pbnRlckluc2lkZTtcbiAgfTtcblxuICBvbkhhbmRsZXJTdGF0ZUNoYW5nZSA9ICh7XG4gICAgbmF0aXZlRXZlbnQsXG4gIH06IEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50PE5hdGl2ZVZpZXdHZXN0dXJlSGFuZGxlclBheWxvYWQ+KSA9PiB7XG4gICAgY29uc3QgeyBzdGF0ZSB9ID0gbmF0aXZlRXZlbnQ7XG4gICAgaWYgKHN0YXRlID09PSBTdGF0ZS5DQU5DRUxMRUQgfHwgc3RhdGUgPT09IFN0YXRlLkZBSUxFRCkge1xuICAgICAgLy8gTmVlZCB0byBoYW5kbGUgY2FzZSB3aXRoIGV4dGVybmFsIGNhbmNlbGxhdGlvbiAoZS5nLiBieSBTY3JvbGxWaWV3KVxuICAgICAgdGhpcy5tb3ZlVG9TdGF0ZShUT1VDSEFCTEVfU1RBVEUuVU5ERVRFUk1JTkVEKTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgLy8gVGhpcyBwbGF0Zm9ybSBjaGVjayBpcyBhbiBpbXBsaWNhdGlvbiBvZiBzbGlnaHRseSBkaWZmZXJlbnQgYmVoYXZpb3Igb2YgaGFuZGxlcnMgb24gZGlmZmVyZW50IHBsYXRmb3JtLlxuICAgICAgLy8gQW5kIEFuZHJvaWQgXCJBY3RpdmVcIiBzdGF0ZSBpcyBhY2hpZXZpbmcgb24gZmlyc3QgbW92ZSBvZiBhIGZpbmdlciwgbm90IG9uIHByZXNzIGluLlxuICAgICAgLy8gT24gaU9TIGV2ZW50IG9uIFwiQmVnYW5cIiBpcyBub3QgZGVsaXZlcmVkLlxuICAgICAgc3RhdGUgPT09IChQbGF0Zm9ybS5PUyAhPT0gJ2FuZHJvaWQnID8gU3RhdGUuQUNUSVZFIDogU3RhdGUuQkVHQU4pICYmXG4gICAgICB0aGlzLlNUQVRFID09PSBUT1VDSEFCTEVfU1RBVEUuVU5ERVRFUk1JTkVEXG4gICAgKSB7XG4gICAgICAvLyBNb3ZpbmcgaW5zaWRlIHJlcXVpcmVzXG4gICAgICB0aGlzLmhhbmRsZVByZXNzSW4oKTtcbiAgICB9IGVsc2UgaWYgKHN0YXRlID09PSBTdGF0ZS5FTkQpIHtcbiAgICAgIGNvbnN0IHNob3VsZENhbGxPblByZXNzID1cbiAgICAgICAgIXRoaXMubG9uZ1ByZXNzRGV0ZWN0ZWQgJiZcbiAgICAgICAgdGhpcy5TVEFURSAhPT0gVE9VQ0hBQkxFX1NUQVRFLk1PVkVEX09VVFNJREUgJiZcbiAgICAgICAgdGhpcy5wcmVzc091dFRpbWVvdXQgPT09IG51bGw7XG4gICAgICB0aGlzLmhhbmRsZUdvVG9VbmRldGVybWluZWQoKTtcbiAgICAgIGlmIChzaG91bGRDYWxsT25QcmVzcykge1xuICAgICAgICAvLyBDYWxscyBvbmx5IGluc2lkZSBjb21wb25lbnQgd2hldGhlciBubyBsb25nIHByZXNzIHdhcyBjYWxsZWQgcHJldmlvdXNseVxuICAgICAgICB0aGlzLnByb3BzLm9uUHJlc3M/LigpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBvbkxvbmdQcmVzc0RldGVjdGVkID0gKCkgPT4ge1xuICAgIHRoaXMubG9uZ1ByZXNzRGV0ZWN0ZWQgPSB0cnVlO1xuICAgIC8vIGNoZWNrZWQgZm9yIGluIHRoZSBjYWxsZXIgb2YgYG9uTG9uZ1ByZXNzRGV0ZWN0ZWRgLCBidXQgYmV0dGVyIHRvIGNoZWNrIHR3aWNlXG4gICAgdGhpcy5wcm9wcy5vbkxvbmdQcmVzcz8uKCk7XG4gIH07XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgLy8gdG8gcHJldmVudCBtZW1vcnkgbGVha3NcbiAgICB0aGlzLnJlc2V0KCk7XG4gIH1cblxuICBvbk1vdmVJbigpIHtcbiAgICBpZiAodGhpcy5TVEFURSA9PT0gVE9VQ0hBQkxFX1NUQVRFLk1PVkVEX09VVFNJREUpIHtcbiAgICAgIC8vIFRoaXMgY2FsbCBpcyBub3QgdGhyb3R0bGVkIHdpdGggZGVsYXlzIChsaWtlIGluIFJOJ3MgaW1wbGVtZW50YXRpb24pLlxuICAgICAgdGhpcy5tb3ZlVG9TdGF0ZShUT1VDSEFCTEVfU1RBVEUuQkVHQU4pO1xuICAgIH1cbiAgfVxuXG4gIG9uTW92ZU91dCgpIHtcbiAgICAvLyBsb25nIHByZXNzIHNob3VsZCBubyBsb25nZXIgYmUgZGV0ZWN0ZWRcbiAgICBjbGVhclRpbWVvdXQodGhpcy5sb25nUHJlc3NUaW1lb3V0ISk7XG4gICAgdGhpcy5sb25nUHJlc3NUaW1lb3V0ID0gbnVsbDtcbiAgICBpZiAodGhpcy5TVEFURSA9PT0gVE9VQ0hBQkxFX1NUQVRFLkJFR0FOKSB7XG4gICAgICB0aGlzLmhhbmRsZU1vdmVPdXRzaWRlKCk7XG4gICAgfVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IGNvcmVQcm9wcyA9IHtcbiAgICAgIGFjY2Vzc2libGU6IHRoaXMucHJvcHMuYWNjZXNzaWJsZSAhPT0gZmFsc2UsXG4gICAgICBhY2Nlc3NpYmlsaXR5TGFiZWw6IHRoaXMucHJvcHMuYWNjZXNzaWJpbGl0eUxhYmVsLFxuICAgICAgYWNjZXNzaWJpbGl0eUhpbnQ6IHRoaXMucHJvcHMuYWNjZXNzaWJpbGl0eUhpbnQsXG4gICAgICBhY2Nlc3NpYmlsaXR5Um9sZTogdGhpcy5wcm9wcy5hY2Nlc3NpYmlsaXR5Um9sZSxcbiAgICAgIC8vIFRPRE86IGNoZWNrIGlmIGNoYW5nZWQgdG8gbm8gJ3MnIGNvcnJlY3RseSwgYWxzbyByZW1vdmVkIDIgcHJvcHMgdGhhdCBhcmUgbm8gbG9uZ2VyIGF2YWlsYWJsZTogYGFjY2Vzc2liaWxpdHlDb21wb25lbnRUeXBlYCBhbmQgYGFjY2Vzc2liaWxpdHlUcmFpdHNgLFxuICAgICAgLy8gd291bGQgYmUgZ29vZCB0byBjaGVjayBpZiBpdCBpcyBvayBmb3Igc3VyZSwgc2VlOiBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVhY3QtbmF0aXZlL2lzc3Vlcy8yNDAxNlxuICAgICAgYWNjZXNzaWJpbGl0eVN0YXRlOiB0aGlzLnByb3BzLmFjY2Vzc2liaWxpdHlTdGF0ZSxcbiAgICAgIG5hdGl2ZUlEOiB0aGlzLnByb3BzLm5hdGl2ZUlELFxuICAgICAgb25MYXlvdXQ6IHRoaXMucHJvcHMub25MYXlvdXQsXG4gICAgICBoaXRTbG9wOiB0aGlzLnByb3BzLmhpdFNsb3AsXG4gICAgfTtcblxuICAgIHJldHVybiAoXG4gICAgICA8QmFzZUJ1dHRvblxuICAgICAgICBzdHlsZT17dGhpcy5wcm9wcy5jb250YWluZXJTdHlsZX1cbiAgICAgICAgb25IYW5kbGVyU3RhdGVDaGFuZ2U9e1xuICAgICAgICAgIC8vIFRPRE86IG5vdCBzdXJlIGlmIGl0IGNhbiBiZSB1bmRlZmluZWQgaW5zdGVhZCBvZiBudWxsXG4gICAgICAgICAgdGhpcy5wcm9wcy5kaXNhYmxlZCA/IHVuZGVmaW5lZCA6IHRoaXMub25IYW5kbGVyU3RhdGVDaGFuZ2VcbiAgICAgICAgfVxuICAgICAgICBvbkdlc3R1cmVFdmVudD17dGhpcy5vbkdlc3R1cmVFdmVudH1cbiAgICAgICAgaGl0U2xvcD17dGhpcy5wcm9wcy5oaXRTbG9wfVxuICAgICAgICBzaG91bGRBY3RpdmF0ZU9uU3RhcnQ9e3RoaXMucHJvcHMuc2hvdWxkQWN0aXZhdGVPblN0YXJ0fVxuICAgICAgICBkaXNhbGxvd0ludGVycnVwdGlvbj17dGhpcy5wcm9wcy5kaXNhbGxvd0ludGVycnVwdGlvbn1cbiAgICAgICAgdGVzdElEPXt0aGlzLnByb3BzLnRlc3RJRH1cbiAgICAgICAgey4uLnRoaXMucHJvcHMuZXh0cmFCdXR0b25Qcm9wc30+XG4gICAgICAgIDxBbmltYXRlZC5WaWV3IHsuLi5jb3JlUHJvcHN9IHN0eWxlPXt0aGlzLnByb3BzLnN0eWxlfT5cbiAgICAgICAgICB7dGhpcy5wcm9wcy5jaGlsZHJlbn1cbiAgICAgICAgPC9BbmltYXRlZC5WaWV3PlxuICAgICAgPC9CYXNlQnV0dG9uPlxuICAgICk7XG4gIH1cbn1cbiJdfQ==