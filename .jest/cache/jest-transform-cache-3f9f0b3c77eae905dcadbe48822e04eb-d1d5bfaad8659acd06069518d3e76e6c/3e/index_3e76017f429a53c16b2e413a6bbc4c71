7f6bce7fabe3dd036c40a5a0df17a56d
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.codeFrameColumns = codeFrameColumns;
exports.default = _default;

var _highlight = require("@babel/highlight");

var deprecationWarningShown = false;

function getDefs(chalk) {
  return {
    gutter: chalk.grey,
    marker: chalk.red.bold,
    message: chalk.red.bold
  };
}

var NEWLINE = /\r\n|[\n\r\u2028\u2029]/;

function getMarkerLines(loc, source, opts) {
  var startLoc = (0, _extends2.default)({
    column: 0,
    line: -1
  }, loc.start);
  var endLoc = (0, _extends2.default)({}, startLoc, loc.end);

  var _ref = opts || {},
      _ref$linesAbove = _ref.linesAbove,
      linesAbove = _ref$linesAbove === void 0 ? 2 : _ref$linesAbove,
      _ref$linesBelow = _ref.linesBelow,
      linesBelow = _ref$linesBelow === void 0 ? 3 : _ref$linesBelow;

  var startLine = startLoc.line;
  var startColumn = startLoc.column;
  var endLine = endLoc.line;
  var endColumn = endLoc.column;
  var start = Math.max(startLine - (linesAbove + 1), 0);
  var end = Math.min(source.length, endLine + linesBelow);

  if (startLine === -1) {
    start = 0;
  }

  if (endLine === -1) {
    end = source.length;
  }

  var lineDiff = endLine - startLine;
  var markerLines = {};

  if (lineDiff) {
    for (var i = 0; i <= lineDiff; i++) {
      var lineNumber = i + startLine;

      if (!startColumn) {
        markerLines[lineNumber] = true;
      } else if (i === 0) {
        var sourceLength = source[lineNumber - 1].length;
        markerLines[lineNumber] = [startColumn, sourceLength - startColumn + 1];
      } else if (i === lineDiff) {
        markerLines[lineNumber] = [0, endColumn];
      } else {
        var _sourceLength = source[lineNumber - i].length;
        markerLines[lineNumber] = [0, _sourceLength];
      }
    }
  } else {
    if (startColumn === endColumn) {
      if (startColumn) {
        markerLines[startLine] = [startColumn, 0];
      } else {
        markerLines[startLine] = true;
      }
    } else {
      markerLines[startLine] = [startColumn, endColumn - startColumn];
    }
  }

  return {
    start: start,
    end: end,
    markerLines: markerLines
  };
}

function codeFrameColumns(rawLines, loc) {
  var opts = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  var highlighted = (opts.highlightCode || opts.forceColor) && (0, _highlight.shouldHighlight)(opts);
  var chalk = (0, _highlight.getChalk)(opts);
  var defs = getDefs(chalk);

  var maybeHighlight = function maybeHighlight(chalkFn, string) {
    return highlighted ? chalkFn(string) : string;
  };

  var lines = rawLines.split(NEWLINE);

  var _getMarkerLines = getMarkerLines(loc, lines, opts),
      start = _getMarkerLines.start,
      end = _getMarkerLines.end,
      markerLines = _getMarkerLines.markerLines;

  var hasColumns = loc.start && typeof loc.start.column === "number";
  var numberMaxWidth = String(end).length;
  var highlightedLines = highlighted ? (0, _highlight.default)(rawLines, opts) : rawLines;
  var frame = highlightedLines.split(NEWLINE).slice(start, end).map(function (line, index) {
    var number = start + 1 + index;
    var paddedNumber = (" " + number).slice(-numberMaxWidth);
    var gutter = " " + paddedNumber + " |";
    var hasMarker = markerLines[number];
    var lastMarkerLine = !markerLines[number + 1];

    if (hasMarker) {
      var markerLine = "";

      if (Array.isArray(hasMarker)) {
        var markerSpacing = line.slice(0, Math.max(hasMarker[0] - 1, 0)).replace(/[^\t]/g, " ");
        var numberOfMarkers = hasMarker[1] || 1;
        markerLine = ["\n ", maybeHighlight(defs.gutter, gutter.replace(/\d/g, " ")), " ", markerSpacing, maybeHighlight(defs.marker, "^").repeat(numberOfMarkers)].join("");

        if (lastMarkerLine && opts.message) {
          markerLine += " " + maybeHighlight(defs.message, opts.message);
        }
      }

      return [maybeHighlight(defs.marker, ">"), maybeHighlight(defs.gutter, gutter), line.length > 0 ? " " + line : "", markerLine].join("");
    } else {
      return " " + maybeHighlight(defs.gutter, gutter) + (line.length > 0 ? " " + line : "");
    }
  }).join("\n");

  if (opts.message && !hasColumns) {
    frame = "" + " ".repeat(numberMaxWidth + 1) + opts.message + "\n" + frame;
  }

  if (highlighted) {
    return chalk.reset(frame);
  } else {
    return frame;
  }
}

function _default(rawLines, lineNumber, colNumber) {
  var opts = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};

  if (!deprecationWarningShown) {
    deprecationWarningShown = true;
    var message = "Passing lineNumber and colNumber is deprecated to @babel/code-frame. Please use `codeFrameColumns`.";

    if (process.emitWarning) {
      process.emitWarning(message, "DeprecationWarning");
    } else {
      var deprecationError = new Error(message);
      deprecationError.name = "DeprecationWarning";
      console.warn(new Error(message));
    }
  }

  colNumber = Math.max(colNumber, 0);
  var location = {
    start: {
      column: colNumber,
      line: lineNumber
    }
  };
  return codeFrameColumns(rawLines, location, opts);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiY29kZUZyYW1lQ29sdW1ucyIsImRlZmF1bHQiLCJfZGVmYXVsdCIsIl9oaWdobGlnaHQiLCJyZXF1aXJlIiwiZGVwcmVjYXRpb25XYXJuaW5nU2hvd24iLCJnZXREZWZzIiwiY2hhbGsiLCJndXR0ZXIiLCJncmV5IiwibWFya2VyIiwicmVkIiwiYm9sZCIsIm1lc3NhZ2UiLCJORVdMSU5FIiwiZ2V0TWFya2VyTGluZXMiLCJsb2MiLCJzb3VyY2UiLCJvcHRzIiwic3RhcnRMb2MiLCJjb2x1bW4iLCJsaW5lIiwic3RhcnQiLCJlbmRMb2MiLCJlbmQiLCJsaW5lc0Fib3ZlIiwibGluZXNCZWxvdyIsInN0YXJ0TGluZSIsInN0YXJ0Q29sdW1uIiwiZW5kTGluZSIsImVuZENvbHVtbiIsIk1hdGgiLCJtYXgiLCJtaW4iLCJsZW5ndGgiLCJsaW5lRGlmZiIsIm1hcmtlckxpbmVzIiwiaSIsImxpbmVOdW1iZXIiLCJzb3VyY2VMZW5ndGgiLCJyYXdMaW5lcyIsImhpZ2hsaWdodGVkIiwiaGlnaGxpZ2h0Q29kZSIsImZvcmNlQ29sb3IiLCJzaG91bGRIaWdobGlnaHQiLCJnZXRDaGFsayIsImRlZnMiLCJtYXliZUhpZ2hsaWdodCIsImNoYWxrRm4iLCJzdHJpbmciLCJsaW5lcyIsInNwbGl0IiwiaGFzQ29sdW1ucyIsIm51bWJlck1heFdpZHRoIiwiU3RyaW5nIiwiaGlnaGxpZ2h0ZWRMaW5lcyIsImZyYW1lIiwic2xpY2UiLCJtYXAiLCJpbmRleCIsIm51bWJlciIsInBhZGRlZE51bWJlciIsImhhc01hcmtlciIsImxhc3RNYXJrZXJMaW5lIiwibWFya2VyTGluZSIsIkFycmF5IiwiaXNBcnJheSIsIm1hcmtlclNwYWNpbmciLCJyZXBsYWNlIiwibnVtYmVyT2ZNYXJrZXJzIiwicmVwZWF0Iiwiam9pbiIsInJlc2V0IiwiY29sTnVtYmVyIiwicHJvY2VzcyIsImVtaXRXYXJuaW5nIiwiZGVwcmVjYXRpb25FcnJvciIsIkVycm9yIiwibmFtZSIsImNvbnNvbGUiLCJ3YXJuIiwibG9jYXRpb24iXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7QUFFQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUMzQ0MsRUFBQUEsS0FBSyxFQUFFO0FBRG9DLENBQTdDO0FBR0FELE9BQU8sQ0FBQ0UsZ0JBQVIsR0FBMkJBLGdCQUEzQjtBQUNBRixPQUFPLENBQUNHLE9BQVIsR0FBa0JDLFFBQWxCOztBQUVBLElBQUlDLFVBQVUsR0FBR0MsT0FBTyxDQUFDLGtCQUFELENBQXhCOztBQUVBLElBQUlDLHVCQUF1QixHQUFHLEtBQTlCOztBQUVBLFNBQVNDLE9BQVQsQ0FBaUJDLEtBQWpCLEVBQXdCO0FBQ3RCLFNBQU87QUFDTEMsSUFBQUEsTUFBTSxFQUFFRCxLQUFLLENBQUNFLElBRFQ7QUFFTEMsSUFBQUEsTUFBTSxFQUFFSCxLQUFLLENBQUNJLEdBQU4sQ0FBVUMsSUFGYjtBQUdMQyxJQUFBQSxPQUFPLEVBQUVOLEtBQUssQ0FBQ0ksR0FBTixDQUFVQztBQUhkLEdBQVA7QUFLRDs7QUFFRCxJQUFNRSxPQUFPLEdBQUcseUJBQWhCOztBQUVBLFNBQVNDLGNBQVQsQ0FBd0JDLEdBQXhCLEVBQTZCQyxNQUE3QixFQUFxQ0MsSUFBckMsRUFBMkM7QUFDekMsTUFBTUMsUUFBUSxHQUFHLHVCQUFjO0FBQzdCQyxJQUFBQSxNQUFNLEVBQUUsQ0FEcUI7QUFFN0JDLElBQUFBLElBQUksRUFBRSxDQUFDO0FBRnNCLEdBQWQsRUFHZEwsR0FBRyxDQUFDTSxLQUhVLENBQWpCO0FBSUEsTUFBTUMsTUFBTSxHQUFHLHVCQUFjLEVBQWQsRUFBa0JKLFFBQWxCLEVBQTRCSCxHQUFHLENBQUNRLEdBQWhDLENBQWY7O0FBQ0EsYUFHSU4sSUFBSSxJQUFJLEVBSFo7QUFBQSw2QkFDRU8sVUFERjtBQUFBLE1BQ0VBLFVBREYsZ0NBQ2UsQ0FEZjtBQUFB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QVcsdUVBQUosRUFBSTs7QUFDNUQsTUFBSSxDQUFDYix1QkFBTCxFQUE4QjtBQUM1QkEsSUFBQUEsdUJBQXVCLEdBQUcsSUFBMUI7QUFDQSxRQUFNUSxPQUFPLEdBQUcscUdBQWhCOztBQUVBLFFBQUk2RCxPQUFPLENBQUNDLFdBQVosRUFBeUI7QUFDdkJELE1BQUFBLE9BQU8sQ0FBQ0MsV0FBUixDQUFvQjlELE9BQXBCLEVBQTZCLG9CQUE3QjtBQUNELEtBRkQsTUFFTztBQUNMLFVBQU0rRCxnQkFBZ0IsR0FBRyxJQUFJQyxLQUFKLENBQVVoRSxPQUFWLENBQXpCO0FBQ0ErRCxNQUFBQSxnQkFBZ0IsQ0FBQ0UsSUFBakIsR0FBd0Isb0JBQXhCO0FBQ0FDLE1BQUFBLE9BQU8sQ0FBQ0MsSUFBUixDQUFhLElBQUlILEtBQUosQ0FBVWhFLE9BQVYsQ0FBYjtBQUNEO0FBQ0Y7O0FBRUQ0RCxFQUFBQSxTQUFTLEdBQUcxQyxJQUFJLENBQUNDLEdBQUwsQ0FBU3lDLFNBQVQsRUFBb0IsQ0FBcEIsQ0FBWjtBQUNBLE1BQU1RLFFBQVEsR0FBRztBQUNmM0QsSUFBQUEsS0FBSyxFQUFFO0FBQ0xGLE1BQUFBLE1BQU0sRUFBRXFELFNBREg7QUFFTHBELE1BQUFBLElBQUksRUFBRWlCO0FBRkQ7QUFEUSxHQUFqQjtBQU1BLFNBQU90QyxnQkFBZ0IsQ0FBQ3dDLFFBQUQsRUFBV3lDLFFBQVgsRUFBcUIvRCxJQUFyQixDQUF2QjtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmNvZGVGcmFtZUNvbHVtbnMgPSBjb2RlRnJhbWVDb2x1bW5zO1xuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7XG5cbnZhciBfaGlnaGxpZ2h0ID0gcmVxdWlyZShcIkBiYWJlbC9oaWdobGlnaHRcIik7XG5cbmxldCBkZXByZWNhdGlvbldhcm5pbmdTaG93biA9IGZhbHNlO1xuXG5mdW5jdGlvbiBnZXREZWZzKGNoYWxrKSB7XG4gIHJldHVybiB7XG4gICAgZ3V0dGVyOiBjaGFsay5ncmV5LFxuICAgIG1hcmtlcjogY2hhbGsucmVkLmJvbGQsXG4gICAgbWVzc2FnZTogY2hhbGsucmVkLmJvbGRcbiAgfTtcbn1cblxuY29uc3QgTkVXTElORSA9IC9cXHJcXG58W1xcblxcclxcdTIwMjhcXHUyMDI5XS87XG5cbmZ1bmN0aW9uIGdldE1hcmtlckxpbmVzKGxvYywgc291cmNlLCBvcHRzKSB7XG4gIGNvbnN0IHN0YXJ0TG9jID0gT2JqZWN0LmFzc2lnbih7XG4gICAgY29sdW1uOiAwLFxuICAgIGxpbmU6IC0xXG4gIH0sIGxvYy5zdGFydCk7XG4gIGNvbnN0IGVuZExvYyA9IE9iamVjdC5hc3NpZ24oe30sIHN0YXJ0TG9jLCBsb2MuZW5kKTtcbiAgY29uc3Qge1xuICAgIGxpbmVzQWJvdmUgPSAyLFxuICAgIGxpbmVzQmVsb3cgPSAzXG4gIH0gPSBvcHRzIHx8IHt9O1xuICBjb25zdCBzdGFydExpbmUgPSBzdGFydExvYy5saW5lO1xuICBjb25zdCBzdGFydENvbHVtbiA9IHN0YXJ0TG9jLmNvbHVtbjtcbiAgY29uc3QgZW5kTGluZSA9IGVuZExvYy5saW5lO1xuICBjb25zdCBlbmRDb2x1bW4gPSBlbmRMb2MuY29sdW1uO1xuICBsZXQgc3RhcnQgPSBNYXRoLm1heChzdGFydExpbmUgLSAobGluZXNBYm92ZSArIDEpLCAwKTtcbiAgbGV0IGVuZCA9IE1hdGgubWluKHNvdXJjZS5sZW5ndGgsIGVuZExpbmUgKyBsaW5lc0JlbG93KTtcblxuICBpZiAoc3RhcnRMaW5lID09PSAtMSkge1xuICAgIHN0YXJ0ID0gMDtcbiAgfVxuXG4gIGlmIChlbmRMaW5lID09PSAtMSkge1xuICAgIGVuZCA9IHNvdXJjZS5sZW5ndGg7XG4gIH1cblxuICBjb25zdCBsaW5lRGlmZiA9IGVuZExpbmUgLSBzdGFydExpbmU7XG4gIGNvbnN0IG1hcmtlckxpbmVzID0ge307XG5cbiAgaWYgKGxpbmVEaWZmKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbGluZURpZmY7IGkrKykge1xuICAgICAgY29uc3QgbGluZU51bWJlciA9IGkgKyBzdGFydExpbmU7XG5cbiAgICAgIGlmICghc3RhcnRDb2x1bW4pIHtcbiAgICAgICAgbWFya2VyTGluZXNbbGluZU51bWJlcl0gPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChpID09PSAwKSB7XG4gICAgICAgIGNvbnN0IHNvdXJjZUxlbmd0aCA9IHNvdXJjZVtsaW5lTnVtYmVyIC0gMV0ubGVuZ3RoO1xuICAgICAgICBtYXJrZXJMaW5lc1tsaW5lTnVtYmVyXSA9IFtzdGFydENvbHVtbiwgc291cmNlTGVuZ3RoIC0gc3RhcnRDb2x1bW4gKyAxXTtcbiAgICAgIH0gZWxzZSBpZiAoaSA9PT0gbGluZURpZmYpIHtcbiAgICAgICAgbWFya2VyTGluZXNbbGluZU51bWJlcl0gPSBbMCwgZW5kQ29sdW1uXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHNvdXJjZUxlbmd0aCA9IHNvdXJjZVtsaW5lTnVtYmVyIC0gaV0ubGVuZ3RoO1xuICAgICAgICBtYXJrZXJMaW5lc1tsaW5lTnVtYmVyXSA9IFswLCBzb3VyY2VMZW5ndGhdO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpZiAoc3RhcnRDb2x1bW4gPT09IGVuZENvbHVtbikge1xuICAgICAgaWYgKHN0YXJ0Q29sdW1uKSB7XG4gICAgICAgIG1hcmtlckxpbmVzW3N0YXJ0TGluZV0gPSBbc3RhcnRDb2x1bW4sIDBdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWFya2VyTGluZXNbc3RhcnRMaW5lXSA9IHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIG1hcmtlckxpbmVzW3N0YXJ0TGluZV0gPSBbc3RhcnRDb2x1bW4sIGVuZENvbHVtbiAtIHN0YXJ0Q29sdW1uXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHN0YXJ0LFxuICAgIGVuZCxcbiAgICBtYXJrZXJMaW5lc1xuICB9O1xufVxuXG5mdW5jdGlvbiBjb2RlRnJhbWVDb2x1bW5zKHJhd0xpbmVzLCBsb2MsIG9wdHMgPSB7fSkge1xuICBjb25zdCBoaWdobGlnaHRlZCA9IChvcHRzLmhpZ2hsaWdodENvZGUgfHwgb3B0cy5mb3JjZUNvbG9yKSAmJiAoMCwgX2hpZ2hsaWdodC5zaG91bGRIaWdobGlnaHQpKG9wdHMpO1xuICBjb25zdCBjaGFsayA9ICgwLCBfaGlnaGxpZ2h0LmdldENoYWxrKShvcHRzKTtcbiAgY29uc3QgZGVmcyA9IGdldERlZnMoY2hhbGspO1xuXG4gIGNvbnN0IG1heWJlSGlnaGxpZ2h0ID0gKGNoYWxrRm4sIHN0cmluZykgPT4ge1xuICAgIHJldHVybiBoaWdobGlnaHRlZCA/IGNoYWxrRm4oc3RyaW5nKSA6IHN0cmluZztcbiAgfTtcblxuICBjb25zdCBsaW5lcyA9IHJhd0xpbmVzLnNwbGl0KE5FV0xJTkUpO1xuICBjb25zdCB7XG4gICAgc3RhcnQsXG4gICAgZW5kLFxuICAgIG1hcmtlckxpbmVzXG4gIH0gPSBnZXRNYXJrZXJMaW5lcyhsb2MsIGxpbmVzLCBvcHRzKTtcbiAgY29uc3QgaGFzQ29sdW1ucyA9IGxvYy5zdGFydCAmJiB0eXBlb2YgbG9jLnN0YXJ0LmNvbHVtbiA9PT0gXCJudW1iZXJcIjtcbiAgY29uc3QgbnVtYmVyTWF4V2lkdGggPSBTdHJpbmcoZW5kKS5sZW5ndGg7XG4gIGNvbnN0IGhpZ2hsaWdodGVkTGluZXMgPSBoaWdobGlnaHRlZCA/ICgwLCBfaGlnaGxpZ2h0LmRlZmF1bHQpKHJhd0xpbmVzLCBvcHRzKSA6IHJhd0xpbmVzO1xuICBsZXQgZnJhbWUgPSBoaWdobGlnaHRlZExpbmVzLnNwbGl0KE5FV0xJTkUpLnNsaWNlKHN0YXJ0LCBlbmQpLm1hcCgobGluZSwgaW5kZXgpID0+IHtcbiAgICBjb25zdCBudW1iZXIgPSBzdGFydCArIDEgKyBpbmRleDtcbiAgICBjb25zdCBwYWRkZWROdW1iZXIgPSBgICR7bnVtYmVyfWAuc2xpY2UoLW51bWJlck1heFdpZHRoKTtcbiAgICBjb25zdCBndXR0ZXIgPSBgICR7cGFkZGVkTnVtYmVyfSB8YDtcbiAgICBjb25zdCBoYXNNYXJrZXIgPSBtYXJrZXJMaW5lc1tudW1iZXJdO1xuICAgIGNvbnN0IGxhc3RNYXJrZXJMaW5lID0gIW1hcmtlckxpbmVzW251bWJlciArIDFdO1xuXG4gICAgaWYgKGhhc01hcmtlcikge1xuICAgICAgbGV0IG1hcmtlckxpbmUgPSBcIlwiO1xuXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShoYXNNYXJrZXIpKSB7XG4gICAgICAgIGNvbnN0IG1hcmtlclNwYWNpbmcgPSBsaW5lLnNsaWNlKDAsIE1hdGgubWF4KGhhc01hcmtlclswXSAtIDEsIDApKS5yZXBsYWNlKC9bXlxcdF0vZywgXCIgXCIpO1xuICAgICAgICBjb25zdCBudW1iZXJPZk1hcmtlcnMgPSBoYXNNYXJrZXJbMV0gfHwgMTtcbiAgICAgICAgbWFya2VyTGluZSA9IFtcIlxcbiBcIiwgbWF5YmVIaWdobGlnaHQoZGVmcy5ndXR0ZXIsIGd1dHRlci5yZXBsYWNlKC9cXGQvZywgXCIgXCIpKSwgXCIgXCIsIG1hcmtlclNwYWNpbmcsIG1heWJlSGlnaGxpZ2h0KGRlZnMubWFya2VyLCBcIl5cIikucmVwZWF0KG51bWJlck9mTWFya2VycyldLmpvaW4oXCJcIik7XG5cbiAgICAgICAgaWYgKGxhc3RNYXJrZXJMaW5lICYmIG9wdHMubWVzc2FnZSkge1xuICAgICAgICAgIG1hcmtlckxpbmUgKz0gXCIgXCIgKyBtYXliZUhpZ2hsaWdodChkZWZzLm1lc3NhZ2UsIG9wdHMubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFttYXliZUhpZ2hsaWdodChkZWZzLm1hcmtlciwgXCI+XCIpLCBtYXliZUhpZ2hsaWdodChkZWZzLmd1dHRlciwgZ3V0dGVyKSwgbGluZS5sZW5ndGggPiAwID8gYCAke2xpbmV9YCA6IFwiXCIsIG1hcmtlckxpbmVdLmpvaW4oXCJcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgICR7bWF5YmVIaWdobGlnaHQoZGVmcy5ndXR0ZXIsIGd1dHRlcil9JHtsaW5lLmxlbmd0aCA+IDAgPyBgICR7bGluZX1gIDogXCJcIn1gO1xuICAgIH1cbiAgfSkuam9pbihcIlxcblwiKTtcblxuICBpZiAob3B0cy5tZXNzYWdlICYmICFoYXNDb2x1bW5zKSB7XG4gICAgZnJhbWUgPSBgJHtcIiBcIi5yZXBlYXQobnVtYmVyTWF4V2lkdGggKyAxKX0ke29wdHMubWVzc2FnZX1cXG4ke2ZyYW1lfWA7XG4gIH1cblxuICBpZiAoaGlnaGxpZ2h0ZWQpIHtcbiAgICByZXR1cm4gY2hhbGsucmVzZXQoZnJhbWUpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBmcmFtZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBfZGVmYXVsdChyYXdMaW5lcywgbGluZU51bWJlciwgY29sTnVtYmVyLCBvcHRzID0ge30pIHtcbiAgaWYgKCFkZXByZWNhdGlvbldhcm5pbmdTaG93bikge1xuICAgIGRlcHJlY2F0aW9uV2FybmluZ1Nob3duID0gdHJ1ZTtcbiAgICBjb25zdCBtZXNzYWdlID0gXCJQYXNzaW5nIGxpbmVOdW1iZXIgYW5kIGNvbE51bWJlciBpcyBkZXByZWNhdGVkIHRvIEBiYWJlbC9jb2RlLWZyYW1lLiBQbGVhc2UgdXNlIGBjb2RlRnJhbWVDb2x1bW5zYC5cIjtcblxuICAgIGlmIChwcm9jZXNzLmVtaXRXYXJuaW5nKSB7XG4gICAgICBwcm9jZXNzLmVtaXRXYXJuaW5nKG1lc3NhZ2UsIFwiRGVwcmVjYXRpb25XYXJuaW5nXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBkZXByZWNhdGlvbkVycm9yID0gbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgICAgZGVwcmVjYXRpb25FcnJvci5uYW1lID0gXCJEZXByZWNhdGlvbldhcm5pbmdcIjtcbiAgICAgIGNvbnNvbGUud2FybihuZXcgRXJyb3IobWVzc2FnZSkpO1xuICAgIH1cbiAgfVxuXG4gIGNvbE51bWJlciA9IE1hdGgubWF4KGNvbE51bWJlciwgMCk7XG4gIGNvbnN0IGxvY2F0aW9uID0ge1xuICAgIHN0YXJ0OiB7XG4gICAgICBjb2x1bW46IGNvbE51bWJlcixcbiAgICAgIGxpbmU6IGxpbmVOdW1iZXJcbiAgICB9XG4gIH07XG4gIHJldHVybiBjb2RlRnJhbWVDb2x1bW5zKHJhd0xpbmVzLCBsb2NhdGlvbiwgb3B0cyk7XG59Il19