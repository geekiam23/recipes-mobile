2302e73cf24b68b95afe36f7bfdcdfb4
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault2(require("@babel/runtime/helpers/objectWithoutProperties"));

var _excluded = ["filterNode"];

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.prettyDOM = prettyDOM;
exports.prettyFormat = exports.logDOM = void 0;

var prettyFormat = _interopRequireWildcard(require("pretty-format"));

exports.prettyFormat = prettyFormat;

var _DOMElementFilter = _interopRequireDefault(require("./DOMElementFilter"));

var _getUserCodeFrame = require("./get-user-code-frame");

var _helpers = require("./helpers");

var _shared = require("./shared");

function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}

function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache(nodeInterop);

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function inCypress(dom) {
  var window = dom.ownerDocument && dom.ownerDocument.defaultView || undefined;
  return typeof global !== 'undefined' && global.Cypress || typeof window !== 'undefined' && window.Cypress;
}

var inNode = function inNode() {
  return typeof process !== 'undefined' && process.versions !== undefined && process.versions.node !== undefined;
};

var getMaxLength = function getMaxLength(dom) {
  return inCypress(dom) ? 0 : typeof process !== 'undefined' && process.env.DEBUG_PRINT_LIMIT || 7000;
};

var DOMCollection = prettyFormat.plugins.DOMCollection;
var ELEMENT_NODE = 1;
var COMMENT_NODE = 8;

function filterCommentsAndDefaultIgnoreTagsTags(value) {
  return value.nodeType !== COMMENT_NODE && (value.nodeType !== ELEMENT_NODE || !value.matches(_shared.DEFAULT_IGNORE_TAGS));
}

function prettyDOM(dom, maxLength) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  if (!dom) {
    dom = (0, _helpers.getDocument)().body;
  }

  if (typeof maxLength !== 'number') {
    maxLength = getMaxLength(dom);
  }

  if (maxLength === 0) {
    return '';
  }

  if (dom.documentElement) {
    dom = dom.documentElement;
  }

  var domTypeName = typeof dom;

  if (domTypeName === 'object') {
    domTypeName = dom.constructor.name;
  } else {
    dom = {};
  }

  if (!('outerHTML' in dom)) {
    throw new TypeError("Expected an element or document but got " + domTypeName);
  }

  var _options$filterNode = options.filterNode,
      filterNode = _options$filterNode === void 0 ? filterCommentsAndDefaultIgnoreTagsTags : _options$filterNode,
      prettyFormatOptions = (0, _objectWithoutProperties2.default)(options, _excluded);
  var debugContent = prettyFormat.format(dom, (0, _extends2.default)({
    plugins: [(0, _DOMElementFilter.default)(filterNode), DOMCollection],
    printFunctionName: false,
    highlight: inNode()
  }, prettyFormatOptions));
  return maxLength !== undefined && dom.outerHTML.length > maxLength ? debugContent.slice(0, maxLength) + "..." : debugContent;
}

var logDOM = function logDOM() {
  var userCodeFrame = (0, _getUserCodeFrame.getUserCodeFrame)();

  if (userCodeFrame) {
    console.log(prettyDOM.apply(void 0, arguments) + "\n\n" + userCodeFrame);
  } else {
    console.log(prettyDOM.apply(void 0, arguments));
  }
};

exports.logDOM = logDOM;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByZXR0eS1kb20uanMiXSwibmFtZXMiOlsiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInByZXR0eURPTSIsInByZXR0eUZvcm1hdCIsImxvZ0RPTSIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiX0RPTUVsZW1lbnRGaWx0ZXIiLCJfZ2V0VXNlckNvZGVGcmFtZSIsIl9oZWxwZXJzIiwiX3NoYXJlZCIsIl9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSIsIm5vZGVJbnRlcm9wIiwiV2Vha01hcCIsImNhY2hlQmFiZWxJbnRlcm9wIiwiY2FjaGVOb2RlSW50ZXJvcCIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiY2FjaGUiLCJoYXMiLCJnZXQiLCJuZXdPYmoiLCJoYXNQcm9wZXJ0eURlc2NyaXB0b3IiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJrZXkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJkZXNjIiwic2V0IiwiaW5DeXByZXNzIiwiZG9tIiwid2luZG93Iiwib3duZXJEb2N1bWVudCIsImRlZmF1bHRWaWV3IiwidW5kZWZpbmVkIiwiZ2xvYmFsIiwiQ3lwcmVzcyIsImluTm9kZSIsInByb2Nlc3MiLCJ2ZXJzaW9ucyIsIm5vZGUiLCJnZXRNYXhMZW5ndGgiLCJlbnYiLCJERUJVR19QUklOVF9MSU1JVCIsIkRPTUNvbGxlY3Rpb24iLCJwbHVnaW5zIiwiRUxFTUVOVF9OT0RFIiwiQ09NTUVOVF9OT0RFIiwiZmlsdGVyQ29tbWVudHNBbmREZWZhdWx0SWdub3JlVGFnc1RhZ3MiLCJub2RlVHlwZSIsIm1hdGNoZXMiLCJERUZBVUxUX0lHTk9SRV9UQUdTIiwibWF4TGVuZ3RoIiwib3B0aW9ucyIsImdldERvY3VtZW50IiwiYm9keSIsImRvY3VtZW50RWxlbWVudCIsImRvbVR5cGVOYW1lIiwiY29uc3RydWN0b3IiLCJuYW1lIiwiVHlwZUVycm9yIiwiZmlsdGVyTm9kZSIsInByZXR0eUZvcm1hdE9wdGlvbnMiLCJkZWJ1Z0NvbnRlbnQiLCJmb3JtYXQiLCJwcmludEZ1bmN0aW9uTmFtZSIsImhpZ2hsaWdodCIsIm91dGVySFRNTCIsImxlbmd0aCIsInNsaWNlIiwidXNlckNvZGVGcmFtZSIsImdldFVzZXJDb2RlRnJhbWUiLCJjb25zb2xlIiwibG9nIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7OztBQUVBLElBQUlBLHNCQUFzQixHQUFHQyxPQUFPLENBQUMsOENBQUQsQ0FBcEM7O0FBRUFDLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLEVBQUFBLEtBQUssRUFBRTtBQURvQyxDQUE3QztBQUdBRCxPQUFPLENBQUNFLFNBQVIsR0FBb0JBLFNBQXBCO0FBQ0FGLE9BQU8sQ0FBQ0csWUFBUixHQUF1QkgsT0FBTyxDQUFDSSxNQUFSLEdBQWlCLEtBQUssQ0FBN0M7O0FBRUEsSUFBSUQsWUFBWSxHQUFHRSx1QkFBdUIsQ0FBQ1IsT0FBTyxDQUFDLGVBQUQsQ0FBUixDQUExQzs7QUFFQUcsT0FBTyxDQUFDRyxZQUFSLEdBQXVCQSxZQUF2Qjs7QUFFQSxJQUFJRyxpQkFBaUIsR0FBR1Ysc0JBQXNCLENBQUNDLE9BQU8sc0JBQVIsQ0FBOUM7O0FBRUEsSUFBSVUsaUJBQWlCLEdBQUdWLE9BQU8seUJBQS9COztBQUVBLElBQUlXLFFBQVEsR0FBR1gsT0FBTyxhQUF0Qjs7QUFFQSxJQUFJWSxPQUFPLEdBQUdaLE9BQU8sWUFBckI7O0FBRUEsU0FBU2Esd0JBQVQsQ0FBa0NDLFdBQWxDLEVBQStDO0FBQUUsTUFBSSxPQUFPQyxPQUFQLEtBQW1CLFVBQXZCLEVBQW1DLE9BQU8sSUFBUDtBQUFhLE1BQUlDLGlCQUFpQixHQUFHLElBQUlELE9BQUosRUFBeEI7QUFBdUMsTUFBSUUsZ0JBQWdCLEdBQUcsSUFBSUYsT0FBSixFQUF2QjtBQUFzQyxTQUFPLENBQUNGLHdCQUF3QixH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IjpbIlwidXNlIHN0cmljdFwiO1xuXG52YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2ludGVyb3BSZXF1aXJlRGVmYXVsdFwiKTtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMucHJldHR5RE9NID0gcHJldHR5RE9NO1xuZXhwb3J0cy5wcmV0dHlGb3JtYXQgPSBleHBvcnRzLmxvZ0RPTSA9IHZvaWQgMDtcblxudmFyIHByZXR0eUZvcm1hdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoXCJwcmV0dHktZm9ybWF0XCIpKTtcblxuZXhwb3J0cy5wcmV0dHlGb3JtYXQgPSBwcmV0dHlGb3JtYXQ7XG5cbnZhciBfRE9NRWxlbWVudEZpbHRlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vRE9NRWxlbWVudEZpbHRlclwiKSk7XG5cbnZhciBfZ2V0VXNlckNvZGVGcmFtZSA9IHJlcXVpcmUoXCIuL2dldC11c2VyLWNvZGUtZnJhbWVcIik7XG5cbnZhciBfaGVscGVycyA9IHJlcXVpcmUoXCIuL2hlbHBlcnNcIik7XG5cbnZhciBfc2hhcmVkID0gcmVxdWlyZShcIi4vc2hhcmVkXCIpO1xuXG5mdW5jdGlvbiBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUobm9kZUludGVyb3ApIHsgaWYgKHR5cGVvZiBXZWFrTWFwICE9PSBcImZ1bmN0aW9uXCIpIHJldHVybiBudWxsOyB2YXIgY2FjaGVCYWJlbEludGVyb3AgPSBuZXcgV2Vha01hcCgpOyB2YXIgY2FjaGVOb2RlSW50ZXJvcCA9IG5ldyBXZWFrTWFwKCk7IHJldHVybiAoX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlID0gZnVuY3Rpb24gKG5vZGVJbnRlcm9wKSB7IHJldHVybiBub2RlSW50ZXJvcCA/IGNhY2hlTm9kZUludGVyb3AgOiBjYWNoZUJhYmVsSW50ZXJvcDsgfSkobm9kZUludGVyb3ApOyB9XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaiwgbm9kZUludGVyb3ApIHsgaWYgKCFub2RlSW50ZXJvcCAmJiBvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsgcmV0dXJuIG9iajsgfSBpZiAob2JqID09PSBudWxsIHx8IHR5cGVvZiBvYmogIT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIG9iaiAhPT0gXCJmdW5jdGlvblwiKSB7IHJldHVybiB7IGRlZmF1bHQ6IG9iaiB9OyB9IHZhciBjYWNoZSA9IF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZShub2RlSW50ZXJvcCk7IGlmIChjYWNoZSAmJiBjYWNoZS5oYXMob2JqKSkgeyByZXR1cm4gY2FjaGUuZ2V0KG9iaik7IH0gdmFyIG5ld09iaiA9IHt9OyB2YXIgaGFzUHJvcGVydHlEZXNjcmlwdG9yID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKGtleSAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgeyB2YXIgZGVzYyA9IGhhc1Byb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDogbnVsbDsgaWYgKGRlc2MgJiYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOyB9IGVsc2UgeyBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgaWYgKGNhY2hlKSB7IGNhY2hlLnNldChvYmosIG5ld09iaik7IH0gcmV0dXJuIG5ld09iajsgfVxuXG5mdW5jdGlvbiBpbkN5cHJlc3MoZG9tKSB7XG4gIGNvbnN0IHdpbmRvdyA9IGRvbS5vd25lckRvY3VtZW50ICYmIGRvbS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3IHx8IHVuZGVmaW5lZDtcbiAgcmV0dXJuIHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnICYmIGdsb2JhbC5DeXByZXNzIHx8IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5DeXByZXNzO1xufVxuXG5jb25zdCBpbk5vZGUgPSAoKSA9PiB0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCcgJiYgcHJvY2Vzcy52ZXJzaW9ucyAhPT0gdW5kZWZpbmVkICYmIHByb2Nlc3MudmVyc2lvbnMubm9kZSAhPT0gdW5kZWZpbmVkO1xuXG5jb25zdCBnZXRNYXhMZW5ndGggPSBkb20gPT4gaW5DeXByZXNzKGRvbSkgPyAwIDogdHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnICYmIHByb2Nlc3MuZW52LkRFQlVHX1BSSU5UX0xJTUlUIHx8IDcwMDA7XG5cbmNvbnN0IHtcbiAgRE9NQ29sbGVjdGlvblxufSA9IHByZXR0eUZvcm1hdC5wbHVnaW5zOyAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvTm9kZS9ub2RlVHlwZSNub2RlX3R5cGVfY29uc3RhbnRzXG5cbmNvbnN0IEVMRU1FTlRfTk9ERSA9IDE7XG5jb25zdCBDT01NRU5UX05PREUgPSA4OyAvLyBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svamVzdC9ibG9iLzYxNTA4NDE5NWFlMWFlNjFkZGQ1NjE2MmM2MmJiZGRhMTc1ODc1NjkvcGFja2FnZXMvcHJldHR5LWZvcm1hdC9zcmMvcGx1Z2lucy9ET01FbGVtZW50LnRzI0w1MFxuXG5mdW5jdGlvbiBmaWx0ZXJDb21tZW50c0FuZERlZmF1bHRJZ25vcmVUYWdzVGFncyh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUubm9kZVR5cGUgIT09IENPTU1FTlRfTk9ERSAmJiAoIC8vIHZhbHVlLm5vZGVUeXBlID09PSBFTEVNRU5UX05PREUgPT4gIXZhbHVlLm1hdGNoZXMoREVGQVVMVF9JR05PUkVfVEFHUylcbiAgdmFsdWUubm9kZVR5cGUgIT09IEVMRU1FTlRfTk9ERSB8fCAhdmFsdWUubWF0Y2hlcyhfc2hhcmVkLkRFRkFVTFRfSUdOT1JFX1RBR1MpKTtcbn1cblxuZnVuY3Rpb24gcHJldHR5RE9NKGRvbSwgbWF4TGVuZ3RoLCBvcHRpb25zID0ge30pIHtcbiAgaWYgKCFkb20pIHtcbiAgICBkb20gPSAoMCwgX2hlbHBlcnMuZ2V0RG9jdW1lbnQpKCkuYm9keTtcbiAgfVxuXG4gIGlmICh0eXBlb2YgbWF4TGVuZ3RoICE9PSAnbnVtYmVyJykge1xuICAgIG1heExlbmd0aCA9IGdldE1heExlbmd0aChkb20pO1xuICB9XG5cbiAgaWYgKG1heExlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIGlmIChkb20uZG9jdW1lbnRFbGVtZW50KSB7XG4gICAgZG9tID0gZG9tLmRvY3VtZW50RWxlbWVudDtcbiAgfVxuXG4gIGxldCBkb21UeXBlTmFtZSA9IHR5cGVvZiBkb207XG5cbiAgaWYgKGRvbVR5cGVOYW1lID09PSAnb2JqZWN0Jykge1xuICAgIGRvbVR5cGVOYW1lID0gZG9tLmNvbnN0cnVjdG9yLm5hbWU7XG4gIH0gZWxzZSB7XG4gICAgLy8gVG8gZG9uJ3QgZmFsbCB3aXRoIGBpbmAgb3BlcmF0b3JcbiAgICBkb20gPSB7fTtcbiAgfVxuXG4gIGlmICghKCdvdXRlckhUTUwnIGluIGRvbSkpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBFeHBlY3RlZCBhbiBlbGVtZW50IG9yIGRvY3VtZW50IGJ1dCBnb3QgJHtkb21UeXBlTmFtZX1gKTtcbiAgfVxuXG4gIGNvbnN0IHtcbiAgICBmaWx0ZXJOb2RlID0gZmlsdGVyQ29tbWVudHNBbmREZWZhdWx0SWdub3JlVGFnc1RhZ3MsXG4gICAgLi4ucHJldHR5Rm9ybWF0T3B0aW9uc1xuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgZGVidWdDb250ZW50ID0gcHJldHR5Rm9ybWF0LmZvcm1hdChkb20sIHtcbiAgICBwbHVnaW5zOiBbKDAsIF9ET01FbGVtZW50RmlsdGVyLmRlZmF1bHQpKGZpbHRlck5vZGUpLCBET01Db2xsZWN0aW9uXSxcbiAgICBwcmludEZ1bmN0aW9uTmFtZTogZmFsc2UsXG4gICAgaGlnaGxpZ2h0OiBpbk5vZGUoKSxcbiAgICAuLi5wcmV0dHlGb3JtYXRPcHRpb25zXG4gIH0pO1xuICByZXR1cm4gbWF4TGVuZ3RoICE9PSB1bmRlZmluZWQgJiYgZG9tLm91dGVySFRNTC5sZW5ndGggPiBtYXhMZW5ndGggPyBgJHtkZWJ1Z0NvbnRlbnQuc2xpY2UoMCwgbWF4TGVuZ3RoKX0uLi5gIDogZGVidWdDb250ZW50O1xufVxuXG5jb25zdCBsb2dET00gPSAoLi4uYXJncykgPT4ge1xuICBjb25zdCB1c2VyQ29kZUZyYW1lID0gKDAsIF9nZXRVc2VyQ29kZUZyYW1lLmdldFVzZXJDb2RlRnJhbWUpKCk7XG5cbiAgaWYgKHVzZXJDb2RlRnJhbWUpIHtcbiAgICBjb25zb2xlLmxvZyhgJHtwcmV0dHlET00oLi4uYXJncyl9XFxuXFxuJHt1c2VyQ29kZUZyYW1lfWApO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUubG9nKHByZXR0eURPTSguLi5hcmdzKSk7XG4gIH1cbn07XG5cbmV4cG9ydHMubG9nRE9NID0gbG9nRE9NOyJdfQ==