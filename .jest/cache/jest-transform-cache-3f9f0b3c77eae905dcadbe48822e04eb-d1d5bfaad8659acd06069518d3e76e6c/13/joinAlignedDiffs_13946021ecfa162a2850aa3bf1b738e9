b65324379486413b00086ba0d1fe9466
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.joinAlignedDiffsExpand = exports.joinAlignedDiffsNoExpand = void 0;

var _cleanupSemantic = require("./cleanupSemantic");

var _printDiffs = require("./printDiffs");

var DIFF_CONTEXT_DEFAULT = 5;

var joinAlignedDiffsNoExpand = function joinAlignedDiffsNoExpand(diffs) {
  var nContextLines = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : DIFF_CONTEXT_DEFAULT;
  var iLength = diffs.length;
  var nContextLines2 = nContextLines + nContextLines;
  var jLength = iLength;
  var hasExcessAtStartOrEnd = false;
  var nExcessesBetweenChanges = 0;
  var i = 0;

  while (i !== iLength) {
    var iStart = i;

    while (i !== iLength && diffs[i][0] === _cleanupSemantic.DIFF_EQUAL) {
      i += 1;
    }

    if (iStart !== i) {
      if (iStart === 0) {
        if (i > nContextLines) {
          jLength -= i - nContextLines;
          hasExcessAtStartOrEnd = true;
        }
      } else if (i === iLength) {
        var n = i - iStart;

        if (n > nContextLines) {
          jLength -= n - nContextLines;
          hasExcessAtStartOrEnd = true;
        }
      } else {
        var _n = i - iStart;

        if (_n > nContextLines2) {
          jLength -= _n - nContextLines2;
          nExcessesBetweenChanges += 1;
        }
      }
    }

    while (i !== iLength && diffs[i][0] !== _cleanupSemantic.DIFF_EQUAL) {
      i += 1;
    }
  }

  var hasPatch = nExcessesBetweenChanges !== 0 || hasExcessAtStartOrEnd;

  if (nExcessesBetweenChanges !== 0) {
    jLength += nExcessesBetweenChanges + 1;
  } else if (hasExcessAtStartOrEnd) {
    jLength += 1;
  }

  var jLast = jLength - 1;
  var lines = [];
  var jPatchMark = 0;

  if (hasPatch) {
    lines.push('');
  }

  var aStart = 0;
  var bStart = 0;
  var aEnd = 0;
  var bEnd = 0;

  var pushCommonLine = function pushCommonLine(line) {
    var j = lines.length;
    lines.push((0, _printDiffs.printCommonLine)(line, j === 0 || j === jLast));
    aEnd += 1;
    bEnd += 1;
  };

  var pushDeleteLine = function pushDeleteLine(line) {
    lines.push((0, _printDiffs.printDeleteLine)(line));
    aEnd += 1;
  };

  var pushInsertLine = function pushInsertLine(line) {
    lines.push((0, _printDiffs.printInsertLine)(line));
    bEnd += 1;
  };

  i = 0;

  while (i !== iLength) {
    var _iStart = i;

    while (i !== iLength && diffs[i][0] === _cleanupSemantic.DIFF_EQUAL) {
      i += 1;
    }

    if (_iStart !== i) {
      if (_iStart === 0) {
        if (i > nContextLines) {
          _iStart = i - nContextLines;
          aStart = _iStart;
          bStart = _iStart;
          aEnd = aStart;
          bEnd = bStart;
        }

        for (var iCommon = _iStart; iCommon !== i; iCommon += 1) {
          pushCommonLine(diffs[iCommon][1]);
        }
      } else if (i === iLength) {
        var iEnd = i - _iStart > nContextLines ? _iStart + nContextLines : i;

        for (var _iCommon = _iStart; _iCommon !== iEnd; _iCommon += 1) {
          pushCommonLine(diffs[_iCommon][1]);
        }
      } else {
        var nCommon = i - _iStart;

        if (nCommon > nContextLines2) {
          var _iEnd = _iStart + nContextLines;

          for (var _iCommon2 = _iStart; _iCommon2 !== _iEnd; _iCommon2 += 1) {
            pushCommonLine(diffs[_iCommon2][1]);
          }

          lines[jPatchMark] = (0, _printDiffs.createPatchMark)(aStart, aEnd, bStart, bEnd);
          jPatchMark = lines.length;
          lines.push('');
          var nOmit = nCommon - nContextLines2;
          aStart = aEnd + nOmit;
          bStart = bEnd + nOmit;
          aEnd = aStart;
          bEnd = bStart;

          for (var _iCommon3 = i - nContextLines; _iCommon3 !== i; _iCommon3 += 1) {
            pushCommonLine(diffs[_iCommon3][1]);
          }
        } else {
          for (var _iCommon4 = _iStart; _iCommon4 !== i; _iCommon4 += 1) {
            pushCommonLine(diffs[_iCommon4][1]);
          }
        }
      }
    }

    while (i !== iLength && diffs[i][0] === _cleanupSemantic.DIFF_DELETE) {
      pushDeleteLine(diffs[i][1]);
      i += 1;
    }

    while (i !== iLength && diffs[i][0] === _cleanupSemantic.DIFF_INSERT) {
      pushInsertLine(diffs[i][1]);
      i += 1;
    }
  }

  if (hasPatch) {
    lines[jPatchMark] = (0, _printDiffs.createPatchMark)(aStart, aEnd, bStart, bEnd);
  }

  return lines.join('\n');
};

exports.joinAlignedDiffsNoExpand = joinAlignedDiffsNoExpand;

var joinAlignedDiffsExpand = function joinAlignedDiffsExpand(diffs) {
  return diffs.map(function (diff, i, diffs) {
    var line = diff[1];

    switch (diff[0]) {
      case _cleanupSemantic.DIFF_DELETE:
        return (0, _printDiffs.printDeleteLine)(line);

      case _cleanupSemantic.DIFF_INSERT:
        return (0, _printDiffs.printInsertLine)(line);

      default:
        return (0, _printDiffs.printCommonLine)(line, i === 0 || i === diffs.length - 1);
    }
  }).join('\n');
};

exports.joinAlignedDiffsExpand = joinAlignedDiffsExpand;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpvaW5BbGlnbmVkRGlmZnMuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJqb2luQWxpZ25lZERpZmZzRXhwYW5kIiwiam9pbkFsaWduZWREaWZmc05vRXhwYW5kIiwiX2NsZWFudXBTZW1hbnRpYyIsInJlcXVpcmUiLCJfcHJpbnREaWZmcyIsIkRJRkZfQ09OVEVYVF9ERUZBVUxUIiwiZGlmZnMiLCJuQ29udGV4dExpbmVzIiwiaUxlbmd0aCIsImxlbmd0aCIsIm5Db250ZXh0TGluZXMyIiwiakxlbmd0aCIsImhhc0V4Y2Vzc0F0U3RhcnRPckVuZCIsIm5FeGNlc3Nlc0JldHdlZW5DaGFuZ2VzIiwiaSIsImlTdGFydCIsIkRJRkZfRVFVQUwiLCJuIiwiaGFzUGF0Y2giLCJqTGFzdCIsImxpbmVzIiwialBhdGNoTWFyayIsInB1c2giLCJhU3RhcnQiLCJiU3RhcnQiLCJhRW5kIiwiYkVuZCIsInB1c2hDb21tb25MaW5lIiwibGluZSIsImoiLCJwcmludENvbW1vbkxpbmUiLCJwdXNoRGVsZXRlTGluZSIsInByaW50RGVsZXRlTGluZSIsInB1c2hJbnNlcnRMaW5lIiwicHJpbnRJbnNlcnRMaW5lIiwiaUNvbW1vbiIsImlFbmQiLCJuQ29tbW9uIiwiY3JlYXRlUGF0Y2hNYXJrIiwibk9taXQiLCJESUZGX0RFTEVURSIsIkRJRkZfSU5TRVJUIiwiam9pbiIsIm1hcCIsImRpZmYiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQzNDQyxFQUFBQSxLQUFLLEVBQUU7QUFEb0MsQ0FBN0M7QUFHQUQsT0FBTyxDQUFDRSxzQkFBUixHQUFpQ0YsT0FBTyxDQUFDRyx3QkFBUixHQUFtQyxLQUFLLENBQXpFOztBQUVBLElBQUlDLGdCQUFnQixHQUFHQyxPQUFPLHFCQUE5Qjs7QUFFQSxJQUFJQyxXQUFXLEdBQUdELE9BQU8s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QUFQO0FBUko7QUFhRCxHQWpCSCxFQWtCR2lDLElBbEJILENBa0JRLElBbEJSLENBRGtDO0FBQUEsQ0FBcEM7O0FBcUJBNUMsT0FBTyxDQUFDRSxzQkFBUixHQUFpQ0Esc0JBQWpDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuam9pbkFsaWduZWREaWZmc0V4cGFuZCA9IGV4cG9ydHMuam9pbkFsaWduZWREaWZmc05vRXhwYW5kID0gdm9pZCAwO1xuXG52YXIgX2NsZWFudXBTZW1hbnRpYyA9IHJlcXVpcmUoJy4vY2xlYW51cFNlbWFudGljJyk7XG5cbnZhciBfcHJpbnREaWZmcyA9IHJlcXVpcmUoJy4vcHJpbnREaWZmcycpO1xuXG4vKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5jb25zdCBESUZGX0NPTlRFWFRfREVGQVVMVCA9IDU7IC8vIHNhbWUgYXMgZGlmZkxpbmVzXG4vLyBqZXN0IC0tbm8tZXhwYW5kXG4vL1xuLy8gR2l2ZW4gYXJyYXkgb2YgYWxpZ25lZCBzdHJpbmdzIHdpdGggaW52ZXJzZSBoaWdobGlnaHQgZm9ybWF0dGluZyxcbi8vIHJldHVybiBqb2luZWQgbGluZXMgd2l0aCBkaWZmIGZvcm1hdHRpbmcgKGFuZCBwYXRjaCBtYXJrcywgaWYgbmVlZGVkKS5cblxuY29uc3Qgam9pbkFsaWduZWREaWZmc05vRXhwYW5kID0gKFxuICBkaWZmcyxcbiAgbkNvbnRleHRMaW5lcyA9IERJRkZfQ09OVEVYVF9ERUZBVUxUXG4pID0+IHtcbiAgY29uc3QgaUxlbmd0aCA9IGRpZmZzLmxlbmd0aDtcbiAgY29uc3QgbkNvbnRleHRMaW5lczIgPSBuQ29udGV4dExpbmVzICsgbkNvbnRleHRMaW5lczsgLy8gRmlyc3QgcGFzczogY291bnQgb3V0cHV0IGxpbmVzIGFuZCBzZWUgaWYgaXQgaGFzIHBhdGNoZXMuXG5cbiAgbGV0IGpMZW5ndGggPSBpTGVuZ3RoO1xuICBsZXQgaGFzRXhjZXNzQXRTdGFydE9yRW5kID0gZmFsc2U7XG4gIGxldCBuRXhjZXNzZXNCZXR3ZWVuQ2hhbmdlcyA9IDA7XG4gIGxldCBpID0gMDtcblxuICB3aGlsZSAoaSAhPT0gaUxlbmd0aCkge1xuICAgIGNvbnN0IGlTdGFydCA9IGk7XG5cbiAgICB3aGlsZSAoaSAhPT0gaUxlbmd0aCAmJiBkaWZmc1tpXVswXSA9PT0gX2NsZWFudXBTZW1hbnRpYy5ESUZGX0VRVUFMKSB7XG4gICAgICBpICs9IDE7XG4gICAgfVxuXG4gICAgaWYgKGlTdGFydCAhPT0gaSkge1xuICAgICAgaWYgKGlTdGFydCA9PT0gMCkge1xuICAgICAgICAvLyBhdCBzdGFydFxuICAgICAgICBpZiAoaSA+IG5Db250ZXh0TGluZXMpIHtcbiAgICAgICAgICBqTGVuZ3RoIC09IGkgLSBuQ29udGV4dExpbmVzOyAvLyBzdWJ0cmFjdCBleGNlc3MgY29tbW9uIGxpbmVzXG5cbiAgICAgICAgICBoYXNFeGNlc3NBdFN0YXJ0T3JFbmQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGkgPT09IGlMZW5ndGgpIHtcbiAgICAgICAgLy8gYXQgZW5kXG4gICAgICAgIGNvbnN0IG4gPSBpIC0gaVN0YXJ0O1xuXG4gICAgICAgIGlmIChuID4gbkNvbnRleHRMaW5lcykge1xuICAgICAgICAgIGpMZW5ndGggLT0gbiAtIG5Db250ZXh0TGluZXM7IC8vIHN1YnRyYWN0IGV4Y2VzcyBjb21tb24gbGluZXNcblxuICAgICAgICAgIGhhc0V4Y2Vzc0F0U3RhcnRPckVuZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGJldHdlZW4gY2hhbmdlc1xuICAgICAgICBjb25zdCBuID0gaSAtIGlTdGFydDtcblxuICAgICAgICBpZiAobiA+IG5Db250ZXh0TGluZXMyKSB7XG4gICAgICAgICAgakxlbmd0aCAtPSBuIC0gbkNvbnRleHRMaW5lczI7IC8vIHN1YnRyYWN0IGV4Y2VzcyBjb21tb24gbGluZXNcblxuICAgICAgICAgIG5FeGNlc3Nlc0JldHdlZW5DaGFuZ2VzICs9IDE7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB3aGlsZSAoaSAhPT0gaUxlbmd0aCAmJiBkaWZmc1tpXVswXSAhPT0gX2NsZWFudXBTZW1hbnRpYy5ESUZGX0VRVUFMKSB7XG4gICAgICBpICs9IDE7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgaGFzUGF0Y2ggPSBuRXhjZXNzZXNCZXR3ZWVuQ2hhbmdlcyAhPT0gMCB8fCBoYXNFeGNlc3NBdFN0YXJ0T3JFbmQ7XG5cbiAgaWYgKG5FeGNlc3Nlc0JldHdlZW5DaGFuZ2VzICE9PSAwKSB7XG4gICAgakxlbmd0aCArPSBuRXhjZXNzZXNCZXR3ZWVuQ2hhbmdlcyArIDE7IC8vIGFkZCBwYXRjaCBsaW5lc1xuICB9IGVsc2UgaWYgKGhhc0V4Y2Vzc0F0U3RhcnRPckVuZCkge1xuICAgIGpMZW5ndGggKz0gMTsgLy8gYWRkIHBhdGNoIGxpbmVcbiAgfVxuXG4gIGNvbnN0IGpMYXN0ID0gakxlbmd0aCAtIDE7XG4gIGNvbnN0IGxpbmVzID0gW107XG4gIGxldCBqUGF0Y2hNYXJrID0gMDsgLy8gaW5kZXggb2YgcGxhY2Vob2xkZXIgbGluZSBmb3IgY3VycmVudCBwYXRjaCBtYXJrXG5cbiAgaWYgKGhhc1BhdGNoKSB7XG4gICAgbGluZXMucHVzaCgnJyk7IC8vIHBsYWNlaG9sZGVyIGxpbmUgZm9yIGZpcnN0IHBhdGNoIG1hcmtcbiAgfSAvLyBJbmRleGVzIG9mIGV4cGVjdGVkIG9yIHJlY2VpdmVkIGxpbmVzIGluIGN1cnJlbnQgcGF0Y2g6XG5cbiAgbGV0IGFTdGFydCA9IDA7XG4gIGxldCBiU3RhcnQgPSAwO1xuICBsZXQgYUVuZCA9IDA7XG4gIGxldCBiRW5kID0gMDtcblxuICBjb25zdCBwdXNoQ29tbW9uTGluZSA9IGxpbmUgPT4ge1xuICAgIGNvbnN0IGogPSBsaW5lcy5sZW5ndGg7XG4gICAgbGluZXMucHVzaCgoMCwgX3ByaW50RGlmZnMucHJpbnRDb21tb25MaW5lKShsaW5lLCBqID09PSAwIHx8IGogPT09IGpMYXN0KSk7XG4gICAgYUVuZCArPSAxO1xuICAgIGJFbmQgKz0gMTtcbiAgfTtcblxuICBjb25zdCBwdXNoRGVsZXRlTGluZSA9IGxpbmUgPT4ge1xuICAgIGxpbmVzLnB1c2goKDAsIF9wcmludERpZmZzLnByaW50RGVsZXRlTGluZSkobGluZSkpO1xuICAgIGFFbmQgKz0gMTtcbiAgfTtcblxuICBjb25zdCBwdXNoSW5zZXJ0TGluZSA9IGxpbmUgPT4ge1xuICAgIGxpbmVzLnB1c2goKDAsIF9wcmludERpZmZzLnByaW50SW5zZXJ0TGluZSkobGluZSkpO1xuICAgIGJFbmQgKz0gMTtcbiAgfTsgLy8gU2Vjb25kIHBhc3M6IHB1c2ggbGluZXMgd2l0aCBkaWZmIGZvcm1hdHRpbmcgKGFuZCBwYXRjaCBtYXJrcywgaWYgbmVlZGVkKS5cblxuICBpID0gMDtcblxuICB3aGlsZSAoaSAhPT0gaUxlbmd0aCkge1xuICAgIGxldCBpU3RhcnQgPSBpO1xuXG4gICAgd2hpbGUgKGkgIT09IGlMZW5ndGggJiYgZGlmZnNbaV1bMF0gPT09IF9jbGVhbnVwU2VtYW50aWMuRElGRl9FUVVBTCkge1xuICAgICAgaSArPSAxO1xuICAgIH1cblxuICAgIGlmIChpU3RhcnQgIT09IGkpIHtcbiAgICAgIGlmIChpU3RhcnQgPT09IDApIHtcbiAgICAgICAgLy8gYXQgYmVnaW5uaW5nXG4gICAgICAgIGlmIChpID4gbkNvbnRleHRMaW5lcykge1xuICAgICAgICAgIGlTdGFydCA9IGkgLSBuQ29udGV4dExpbmVzO1xuICAgICAgICAgIGFTdGFydCA9IGlTdGFydDtcbiAgICAgICAgICBiU3RhcnQgPSBpU3RhcnQ7XG4gICAgICAgICAgYUVuZCA9IGFTdGFydDtcbiAgICAgICAgICBiRW5kID0gYlN0YXJ0O1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgaUNvbW1vbiA9IGlTdGFydDsgaUNvbW1vbiAhPT0gaTsgaUNvbW1vbiArPSAxKSB7XG4gICAgICAgICAgcHVzaENvbW1vbkxpbmUoZGlmZnNbaUNvbW1vbl1bMV0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGkgPT09IGlMZW5ndGgpIHtcbiAgICAgICAgLy8gYXQgZW5kXG4gICAgICAgIGNvbnN0IGlFbmQgPSBpIC0gaVN0YXJ0ID4gbkNvbnRleHRMaW5lcyA/IGlTdGFydCArIG5Db250ZXh0TGluZXMgOiBpO1xuXG4gICAgICAgIGZvciAobGV0IGlDb21tb24gPSBpU3RhcnQ7IGlDb21tb24gIT09IGlFbmQ7IGlDb21tb24gKz0gMSkge1xuICAgICAgICAgIHB1c2hDb21tb25MaW5lKGRpZmZzW2lDb21tb25dWzFdKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gYmV0d2VlbiBjaGFuZ2VzXG4gICAgICAgIGNvbnN0IG5Db21tb24gPSBpIC0gaVN0YXJ0O1xuXG4gICAgICAgIGlmIChuQ29tbW9uID4gbkNvbnRleHRMaW5lczIpIHtcbiAgICAgICAgICBjb25zdCBpRW5kID0gaVN0YXJ0ICsgbkNvbnRleHRMaW5lcztcblxuICAgICAgICAgIGZvciAobGV0IGlDb21tb24gPSBpU3RhcnQ7IGlDb21tb24gIT09IGlFbmQ7IGlDb21tb24gKz0gMSkge1xuICAgICAgICAgICAgcHVzaENvbW1vbkxpbmUoZGlmZnNbaUNvbW1vbl1bMV0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGxpbmVzW2pQYXRjaE1hcmtdID0gKDAsIF9wcmludERpZmZzLmNyZWF0ZVBhdGNoTWFyaykoXG4gICAgICAgICAgICBhU3RhcnQsXG4gICAgICAgICAgICBhRW5kLFxuICAgICAgICAgICAgYlN0YXJ0LFxuICAgICAgICAgICAgYkVuZFxuICAgICAgICAgICk7XG4gICAgICAgICAgalBhdGNoTWFyayA9IGxpbmVzLmxlbmd0aDtcbiAgICAgICAgICBsaW5lcy5wdXNoKCcnKTsgLy8gcGxhY2Vob2xkZXIgbGluZSBmb3IgbmV4dCBwYXRjaCBtYXJrXG5cbiAgICAgICAgICBjb25zdCBuT21pdCA9IG5Db21tb24gLSBuQ29udGV4dExpbmVzMjtcbiAgICAgICAgICBhU3RhcnQgPSBhRW5kICsgbk9taXQ7XG4gICAgICAgICAgYlN0YXJ0ID0gYkVuZCArIG5PbWl0O1xuICAgICAgICAgIGFFbmQgPSBhU3RhcnQ7XG4gICAgICAgICAgYkVuZCA9IGJTdGFydDtcblxuICAgICAgICAgIGZvciAobGV0IGlDb21tb24gPSBpIC0gbkNvbnRleHRMaW5lczsgaUNvbW1vbiAhPT0gaTsgaUNvbW1vbiArPSAxKSB7XG4gICAgICAgICAgICBwdXNoQ29tbW9uTGluZShkaWZmc1tpQ29tbW9uXVsxXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvciAobGV0IGlDb21tb24gPSBpU3RhcnQ7IGlDb21tb24gIT09IGk7IGlDb21tb24gKz0gMSkge1xuICAgICAgICAgICAgcHVzaENvbW1vbkxpbmUoZGlmZnNbaUNvbW1vbl1bMV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHdoaWxlIChpICE9PSBpTGVuZ3RoICYmIGRpZmZzW2ldWzBdID09PSBfY2xlYW51cFNlbWFudGljLkRJRkZfREVMRVRFKSB7XG4gICAgICBwdXNoRGVsZXRlTGluZShkaWZmc1tpXVsxXSk7XG4gICAgICBpICs9IDE7XG4gICAgfVxuXG4gICAgd2hpbGUgKGkgIT09IGlMZW5ndGggJiYgZGlmZnNbaV1bMF0gPT09IF9jbGVhbnVwU2VtYW50aWMuRElGRl9JTlNFUlQpIHtcbiAgICAgIHB1c2hJbnNlcnRMaW5lKGRpZmZzW2ldWzFdKTtcbiAgICAgIGkgKz0gMTtcbiAgICB9XG4gIH1cblxuICBpZiAoaGFzUGF0Y2gpIHtcbiAgICBsaW5lc1tqUGF0Y2hNYXJrXSA9ICgwLCBfcHJpbnREaWZmcy5jcmVhdGVQYXRjaE1hcmspKFxuICAgICAgYVN0YXJ0LFxuICAgICAgYUVuZCxcbiAgICAgIGJTdGFydCxcbiAgICAgIGJFbmRcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIGxpbmVzLmpvaW4oJ1xcbicpO1xufTsgLy8gamVzdCAtLWV4cGFuZFxuLy9cbi8vIEdpdmVuIGFycmF5IG9mIGFsaWduZWQgc3RyaW5ncyB3aXRoIGludmVyc2UgaGlnaGxpZ2h0IGZvcm1hdHRpbmcsXG4vLyByZXR1cm4gam9pbmVkIGxpbmVzIHdpdGggZGlmZiBmb3JtYXR0aW5nLlxuXG5leHBvcnRzLmpvaW5BbGlnbmVkRGlmZnNOb0V4cGFuZCA9IGpvaW5BbGlnbmVkRGlmZnNOb0V4cGFuZDtcblxuY29uc3Qgam9pbkFsaWduZWREaWZmc0V4cGFuZCA9IGRpZmZzID0+XG4gIGRpZmZzXG4gICAgLm1hcCgoZGlmZiwgaSwgZGlmZnMpID0+IHtcbiAgICAgIGNvbnN0IGxpbmUgPSBkaWZmWzFdO1xuXG4gICAgICBzd2l0Y2ggKGRpZmZbMF0pIHtcbiAgICAgICAgY2FzZSBfY2xlYW51cFNlbWFudGljLkRJRkZfREVMRVRFOlxuICAgICAgICAgIHJldHVybiAoMCwgX3ByaW50RGlmZnMucHJpbnREZWxldGVMaW5lKShsaW5lKTtcblxuICAgICAgICBjYXNlIF9jbGVhbnVwU2VtYW50aWMuRElGRl9JTlNFUlQ6XG4gICAgICAgICAgcmV0dXJuICgwLCBfcHJpbnREaWZmcy5wcmludEluc2VydExpbmUpKGxpbmUpO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuICgwLCBfcHJpbnREaWZmcy5wcmludENvbW1vbkxpbmUpKFxuICAgICAgICAgICAgbGluZSxcbiAgICAgICAgICAgIGkgPT09IDAgfHwgaSA9PT0gZGlmZnMubGVuZ3RoIC0gMVxuICAgICAgICAgICk7XG4gICAgICB9XG4gICAgfSlcbiAgICAuam9pbignXFxuJyk7XG5cbmV4cG9ydHMuam9pbkFsaWduZWREaWZmc0V4cGFuZCA9IGpvaW5BbGlnbmVkRGlmZnNFeHBhbmQ7XG4iXX0=