bcb4e904d08f3e29e69f580c5c9c6770
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _TextInjection = _interopRequireDefault(require("./TextInjection"));

var _TextNativeComponent = require("./TextNativeComponent");

var _excluded = ["forwardedRef", "selectionColor"];

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var DeprecatedTextPropTypes = require("../DeprecatedPropTypes/DeprecatedTextPropTypes");

var React = require('react');

var TextAncestor = require("./TextAncestor");

var Touchable = require("../Components/Touchable/Touchable");

var nullthrows = require('nullthrows');

var processColor = require("../StyleSheet/processColor");

var PRESS_RECT_OFFSET = {
  top: 20,
  left: 20,
  right: 20,
  bottom: 30
};

var TouchableText = function (_React$Component) {
  (0, _inherits2.default)(TouchableText, _React$Component);

  var _super = _createSuper(TouchableText);

  function TouchableText() {
    var _this;

    (0, _classCallCheck2.default)(this, TouchableText);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));
    _this.state = (0, _extends2.default)({}, Touchable.Mixin.touchableGetInitialState(), {
      isHighlighted: false,
      createResponderHandlers: _this._createResponseHandlers.bind((0, _assertThisInitialized2.default)(_this)),
      responseHandlers: null
    });
    return _this;
  }

  (0, _createClass2.default)(TouchableText, [{
    key: "render",
    value: function render() {
      var _this$props = this.props,
          forwardedRef = _this$props.forwardedRef,
          selectionColor = _this$props.selectionColor,
          props = (0, _objectWithoutProperties2.default)(_this$props, _excluded);

      if (isTouchable(this.props)) {
        props = (0, _extends2.default)({}, props, this.state.responseHandlers, {
          isHighlighted: this.state.isHighlighted
        });
      }

      if (selectionColor != null) {
        props = (0, _extends2.default)({}, props, {
          selectionColor: processColor(selectionColor)
        });
      }

      if (__DEV__) {
        if (Touchable.TOUCH_TARGET_DEBUG && props.onPress != null) {
          props = (0, _extends2.default)({}, props, {
            style: [props.style, {
              color: 'magenta'
            }]
          });
        }
      }

      return React.createElement(TextAncestor.Consumer, null, function (hasTextAncestor) {
        return hasTextAncestor ? React.createElement(_TextNativeComponent.NativeVirtualText, (0, _extends2.default)({}, props, {
          onClick: props.onPress,
          ref: forwardedRef
        })) : React.createElement(TextAncestor.Provider, {
          value: true
        }, React.createElement(_TextNativeComponent.NativeText, (0, _extends2.default)({}, props, {
          ref: forwardedRef
        })));
      });
    }
  }, {
    key: "_createResponseHandlers",
    value: function _createResponseHandlers() {
      var _this2 = this;

      return {
        onStartShouldSetResponder: function onStartShouldSetResponder() {
          var onStartShouldSetResponder = _this2.props.onStartShouldSetResponder;
          var shouldSetResponder = (onStartShouldSetResponder == null ? false : onStartShouldSetResponder()) || isTouchable(_this2.props);

          if (shouldSetResponder) {
            _this2._attachTouchHandlers();
          }

          return shouldSetResponder;
        },
        onResponderGrant: function onResponderGrant(event) {
          nullthrows(_this2.touchableHandleResponderGrant)(event);

          if (_this2.props.onResponderGrant != null) {
            _this2.props.onResponderGrant.call(_this2, event);
          }
        },
        onResponderMove: function onResponderMove(event) {
          nullthrows(_this2.touchableHandleResponderMove)(event);

          if (_this2.props.onResponderMove != null) {
            _this2.props.onResponderMove.call(_this2, event);
          }
        },
        onResponderRelease: function onResponderRelease(event) {
          nullthrows(_this2.touchableHandleResponderRelease)(event);

          if (_this2.props.onResponderRelease != null) {
            _this2.props.onResponderRelease.call(_this2, event);
          }
        },
        onResponderTerminate: function onResponderTerminate(event) {
          nullthrows(_this2.touchableHandleResponderTerminate)(event);

          if (_this2.props.onResponderTerminate != null) {
            _this2.props.onResponderTerminate.call(_this2, event);
          }
        },
        onResponderTerminationRequest: function onResponderTerminationRequest() {
          var onResponderTerminationRequest = _this2.props.onResponderTerminationRequest;

          if (!nullthrows(_this2.touchableHandleResponderTerminationRequest)()) {
            return false;
          }

          if (onResponderTerminationRequest == null) {
            return true;
          }

          return onResponderTerminationRequest();
        }
      };
    }
  }, {
    key: "_attachTouchHandlers",
    value: function _attachTouchHandlers() {
      var _this3 = this;

      if (this.touchableGetPressRectOffset != null) {
        return;
      }

      for (var key in Touchable.Mixin) {
        if (typeof Touchable.Mixin[key] === 'function') {
          this[key] = Touchable.Mixin[key].bind(this);
        }
      }

      this.touchableHandleActivePressIn = function () {
        if (!_this3.props.suppressHighlighting && isTouchable(_this3.props)) {
          _this3.setState({
            isHighlighted: true
          });
        }
      };

      this.touchableHandleActivePressOut = function () {
        if (!_this3.props.suppressHighlighting && isTouchable(_this3.props)) {
          _this3.setState({
            isHighlighted: false
          });
        }
      };

      this.touchableHandlePress = function (event) {
        if (_this3.props.onPress != null) {
          _this3.props.onPress(event);
        }
      };

      this.touchableHandleLongPress = function (event) {
        if (_this3.props.onLongPress != null) {
          _this3.props.onLongPress(event);
        }
      };

      this.touchableGetPressRectOffset = function () {
        return _this3.props.pressRetentionOffset == null ? PRESS_RECT_OFFSET : _this3.props.pressRetentionOffset;
      };
    }
  }], [{
    key: "getDerivedStateFromProps",
    value: function getDerivedStateFromProps(nextProps, prevState) {
      return prevState.responseHandlers == null && isTouchable(nextProps) ? {
        responseHandlers: prevState.createResponderHandlers()
      } : null;
    }
  }]);
  return TouchableText;
}(React.Component);

TouchableText.defaultProps = {
  accessible: true,
  allowFontScaling: true,
  ellipsizeMode: 'tail'
};

var isTouchable = function isTouchable(props) {
  return props.onPress != null || props.onLongPress != null || props.onStartShouldSetResponder != null;
};

var Text = React.forwardRef(function (props, forwardedRef) {
  return React.createElement(TouchableText, (0, _extends2.default)({}, props, {
    forwardedRef: forwardedRef
  }));
});
Text.displayName = 'Text';
Text.propTypes = DeprecatedTextPropTypes;
var TextToExport = _TextInjection.default.unstable_Text == null ? Text : _TextInjection.default.unstable_Text;
module.exports = TextToExport;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRleHQuanMiXSwibmFtZXMiOlsiRGVwcmVjYXRlZFRleHRQcm9wVHlwZXMiLCJyZXF1aXJlIiwiUmVhY3QiLCJUZXh0QW5jZXN0b3IiLCJUb3VjaGFibGUiLCJudWxsdGhyb3dzIiwicHJvY2Vzc0NvbG9yIiwiUFJFU1NfUkVDVF9PRkZTRVQiLCJ0b3AiLCJsZWZ0IiwicmlnaHQiLCJib3R0b20iLCJUb3VjaGFibGVUZXh0Iiwic3RhdGUiLCJNaXhpbiIsInRvdWNoYWJsZUdldEluaXRpYWxTdGF0ZSIsImlzSGlnaGxpZ2h0ZWQiLCJjcmVhdGVSZXNwb25kZXJIYW5kbGVycyIsIl9jcmVhdGVSZXNwb25zZUhhbmRsZXJzIiwiYmluZCIsInJlc3BvbnNlSGFuZGxlcnMiLCJwcm9wcyIsImZvcndhcmRlZFJlZiIsInNlbGVjdGlvbkNvbG9yIiwiaXNUb3VjaGFibGUiLCJfX0RFVl9fIiwiVE9VQ0hfVEFSR0VUX0RFQlVHIiwib25QcmVzcyIsInN0eWxlIiwiY29sb3IiLCJoYXNUZXh0QW5jZXN0b3IiLCJvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyIiwic2hvdWxkU2V0UmVzcG9uZGVyIiwiX2F0dGFjaFRvdWNoSGFuZGxlcnMiLCJvblJlc3BvbmRlckdyYW50IiwiZXZlbnQiLCJ0b3VjaGFibGVIYW5kbGVSZXNwb25kZXJHcmFudCIsImNhbGwiLCJvblJlc3BvbmRlck1vdmUiLCJ0b3VjaGFibGVIYW5kbGVSZXNwb25kZXJNb3ZlIiwib25SZXNwb25kZXJSZWxlYXNlIiwidG91Y2hhYmxlSGFuZGxlUmVzcG9uZGVyUmVsZWFzZSIsIm9uUmVzcG9uZGVyVGVybWluYXRlIiwidG91Y2hhYmxlSGFuZGxlUmVzcG9uZGVyVGVybWluYXRlIiwib25SZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3QiLCJ0b3VjaGFibGVIYW5kbGVSZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3QiLCJ0b3VjaGFibGVHZXRQcmVzc1JlY3RPZmZzZXQiLCJrZXkiLCJ0b3VjaGFibGVIYW5kbGVBY3RpdmVQcmVzc0luIiwic3VwcHJlc3NIaWdobGlnaHRpbmciLCJzZXRTdGF0ZSIsInRvdWNoYWJsZUhhbmRsZUFjdGl2ZVByZXNzT3V0IiwidG91Y2hhYmxlSGFuZGxlUHJlc3MiLCJ0b3VjaGFibGVIYW5kbGVMb25nUHJlc3MiLCJvbkxvbmdQcmVzcyIsInByZXNzUmV0ZW50aW9uT2Zmc2V0IiwibmV4dFByb3BzIiwicHJldlN0YXRlIiwiQ29tcG9uZW50IiwiZGVmYXVsdFByb3BzIiwiYWNjZXNzaWJsZSIsImFsbG93Rm9udFNjYWxpbmciLCJlbGxpcHNpemVNb2RlIiwiVGV4dCIsImZvcndhcmRSZWYiLCJkaXNwbGF5TmFtZSIsInByb3BUeXBlcyIsIlRleHRUb0V4cG9ydCIsIlRleHRJbmplY3Rpb24iLCJ1bnN0YWJsZV9UZXh0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUE7O0FBQ0E7Ozs7Ozs7O0FBRUEsSUFBTUEsdUJBQXVCLEdBQUdDLE9BQU8sa0RBQXZDOztBQUNBLElBQU1DLEtBQUssR0FBR0QsT0FBTyxDQUFDLE9BQUQsQ0FBckI7O0FBQ0EsSUFBTUUsWUFBWSxHQUFHRixPQUFPLGtCQUE1Qjs7QUFDQSxJQUFNRyxTQUFTLEdBQUdILE9BQU8scUNBQXpCOztBQUVBLElBQU1JLFVBQVUsR0FBR0osT0FBTyxDQUFDLFlBQUQsQ0FBMUI7O0FBQ0EsSUFBTUssWUFBWSxHQUFHTCxPQUFPLDhCQUE1Qjs7QUE2QkEsSUFBTU0saUJBQWlCLEdBQUc7QUFBQ0MsRUFBQUEsR0FBRyxFQUFFLEVBQU47QUFBVUMsRUFBQUEsSUFBSSxFQUFFLEVBQWhCO0FBQW9CQyxFQUFBQSxLQUFLLEVBQUUsRUFBM0I7QUFBK0JDLEVBQUFBLE1BQU0sRUFBRTtBQUF2QyxDQUExQjs7SUFPTUMsYTs7Ozs7Ozs7Ozs7Ozs7O1VBa0JKQyxLLDhCQUNLVCxTQUFTLENBQUNVLEtBQVYsQ0FBZ0JDLHdCQUFoQixFO0FBQ0hDLE1BQUFBLGFBQWEs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LFNBQUwsR0FBaUJsRSx1QkFBakI7QUFFQSxJQUFNbUUsWUFHRCxHQUVIQyx1QkFBY0MsYUFBZCxJQUErQixJQUEvQixHQUFzQ04sSUFBdEMsR0FBNkNLLHVCQUFjQyxhQUw3RDtBQU9BQyxNQUFNLENBQUNDLE9BQVAsR0FBaUJKLFlBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IFRleHRJbmplY3Rpb24gZnJvbSAnLi9UZXh0SW5qZWN0aW9uJztcbmltcG9ydCB7TmF0aXZlVGV4dCwgTmF0aXZlVmlydHVhbFRleHR9IGZyb20gJy4vVGV4dE5hdGl2ZUNvbXBvbmVudCc7XG5cbmNvbnN0IERlcHJlY2F0ZWRUZXh0UHJvcFR5cGVzID0gcmVxdWlyZSgnLi4vRGVwcmVjYXRlZFByb3BUeXBlcy9EZXByZWNhdGVkVGV4dFByb3BUeXBlcycpO1xuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuY29uc3QgVGV4dEFuY2VzdG9yID0gcmVxdWlyZSgnLi9UZXh0QW5jZXN0b3InKTtcbmNvbnN0IFRvdWNoYWJsZSA9IHJlcXVpcmUoJy4uL0NvbXBvbmVudHMvVG91Y2hhYmxlL1RvdWNoYWJsZScpO1xuXG5jb25zdCBudWxsdGhyb3dzID0gcmVxdWlyZSgnbnVsbHRocm93cycpO1xuY29uc3QgcHJvY2Vzc0NvbG9yID0gcmVxdWlyZSgnLi4vU3R5bGVTaGVldC9wcm9jZXNzQ29sb3InKTtcblxuaW1wb3J0IHR5cGUge1ByZXNzRXZlbnR9IGZyb20gJy4uL1R5cGVzL0NvcmVFdmVudFR5cGVzJztcbmltcG9ydCB0eXBlIHtQcmVzc1JldGVudGlvbk9mZnNldCwgVGV4dFByb3BzfSBmcm9tICcuL1RleHRQcm9wcyc7XG5cbnR5cGUgUmVzcG9uc2VIYW5kbGVycyA9ICRSZWFkT25seTx7fFxuICBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyOiAoKSA9PiBib29sZWFuLFxuICBvblJlc3BvbmRlckdyYW50OiAoZXZlbnQ6IFByZXNzRXZlbnQpID0+IHZvaWQsXG4gIG9uUmVzcG9uZGVyTW92ZTogKGV2ZW50OiBQcmVzc0V2ZW50KSA9PiB2b2lkLFxuICBvblJlc3BvbmRlclJlbGVhc2U6IChldmVudDogUHJlc3NFdmVudCkgPT4gdm9pZCxcbiAgb25SZXNwb25kZXJUZXJtaW5hdGU6IChldmVudDogUHJlc3NFdmVudCkgPT4gdm9pZCxcbiAgb25SZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3Q6ICgpID0+IGJvb2xlYW4sXG58fT47XG5cbnR5cGUgUHJvcHMgPSAkUmVhZE9ubHk8e3xcbiAgLi4uVGV4dFByb3BzLFxuICBmb3J3YXJkZWRSZWY6ID9SZWFjdC5SZWY8dHlwZW9mIE5hdGl2ZVRleHQgfCB0eXBlb2YgTmF0aXZlVmlydHVhbFRleHQ+LFxufH0+O1xuXG50eXBlIFN0YXRlID0ge3xcbiAgdG91Y2hhYmxlOiB7fFxuICAgIHRvdWNoU3RhdGU6ID9zdHJpbmcsXG4gICAgcmVzcG9uZGVySUQ6ID9udW1iZXIsXG4gIHx9LFxuICBpc0hpZ2hsaWdodGVkOiBib29sZWFuLFxuICBjcmVhdGVSZXNwb25kZXJIYW5kbGVyczogKCkgPT4gUmVzcG9uc2VIYW5kbGVycyxcbiAgcmVzcG9uc2VIYW5kbGVyczogP1Jlc3BvbnNlSGFuZGxlcnMsXG58fTtcblxuY29uc3QgUFJFU1NfUkVDVF9PRkZTRVQgPSB7dG9wOiAyMCwgbGVmdDogMjAsIHJpZ2h0OiAyMCwgYm90dG9tOiAzMH07XG5cbi8qKlxuICogQSBSZWFjdCBjb21wb25lbnQgZm9yIGRpc3BsYXlpbmcgdGV4dC5cbiAqXG4gKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy90ZXh0Lmh0bWxcbiAqL1xuY2xhc3MgVG91Y2hhYmxlVGV4dCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcywgU3RhdGU+IHtcbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBhY2Nlc3NpYmxlOiB0cnVlLFxuICAgIGFsbG93Rm9udFNjYWxpbmc6IHRydWUsXG4gICAgZWxsaXBzaXplTW9kZTogJ3RhaWwnLFxuICB9O1xuXG4gIHRvdWNoYWJsZUdldFByZXNzUmVjdE9mZnNldDogPygpID0+IFByZXNzUmV0ZW50aW9uT2Zmc2V0O1xuICB0b3VjaGFibGVIYW5kbGVBY3RpdmVQcmVzc0luOiA/KCkgPT4gdm9pZDtcbiAgdG91Y2hhYmxlSGFuZGxlQWN0aXZlUHJlc3NPdXQ6ID8oKSA9PiB2b2lkO1xuICB0b3VjaGFibGVIYW5kbGVMb25nUHJlc3M6ID8oZXZlbnQ6IFByZXNzRXZlbnQpID0+IHZvaWQ7XG4gIHRvdWNoYWJsZUhhbmRsZVByZXNzOiA/KGV2ZW50OiBQcmVzc0V2ZW50KSA9PiB2b2lkO1xuICB0b3VjaGFibGVIYW5kbGVSZXNwb25kZXJHcmFudDogPyhldmVudDogUHJlc3NFdmVudCkgPT4gdm9pZDtcbiAgdG91Y2hhYmxlSGFuZGxlUmVzcG9uZGVyTW92ZTogPyhldmVudDogUHJlc3NFdmVudCkgPT4gdm9pZDtcbiAgdG91Y2hhYmxlSGFuZGxlUmVzcG9uZGVyUmVsZWFzZTogPyhldmVudDogUHJlc3NFdmVudCkgPT4gdm9pZDtcbiAgdG91Y2hhYmxlSGFuZGxlUmVzcG9uZGVyVGVybWluYXRlOiA/KGV2ZW50OiBQcmVzc0V2ZW50KSA9PiB2b2lkO1xuICB0b3VjaGFibGVIYW5kbGVSZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3Q6ID8oKSA9PiBib29sZWFuO1xuXG4gIHN0YXRlID0ge1xuICAgIC4uLlRvdWNoYWJsZS5NaXhpbi50b3VjaGFibGVHZXRJbml0aWFsU3RhdGUoKSxcbiAgICBpc0hpZ2hsaWdodGVkOiBmYWxzZSxcbiAgICBjcmVhdGVSZXNwb25kZXJIYW5kbGVyczogdGhpcy5fY3JlYXRlUmVzcG9uc2VIYW5kbGVycy5iaW5kKHRoaXMpLFxuICAgIHJlc3BvbnNlSGFuZGxlcnM6IG51bGwsXG4gIH07XG5cbiAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhcbiAgICBuZXh0UHJvcHM6IFByb3BzLFxuICAgIHByZXZTdGF0ZTogU3RhdGUsXG4gICk6ICRTaGFwZTxTdGF0ZT4gfCBudWxsIHtcbiAgICByZXR1cm4gcHJldlN0YXRlLnJlc3BvbnNlSGFuZGxlcnMgPT0gbnVsbCAmJiBpc1RvdWNoYWJsZShuZXh0UHJvcHMpXG4gICAgICA/IHtcbiAgICAgICAgICByZXNwb25zZUhhbmRsZXJzOiBwcmV2U3RhdGUuY3JlYXRlUmVzcG9uZGVySGFuZGxlcnMoKSxcbiAgICAgICAgfVxuICAgICAgOiBudWxsO1xuICB9XG5cbiAgcmVuZGVyKCk6IFJlYWN0Lk5vZGUge1xuICAgIGxldCB7Zm9yd2FyZGVkUmVmLCBzZWxlY3Rpb25Db2xvciwgLi4ucHJvcHN9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoaXNUb3VjaGFibGUodGhpcy5wcm9wcykpIHtcbiAgICAgIHByb3BzID0ge1xuICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgLi4udGhpcy5zdGF0ZS5yZXNwb25zZUhhbmRsZXJzLFxuICAgICAgICBpc0hpZ2hsaWdodGVkOiB0aGlzLnN0YXRlLmlzSGlnaGxpZ2h0ZWQsXG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAoc2VsZWN0aW9uQ29sb3IgIT0gbnVsbCkge1xuICAgICAgcHJvcHMgPSB7XG4gICAgICAgIC4uLnByb3BzLFxuICAgICAgICBzZWxlY3Rpb25Db2xvcjogcHJvY2Vzc0NvbG9yKHNlbGVjdGlvbkNvbG9yKSxcbiAgICAgIH07XG4gICAgfVxuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICBpZiAoVG91Y2hhYmxlLlRPVUNIX1RBUkdFVF9ERUJVRyAmJiBwcm9wcy5vblByZXNzICE9IG51bGwpIHtcbiAgICAgICAgcHJvcHMgPSB7XG4gICAgICAgICAgLi4ucHJvcHMsXG4gICAgICAgICAgc3R5bGU6IFtwcm9wcy5zdHlsZSwge2NvbG9yOiAnbWFnZW50YSd9XSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIChcbiAgICAgIDxUZXh0QW5jZXN0b3IuQ29uc3VtZXI+XG4gICAgICAgIHtoYXNUZXh0QW5jZXN0b3IgPT5cbiAgICAgICAgICBoYXNUZXh0QW5jZXN0b3IgPyAoXG4gICAgICAgICAgICAvLyAkRmxvd0ZpeE1lW3Byb3AtbWlzc2luZ10gRm9yIHRoZSBgb25DbGlja2Agd29ya2Fyb3VuZC5cbiAgICAgICAgICAgIDxOYXRpdmVWaXJ0dWFsVGV4dFxuICAgICAgICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgICAgICAgIC8vIFRoaXMgaXMgdXNlZCBvbiBBbmRyb2lkIHRvIGNhbGwgYSBuZXN0ZWQgVGV4dCBjb21wb25lbnQncyBwcmVzcyBoYW5kbGVyIGZyb20gdGhlIGNvbnRleHQgbWVudS5cbiAgICAgICAgICAgICAgLy8gVE9ETyBUNzUxNDUwNTkgQ2xlYW4gdGhpcyB1cCBvbmNlIFRleHQgaXMgbWlncmF0ZWQgb2ZmIG9mIFRvdWNoYWJsZVxuICAgICAgICAgICAgICBvbkNsaWNrPXtwcm9wcy5vblByZXNzfVxuICAgICAgICAgICAgICByZWY9e2ZvcndhcmRlZFJlZn1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKSA6IChcbiAgICAgICAgICAgIDxUZXh0QW5jZXN0b3IuUHJvdmlkZXIgdmFsdWU9e3RydWV9PlxuICAgICAgICAgICAgICA8TmF0aXZlVGV4dCB7Li4ucHJvcHN9IHJlZj17Zm9yd2FyZGVkUmVmfSAvPlxuICAgICAgICAgICAgPC9UZXh0QW5jZXN0b3IuUHJvdmlkZXI+XG4gICAgICAgICAgKVxuICAgICAgICB9XG4gICAgICA8L1RleHRBbmNlc3Rvci5Db25zdW1lcj5cbiAgICApO1xuICB9XG5cbiAgX2NyZWF0ZVJlc3BvbnNlSGFuZGxlcnMoKTogUmVzcG9uc2VIYW5kbGVycyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXI6ICgpOiBib29sZWFuID0+IHtcbiAgICAgICAgY29uc3Qge29uU3RhcnRTaG91bGRTZXRSZXNwb25kZXJ9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3Qgc2hvdWxkU2V0UmVzcG9uZGVyID1cbiAgICAgICAgICAob25TdGFydFNob3VsZFNldFJlc3BvbmRlciA9PSBudWxsXG4gICAgICAgICAgICA/IGZhbHNlXG4gICAgICAgICAgICA6IG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXIoKSkgfHwgaXNUb3VjaGFibGUodGhpcy5wcm9wcyk7XG5cbiAgICAgICAgaWYgKHNob3VsZFNldFJlc3BvbmRlcikge1xuICAgICAgICAgIHRoaXMuX2F0dGFjaFRvdWNoSGFuZGxlcnMoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2hvdWxkU2V0UmVzcG9uZGVyO1xuICAgICAgfSxcbiAgICAgIG9uUmVzcG9uZGVyR3JhbnQ6IChldmVudDogUHJlc3NFdmVudCk6IHZvaWQgPT4ge1xuICAgICAgICBudWxsdGhyb3dzKHRoaXMudG91Y2hhYmxlSGFuZGxlUmVzcG9uZGVyR3JhbnQpKGV2ZW50KTtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25SZXNwb25kZXJHcmFudCAhPSBudWxsKSB7XG4gICAgICAgICAgdGhpcy5wcm9wcy5vblJlc3BvbmRlckdyYW50LmNhbGwodGhpcywgZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb25SZXNwb25kZXJNb3ZlOiAoZXZlbnQ6IFByZXNzRXZlbnQpOiB2b2lkID0+IHtcbiAgICAgICAgbnVsbHRocm93cyh0aGlzLnRvdWNoYWJsZUhhbmRsZVJlc3BvbmRlck1vdmUpKGV2ZW50KTtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25SZXNwb25kZXJNb3ZlICE9IG51bGwpIHtcbiAgICAgICAgICB0aGlzLnByb3BzLm9uUmVzcG9uZGVyTW92ZS5jYWxsKHRoaXMsIGV2ZW50KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG9uUmVzcG9uZGVyUmVsZWFzZTogKGV2ZW50OiBQcmVzc0V2ZW50KTogdm9pZCA9PiB7XG4gICAgICAgIG51bGx0aHJvd3ModGhpcy50b3VjaGFibGVIYW5kbGVSZXNwb25kZXJSZWxlYXNlKShldmVudCk7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9uUmVzcG9uZGVyUmVsZWFzZSAhPSBudWxsKSB7XG4gICAgICAgICAgdGhpcy5wcm9wcy5vblJlc3BvbmRlclJlbGVhc2UuY2FsbCh0aGlzLCBldmVudCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvblJlc3BvbmRlclRlcm1pbmF0ZTogKGV2ZW50OiBQcmVzc0V2ZW50KTogdm9pZCA9PiB7XG4gICAgICAgIG51bGx0aHJvd3ModGhpcy50b3VjaGFibGVIYW5kbGVSZXNwb25kZXJUZXJtaW5hdGUpKGV2ZW50KTtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25SZXNwb25kZXJUZXJtaW5hdGUgIT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMucHJvcHMub25SZXNwb25kZXJUZXJtaW5hdGUuY2FsbCh0aGlzLCBldmVudCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvblJlc3BvbmRlclRlcm1pbmF0aW9uUmVxdWVzdDogKCk6IGJvb2xlYW4gPT4ge1xuICAgICAgICBjb25zdCB7b25SZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3R9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCFudWxsdGhyb3dzKHRoaXMudG91Y2hhYmxlSGFuZGxlUmVzcG9uZGVyVGVybWluYXRpb25SZXF1ZXN0KSgpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvblJlc3BvbmRlclRlcm1pbmF0aW9uUmVxdWVzdCA9PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9uUmVzcG9uZGVyVGVybWluYXRpb25SZXF1ZXN0KCk7XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogTGF6aWx5IGF0dGFjaGVzIFRvdWNoYWJsZS5NaXhpbiBoYW5kbGVycy5cbiAgICovXG4gIF9hdHRhY2hUb3VjaEhhbmRsZXJzKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnRvdWNoYWJsZUdldFByZXNzUmVjdE9mZnNldCAhPSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGZvciAoY29uc3Qga2V5IGluIFRvdWNoYWJsZS5NaXhpbikge1xuICAgICAgaWYgKHR5cGVvZiBUb3VjaGFibGUuTWl4aW5ba2V5XSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAodGhpczogYW55KVtrZXldID0gVG91Y2hhYmxlLk1peGluW2tleV0uYmluZCh0aGlzKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy50b3VjaGFibGVIYW5kbGVBY3RpdmVQcmVzc0luID0gKCk6IHZvaWQgPT4ge1xuICAgICAgaWYgKCF0aGlzLnByb3BzLnN1cHByZXNzSGlnaGxpZ2h0aW5nICYmIGlzVG91Y2hhYmxlKHRoaXMucHJvcHMpKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe2lzSGlnaGxpZ2h0ZWQ6IHRydWV9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMudG91Y2hhYmxlSGFuZGxlQWN0aXZlUHJlc3NPdXQgPSAoKTogdm9pZCA9PiB7XG4gICAgICBpZiAoIXRoaXMucHJvcHMuc3VwcHJlc3NIaWdobGlnaHRpbmcgJiYgaXNUb3VjaGFibGUodGhpcy5wcm9wcykpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7aXNIaWdobGlnaHRlZDogZmFsc2V9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMudG91Y2hhYmxlSGFuZGxlUHJlc3MgPSAoZXZlbnQ6IFByZXNzRXZlbnQpOiB2b2lkID0+IHtcbiAgICAgIGlmICh0aGlzLnByb3BzLm9uUHJlc3MgIT0gbnVsbCkge1xuICAgICAgICB0aGlzLnByb3BzLm9uUHJlc3MoZXZlbnQpO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy50b3VjaGFibGVIYW5kbGVMb25nUHJlc3MgPSAoZXZlbnQ6IFByZXNzRXZlbnQpOiB2b2lkID0+IHtcbiAgICAgIGlmICh0aGlzLnByb3BzLm9uTG9uZ1ByZXNzICE9IG51bGwpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkxvbmdQcmVzcyhldmVudCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLnRvdWNoYWJsZUdldFByZXNzUmVjdE9mZnNldCA9ICgpOiBQcmVzc1JldGVudGlvbk9mZnNldCA9PlxuICAgICAgdGhpcy5wcm9wcy5wcmVzc1JldGVudGlvbk9mZnNldCA9PSBudWxsXG4gICAgICAgID8gUFJFU1NfUkVDVF9PRkZTRVRcbiAgICAgICAgOiB0aGlzLnByb3BzLnByZXNzUmV0ZW50aW9uT2Zmc2V0O1xuICB9XG59XG5cbmNvbnN0IGlzVG91Y2hhYmxlID0gKHByb3BzOiBQcm9wcyk6IGJvb2xlYW4gPT5cbiAgcHJvcHMub25QcmVzcyAhPSBudWxsIHx8XG4gIHByb3BzLm9uTG9uZ1ByZXNzICE9IG51bGwgfHxcbiAgcHJvcHMub25TdGFydFNob3VsZFNldFJlc3BvbmRlciAhPSBudWxsO1xuXG5jb25zdCBUZXh0OiBSZWFjdC5BYnN0cmFjdENvbXBvbmVudDxcbiAgVGV4dFByb3BzLFxuICBSZWFjdC5FbGVtZW50UmVmPHR5cGVvZiBOYXRpdmVUZXh0IHwgdHlwZW9mIE5hdGl2ZVZpcnR1YWxUZXh0Pixcbj4gPSBSZWFjdC5mb3J3YXJkUmVmKFxuICAoXG4gICAgcHJvcHM6IFRleHRQcm9wcyxcbiAgICBmb3J3YXJkZWRSZWY6ID9SZWFjdC5SZWY8dHlwZW9mIE5hdGl2ZVRleHQgfCB0eXBlb2YgTmF0aXZlVmlydHVhbFRleHQ+LFxuICApID0+IHtcbiAgICByZXR1cm4gPFRvdWNoYWJsZVRleHQgey4uLnByb3BzfSBmb3J3YXJkZWRSZWY9e2ZvcndhcmRlZFJlZn0gLz47XG4gIH0sXG4pO1xuVGV4dC5kaXNwbGF5TmFtZSA9ICdUZXh0JztcblxuLy8gVE9ETzogRGVwcmVjYXRlIHRoaXMuXG4vKiAkRmxvd0ZpeE1lKD49MC44OS4wIHNpdGU9cmVhY3RfbmF0aXZlX2ZiKSBUaGlzIGNvbW1lbnQgc3VwcHJlc3NlcyBhbiBlcnJvclxuICogZm91bmQgd2hlbiBGbG93IHYwLjg5IHdhcyBkZXBsb3llZC4gVG8gc2VlIHRoZSBlcnJvciwgZGVsZXRlIHRoaXMgY29tbWVudFxuICogYW5kIHJ1biBGbG93LiAqL1xuVGV4dC5wcm9wVHlwZXMgPSBEZXByZWNhdGVkVGV4dFByb3BUeXBlcztcblxuY29uc3QgVGV4dFRvRXhwb3J0OiB0eXBlb2YgVGV4dCAmXG4gICRSZWFkT25seTx7fFxuICAgIHByb3BUeXBlczogdHlwZW9mIERlcHJlY2F0ZWRUZXh0UHJvcFR5cGVzLFxuICB8fT4gPVxuICAvLyAkRmxvd0ZpeE1lW2luY29tcGF0aWJsZS10eXBlXSAtIE5vIGdvb2Qgd2F5IHRvIHR5cGUgYSBSZWFjdC5BYnN0cmFjdENvbXBvbmVudCB3aXRoIHN0YXRpY3MuXG4gIFRleHRJbmplY3Rpb24udW5zdGFibGVfVGV4dCA9PSBudWxsID8gVGV4dCA6IFRleHRJbmplY3Rpb24udW5zdGFibGVfVGV4dDtcblxubW9kdWxlLmV4cG9ydHMgPSBUZXh0VG9FeHBvcnQ7XG4iXX0=