94106f14c39d697d60f79aee6b918d95
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.default = void 0;

var _chalk = _interopRequireDefault(require('chalk'));

var _diffSequences = _interopRequireDefault(require('diff-sequences'));

var _constants = require("./constants");

var _printDiffs = require("./printDiffs");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

var DIFF_CONTEXT_DEFAULT = 5;
var fgDelete = _chalk.default.green;
var fgInsert = _chalk.default.red;
var fgCommon = _chalk.default.dim;
var fgIndent = _chalk.default.cyan;
var bgCommon = _chalk.default.bgYellow;
var bgInverse = _chalk.default.inverse;

var highlightTrailingSpaces = function highlightTrailingSpaces(line, bgColor) {
  return line.replace(/\s+$/, bgColor('$&'));
};

var highlightLeadingTrailingSpaces = function highlightLeadingTrailingSpaces(line, bgColor) {
  return highlightTrailingSpaces(line, bgColor).replace(/^(\s\s)*(\s)(?=[^\s])/, '$1' + bgColor('$2'));
};

var getHighlightSpaces = function getHighlightSpaces(bothEdges) {
  return bothEdges ? highlightLeadingTrailingSpaces : highlightTrailingSpaces;
};

var formatDelete = function formatDelete(aStart, aEnd, aLinesUn, aLinesIn, put) {
  var highlightSpaces = getHighlightSpaces(aLinesUn !== aLinesIn);

  for (var aIndex = aStart; aIndex !== aEnd; aIndex += 1) {
    var aLineUn = aLinesUn[aIndex];
    var aLineIn = aLinesIn[aIndex];
    var indentation = aLineIn.slice(0, aLineIn.length - aLineUn.length);
    put(fgDelete('- ' + indentation + highlightSpaces(aLineUn, bgInverse)));
  }
};

var formatInsert = function formatInsert(bStart, bEnd, bLinesUn, bLinesIn, put) {
  var highlightSpaces = getHighlightSpaces(bLinesUn !== bLinesIn);

  for (var bIndex = bStart; bIndex !== bEnd; bIndex += 1) {
    var bLineUn = bLinesUn[bIndex];
    var bLineIn = bLinesIn[bIndex];
    var indentation = bLineIn.slice(0, bLineIn.length - bLineUn.length);
    put(fgInsert('+ ' + indentation + highlightSpaces(bLineUn, bgInverse)));
  }
};

var formatCommon = function formatCommon(nCommon, aCommon, bCommon, aLinesIn, bLinesUn, bLinesIn, put) {
  var highlightSpaces = getHighlightSpaces(bLinesUn !== bLinesIn);

  for (; nCommon !== 0; nCommon -= 1, aCommon += 1, bCommon += 1) {
    var bLineUn = bLinesUn[bCommon];
    var bLineIn = bLinesIn[bCommon];
    var bLineInLength = bLineIn.length;
    var indentation = bLineIn.slice(0, bLineInLength - bLineUn.length);
    var hasSameIndentation = aLinesIn[aCommon].length === bLineInLength;
    var fg = hasSameIndentation ? fgCommon : fgIndent;
    var bg = hasSameIndentation ? bgCommon : bgInverse;
    put(fg('  ' + indentation + highlightSpaces(bLineUn, bg)));
  }
};

var diffExpand = function diffExpand(aLinesUn, bLinesUn, aLinesIn, bLinesIn) {
  var isCommon = function isCommon(aIndex, bIndex) {
    return aLinesUn[aIndex] === bLinesUn[bIndex];
  };

  var array = [];

  var put = function put(line) {
    array.push(line);
  };

  var aStart = 0;
  var bStart = 0;

  var foundSubsequence = function foundSubsequence(nCommon, aCommon, bCommon) {
    formatDelete(aStart, aCommon, aLinesUn, aLinesIn, put);
    formatInsert(bStart, bCommon, bLinesUn, bLinesIn, put);
    formatCommon(nCommon, aCommon, bCommon, aLinesIn, bLinesUn, bLinesIn, put);
    aStart = aCommon + nCommon;
    bStart = bCommon + nCommon;
  };

  var aLength = aLinesUn.length;
  var bLength = bLinesUn.length;
  (0, _diffSequences.default)(aLength, bLength, isCommon, foundSubsequence);
  formatDelete(aStart, aLength, aLinesUn, aLinesIn, put);
  formatInsert(bStart, bLength, bLinesUn, bLinesIn, put);
  return array.join('\n');
};

var getContextLines = function getContextLines(options) {
  return options && typeof options.contextLines === 'number' && options.contextLines >= 0 ? options.contextLines : DIFF_CONTEXT_DEFAULT;
};

var diffNoExpand = function diffNoExpand(aLinesUn, bLinesUn, aLinesIn, bLinesIn, nContextLines) {
  var isCommon = function isCommon(aIndex, bIndex) {
    return aLinesUn[aIndex] === bLinesUn[bIndex];
  };

  var iPatchMark = 0;
  var array = [''];

  var put = function put(line) {
    array.push(line);
  };

  var isAtEnd = false;
  var aLength = aLinesUn.length;
  var bLength = bLinesUn.length;
  var nContextLines2 = nContextLines + nContextLines;
  var aStart = 0;
  var aEnd = 0;
  var bStart = 0;
  var bEnd = 0;

  var foundSubsequence = function foundSubsequence(nCommon, aStartCommon, bStartCommon) {
    var aEndCommon = aStartCommon + nCommon;
    var bEndCommon = bStartCommon + nCommon;
    isAtEnd = aEndCommon === aLength && bEndCommon === bLength;

    if (aStartCommon === 0 && bStartCommon === 0) {
      var nLines = nContextLines < nCommon ? nContextLines : nCommon;
      aStart = aEndCommon - nLines;
      bStart = bEndCommon - nLines;
      formatCommon(nLines, aStart, bStart, aLinesIn, bLinesUn, bLinesIn, put);
      aEnd = aEndCommon;
      bEnd = bEndCommon;
      return;
    }

    formatDelete(aEnd, aStartCommon, aLinesUn, aLinesIn, put);
    formatInsert(bEnd, bStartCommon, bLinesUn, bLinesIn, put);
    aEnd = aStartCommon;
    bEnd = bStartCommon;
    var maxContextLines = isAtEnd ? nContextLines : nContextLines2;

    if (nCommon <= maxContextLines) {
      formatCommon(nCommon, aEnd, bEnd, aLinesIn, bLinesUn, bLinesIn, put);
      aEnd += nCommon;
      bEnd += nCommon;
      return;
    }

    formatCommon(nContextLines, aEnd, bEnd, aLinesIn, bLinesUn, bLinesIn, put);
    aEnd += nContextLines;
    bEnd += nContextLines;
    array[iPatchMark] = (0, _printDiffs.createPatchMark)(aStart, aEnd, bStart, bEnd);

    if (!isAtEnd) {
      iPatchMark = array.length;
      array[iPatchMark] = '';

      var _nLines = nContextLines < nCommon ? nContextLines : nCommon;

      aStart = aEndCommon - _nLines;
      bStart = bEndCommon - _nLines;
      formatCommon(_nLines, aStart, bStart, aLinesIn, bLinesUn, bLinesIn, put);
      aEnd = aEndCommon;
      bEnd = bEndCommon;
    }
  };

  (0, _diffSequences.default)(aLength, bLength, isCommon, foundSubsequence);

  if (!isAtEnd) {
    formatDelete(aEnd, aLength, aLinesUn, aLinesIn, put);
    formatInsert(bEnd, bLength, bLinesUn, bLinesIn, put);
    aEnd = aLength;
    bEnd = bLength;
  }

  if (aStart === 0 && aEnd === aLength && bStart === 0 && bEnd === bLength) {
    array.splice(0, 1);
  } else {
    array[iPatchMark] = (0, _printDiffs.createPatchMark)(aStart, aEnd, bStart, bEnd);
  }

  return array.join('\n');
};

var _default = function _default(a, b, options, original) {
  if (a === b) {
    return _constants.NO_DIFF_MESSAGE;
  }

  var aLinesUn = a.split('\n');
  var bLinesUn = b.split('\n');
  var aLinesIn = aLinesUn;
  var bLinesIn = bLinesUn;

  if (original) {
    aLinesIn = original.a.split('\n');
    bLinesIn = original.b.split('\n');

    if (aLinesUn.length !== aLinesIn.length || bLinesUn.length !== bLinesIn.length) {
      aLinesUn = aLinesIn;
      bLinesUn = bLinesIn;
    }
  }

  return (0, _printDiffs.printAnnotation)(options) + (options && options.expand === false ? diffNoExpand(aLinesUn, bLinesUn, aLinesIn, bLinesIn, getContextLines(options)) : diffExpand(aLinesUn, bLinesUn, aLinesIn, bLinesIn));
};

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRpZmZMaW5lcy5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJfY2hhbGsiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9kaWZmU2VxdWVuY2VzIiwiX2NvbnN0YW50cyIsIl9wcmludERpZmZzIiwib2JqIiwiX19lc01vZHVsZSIsIkRJRkZfQ09OVEVYVF9ERUZBVUxUIiwiZmdEZWxldGUiLCJncmVlbiIsImZnSW5zZXJ0IiwicmVkIiwiZmdDb21tb24iLCJkaW0iLCJmZ0luZGVudCIsImN5YW4iLCJiZ0NvbW1vbiIsImJnWWVsbG93IiwiYmdJbnZlcnNlIiwiaW52ZXJzZSIsImhpZ2hsaWdodFRyYWlsaW5nU3BhY2VzIiwibGluZSIsImJnQ29sb3IiLCJyZXBsYWNlIiwiaGlnaGxpZ2h0TGVhZGluZ1RyYWlsaW5nU3BhY2VzIiwiZ2V0SGlnaGxpZ2h0U3BhY2VzIiwiYm90aEVkZ2VzIiwiZm9ybWF0RGVsZXRlIiwiYVN0YXJ0IiwiYUVuZCIsImFMaW5lc1VuIiwiYUxpbmVzSW4iLCJwdXQiLCJoaWdobGlnaHRTcGFjZXMiLCJhSW5kZXgiLCJhTGluZVVuIiwiYUxpbmVJbiIsImluZGVudGF0aW9uIiwic2xpY2UiLCJsZW5ndGgiLCJmb3JtYXRJbnNlcnQiLCJiU3RhcnQiLCJiRW5kIiwiYkxpbmVzVW4iLCJiTGluZXNJbiIsImJJbmRleCIsImJMaW5lVW4iLCJiTGluZUluIiwiZm9ybWF0Q29tbW9uIiwibkNvbW1vbiIsImFDb21tb24iLCJiQ29tbW9uIiwiYkxpbmVJbkxlbmd0aCIsImhhc1NhbWVJbmRlbnRhdGlvbiIsImZnIiwiYmciLCJkaWZmRXhwYW5kIiwiaXNDb21tb24iLCJhcnJheSIsInB1c2giLCJmb3VuZFN1YnNlcXVlbmNlIiwiYUxlbmd0aCIsImJMZW5ndGgiLCJqb2luIiwiZ2V0Q29udGV4dExpbmVzIiwib3B0aW9ucyIsImNvbnRleHRMaW5lcyIsImRpZmZOb0V4cGFuZCIsIm5Db250ZXh0TGluZXMiLCJpUGF0Y2hNYXJrIiwiaXNBdEVuZCIsIm5Db250ZXh0TGluZXMyIiwiYVN0YXJ0Q29tbW9uIiwiYlN0YXJ0Q29tbW9uIiwiYUVuZENvbW1vbiIsImJFbmRDb21tb24iLCJuTGluZXMiLCJtYXhDb250ZXh0TGluZXMiLCJjcmVhdGVQYXRjaE1hcmsiLCJzcGxpY2UiLCJfZGVmYXVsdCIsImEiLCJiIiwib3JpZ2luYWwiLCJOT19ESUZGX01FU1NBR0UiLCJzcGxpdCIsInByaW50QW5ub3RhdGlvbiIsImV4cGFuZCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLEVBQUFBLEtBQUssRUFBRTtBQURvQyxDQUE3QztBQUdBRCxPQUFPLENBQUNFLE9BQVIsR0FBa0IsS0FBSyxDQUF2Qjs7QUFFQSxJQUFJQyxNQUFNLEdBQUdDLHNCQUFzQixDQUFDQyxPQUFPLENBQUMsT0FBRCxDQUFSLENBQW5DOztBQUVBLElBQUlDLGNBQWMsR0FBR0Ysc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxnQkFBRCxDQUFSLENBQTNDOztBQUVBLElBQUlFLFVBQVUsR0FBR0YsT0FBTyxlQUF4Qjs7QUFFQSxJQUFJRyxXQUFXLEdBQUdILE9BQU8sZ0JBQXpCOztBQUVBLFNBQVNELHNCQUFULENBQWdDSyxHQUFoQyxFQUFxQztBQUNuQyxTQUFPQSxHQUFHLElBQUlBLEdBQUcsQ0FBQ0MsVUFBWCxHQUF3QkQsR0FBeEIsR0FBOEI7QUFBQ1AsSUFBQUEsT0FBTyxFQUFFTztBQUFWLEdBQXJDO0FBQ0Q7O0FBUUQsSUFBTUUsb0JBQW9CLEdBQUcsQ0FBN0I7QUFDQSxJQUFNQyxRQUFRLEdBQUdULE1BQU0sQ0FBQ0QsT0FBUCxDQUFlVyxLQUFoQztBQUNBLElBQU1DLFFBQVEsR0FBR1gsTUFBTSxDQUFDRCxPQUFQLENBQWVhLEdBQWhDO0FBQ0EsSUFBTUMsUUFBUSxHQUFHYixNQUFN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OztBQXlDQWhELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQmtGLFFBQWxCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcblxudmFyIF9jaGFsayA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgnY2hhbGsnKSk7XG5cbnZhciBfZGlmZlNlcXVlbmNlcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgnZGlmZi1zZXF1ZW5jZXMnKSk7XG5cbnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgnLi9jb25zdGFudHMnKTtcblxudmFyIF9wcmludERpZmZzID0gcmVxdWlyZSgnLi9wcmludERpZmZzJyk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7XG4gIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ZGVmYXVsdDogb2JqfTtcbn1cblxuLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuY29uc3QgRElGRl9DT05URVhUX0RFRkFVTFQgPSA1O1xuY29uc3QgZmdEZWxldGUgPSBfY2hhbGsuZGVmYXVsdC5ncmVlbjtcbmNvbnN0IGZnSW5zZXJ0ID0gX2NoYWxrLmRlZmF1bHQucmVkO1xuY29uc3QgZmdDb21tb24gPSBfY2hhbGsuZGVmYXVsdC5kaW07IC8vIGNvbW1vbiBsaW5lcyAoZXZlbiBpbmRlbnRhdGlvbiBzYW1lKVxuXG5jb25zdCBmZ0luZGVudCA9IF9jaGFsay5kZWZhdWx0LmN5YW47IC8vIGNvbW1vbiBsaW5lcyAob25seSBpbmRlbnRhdGlvbiBkaWZmZXJlbnQpXG5cbmNvbnN0IGJnQ29tbW9uID0gX2NoYWxrLmRlZmF1bHQuYmdZZWxsb3c7IC8vIGVkZ2Ugc3BhY2VzIGluIGNvbW1vbiBsaW5lIChldmVuIGluZGVudGF0aW9uIHNhbWUpXG5cbmNvbnN0IGJnSW52ZXJzZSA9IF9jaGFsay5kZWZhdWx0LmludmVyc2U7IC8vIGVkZ2Ugc3BhY2VzIGluIGFueSBvdGhlciBsaW5lc1xuLy8gT05MWSB0cmFpbGluZyBpZiBleHBlY3RlZCB2YWx1ZSBpcyBzbmFwc2hvdCBvciBtdWx0aWxpbmUgc3RyaW5nLlxuXG5jb25zdCBoaWdobGlnaHRUcmFpbGluZ1NwYWNlcyA9IChsaW5lLCBiZ0NvbG9yKSA9PlxuICBsaW5lLnJlcGxhY2UoL1xccyskLywgYmdDb2xvcignJCYnKSk7IC8vIEJPVEggbGVhZGluZyBBTkQgdHJhaWxpbmcgaWYgZXhwZWN0ZWQgdmFsdWUgaXMgZGF0YSBzdHJ1Y3R1cmUuXG5cbmNvbnN0IGhpZ2hsaWdodExlYWRpbmdUcmFpbGluZ1NwYWNlcyA9IChcbiAgbGluZSxcbiAgYmdDb2xvciAvLyBJZiBsaW5lIGNvbnNpc3RzIG9mIEFMTCBzcGFjZXM6IGhpZ2hsaWdodCBhbGwgb2YgdGhlbS5cbikgPT5cbiAgaGlnaGxpZ2h0VHJhaWxpbmdTcGFjZXMobGluZSwgYmdDb2xvcikucmVwbGFjZShcbiAgICAvLyBJZiBsaW5lIGhhcyBhbiBPREQgbGVuZ3RoIG9mIGxlYWRpbmcgc3BhY2VzOiBoaWdobGlnaHQgb25seSB0aGUgTEFTVC5cbiAgICAvXihcXHNcXHMpKihcXHMpKD89W15cXHNdKS8sXG4gICAgJyQxJyArIGJnQ29sb3IoJyQyJylcbiAgKTtcblxuY29uc3QgZ2V0SGlnaGxpZ2h0U3BhY2VzID0gYm90aEVkZ2VzID0+XG4gIGJvdGhFZGdlcyA/IGhpZ2hsaWdodExlYWRpbmdUcmFpbGluZ1NwYWNlcyA6IGhpZ2hsaWdodFRyYWlsaW5nU3BhY2VzO1xuXG4vLyBHaXZlbiBpbmRleCBpbnRlcnZhbCBpbiBleHBlY3RlZCBsaW5lcywgcHV0IGZvcm1hdHRlZCBkZWxldGUgbGluZXMuXG5jb25zdCBmb3JtYXREZWxldGUgPSAoYVN0YXJ0LCBhRW5kLCBhTGluZXNVbiwgYUxpbmVzSW4sIHB1dCkgPT4ge1xuICBjb25zdCBoaWdobGlnaHRTcGFjZXMgPSBnZXRIaWdobGlnaHRTcGFjZXMoYUxpbmVzVW4gIT09IGFMaW5lc0luKTtcblxuICBmb3IgKGxldCBhSW5kZXggPSBhU3RhcnQ7IGFJbmRleCAhPT0gYUVuZDsgYUluZGV4ICs9IDEpIHtcbiAgICBjb25zdCBhTGluZVVuID0gYUxpbmVzVW5bYUluZGV4XTtcbiAgICBjb25zdCBhTGluZUluID0gYUxpbmVzSW5bYUluZGV4XTtcbiAgICBjb25zdCBpbmRlbnRhdGlvbiA9IGFMaW5lSW4uc2xpY2UoMCwgYUxpbmVJbi5sZW5ndGggLSBhTGluZVVuLmxlbmd0aCk7XG4gICAgcHV0KGZnRGVsZXRlKCctICcgKyBpbmRlbnRhdGlvbiArIGhpZ2hsaWdodFNwYWNlcyhhTGluZVVuLCBiZ0ludmVyc2UpKSk7XG4gIH1cbn07IC8vIEdpdmVuIGluZGV4IGludGVydmFsIGluIHJlY2VpdmVkIGxpbmVzLCBwdXQgZm9ybWF0dGVkIGluc2VydCBsaW5lcy5cblxuY29uc3QgZm9ybWF0SW5zZXJ0ID0gKGJTdGFydCwgYkVuZCwgYkxpbmVzVW4sIGJMaW5lc0luLCBwdXQpID0+IHtcbiAgY29uc3QgaGlnaGxpZ2h0U3BhY2VzID0gZ2V0SGlnaGxpZ2h0U3BhY2VzKGJMaW5lc1VuICE9PSBiTGluZXNJbik7XG5cbiAgZm9yIChsZXQgYkluZGV4ID0gYlN0YXJ0OyBiSW5kZXggIT09IGJFbmQ7IGJJbmRleCArPSAxKSB7XG4gICAgY29uc3QgYkxpbmVVbiA9IGJMaW5lc1VuW2JJbmRleF07XG4gICAgY29uc3QgYkxpbmVJbiA9IGJMaW5lc0luW2JJbmRleF07XG4gICAgY29uc3QgaW5kZW50YXRpb24gPSBiTGluZUluLnNsaWNlKDAsIGJMaW5lSW4ubGVuZ3RoIC0gYkxpbmVVbi5sZW5ndGgpO1xuICAgIHB1dChmZ0luc2VydCgnKyAnICsgaW5kZW50YXRpb24gKyBoaWdobGlnaHRTcGFjZXMoYkxpbmVVbiwgYmdJbnZlcnNlKSkpO1xuICB9XG59OyAvLyBHaXZlbiB0aGUgbnVtYmVyIG9mIGl0ZW1zIGFuZCBzdGFydGluZyBpbmRleGVzIG9mIGEgY29tbW9uIHN1YnNlcXVlbmNlLFxuLy8gcHV0IGZvcm1hdHRlZCBjb21tb24gbGluZXMuXG5cbmNvbnN0IGZvcm1hdENvbW1vbiA9IChcbiAgbkNvbW1vbixcbiAgYUNvbW1vbixcbiAgYkNvbW1vbixcbiAgYUxpbmVzSW4sXG4gIGJMaW5lc1VuLFxuICBiTGluZXNJbixcbiAgcHV0XG4pID0+IHtcbiAgY29uc3QgaGlnaGxpZ2h0U3BhY2VzID0gZ2V0SGlnaGxpZ2h0U3BhY2VzKGJMaW5lc1VuICE9PSBiTGluZXNJbik7XG5cbiAgZm9yICg7IG5Db21tb24gIT09IDA7IG5Db21tb24gLT0gMSwgYUNvbW1vbiArPSAxLCBiQ29tbW9uICs9IDEpIHtcbiAgICBjb25zdCBiTGluZVVuID0gYkxpbmVzVW5bYkNvbW1vbl07XG4gICAgY29uc3QgYkxpbmVJbiA9IGJMaW5lc0luW2JDb21tb25dO1xuICAgIGNvbnN0IGJMaW5lSW5MZW5ndGggPSBiTGluZUluLmxlbmd0aDsgLy8gRm9yIGNvbW1vbiBsaW5lcywgcmVjZWl2ZWQgaW5kZW50YXRpb24gc2VlbXMgbW9yZSBpbnR1aXRpdmUuXG5cbiAgICBjb25zdCBpbmRlbnRhdGlvbiA9IGJMaW5lSW4uc2xpY2UoMCwgYkxpbmVJbkxlbmd0aCAtIGJMaW5lVW4ubGVuZ3RoKTsgLy8gQ29sb3Igc2hvd3Mgd2hldGhlciBleHBlY3RlZCBhbmQgcmVjZWl2ZWQgbGluZSBoYXMgc2FtZSBpbmRlbnRhdGlvbi5cblxuICAgIGNvbnN0IGhhc1NhbWVJbmRlbnRhdGlvbiA9IGFMaW5lc0luW2FDb21tb25dLmxlbmd0aCA9PT0gYkxpbmVJbkxlbmd0aDtcbiAgICBjb25zdCBmZyA9IGhhc1NhbWVJbmRlbnRhdGlvbiA/IGZnQ29tbW9uIDogZmdJbmRlbnQ7XG4gICAgY29uc3QgYmcgPSBoYXNTYW1lSW5kZW50YXRpb24gPyBiZ0NvbW1vbiA6IGJnSW52ZXJzZTtcbiAgICBwdXQoZmcoJyAgJyArIGluZGVudGF0aW9uICsgaGlnaGxpZ2h0U3BhY2VzKGJMaW5lVW4sIGJnKSkpO1xuICB9XG59OyAvLyBqZXN0IC0tZXhwYW5kXG4vLyBSZXR1cm4gZm9ybWF0dGVkIGRpZmYgYXMgam9pbmVkIHN0cmluZyBvZiBhbGwgbGluZXMuXG5cbmNvbnN0IGRpZmZFeHBhbmQgPSAoYUxpbmVzVW4sIGJMaW5lc1VuLCBhTGluZXNJbiwgYkxpbmVzSW4pID0+IHtcbiAgY29uc3QgaXNDb21tb24gPSAoYUluZGV4LCBiSW5kZXgpID0+IGFMaW5lc1VuW2FJbmRleF0gPT09IGJMaW5lc1VuW2JJbmRleF07XG5cbiAgY29uc3QgYXJyYXkgPSBbXTtcblxuICBjb25zdCBwdXQgPSBsaW5lID0+IHtcbiAgICBhcnJheS5wdXNoKGxpbmUpO1xuICB9O1xuXG4gIGxldCBhU3RhcnQgPSAwO1xuICBsZXQgYlN0YXJ0ID0gMDtcblxuICBjb25zdCBmb3VuZFN1YnNlcXVlbmNlID0gKG5Db21tb24sIGFDb21tb24sIGJDb21tb24pID0+IHtcbiAgICBmb3JtYXREZWxldGUoYVN0YXJ0LCBhQ29tbW9uLCBhTGluZXNVbiwgYUxpbmVzSW4sIHB1dCk7XG4gICAgZm9ybWF0SW5zZXJ0KGJTdGFydCwgYkNvbW1vbiwgYkxpbmVzVW4sIGJMaW5lc0luLCBwdXQpO1xuICAgIGZvcm1hdENvbW1vbihuQ29tbW9uLCBhQ29tbW9uLCBiQ29tbW9uLCBhTGluZXNJbiwgYkxpbmVzVW4sIGJMaW5lc0luLCBwdXQpO1xuICAgIGFTdGFydCA9IGFDb21tb24gKyBuQ29tbW9uO1xuICAgIGJTdGFydCA9IGJDb21tb24gKyBuQ29tbW9uO1xuICB9O1xuXG4gIGNvbnN0IGFMZW5ndGggPSBhTGluZXNVbi5sZW5ndGg7XG4gIGNvbnN0IGJMZW5ndGggPSBiTGluZXNVbi5sZW5ndGg7XG4gICgwLCBfZGlmZlNlcXVlbmNlcy5kZWZhdWx0KShhTGVuZ3RoLCBiTGVuZ3RoLCBpc0NvbW1vbiwgZm91bmRTdWJzZXF1ZW5jZSk7IC8vIEFmdGVyIHRoZSBsYXN0IGNvbW1vbiBzdWJzZXF1ZW5jZSwgZm9ybWF0IHJlbWFpbmluZyBjaGFuZ2UgbGluZXMuXG5cbiAgZm9ybWF0RGVsZXRlKGFTdGFydCwgYUxlbmd0aCwgYUxpbmVzVW4sIGFMaW5lc0luLCBwdXQpO1xuICBmb3JtYXRJbnNlcnQoYlN0YXJ0LCBiTGVuZ3RoLCBiTGluZXNVbiwgYkxpbmVzSW4sIHB1dCk7XG4gIHJldHVybiBhcnJheS5qb2luKCdcXG4nKTtcbn07XG5cbmNvbnN0IGdldENvbnRleHRMaW5lcyA9IG9wdGlvbnMgPT5cbiAgb3B0aW9ucyAmJlxuICB0eXBlb2Ygb3B0aW9ucy5jb250ZXh0TGluZXMgPT09ICdudW1iZXInICYmXG4gIG9wdGlvbnMuY29udGV4dExpbmVzID49IDBcbiAgICA/IG9wdGlvbnMuY29udGV4dExpbmVzXG4gICAgOiBESUZGX0NPTlRFWFRfREVGQVVMVDsgLy8gamVzdCAtLW5vLWV4cGFuZFxuLy8gUmV0dXJuIGpvaW5lZCBzdHJpbmcgb2YgZm9ybWF0dGVkIGRpZmYgZm9yIGFsbCBjaGFuZ2UgbGluZXMsXG4vLyBidXQgaWYgc29tZSBjb21tb24gbGluZXMgYXJlIG9taXR0ZWQgYmVjYXVzZSB0aGVyZSBhcmUgbW9yZSB0aGFuIHRoZSBjb250ZXh0LFxuLy8gdGhlbiBhIOKAnHBhdGNoIG1hcmvigJ0gcHJlY2VkZXMgZWFjaCBzZXQgb2YgYWRqYWNlbnQgY2hhbmdlZCBhbmQgY29tbW9uIGxpbmVzLlxuXG5jb25zdCBkaWZmTm9FeHBhbmQgPSAoXG4gIGFMaW5lc1VuLFxuICBiTGluZXNVbixcbiAgYUxpbmVzSW4sXG4gIGJMaW5lc0luLFxuICBuQ29udGV4dExpbmVzXG4pID0+IHtcbiAgY29uc3QgaXNDb21tb24gPSAoYUluZGV4LCBiSW5kZXgpID0+IGFMaW5lc1VuW2FJbmRleF0gPT09IGJMaW5lc1VuW2JJbmRleF07XG5cbiAgbGV0IGlQYXRjaE1hcmsgPSAwOyAvLyBpbmRleCBvZiBwbGFjZWhvbGRlciBsaW5lIGZvciBwYXRjaCBtYXJrXG5cbiAgY29uc3QgYXJyYXkgPSBbJyddO1xuXG4gIGNvbnN0IHB1dCA9IGxpbmUgPT4ge1xuICAgIGFycmF5LnB1c2gobGluZSk7XG4gIH07XG5cbiAgbGV0IGlzQXRFbmQgPSBmYWxzZTtcbiAgY29uc3QgYUxlbmd0aCA9IGFMaW5lc1VuLmxlbmd0aDtcbiAgY29uc3QgYkxlbmd0aCA9IGJMaW5lc1VuLmxlbmd0aDtcbiAgY29uc3QgbkNvbnRleHRMaW5lczIgPSBuQ29udGV4dExpbmVzICsgbkNvbnRleHRMaW5lczsgLy8gSW5pdGlhbGl6ZSB0aGUgZmlyc3QgcGF0Y2ggZm9yIGNoYW5nZXMgYXQgdGhlIHN0YXJ0LFxuICAvLyBlc3BlY2lhbGx5IGZvciBlZGdlIGNhc2UgaW4gd2hpY2ggdGhlcmUgaXMgbm8gY29tbW9uIHN1YnNlcXVlbmNlLlxuXG4gIGxldCBhU3RhcnQgPSAwO1xuICBsZXQgYUVuZCA9IDA7XG4gIGxldCBiU3RhcnQgPSAwO1xuICBsZXQgYkVuZCA9IDA7IC8vIEdpdmVuIHRoZSBudW1iZXIgb2YgaXRlbXMgYW5kIHN0YXJ0aW5nIGluZGV4ZXMgb2YgZWFjaCBjb21tb24gc3Vic2VxdWVuY2UsXG4gIC8vIGZvcm1hdCBhbnkgcHJlY2VkaW5nIGNoYW5nZSBsaW5lcywgYW5kIHRoZW4gY29tbW9uIGNvbnRleHQgbGluZXMuXG5cbiAgY29uc3QgZm91bmRTdWJzZXF1ZW5jZSA9IChuQ29tbW9uLCBhU3RhcnRDb21tb24sIGJTdGFydENvbW1vbikgPT4ge1xuICAgIGNvbnN0IGFFbmRDb21tb24gPSBhU3RhcnRDb21tb24gKyBuQ29tbW9uO1xuICAgIGNvbnN0IGJFbmRDb21tb24gPSBiU3RhcnRDb21tb24gKyBuQ29tbW9uO1xuICAgIGlzQXRFbmQgPSBhRW5kQ29tbW9uID09PSBhTGVuZ3RoICYmIGJFbmRDb21tb24gPT09IGJMZW5ndGg7IC8vIElmIGNvbW1vbiBzdWJzZXF1ZW5jZSBpcyBhdCBzdGFydCwgcmUtaW5pdGlhbGl6ZSB0aGUgZmlyc3QgcGF0Y2guXG5cbiAgICBpZiAoYVN0YXJ0Q29tbW9uID09PSAwICYmIGJTdGFydENvbW1vbiA9PT0gMCkge1xuICAgICAgY29uc3QgbkxpbmVzID0gbkNvbnRleHRMaW5lcyA8IG5Db21tb24gPyBuQ29udGV4dExpbmVzIDogbkNvbW1vbjtcbiAgICAgIGFTdGFydCA9IGFFbmRDb21tb24gLSBuTGluZXM7XG4gICAgICBiU3RhcnQgPSBiRW5kQ29tbW9uIC0gbkxpbmVzO1xuICAgICAgZm9ybWF0Q29tbW9uKG5MaW5lcywgYVN0YXJ0LCBiU3RhcnQsIGFMaW5lc0luLCBiTGluZXNVbiwgYkxpbmVzSW4sIHB1dCk7XG4gICAgICBhRW5kID0gYUVuZENvbW1vbjtcbiAgICAgIGJFbmQgPSBiRW5kQ29tbW9uO1xuICAgICAgcmV0dXJuO1xuICAgIH0gLy8gRm9ybWF0IHByZWNlZGluZyBjaGFuZ2UgbGluZXMuXG5cbiAgICBmb3JtYXREZWxldGUoYUVuZCwgYVN0YXJ0Q29tbW9uLCBhTGluZXNVbiwgYUxpbmVzSW4sIHB1dCk7XG4gICAgZm9ybWF0SW5zZXJ0KGJFbmQsIGJTdGFydENvbW1vbiwgYkxpbmVzVW4sIGJMaW5lc0luLCBwdXQpO1xuICAgIGFFbmQgPSBhU3RhcnRDb21tb247XG4gICAgYkVuZCA9IGJTdGFydENvbW1vbjsgLy8gSWYgY29tbW9uIHN1YnNlcXVlbmNlIGlzIGF0IGVuZCwgdGhlbiBjb250ZXh0IGZvbGxvd3MgcHJlY2VkaW5nIGNoYW5nZXM7XG4gICAgLy8gZWxzZSBjb250ZXh0IGZvbGxvd3MgcHJlY2VkaW5nIGNoYW5nZXMgQU5EIHByZWNlZGVzIGZvbGxvd2luZyBjaGFuZ2VzLlxuXG4gICAgY29uc3QgbWF4Q29udGV4dExpbmVzID0gaXNBdEVuZCA/IG5Db250ZXh0TGluZXMgOiBuQ29udGV4dExpbmVzMjtcblxuICAgIGlmIChuQ29tbW9uIDw9IG1heENvbnRleHRMaW5lcykge1xuICAgICAgLy8gVGhlIHBhdGNoIGluY2x1ZGVzIGFsbCBsaW5lcyBpbiB0aGUgY29tbW9uIHN1YnNlcXVlbmNlLlxuICAgICAgZm9ybWF0Q29tbW9uKG5Db21tb24sIGFFbmQsIGJFbmQsIGFMaW5lc0luLCBiTGluZXNVbiwgYkxpbmVzSW4sIHB1dCk7XG4gICAgICBhRW5kICs9IG5Db21tb247XG4gICAgICBiRW5kICs9IG5Db21tb247XG4gICAgICByZXR1cm47XG4gICAgfSAvLyBUaGUgcGF0Y2ggZW5kcyBiZWNhdXNlIGNvbnRleHQgaXMgbGVzcyB0aGFuIG51bWJlciBvZiBjb21tb24gbGluZXMuXG5cbiAgICBmb3JtYXRDb21tb24obkNvbnRleHRMaW5lcywgYUVuZCwgYkVuZCwgYUxpbmVzSW4sIGJMaW5lc1VuLCBiTGluZXNJbiwgcHV0KTtcbiAgICBhRW5kICs9IG5Db250ZXh0TGluZXM7XG4gICAgYkVuZCArPSBuQ29udGV4dExpbmVzO1xuICAgIGFycmF5W2lQYXRjaE1hcmtdID0gKDAsIF9wcmludERpZmZzLmNyZWF0ZVBhdGNoTWFyaykoXG4gICAgICBhU3RhcnQsXG4gICAgICBhRW5kLFxuICAgICAgYlN0YXJ0LFxuICAgICAgYkVuZFxuICAgICk7IC8vIElmIGNvbW1vbiBzdWJzZXF1ZW5jZSBpcyBub3QgYXQgZW5kLCBhbm90aGVyIHBhdGNoIGZvbGxvd3MgaXQuXG5cbiAgICBpZiAoIWlzQXRFbmQpIHtcbiAgICAgIGlQYXRjaE1hcmsgPSBhcnJheS5sZW5ndGg7IC8vIGluZGV4IG9mIHBsYWNlaG9sZGVyIGxpbmVcblxuICAgICAgYXJyYXlbaVBhdGNoTWFya10gPSAnJztcbiAgICAgIGNvbnN0IG5MaW5lcyA9IG5Db250ZXh0TGluZXMgPCBuQ29tbW9uID8gbkNvbnRleHRMaW5lcyA6IG5Db21tb247XG4gICAgICBhU3RhcnQgPSBhRW5kQ29tbW9uIC0gbkxpbmVzO1xuICAgICAgYlN0YXJ0ID0gYkVuZENvbW1vbiAtIG5MaW5lcztcbiAgICAgIGZvcm1hdENvbW1vbihuTGluZXMsIGFTdGFydCwgYlN0YXJ0LCBhTGluZXNJbiwgYkxpbmVzVW4sIGJMaW5lc0luLCBwdXQpO1xuICAgICAgYUVuZCA9IGFFbmRDb21tb247XG4gICAgICBiRW5kID0gYkVuZENvbW1vbjtcbiAgICB9XG4gIH07XG5cbiAgKDAsIF9kaWZmU2VxdWVuY2VzLmRlZmF1bHQpKGFMZW5ndGgsIGJMZW5ndGgsIGlzQ29tbW9uLCBmb3VuZFN1YnNlcXVlbmNlKTsgLy8gSWYgbm8gY29tbW9uIHN1YnNlcXVlbmNlIG9yIGxhc3Qgd2FzIG5vdCBhdCBlbmQsIGZvcm1hdCByZW1haW5pbmcgY2hhbmdlIGxpbmVzLlxuXG4gIGlmICghaXNBdEVuZCkge1xuICAgIGZvcm1hdERlbGV0ZShhRW5kLCBhTGVuZ3RoLCBhTGluZXNVbiwgYUxpbmVzSW4sIHB1dCk7XG4gICAgZm9ybWF0SW5zZXJ0KGJFbmQsIGJMZW5ndGgsIGJMaW5lc1VuLCBiTGluZXNJbiwgcHV0KTtcbiAgICBhRW5kID0gYUxlbmd0aDtcbiAgICBiRW5kID0gYkxlbmd0aDtcbiAgfVxuXG4gIGlmIChhU3RhcnQgPT09IDAgJiYgYUVuZCA9PT0gYUxlbmd0aCAmJiBiU3RhcnQgPT09IDAgJiYgYkVuZCA9PT0gYkxlbmd0aCkge1xuICAgIGFycmF5LnNwbGljZSgwLCAxKTsgLy8gZGVsZXRlIHBsYWNlaG9sZGVyIGxpbmUgZm9yIHBhdGNoIG1hcmtcbiAgfSBlbHNlIHtcbiAgICBhcnJheVtpUGF0Y2hNYXJrXSA9ICgwLCBfcHJpbnREaWZmcy5jcmVhdGVQYXRjaE1hcmspKFxuICAgICAgYVN0YXJ0LFxuICAgICAgYUVuZCxcbiAgICAgIGJTdGFydCxcbiAgICAgIGJFbmRcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIGFycmF5LmpvaW4oJ1xcbicpO1xufTtcblxudmFyIF9kZWZhdWx0ID0gKGEsIGIsIG9wdGlvbnMsIG9yaWdpbmFsKSA9PiB7XG4gIGlmIChhID09PSBiKSB7XG4gICAgcmV0dXJuIF9jb25zdGFudHMuTk9fRElGRl9NRVNTQUdFO1xuICB9XG5cbiAgbGV0IGFMaW5lc1VuID0gYS5zcGxpdCgnXFxuJyk7XG4gIGxldCBiTGluZXNVbiA9IGIuc3BsaXQoJ1xcbicpOyAvLyBJbmRlbnRhdGlvbiBpcyB1bmtub3duIGlmIGV4cGVjdGVkIHZhbHVlIGlzIHNuYXBzaG90IG9yIG11bHRpbGluZSBzdHJpbmcuXG5cbiAgbGV0IGFMaW5lc0luID0gYUxpbmVzVW47XG4gIGxldCBiTGluZXNJbiA9IGJMaW5lc1VuO1xuXG4gIGlmIChvcmlnaW5hbCkge1xuICAgIC8vIEluZGVudGF0aW9uIGlzIGtub3duIGlmIGV4cGVjdGVkIHZhbHVlIGlzIGRhdGEgc3RydWN0dXJlOlxuICAgIC8vIENvbXBhcmUgbGluZXMgd2l0aG91dCBpbmRlbnRhdGlvbiBhbmQgZm9ybWF0IGxpbmVzIHdpdGggaW5kZW50YXRpb24uXG4gICAgYUxpbmVzSW4gPSBvcmlnaW5hbC5hLnNwbGl0KCdcXG4nKTtcbiAgICBiTGluZXNJbiA9IG9yaWdpbmFsLmIuc3BsaXQoJ1xcbicpO1xuXG4gICAgaWYgKFxuICAgICAgYUxpbmVzVW4ubGVuZ3RoICE9PSBhTGluZXNJbi5sZW5ndGggfHxcbiAgICAgIGJMaW5lc1VuLmxlbmd0aCAhPT0gYkxpbmVzSW4ubGVuZ3RoXG4gICAgKSB7XG4gICAgICAvLyBGYWxsIGJhY2sgaWYgdW5pbmRlbnRlZCBhbmQgaW5kZW50ZWQgbGluZXMgYXJlIGluY29uc2lzdGVudC5cbiAgICAgIGFMaW5lc1VuID0gYUxpbmVzSW47XG4gICAgICBiTGluZXNVbiA9IGJMaW5lc0luO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiAoXG4gICAgKDAsIF9wcmludERpZmZzLnByaW50QW5ub3RhdGlvbikob3B0aW9ucykgK1xuICAgIChvcHRpb25zICYmIG9wdGlvbnMuZXhwYW5kID09PSBmYWxzZVxuICAgICAgPyBkaWZmTm9FeHBhbmQoXG4gICAgICAgICAgYUxpbmVzVW4sXG4gICAgICAgICAgYkxpbmVzVW4sXG4gICAgICAgICAgYUxpbmVzSW4sXG4gICAgICAgICAgYkxpbmVzSW4sXG4gICAgICAgICAgZ2V0Q29udGV4dExpbmVzKG9wdGlvbnMpXG4gICAgICAgIClcbiAgICAgIDogZGlmZkV4cGFuZChhTGluZXNVbiwgYkxpbmVzVW4sIGFMaW5lc0luLCBiTGluZXNJbikpXG4gICk7XG59O1xuXG5leHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDtcbiJdfQ==