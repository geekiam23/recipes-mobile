25c9294ee4d6b048100b4d9dacc99957
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createDOMElementFilter;
exports.test = void 0;

function escapeHTML(str) {
  return str.replace(/</g, '&lt;').replace(/>/g, '&gt;');
}

var printProps = function printProps(keys, props, config, indentation, depth, refs, printer) {
  var indentationNext = indentation + config.indent;
  var colors = config.colors;
  return keys.map(function (key) {
    var value = props[key];
    var printed = printer(value, config, indentationNext, depth, refs);

    if (typeof value !== 'string') {
      if (printed.indexOf('\n') !== -1) {
        printed = config.spacingOuter + indentationNext + printed + config.spacingOuter + indentation;
      }

      printed = '{' + printed + '}';
    }

    return config.spacingInner + indentation + colors.prop.open + key + colors.prop.close + '=' + colors.value.open + printed + colors.value.close;
  }).join('');
};

var NodeTypeTextNode = 3;

var printChildren = function printChildren(children, config, indentation, depth, refs, printer) {
  return children.map(function (child) {
    var printedChild = typeof child === 'string' ? printText(child, config) : printer(child, config, indentation, depth, refs);

    if (printedChild === '' && typeof child === 'object' && child !== null && child.nodeType !== NodeTypeTextNode) {
      return '';
    }

    return config.spacingOuter + indentation + printedChild;
  }).join('');
};

var printText = function printText(text, config) {
  var contentColor = config.colors.content;
  return contentColor.open + escapeHTML(text) + contentColor.close;
};

var printComment = function printComment(comment, config) {
  var commentColor = config.colors.comment;
  return commentColor.open + '<!--' + escapeHTML(comment) + '-->' + commentColor.close;
};

var printElement = function printElement(type, printedProps, printedChildren, config, indentation) {
  var tagColor = config.colors.tag;
  return tagColor.open + '<' + type + (printedProps && tagColor.close + printedProps + config.spacingOuter + indentation + tagColor.open) + (printedChildren ? '>' + tagColor.close + printedChildren + config.spacingOuter + indentation + tagColor.open + '</' + type : (printedProps && !config.min ? '' : ' ') + '/') + '>' + tagColor.close;
};

var printElementAsLeaf = function printElementAsLeaf(type, config) {
  var tagColor = config.colors.tag;
  return tagColor.open + '<' + type + tagColor.close + ' â€¦' + tagColor.open + ' />' + tagColor.close;
};

var ELEMENT_NODE = 1;
var TEXT_NODE = 3;
var COMMENT_NODE = 8;
var FRAGMENT_NODE = 11;
var ELEMENT_REGEXP = /^((HTML|SVG)\w*)?Element$/;

var testNode = function testNode(val) {
  var constructorName = val.constructor.name;
  var nodeType = val.nodeType,
      tagName = val.tagName;
  var isCustomElement = typeof tagName === 'string' && tagName.includes('-') || typeof val.hasAttribute === 'function' && val.hasAttribute('is');
  return nodeType === ELEMENT_NODE && (ELEMENT_REGEXP.test(constructorName) || isCustomElement) || nodeType === TEXT_NODE && constructorName === 'Text' || nodeType === COMMENT_NODE && constructorName === 'Comment' || nodeType === FRAGMENT_NODE && constructorName === 'DocumentFragment';
};

var test = function test(val) {
  var _val$constructor;

  return (val == null ? void 0 : (_val$constructor = val.constructor) == null ? void 0 : _val$constructor.name) && testNode(val);
};

exports.test = test;

function nodeIsText(node) {
  return node.nodeType === TEXT_NODE;
}

function nodeIsComment(node) {
  return node.nodeType === COMMENT_NODE;
}

function nodeIsFragment(node) {
  return node.nodeType === FRAGMENT_NODE;
}

function createDOMElementFilter(filterNode) {
  return {
    test: function test(val) {
      var _val$constructor2;

      return (val == null ? void 0 : (_val$constructor2 = val.constructor) == null ? void 0 : _val$constructor2.name) && testNode(val);
    },
    serialize: function serialize(node, config, indentation, depth, refs, printer) {
      if (nodeIsText(node)) {
        return printText(node.data, config);
      }

      if (nodeIsComment(node)) {
        return printComment(node.data, config);
      }

      var type = nodeIsFragment(node) ? "DocumentFragment" : node.tagName.toLowerCase();

      if (++depth > config.maxDepth) {
        return printElementAsLeaf(type, config);
      }

      return printElement(type, printProps(nodeIsFragment(node) ? [] : Array.from(node.attributes).map(function (attr) {
        return attr.name;
      }).sort(), nodeIsFragment(node) ? {} : Array.from(node.attributes).reduce(function (props, attribute) {
        props[attribute.name] = attribute.value;
        return props;
      }, {}), config, indentation + config.indent, depth, refs, printer), printChildren(Array.prototype.slice.call(node.childNodes || node.children).filter(filterNode), config, indentation + config.indent, depth, refs, printer), config, indentation);
    }
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRPTUVsZW1lbnRGaWx0ZXIuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJkZWZhdWx0IiwiY3JlYXRlRE9NRWxlbWVudEZpbHRlciIsInRlc3QiLCJlc2NhcGVIVE1MIiwic3RyIiwicmVwbGFjZSIsInByaW50UHJvcHMiLCJrZXlzIiwicHJvcHMiLCJjb25maWciLCJpbmRlbnRhdGlvbiIsImRlcHRoIiwicmVmcyIsInByaW50ZXIiLCJpbmRlbnRhdGlvbk5leHQiLCJpbmRlbnQiLCJjb2xvcnMiLCJtYXAiLCJrZXkiLCJwcmludGVkIiwiaW5kZXhPZiIsInNwYWNpbmdPdXRlciIsInNwYWNpbmdJbm5lciIsInByb3AiLCJvcGVuIiwiY2xvc2UiLCJqb2luIiwiTm9kZVR5cGVUZXh0Tm9kZSIsInByaW50Q2hpbGRyZW4iLCJjaGlsZHJlbiIsImNoaWxkIiwicHJpbnRlZENoaWxkIiwicHJpbnRUZXh0Iiwibm9kZVR5cGUiLCJ0ZXh0IiwiY29udGVudENvbG9yIiwiY29udGVudCIsInByaW50Q29tbWVudCIsImNvbW1lbnQiLCJjb21tZW50Q29sb3IiLCJwcmludEVsZW1lbnQiLCJ0eXBlIiwicHJpbnRlZFByb3BzIiwicHJpbnRlZENoaWxkcmVuIiwidGFnQ29sb3IiLCJ0YWciLCJtaW4iLCJwcmludEVsZW1lbnRBc0xlYWYiLCJFTEVNRU5UX05PREUiLCJURVhUX05PREUiLCJDT01NRU5UX05PREUiLCJGUkFHTUVOVF9OT0RFIiwiRUxFTUVOVF9SRUdFWFAiLCJ0ZXN0Tm9kZSIsInZhbCIsImNvbnN0cnVjdG9yTmFtZSIsImNvbnN0cnVjdG9yIiwibmFtZSIsInRhZ05hbWUiLCJpc0N1c3RvbUVsZW1lbnQiLCJpbmNsdWRlcyIsImhhc0F0dHJpYnV0ZSIsIl92YWwkY29uc3RydWN0b3IiLCJub2RlSXNUZXh0Iiwibm9kZSIsIm5vZGVJc0NvbW1lbnQiLCJub2RlSXNGcmFnbWVudCIsImZpbHRlck5vZGUiLCJfdmFsJGNvbnN0cnVjdG9yMiIsInNlcmlhbGl6ZSIsImRhdGEiLCJ0b0xvd2VyQ2FzZSIsIm1heERlcHRoIiwiQXJyYXkiLCJmcm9tIiwiYXR0cmlidXRlcyIsImF0dHIiLCJzb3J0IiwicmVkdWNlIiwiYXR0cmlidXRlIiwicHJvdG90eXBlIiwic2xpY2UiLCJjYWxsIiwiY2hpbGROb2RlcyIsImZpbHRlciJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLEVBQUFBLEtBQUssRUFBRTtBQURvQyxDQUE3QztBQUdBRCxPQUFPLENBQUNFLE9BQVIsR0FBa0JDLHNCQUFsQjtBQUNBSCxPQUFPLENBQUNJLElBQVIsR0FBZSxLQUFLLENBQXBCOztBQVNBLFNBQVNDLFVBQVQsQ0FBb0JDLEdBQXBCLEVBQXlCO0FBQ3ZCLFNBQU9BLEdBQUcsQ0FBQ0MsT0FBSixDQUFZLElBQVosRUFBa0IsTUFBbEIsRUFBMEJBLE9BQTFCLENBQWtDLElBQWxDLEVBQXdDLE1BQXhDLENBQVA7QUFDRDs7QUFHRCxJQUFNQyxVQUFVLEdBQUcsU0FBYkEsVUFBYSxDQUFDQyxJQUFELEVBQU9DLEtBQVAsRUFBY0MsTUFBZCxFQUFzQkMsV0FBdEIsRUFBbUNDLEtBQW5DLEVBQTBDQyxJQUExQyxFQUFnREMsT0FBaEQsRUFBNEQ7QUFDN0UsTUFBTUMsZUFBZSxHQUFHSixXQUFXLEdBQUdELE1BQU0sQ0FBQ00sTUFBN0M7QUFDQSxNQUFNQyxNQUFNLEdBQUdQLE1BQU0sQ0FBQ08sTUFBdEI7QUFDQSxTQUFPVCxJQUFJLENBQUNVLEdBQUwsQ0FBUyxVQUFBQyxHQUFHLEVBQUk7QUFDckIsUUFBTW5CLEtBQUssR0FBR1MsS0FBSyxDQUFDVSxHQUFELENBQW5CO0FBQ0EsUUFBSUMsT0FBTyxHQUFHTixPQUFPLENBQUNkLEtBQUQsRUFBUVUsTUFBUixFQUFnQkssZUFBaEIsRUFBaUNILEtBQWpDLEVBQXdDQyxJQUF4QyxDQUFyQjs7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IlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gY3JlYXRlRE9NRWxlbWVudEZpbHRlcjtcbmV4cG9ydHMudGVzdCA9IHZvaWQgMDtcblxuLyoqXG4gKiBTb3VyY2U6IGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9qZXN0L2Jsb2IvZTdiYjZhMWUyNmZmYWI5MDYxMWIyNTkzOTEyZGYxNWI2OTMxNTYxMS9wYWNrYWdlcy9wcmV0dHktZm9ybWF0L3NyYy9wbHVnaW5zL0RPTUVsZW1lbnQudHNcbiAqL1xuXG4vKiBlc2xpbnQtZGlzYWJsZSAtLSB0cnlpbmcgdG8gc3RheSBhcyBjbG9zZSB0byB0aGUgb3JpZ2luYWwgYXMgcG9zc2libGUgKi9cblxuLyogaXN0YW5idWwgaWdub3JlIGZpbGUgKi9cbmZ1bmN0aW9uIGVzY2FwZUhUTUwoc3RyKSB7XG4gIHJldHVybiBzdHIucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKTtcbn0gLy8gUmV0dXJuIGVtcHR5IHN0cmluZyBpZiBrZXlzIGlzIGVtcHR5LlxuXG5cbmNvbnN0IHByaW50UHJvcHMgPSAoa2V5cywgcHJvcHMsIGNvbmZpZywgaW5kZW50YXRpb24sIGRlcHRoLCByZWZzLCBwcmludGVyKSA9PiB7XG4gIGNvbnN0IGluZGVudGF0aW9uTmV4dCA9IGluZGVudGF0aW9uICsgY29uZmlnLmluZGVudDtcbiAgY29uc3QgY29sb3JzID0gY29uZmlnLmNvbG9ycztcbiAgcmV0dXJuIGtleXMubWFwKGtleSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBwcm9wc1trZXldO1xuICAgIGxldCBwcmludGVkID0gcHJpbnRlcih2YWx1ZSwgY29uZmlnLCBpbmRlbnRhdGlvbk5leHQsIGRlcHRoLCByZWZzKTtcblxuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICBpZiAocHJpbnRlZC5pbmRleE9mKCdcXG4nKSAhPT0gLTEpIHtcbiAgICAgICAgcHJpbnRlZCA9IGNvbmZpZy5zcGFjaW5nT3V0ZXIgKyBpbmRlbnRhdGlvbk5leHQgKyBwcmludGVkICsgY29uZmlnLnNwYWNpbmdPdXRlciArIGluZGVudGF0aW9uO1xuICAgICAgfVxuXG4gICAgICBwcmludGVkID0gJ3snICsgcHJpbnRlZCArICd9JztcbiAgICB9XG5cbiAgICByZXR1cm4gY29uZmlnLnNwYWNpbmdJbm5lciArIGluZGVudGF0aW9uICsgY29sb3JzLnByb3Aub3BlbiArIGtleSArIGNvbG9ycy5wcm9wLmNsb3NlICsgJz0nICsgY29sb3JzLnZhbHVlLm9wZW4gKyBwcmludGVkICsgY29sb3JzLnZhbHVlLmNsb3NlO1xuICB9KS5qb2luKCcnKTtcbn07IC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9Ob2RlL25vZGVUeXBlI25vZGVfdHlwZV9jb25zdGFudHNcblxuXG5jb25zdCBOb2RlVHlwZVRleHROb2RlID0gMzsgLy8gUmV0dXJuIGVtcHR5IHN0cmluZyBpZiBjaGlsZHJlbiBpcyBlbXB0eS5cblxuY29uc3QgcHJpbnRDaGlsZHJlbiA9IChjaGlsZHJlbiwgY29uZmlnLCBpbmRlbnRhdGlvbiwgZGVwdGgsIHJlZnMsIHByaW50ZXIpID0+IGNoaWxkcmVuLm1hcChjaGlsZCA9PiB7XG4gIGNvbnN0IHByaW50ZWRDaGlsZCA9IHR5cGVvZiBjaGlsZCA9PT0gJ3N0cmluZycgPyBwcmludFRleHQoY2hpbGQsIGNvbmZpZykgOiBwcmludGVyKGNoaWxkLCBjb25maWcsIGluZGVudGF0aW9uLCBkZXB0aCwgcmVmcyk7XG5cbiAgaWYgKHByaW50ZWRDaGlsZCA9PT0gJycgJiYgdHlwZW9mIGNoaWxkID09PSAnb2JqZWN0JyAmJiBjaGlsZCAhPT0gbnVsbCAmJiBjaGlsZC5ub2RlVHlwZSAhPT0gTm9kZVR5cGVUZXh0Tm9kZSkge1xuICAgIC8vIEEgcGx1Z2luIHNlcmlhbGl6ZWQgdGhpcyBOb2RlIHRvICcnIG1lYW5pbmcgd2Ugc2hvdWxkIGlnbm9yZSBpdC5cbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICByZXR1cm4gY29uZmlnLnNwYWNpbmdPdXRlciArIGluZGVudGF0aW9uICsgcHJpbnRlZENoaWxkO1xufSkuam9pbignJyk7XG5cbmNvbnN0IHByaW50VGV4dCA9ICh0ZXh0LCBjb25maWcpID0+IHtcbiAgY29uc3QgY29udGVudENvbG9yID0gY29uZmlnLmNvbG9ycy5jb250ZW50O1xuICByZXR1cm4gY29udGVudENvbG9yLm9wZW4gKyBlc2NhcGVIVE1MKHRleHQpICsgY29udGVudENvbG9yLmNsb3NlO1xufTtcblxuY29uc3QgcHJpbnRDb21tZW50ID0gKGNvbW1lbnQsIGNvbmZpZykgPT4ge1xuICBjb25zdCBjb21tZW50Q29sb3IgPSBjb25maWcuY29sb3JzLmNvbW1lbnQ7XG4gIHJldHVybiBjb21tZW50Q29sb3Iub3BlbiArICc8IS0tJyArIGVzY2FwZUhUTUwoY29tbWVudCkgKyAnLS0+JyArIGNvbW1lbnRDb2xvci5jbG9zZTtcbn07IC8vIFNlcGFyYXRlIHRoZSBmdW5jdGlvbnMgdG8gZm9ybWF0IHByb3BzLCBjaGlsZHJlbiwgYW5kIGVsZW1lbnQsXG4vLyBzbyBhIHBsdWdpbiBjb3VsZCBvdmVycmlkZSBhIHBhcnRpY3VsYXIgZnVuY3Rpb24sIGlmIG5lZWRlZC5cbi8vIFRvbyBiYWQsIHNvIHNhZDogdGhlIHRyYWRpdGlvbmFsIChidXQgdW5uZWNlc3NhcnkpIHNwYWNlXG4vLyBpbiBhIHNlbGYtY2xvc2luZyB0YWdDb2xvciByZXF1aXJlcyBhIHNlY29uZCB0ZXN0IG9mIHByaW50ZWRQcm9wcy5cblxuXG5jb25zdCBwcmludEVsZW1lbnQgPSAodHlwZSwgcHJpbnRlZFByb3BzLCBwcmludGVkQ2hpbGRyZW4sIGNvbmZpZywgaW5kZW50YXRpb24pID0+IHtcbiAgY29uc3QgdGFnQ29sb3IgPSBjb25maWcuY29sb3JzLnRhZztcbiAgcmV0dXJuIHRhZ0NvbG9yLm9wZW4gKyAnPCcgKyB0eXBlICsgKHByaW50ZWRQcm9wcyAmJiB0YWdDb2xvci5jbG9zZSArIHByaW50ZWRQcm9wcyArIGNvbmZpZy5zcGFjaW5nT3V0ZXIgKyBpbmRlbnRhdGlvbiArIHRhZ0NvbG9yLm9wZW4pICsgKHByaW50ZWRDaGlsZHJlbiA/ICc+JyArIHRhZ0NvbG9yLmNsb3NlICsgcHJpbnRlZENoaWxkcmVuICsgY29uZmlnLnNwYWNpbmdPdXRlciArIGluZGVudGF0aW9uICsgdGFnQ29sb3Iub3BlbiArICc8LycgKyB0eXBlIDogKHByaW50ZWRQcm9wcyAmJiAhY29uZmlnLm1pbiA/ICcnIDogJyAnKSArICcvJykgKyAnPicgKyB0YWdDb2xvci5jbG9zZTtcbn07XG5cbmNvbnN0IHByaW50RWxlbWVudEFzTGVhZiA9ICh0eXBlLCBjb25maWcpID0+IHtcbiAgY29uc3QgdGFnQ29sb3IgPSBjb25maWcuY29sb3JzLnRhZztcbiAgcmV0dXJuIHRhZ0NvbG9yLm9wZW4gKyAnPCcgKyB0eXBlICsgdGFnQ29sb3IuY2xvc2UgKyAnIOKApicgKyB0YWdDb2xvci5vcGVuICsgJyAvPicgKyB0YWdDb2xvci5jbG9zZTtcbn07XG5cbmNvbnN0IEVMRU1FTlRfTk9ERSA9IDE7XG5jb25zdCBURVhUX05PREUgPSAzO1xuY29uc3QgQ09NTUVOVF9OT0RFID0gODtcbmNvbnN0IEZSQUdNRU5UX05PREUgPSAxMTtcbmNvbnN0IEVMRU1FTlRfUkVHRVhQID0gL14oKEhUTUx8U1ZHKVxcdyopP0VsZW1lbnQkLztcblxuY29uc3QgdGVzdE5vZGUgPSB2YWwgPT4ge1xuICBjb25zdCBjb25zdHJ1Y3Rvck5hbWUgPSB2YWwuY29uc3RydWN0b3IubmFtZTtcbiAgY29uc3Qge1xuICAgIG5vZGVUeXBlLFxuICAgIHRhZ05hbWVcbiAgfSA9IHZhbDtcbiAgY29uc3QgaXNDdXN0b21FbGVtZW50ID0gdHlwZW9mIHRhZ05hbWUgPT09ICdzdHJpbmcnICYmIHRhZ05hbWUuaW5jbHVkZXMoJy0nKSB8fCB0eXBlb2YgdmFsLmhhc0F0dHJpYnV0ZSA9PT0gJ2Z1bmN0aW9uJyAmJiB2YWwuaGFzQXR0cmlidXRlKCdpcycpO1xuICByZXR1cm4gbm9kZVR5cGUgPT09IEVMRU1FTlRfTk9ERSAmJiAoRUxFTUVOVF9SRUdFWFAudGVzdChjb25zdHJ1Y3Rvck5hbWUpIHx8IGlzQ3VzdG9tRWxlbWVudCkgfHwgbm9kZVR5cGUgPT09IFRFWFRfTk9ERSAmJiBjb25zdHJ1Y3Rvck5hbWUgPT09ICdUZXh0JyB8fCBub2RlVHlwZSA9PT0gQ09NTUVOVF9OT0RFICYmIGNvbnN0cnVjdG9yTmFtZSA9PT0gJ0NvbW1lbnQnIHx8IG5vZGVUeXBlID09PSBGUkFHTUVOVF9OT0RFICYmIGNvbnN0cnVjdG9yTmFtZSA9PT0gJ0RvY3VtZW50RnJhZ21lbnQnO1xufTtcblxuY29uc3QgdGVzdCA9IHZhbCA9PiB7XG4gIHZhciBfdmFsJGNvbnN0cnVjdG9yO1xuXG4gIHJldHVybiAodmFsID09IG51bGwgPyB2b2lkIDAgOiAoX3ZhbCRjb25zdHJ1Y3RvciA9IHZhbC5jb25zdHJ1Y3RvcikgPT0gbnVsbCA/IHZvaWQgMCA6IF92YWwkY29uc3RydWN0b3IubmFtZSkgJiYgdGVzdE5vZGUodmFsKTtcbn07XG5cbmV4cG9ydHMudGVzdCA9IHRlc3Q7XG5cbmZ1bmN0aW9uIG5vZGVJc1RleHQobm9kZSkge1xuICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gVEVYVF9OT0RFO1xufVxuXG5mdW5jdGlvbiBub2RlSXNDb21tZW50KG5vZGUpIHtcbiAgcmV0dXJuIG5vZGUubm9kZVR5cGUgPT09IENPTU1FTlRfTk9ERTtcbn1cblxuZnVuY3Rpb24gbm9kZUlzRnJhZ21lbnQobm9kZSkge1xuICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gRlJBR01FTlRfTk9ERTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRE9NRWxlbWVudEZpbHRlcihmaWx0ZXJOb2RlKSB7XG4gIHJldHVybiB7XG4gICAgdGVzdDogdmFsID0+IHtcbiAgICAgIHZhciBfdmFsJGNvbnN0cnVjdG9yMjtcblxuICAgICAgcmV0dXJuICh2YWwgPT0gbnVsbCA/IHZvaWQgMCA6IChfdmFsJGNvbnN0cnVjdG9yMiA9IHZhbC5jb25zdHJ1Y3RvcikgPT0gbnVsbCA/IHZvaWQgMCA6IF92YWwkY29uc3RydWN0b3IyLm5hbWUpICYmIHRlc3ROb2RlKHZhbCk7XG4gICAgfSxcbiAgICBzZXJpYWxpemU6IChub2RlLCBjb25maWcsIGluZGVudGF0aW9uLCBkZXB0aCwgcmVmcywgcHJpbnRlcikgPT4ge1xuICAgICAgaWYgKG5vZGVJc1RleHQobm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIHByaW50VGV4dChub2RlLmRhdGEsIGNvbmZpZyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChub2RlSXNDb21tZW50KG5vZGUpKSB7XG4gICAgICAgIHJldHVybiBwcmludENvbW1lbnQobm9kZS5kYXRhLCBjb25maWcpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0eXBlID0gbm9kZUlzRnJhZ21lbnQobm9kZSkgPyBgRG9jdW1lbnRGcmFnbWVudGAgOiBub2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcblxuICAgICAgaWYgKCsrZGVwdGggPiBjb25maWcubWF4RGVwdGgpIHtcbiAgICAgICAgcmV0dXJuIHByaW50RWxlbWVudEFzTGVhZih0eXBlLCBjb25maWcpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcHJpbnRFbGVtZW50KHR5cGUsIHByaW50UHJvcHMobm9kZUlzRnJhZ21lbnQobm9kZSkgPyBbXSA6IEFycmF5LmZyb20obm9kZS5hdHRyaWJ1dGVzKS5tYXAoYXR0ciA9PiBhdHRyLm5hbWUpLnNvcnQoKSwgbm9kZUlzRnJhZ21lbnQobm9kZSkgPyB7fSA6IEFycmF5LmZyb20obm9kZS5hdHRyaWJ1dGVzKS5yZWR1Y2UoKHByb3BzLCBhdHRyaWJ1dGUpID0+IHtcbiAgICAgICAgcHJvcHNbYXR0cmlidXRlLm5hbWVdID0gYXR0cmlidXRlLnZhbHVlO1xuICAgICAgICByZXR1cm4gcHJvcHM7XG4gICAgICB9LCB7fSksIGNvbmZpZywgaW5kZW50YXRpb24gKyBjb25maWcuaW5kZW50LCBkZXB0aCwgcmVmcywgcHJpbnRlciksIHByaW50Q2hpbGRyZW4oQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwobm9kZS5jaGlsZE5vZGVzIHx8IG5vZGUuY2hpbGRyZW4pLmZpbHRlcihmaWx0ZXJOb2RlKSwgY29uZmlnLCBpbmRlbnRhdGlvbiArIGNvbmZpZy5pbmRlbnQsIGRlcHRoLCByZWZzLCBwcmludGVyKSwgY29uZmlnLCBpbmRlbnRhdGlvbik7XG4gICAgfVxuICB9O1xufSJdfQ==