9ce68e557fa9e0acc87aea7c1a2e7bb1
var _arrayFromIterator = require("./_arrayFromIterator");

var _includesWith = require("./_includesWith");

var _functionName = require("./_functionName");

var _has = require("./_has");

var _objectIs = require("./_objectIs");

var keys = require("../keys");

var type = require("../type");

function _uniqContentEquals(aIterator, bIterator, stackA, stackB) {
  var a = _arrayFromIterator(aIterator);

  var b = _arrayFromIterator(bIterator);

  function eq(_a, _b) {
    return _equals(_a, _b, stackA.slice(), stackB.slice());
  }

  return !_includesWith(function (b, aItem) {
    return !_includesWith(eq, aItem, b);
  }, b, a);
}

function _equals(a, b, stackA, stackB) {
  if (_objectIs(a, b)) {
    return true;
  }

  var typeA = type(a);

  if (typeA !== type(b)) {
    return false;
  }

  if (a == null || b == null) {
    return false;
  }

  if (typeof a['fantasy-land/equals'] === 'function' || typeof b['fantasy-land/equals'] === 'function') {
    return typeof a['fantasy-land/equals'] === 'function' && a['fantasy-land/equals'](b) && typeof b['fantasy-land/equals'] === 'function' && b['fantasy-land/equals'](a);
  }

  if (typeof a.equals === 'function' || typeof b.equals === 'function') {
    return typeof a.equals === 'function' && a.equals(b) && typeof b.equals === 'function' && b.equals(a);
  }

  switch (typeA) {
    case 'Arguments':
    case 'Array':
    case 'Object':
      if (typeof a.constructor === 'function' && _functionName(a.constructor) === 'Promise') {
        return a === b;
      }

      break;

    case 'Boolean':
    case 'Number':
    case 'String':
      if (!(typeof a === typeof b && _objectIs(a.valueOf(), b.valueOf()))) {
        return false;
      }

      break;

    case 'Date':
      if (!_objectIs(a.valueOf(), b.valueOf())) {
        return false;
      }

      break;

    case 'Error':
      return a.name === b.name && a.message === b.message;

    case 'RegExp':
      if (!(a.source === b.source && a.global === b.global && a.ignoreCase === b.ignoreCase && a.multiline === b.multiline && a.sticky === b.sticky && a.unicode === b.unicode)) {
        return false;
      }

      break;
  }

  var idx = stackA.length - 1;

  while (idx >= 0) {
    if (stackA[idx] === a) {
      return stackB[idx] === b;
    }

    idx -= 1;
  }

  switch (typeA) {
    case 'Map':
      if (a.size !== b.size) {
        return false;
      }

      return _uniqContentEquals(a.entries(), b.entries(), stackA.concat([a]), stackB.concat([b]));

    case 'Set':
      if (a.size !== b.size) {
        return false;
      }

      return _uniqContentEquals(a.values(), b.values(), stackA.concat([a]), stackB.concat([b]));

    case 'Arguments':
    case 'Array':
    case 'Object':
    case 'Boolean':
    case 'Number':
    case 'String':
    case 'Date':
    case 'Error':
    case 'RegExp':
    case 'Int8Array':
    case 'Uint8Array':
    case 'Uint8ClampedArray':
    case 'Int16Array':
    case 'Uint16Array':
    case 'Int32Array':
    case 'Uint32Array':
    case 'Float32Array':
    case 'Float64Array':
    case 'ArrayBuffer':
      break;

    default:
      return false;
  }

  var keysA = keys(a);

  if (keysA.length !== keys(b).length) {
    return false;
  }

  var extendedStackA = stackA.concat([a]);
  var extendedStackB = stackB.concat([b]);
  idx = keysA.length - 1;

  while (idx >= 0) {
    var key = keysA[idx];

    if (!(_has(key, b) && _equals(b[key], a[key], extendedStackA, extendedStackB))) {
      return false;
    }

    idx -= 1;
  }

  return true;
}

module.exports = _equals;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9lcXVhbHMuanMiXSwibmFtZXMiOlsiX2FycmF5RnJvbUl0ZXJhdG9yIiwicmVxdWlyZSIsIl9pbmNsdWRlc1dpdGgiLCJfZnVuY3Rpb25OYW1lIiwiX2hhcyIsIl9vYmplY3RJcyIsImtleXMiLCJ0eXBlIiwiX3VuaXFDb250ZW50RXF1YWxzIiwiYUl0ZXJhdG9yIiwiYkl0ZXJhdG9yIiwic3RhY2tBIiwic3RhY2tCIiwiYSIsImIiLCJlcSIsIl9hIiwiX2IiLCJfZXF1YWxzIiwic2xpY2UiLCJhSXRlbSIsInR5cGVBIiwiZXF1YWxzIiwiY29uc3RydWN0b3IiLCJ2YWx1ZU9mIiwibmFtZSIsIm1lc3NhZ2UiLCJzb3VyY2UiLCJnbG9iYWwiLCJpZ25vcmVDYXNlIiwibXVsdGlsaW5lIiwic3RpY2t5IiwidW5pY29kZSIsImlkeCIsImxlbmd0aCIsInNpemUiLCJlbnRyaWVzIiwiY29uY2F0IiwidmFsdWVzIiwia2V5c0EiLCJleHRlbmRlZFN0YWNrQSIsImV4dGVuZGVkU3RhY2tCIiwia2V5IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsa0JBQWtCLEdBQWdCQyxPQUFPLHdCQUE3Qzs7QUFFQSxJQUFJQyxhQUFhLEdBQWdCRCxPQUFPLG1CQUF4Qzs7QUFFQSxJQUFJRSxhQUFhLEdBQWdCRixPQUFPLG1CQUF4Qzs7QUFFQSxJQUFJRyxJQUFJLEdBQWdCSCxPQUFPLFVBQS9COztBQUVBLElBQUlJLFNBQVMsR0FBZ0JKLE9BQU8sZUFBcEM7O0FBRUEsSUFBSUssSUFBSSxHQUFnQkwsT0FBTyxXQUEvQjs7QUFFQSxJQUFJTSxJQUFJLEdBQWdCTixPQUFPLFdBQS9COztBQWFBLFNBQVNPLGtCQUFULENBQTRCQyxTQUE1QixFQUF1Q0MsU0FBdkMsRUFBa0RDLE1BQWxELEVBQTBEQyxNQUExRCxFQUFrRTtBQUNoRSxNQUFJQyxDQUFDLEdBQUdiLGtCQUFrQixDQUFDUyxTQUFELENBQTFCOztBQUNBLE1BQUlLLENBQUMsR0FBR2Qs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R0FBRzdCLE1BQU0sQ0FBQ3lCLE1BQVAsQ0FBYyxDQUFDdkIsQ0FBRCxDQUFkLENBQXJCO0FBRUFtQixFQUFBQSxHQUFHLEdBQUdNLEtBQUssQ0FBQ0wsTUFBTixHQUFlLENBQXJCOztBQUNBLFNBQU9ELEdBQUcsSUFBSSxDQUFkLEVBQWlCO0FBQ2YsUUFBSVMsR0FBRyxHQUFHSCxLQUFLLENBQUNOLEdBQUQsQ0FBZjs7QUFDQSxRQUFJLEVBQUU3QixJQUFJLENBQUNzQyxHQUFELEVBQU01QixDQUFOLENBQUosSUFBZ0JJLE9BQU8sQ0FBQ0osQ0FBQyxDQUFDNEIsR0FBRCxDQUFGLEVBQVM3QixDQUFDLENBQUM2QixHQUFELENBQVYsRUFBaUJGLGNBQWpCLEVBQWlDQyxjQUFqQyxDQUF6QixDQUFKLEVBQWdGO0FBQzlFLGFBQU8sS0FBUDtBQUNEOztBQUNEUixJQUFBQSxHQUFHLElBQUksQ0FBUDtBQUNEOztBQUNELFNBQU8sSUFBUDtBQUNEOztBQUNEVSxNQUFNLENBQUNDLE9BQVAsR0FBaUIxQixPQUFqQiIsInNvdXJjZXNDb250ZW50IjpbInZhciBfYXJyYXlGcm9tSXRlcmF0b3IgPSAvKiNfX1BVUkVfXyovcmVxdWlyZSgnLi9fYXJyYXlGcm9tSXRlcmF0b3InKTtcblxudmFyIF9pbmNsdWRlc1dpdGggPSAvKiNfX1BVUkVfXyovcmVxdWlyZSgnLi9faW5jbHVkZXNXaXRoJyk7XG5cbnZhciBfZnVuY3Rpb25OYW1lID0gLyojX19QVVJFX18qL3JlcXVpcmUoJy4vX2Z1bmN0aW9uTmFtZScpO1xuXG52YXIgX2hhcyA9IC8qI19fUFVSRV9fKi9yZXF1aXJlKCcuL19oYXMnKTtcblxudmFyIF9vYmplY3RJcyA9IC8qI19fUFVSRV9fKi9yZXF1aXJlKCcuL19vYmplY3RJcycpO1xuXG52YXIga2V5cyA9IC8qI19fUFVSRV9fKi9yZXF1aXJlKCcuLi9rZXlzJyk7XG5cbnZhciB0eXBlID0gLyojX19QVVJFX18qL3JlcXVpcmUoJy4uL3R5cGUnKTtcblxuLyoqXG4gKiBwcml2YXRlIF91bmlxQ29udGVudEVxdWFscyBmdW5jdGlvbi5cbiAqIFRoYXQgZnVuY3Rpb24gaXMgY2hlY2tpbmcgZXF1YWxpdHkgb2YgMiBpdGVyYXRvciBjb250ZW50cyB3aXRoIDIgYXNzdW1wdGlvbnNcbiAqIC0gaXRlcmF0b3JzIGxlbmd0aHMgYXJlIHRoZSBzYW1lXG4gKiAtIGl0ZXJhdG9ycyB2YWx1ZXMgYXJlIHVuaXF1ZVxuICpcbiAqIGZhbHNlLXBvc2l0aXZlIHJlc3VsdCB3aWxsIGJlIHJldHVybmVkIGZvciBjb21wYXJpc2lvbiBvZiwgZS5nLlxuICogLSBbMSwyLDNdIGFuZCBbMSwyLDMsNF1cbiAqIC0gWzEsMSwxXSBhbmQgWzEsMiwzXVxuICogKi9cblxuZnVuY3Rpb24gX3VuaXFDb250ZW50RXF1YWxzKGFJdGVyYXRvciwgYkl0ZXJhdG9yLCBzdGFja0EsIHN0YWNrQikge1xuICB2YXIgYSA9IF9hcnJheUZyb21JdGVyYXRvcihhSXRlcmF0b3IpO1xuICB2YXIgYiA9IF9hcnJheUZyb21JdGVyYXRvcihiSXRlcmF0b3IpO1xuXG4gIGZ1bmN0aW9uIGVxKF9hLCBfYikge1xuICAgIHJldHVybiBfZXF1YWxzKF9hLCBfYiwgc3RhY2tBLnNsaWNlKCksIHN0YWNrQi5zbGljZSgpKTtcbiAgfVxuXG4gIC8vIGlmICphKiBhcnJheSBjb250YWlucyBhbnkgZWxlbWVudCB0aGF0IGlzIG5vdCBpbmNsdWRlZCBpbiAqYipcbiAgcmV0dXJuICFfaW5jbHVkZXNXaXRoKGZ1bmN0aW9uIChiLCBhSXRlbSkge1xuICAgIHJldHVybiAhX2luY2x1ZGVzV2l0aChlcSwgYUl0ZW0sIGIpO1xuICB9LCBiLCBhKTtcbn1cblxuZnVuY3Rpb24gX2VxdWFscyhhLCBiLCBzdGFja0EsIHN0YWNrQikge1xuICBpZiAoX29iamVjdElzKGEsIGIpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICB2YXIgdHlwZUEgPSB0eXBlKGEpO1xuXG4gIGlmICh0eXBlQSAhPT0gdHlwZShiKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGlmIChhID09IG51bGwgfHwgYiA9PSBudWxsKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBhWydmYW50YXN5LWxhbmQvZXF1YWxzJ10gPT09ICdmdW5jdGlvbicgfHwgdHlwZW9mIGJbJ2ZhbnRhc3ktbGFuZC9lcXVhbHMnXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiB0eXBlb2YgYVsnZmFudGFzeS1sYW5kL2VxdWFscyddID09PSAnZnVuY3Rpb24nICYmIGFbJ2ZhbnRhc3ktbGFuZC9lcXVhbHMnXShiKSAmJiB0eXBlb2YgYlsnZmFudGFzeS1sYW5kL2VxdWFscyddID09PSAnZnVuY3Rpb24nICYmIGJbJ2ZhbnRhc3ktbGFuZC9lcXVhbHMnXShhKTtcbiAgfVxuXG4gIGlmICh0eXBlb2YgYS5lcXVhbHMgPT09ICdmdW5jdGlvbicgfHwgdHlwZW9mIGIuZXF1YWxzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBhLmVxdWFscyA9PT0gJ2Z1bmN0aW9uJyAmJiBhLmVxdWFscyhiKSAmJiB0eXBlb2YgYi5lcXVhbHMgPT09ICdmdW5jdGlvbicgJiYgYi5lcXVhbHMoYSk7XG4gIH1cblxuICBzd2l0Y2ggKHR5cGVBKSB7XG4gICAgY2FzZSAnQXJndW1lbnRzJzpcbiAgICBjYXNlICdBcnJheSc6XG4gICAgY2FzZSAnT2JqZWN0JzpcbiAgICAgIGlmICh0eXBlb2YgYS5jb25zdHJ1Y3RvciA9PT0gJ2Z1bmN0aW9uJyAmJiBfZnVuY3Rpb25OYW1lKGEuY29uc3RydWN0b3IpID09PSAnUHJvbWlzZScpIHtcbiAgICAgICAgcmV0dXJuIGEgPT09IGI7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlICdCb29sZWFuJzpcbiAgICBjYXNlICdOdW1iZXInOlxuICAgIGNhc2UgJ1N0cmluZyc6XG4gICAgICBpZiAoISh0eXBlb2YgYSA9PT0gdHlwZW9mIGIgJiYgX29iamVjdElzKGEudmFsdWVPZigpLCBiLnZhbHVlT2YoKSkpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ0RhdGUnOlxuICAgICAgaWYgKCFfb2JqZWN0SXMoYS52YWx1ZU9mKCksIGIudmFsdWVPZigpKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlICdFcnJvcic6XG4gICAgICByZXR1cm4gYS5uYW1lID09PSBiLm5hbWUgJiYgYS5tZXNzYWdlID09PSBiLm1lc3NhZ2U7XG4gICAgY2FzZSAnUmVnRXhwJzpcbiAgICAgIGlmICghKGEuc291cmNlID09PSBiLnNvdXJjZSAmJiBhLmdsb2JhbCA9PT0gYi5nbG9iYWwgJiYgYS5pZ25vcmVDYXNlID09PSBiLmlnbm9yZUNhc2UgJiYgYS5tdWx0aWxpbmUgPT09IGIubXVsdGlsaW5lICYmIGEuc3RpY2t5ID09PSBiLnN0aWNreSAmJiBhLnVuaWNvZGUgPT09IGIudW5pY29kZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gIH1cblxuICB2YXIgaWR4ID0gc3RhY2tBLmxlbmd0aCAtIDE7XG4gIHdoaWxlIChpZHggPj0gMCkge1xuICAgIGlmIChzdGFja0FbaWR4XSA9PT0gYSkge1xuICAgICAgcmV0dXJuIHN0YWNrQltpZHhdID09PSBiO1xuICAgIH1cbiAgICBpZHggLT0gMTtcbiAgfVxuXG4gIHN3aXRjaCAodHlwZUEpIHtcbiAgICBjYXNlICdNYXAnOlxuICAgICAgaWYgKGEuc2l6ZSAhPT0gYi5zaXplKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIF91bmlxQ29udGVudEVxdWFscyhhLmVudHJpZXMoKSwgYi5lbnRyaWVzKCksIHN0YWNrQS5jb25jYXQoW2FdKSwgc3RhY2tCLmNvbmNhdChbYl0pKTtcbiAgICBjYXNlICdTZXQnOlxuICAgICAgaWYgKGEuc2l6ZSAhPT0gYi5zaXplKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIF91bmlxQ29udGVudEVxdWFscyhhLnZhbHVlcygpLCBiLnZhbHVlcygpLCBzdGFja0EuY29uY2F0KFthXSksIHN0YWNrQi5jb25jYXQoW2JdKSk7XG4gICAgY2FzZSAnQXJndW1lbnRzJzpcbiAgICBjYXNlICdBcnJheSc6XG4gICAgY2FzZSAnT2JqZWN0JzpcbiAgICBjYXNlICdCb29sZWFuJzpcbiAgICBjYXNlICdOdW1iZXInOlxuICAgIGNhc2UgJ1N0cmluZyc6XG4gICAgY2FzZSAnRGF0ZSc6XG4gICAgY2FzZSAnRXJyb3InOlxuICAgIGNhc2UgJ1JlZ0V4cCc6XG4gICAgY2FzZSAnSW50OEFycmF5JzpcbiAgICBjYXNlICdVaW50OEFycmF5JzpcbiAgICBjYXNlICdVaW50OENsYW1wZWRBcnJheSc6XG4gICAgY2FzZSAnSW50MTZBcnJheSc6XG4gICAgY2FzZSAnVWludDE2QXJyYXknOlxuICAgIGNhc2UgJ0ludDMyQXJyYXknOlxuICAgIGNhc2UgJ1VpbnQzMkFycmF5JzpcbiAgICBjYXNlICdGbG9hdDMyQXJyYXknOlxuICAgIGNhc2UgJ0Zsb2F0NjRBcnJheSc6XG4gICAgY2FzZSAnQXJyYXlCdWZmZXInOlxuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIC8vIFZhbHVlcyBvZiBvdGhlciB0eXBlcyBhcmUgb25seSBlcXVhbCBpZiBpZGVudGljYWwuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB2YXIga2V5c0EgPSBrZXlzKGEpO1xuICBpZiAoa2V5c0EubGVuZ3RoICE9PSBrZXlzKGIpLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciBleHRlbmRlZFN0YWNrQSA9IHN0YWNrQS5jb25jYXQoW2FdKTtcbiAgdmFyIGV4dGVuZGVkU3RhY2tCID0gc3RhY2tCLmNvbmNhdChbYl0pO1xuXG4gIGlkeCA9IGtleXNBLmxlbmd0aCAtIDE7XG4gIHdoaWxlIChpZHggPj0gMCkge1xuICAgIHZhciBrZXkgPSBrZXlzQVtpZHhdO1xuICAgIGlmICghKF9oYXMoa2V5LCBiKSAmJiBfZXF1YWxzKGJba2V5XSwgYVtrZXldLCBleHRlbmRlZFN0YWNrQSwgZXh0ZW5kZWRTdGFja0IpKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZHggLT0gMTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cbm1vZHVsZS5leHBvcnRzID0gX2VxdWFsczsiXX0=