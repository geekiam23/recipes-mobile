a2268db500a982a5577250367eccc6b0
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.asyncAct = asyncAct;
exports.default = void 0;

var React = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var testUtils = _interopRequireWildcard(require("react-dom/test-utils"));

function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}

function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache(nodeInterop);

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

var reactAct = testUtils.act;
var actSupported = reactAct !== undefined;

function actPolyfill(cb) {
  _reactDom.default.unstable_batchedUpdates(cb);

  _reactDom.default.render(React.createElement("div", null), document.createElement('div'));
}

var act = reactAct || actPolyfill;
var youHaveBeenWarned = false;
var isAsyncActSupported = null;

function asyncAct(cb) {
  if (actSupported === true) {
    if (isAsyncActSupported === null) {
      return new Promise(function (resolve, reject) {
        var originalConsoleError = console.error;

        console.error = function error() {
          for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
            args[_key] = arguments[_key];
          }

          var firstArgIsString = typeof args[0] === 'string';

          if (firstArgIsString && args[0].indexOf('Warning: Do not await the result of calling ReactTestUtils.act') === 0) {
            isAsyncActSupported = false;
          } else if (firstArgIsString && args[0].indexOf('Warning: The callback passed to ReactTestUtils.act(...) function must not return anything') === 0) {} else {
            originalConsoleError.apply(console, args);
          }
        };

        var cbReturn, result;

        try {
          result = reactAct(function () {
            cbReturn = cb();
            return cbReturn;
          });
        } catch (err) {
          console.error = originalConsoleError;
          reject(err);
          return;
        }

        result.then(function () {
          console.error = originalConsoleError;
          isAsyncActSupported = true;
          resolve();
        }, function (err) {
          console.error = originalConsoleError;
          isAsyncActSupported = true;
          reject(err);
        });

        if (isAsyncActSupported === false) {
          console.error = originalConsoleError;

          if (!youHaveBeenWarned) {
            console.error("It looks like you're using a version of react-dom that supports the \"act\" function, but not an awaitable version of \"act\" which you will need. Please upgrade to at least react-dom@16.9.0 to remove this warning.");
            youHaveBeenWarned = true;
          }

          cbReturn.then(function () {
            Promise.resolve().then(function () {
              act(function () {});
              resolve();
            });
          }, reject);
        }
      });
    } else if (isAsyncActSupported === false) {
      var _result;

      act(function () {
        _result = cb();
      });
      return _result.then(function () {
        return Promise.resolve().then(function () {
          act(function () {});
        });
      });
    }

    return act(cb);
  }

  var result;
  act(function () {
    result = cb();
  });
  return result.then(function () {
    return Promise.resolve().then(function () {
      act(function () {});
    });
  });
}

var _default = act;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjdC1jb21wYXQuanMiXSwibmFtZXMiOlsiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImFzeW5jQWN0IiwiZGVmYXVsdCIsIlJlYWN0IiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfcmVhY3REb20iLCJ0ZXN0VXRpbHMiLCJfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUiLCJub2RlSW50ZXJvcCIsIldlYWtNYXAiLCJjYWNoZUJhYmVsSW50ZXJvcCIsImNhY2hlTm9kZUludGVyb3AiLCJvYmoiLCJfX2VzTW9kdWxlIiwiY2FjaGUiLCJoYXMiLCJnZXQiLCJuZXdPYmoiLCJoYXNQcm9wZXJ0eURlc2NyaXB0b3IiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJrZXkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJkZXNjIiwic2V0IiwicmVhY3RBY3QiLCJhY3QiLCJhY3RTdXBwb3J0ZWQiLCJ1bmRlZmluZWQiLCJhY3RQb2x5ZmlsbCIsImNiIiwidW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXMiLCJyZW5kZXIiLCJjcmVhdGVFbGVtZW50IiwiZG9jdW1lbnQiLCJ5b3VIYXZlQmVlbldhcm5lZCIsImlzQXN5bmNBY3RTdXBwb3J0ZWQiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9yaWdpbmFsQ29uc29sZUVycm9yIiwiY29uc29sZSIsImVycm9yIiwiYXJncyIsImZpcnN0QXJnSXNTdHJpbmciLCJpbmRleE9mIiwiYXBwbHkiLCJjYlJldHVybiIsInJlc3VsdCIsImVyciIsInRoZW4iLCJfZGVmYXVsdCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBSUEsc0JBQXNCLEdBQUdDLE9BQU8sQ0FBQyw4Q0FBRCxDQUFwQzs7QUFFQUMsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUMz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QyxPQUFSLEdBQWtCWSxJQUFsQixDQUF1QixZQUFNO0FBRTNCeEIsY0FBQUEsR0FBRyxDQUFDLFlBQU0sQ0FBRSxDQUFULENBQUg7QUFDQVksY0FBQUEsT0FBTztBQUNSLGFBSkQ7QUFLRCxXQVJELEVBUUdDLE1BUkg7QUFTRDtBQUNGLE9BakVNLENBQVA7QUFrRUQsS0FuRUQsTUFtRU8sSUFBSUgsbUJBQW1CLEtBQUssS0FBNUIsRUFBbUM7QUFFeEMsVUFBSVksT0FBSjs7QUFDQXRCLE1BQUFBLEdBQUcsQ0FBQyxZQUFNO0FBQ1JzQixRQUFBQSxPQUFNLEdBQUdsQixFQUFFLEVBQVg7QUFDRCxPQUZFLENBQUg7QUFHQSxhQUFPa0IsT0FBTSxDQUFDRSxJQUFQLENBQVksWUFBTTtBQUN2QixlQUFPYixPQUFPLENBQUNDLE9BQVIsR0FBa0JZLElBQWxCLENBQXVCLFlBQU07QUFFbEN4QixVQUFBQSxHQUFHLENBQUMsWUFBTSxDQUFFLENBQVQsQ0FBSDtBQUNELFNBSE0sQ0FBUDtBQUlELE9BTE0sQ0FBUDtBQU1EOztBQUdELFdBQU9BLEdBQUcsQ0FBQ0ksRUFBRCxDQUFWO0FBQ0Q7O0FBR0QsTUFBSWtCLE1BQUo7QUFDQXRCLEVBQUFBLEdBQUcsQ0FBQyxZQUFNO0FBQ1JzQixJQUFBQSxNQUFNLEdBQUdsQixFQUFFLEVBQVg7QUFDRCxHQUZFLENBQUg7QUFHQSxTQUFPa0IsTUFBTSxDQUFDRSxJQUFQLENBQVksWUFBTTtBQUN2QixXQUFPYixPQUFPLENBQUNDLE9BQVIsR0FBa0JZLElBQWxCLENBQXVCLFlBQU07QUFFbEN4QixNQUFBQSxHQUFHLENBQUMsWUFBTSxDQUFFLENBQVQsQ0FBSDtBQUNELEtBSE0sQ0FBUDtBQUlELEdBTE0sQ0FBUDtBQU1EOztBQUVELElBQUl5QixRQUFRLEdBQUd6QixHQUFmO0FBR0E1QixPQUFPLENBQUNHLE9BQVIsR0FBa0JrRCxRQUFsQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG52YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2ludGVyb3BSZXF1aXJlRGVmYXVsdFwiKTtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuYXN5bmNBY3QgPSBhc3luY0FjdDtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcblxudmFyIFJlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZShcInJlYWN0XCIpKTtcblxudmFyIF9yZWFjdERvbSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcInJlYWN0LWRvbVwiKSk7XG5cbnZhciB0ZXN0VXRpbHMgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKFwicmVhY3QtZG9tL3Rlc3QtdXRpbHNcIikpO1xuXG5mdW5jdGlvbiBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUobm9kZUludGVyb3ApIHsgaWYgKHR5cGVvZiBXZWFrTWFwICE9PSBcImZ1bmN0aW9uXCIpIHJldHVybiBudWxsOyB2YXIgY2FjaGVCYWJlbEludGVyb3AgPSBuZXcgV2Vha01hcCgpOyB2YXIgY2FjaGVOb2RlSW50ZXJvcCA9IG5ldyBXZWFrTWFwKCk7IHJldHVybiAoX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlID0gZnVuY3Rpb24gKG5vZGVJbnRlcm9wKSB7IHJldHVybiBub2RlSW50ZXJvcCA/IGNhY2hlTm9kZUludGVyb3AgOiBjYWNoZUJhYmVsSW50ZXJvcDsgfSkobm9kZUludGVyb3ApOyB9XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaiwgbm9kZUludGVyb3ApIHsgaWYgKCFub2RlSW50ZXJvcCAmJiBvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsgcmV0dXJuIG9iajsgfSBpZiAob2JqID09PSBudWxsIHx8IHR5cGVvZiBvYmogIT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIG9iaiAhPT0gXCJmdW5jdGlvblwiKSB7IHJldHVybiB7IGRlZmF1bHQ6IG9iaiB9OyB9IHZhciBjYWNoZSA9IF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZShub2RlSW50ZXJvcCk7IGlmIChjYWNoZSAmJiBjYWNoZS5oYXMob2JqKSkgeyByZXR1cm4gY2FjaGUuZ2V0KG9iaik7IH0gdmFyIG5ld09iaiA9IHt9OyB2YXIgaGFzUHJvcGVydHlEZXNjcmlwdG9yID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKGtleSAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgeyB2YXIgZGVzYyA9IGhhc1Byb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDogbnVsbDsgaWYgKGRlc2MgJiYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOyB9IGVsc2UgeyBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgaWYgKGNhY2hlKSB7IGNhY2hlLnNldChvYmosIG5ld09iaik7IH0gcmV0dXJuIG5ld09iajsgfVxuXG5jb25zdCByZWFjdEFjdCA9IHRlc3RVdGlscy5hY3Q7XG5jb25zdCBhY3RTdXBwb3J0ZWQgPSByZWFjdEFjdCAhPT0gdW5kZWZpbmVkOyAvLyBhY3QgaXMgc3VwcG9ydGVkIHJlYWN0LWRvbUAxNi44LjBcbi8vIHNvIGZvciB2ZXJzaW9ucyB0aGF0IGRvbid0IGhhdmUgYWN0IGZyb20gdGVzdCB1dGlsc1xuLy8gd2UgZG8gdGhpcyBsaXR0bGUgcG9seWZpbGwuIE5vIHdhcm5pbmdzLCBidXQgaXQnc1xuLy8gYmV0dGVyIHRoYW4gbm90aGluZy5cblxuZnVuY3Rpb24gYWN0UG9seWZpbGwoY2IpIHtcbiAgX3JlYWN0RG9tLmRlZmF1bHQudW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXMoY2IpO1xuXG4gIF9yZWFjdERvbS5kZWZhdWx0LnJlbmRlciggLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgbnVsbCksIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKTtcbn1cblxuY29uc3QgYWN0ID0gcmVhY3RBY3QgfHwgYWN0UG9seWZpbGw7XG5sZXQgeW91SGF2ZUJlZW5XYXJuZWQgPSBmYWxzZTtcbmxldCBpc0FzeW5jQWN0U3VwcG9ydGVkID0gbnVsbDtcblxuZnVuY3Rpb24gYXN5bmNBY3QoY2IpIHtcbiAgaWYgKGFjdFN1cHBvcnRlZCA9PT0gdHJ1ZSkge1xuICAgIGlmIChpc0FzeW5jQWN0U3VwcG9ydGVkID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAvLyBwYXRjaCBjb25zb2xlLmVycm9yIGhlcmVcbiAgICAgICAgY29uc3Qgb3JpZ2luYWxDb25zb2xlRXJyb3IgPSBjb25zb2xlLmVycm9yO1xuXG4gICAgICAgIGNvbnNvbGUuZXJyb3IgPSBmdW5jdGlvbiBlcnJvciguLi5hcmdzKSB7XG4gICAgICAgICAgLyogaWYgY29uc29sZS5lcnJvciBmaXJlZCAqd2l0aCB0aGF0IHNwZWNpZmljIG1lc3NhZ2UqICovXG5cbiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuICAgICAgICAgIGNvbnN0IGZpcnN0QXJnSXNTdHJpbmcgPSB0eXBlb2YgYXJnc1swXSA9PT0gJ3N0cmluZyc7XG5cbiAgICAgICAgICBpZiAoZmlyc3RBcmdJc1N0cmluZyAmJiBhcmdzWzBdLmluZGV4T2YoJ1dhcm5pbmc6IERvIG5vdCBhd2FpdCB0aGUgcmVzdWx0IG9mIGNhbGxpbmcgUmVhY3RUZXN0VXRpbHMuYWN0JykgPT09IDApIHtcbiAgICAgICAgICAgIC8vIHYxNi44LjZcbiAgICAgICAgICAgIGlzQXN5bmNBY3RTdXBwb3J0ZWQgPSBmYWxzZTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGZpcnN0QXJnSXNTdHJpbmcgJiYgYXJnc1swXS5pbmRleE9mKCdXYXJuaW5nOiBUaGUgY2FsbGJhY2sgcGFzc2VkIHRvIFJlYWN0VGVzdFV0aWxzLmFjdCguLi4pIGZ1bmN0aW9uIG11c3Qgbm90IHJldHVybiBhbnl0aGluZycpID09PSAwKSB7Ly8gbm8tb3BcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb3JpZ2luYWxDb25zb2xlRXJyb3IuYXBwbHkoY29uc29sZSwgYXJncyk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGxldCBjYlJldHVybiwgcmVzdWx0O1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmVzdWx0ID0gcmVhY3RBY3QoKCkgPT4ge1xuICAgICAgICAgICAgY2JSZXR1cm4gPSBjYigpO1xuICAgICAgICAgICAgcmV0dXJuIGNiUmV0dXJuO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yID0gb3JpZ2luYWxDb25zb2xlRXJyb3I7XG4gICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVzdWx0LnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IgPSBvcmlnaW5hbENvbnNvbGVFcnJvcjsgLy8gaWYgaXQgZ290IGhlcmUsIGl0IG1lYW5zIGFzeW5jIGFjdCBpcyBzdXBwb3J0ZWRcblxuICAgICAgICAgIGlzQXN5bmNBY3RTdXBwb3J0ZWQgPSB0cnVlO1xuICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSwgZXJyID0+IHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yID0gb3JpZ2luYWxDb25zb2xlRXJyb3I7XG4gICAgICAgICAgaXNBc3luY0FjdFN1cHBvcnRlZCA9IHRydWU7XG4gICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgIH0pOyAvLyAxNi44LjYncyBhY3QoKS50aGVuKCkgZG9lc24ndCBjYWxsIGEgcmVzb2x2ZSBoYW5kbGVyLCBzbyB3ZSBuZWVkIHRvIG1hbnVhbGx5IGZsdXNoIGhlcmUsIHNpZ2hcblxuICAgICAgICBpZiAoaXNBc3luY0FjdFN1cHBvcnRlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yID0gb3JpZ2luYWxDb25zb2xlRXJyb3I7XG4gICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cblxuICAgICAgICAgIGlmICgheW91SGF2ZUJlZW5XYXJuZWQpIHtcbiAgICAgICAgICAgIC8vIGlmIGFjdCBpcyBzdXBwb3J0ZWQgYW5kIGFzeW5jIGFjdCBpc24ndCBhbmQgdGhleSdyZSB0cnlpbmcgdG8gdXNlIGFzeW5jXG4gICAgICAgICAgICAvLyBhY3QsIHRoZW4gdGhleSBuZWVkIHRvIHVwZ3JhZGUgZnJvbSAxNi44IHRvIDE2LjkuXG4gICAgICAgICAgICAvLyBUaGlzIGlzIGEgc2VhbWxlc3MgdXBncmFkZSwgc28gd2UnbGwgYWRkIGEgd2FybmluZ1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgSXQgbG9va3MgbGlrZSB5b3UncmUgdXNpbmcgYSB2ZXJzaW9uIG9mIHJlYWN0LWRvbSB0aGF0IHN1cHBvcnRzIHRoZSBcImFjdFwiIGZ1bmN0aW9uLCBidXQgbm90IGFuIGF3YWl0YWJsZSB2ZXJzaW9uIG9mIFwiYWN0XCIgd2hpY2ggeW91IHdpbGwgbmVlZC4gUGxlYXNlIHVwZ3JhZGUgdG8gYXQgbGVhc3QgcmVhY3QtZG9tQDE2LjkuMCB0byByZW1vdmUgdGhpcyB3YXJuaW5nLmApO1xuICAgICAgICAgICAgeW91SGF2ZUJlZW5XYXJuZWQgPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNiUmV0dXJuLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgLy8gYSBmYXV4LXZlcnNpb24uXG4gICAgICAgICAgICAvLyB0b2RvIC0gY29weSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVhY3QvYmxvYi9tYXN0ZXIvcGFja2FnZXMvc2hhcmVkL2VucXVldWVUYXNrLmpzXG4gICAgICAgICAgICBQcm9taXNlLnJlc29sdmUoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgLy8gdXNlIHN5bmMgYWN0IHRvIGZsdXNoIGVmZmVjdHNcbiAgICAgICAgICAgICAgYWN0KCgpID0+IHt9KTtcbiAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChpc0FzeW5jQWN0U3VwcG9ydGVkID09PSBmYWxzZSkge1xuICAgICAgLy8gdXNlIHRoZSBwb2x5ZmlsbCBkaXJlY3RseVxuICAgICAgbGV0IHJlc3VsdDtcbiAgICAgIGFjdCgoKSA9PiB7XG4gICAgICAgIHJlc3VsdCA9IGNiKCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByZXN1bHQudGhlbigoKSA9PiB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAvLyB1c2Ugc3luYyBhY3QgdG8gZmx1c2ggZWZmZWN0c1xuICAgICAgICAgIGFjdCgoKSA9PiB7fSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSAvLyBhbGwgZ29vZCEgcmVndWxhciBhY3RcblxuXG4gICAgcmV0dXJuIGFjdChjYik7XG4gIH0gLy8gdXNlIHRoZSBwb2x5ZmlsbFxuXG5cbiAgbGV0IHJlc3VsdDtcbiAgYWN0KCgpID0+IHtcbiAgICByZXN1bHQgPSBjYigpO1xuICB9KTtcbiAgcmV0dXJuIHJlc3VsdC50aGVuKCgpID0+IHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PiB7XG4gICAgICAvLyB1c2Ugc3luYyBhY3QgdG8gZmx1c2ggZWZmZWN0c1xuICAgICAgYWN0KCgpID0+IHt9KTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbnZhciBfZGVmYXVsdCA9IGFjdDtcbi8qIGVzbGludCBuby1jb25zb2xlOjAgKi9cblxuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7Il19