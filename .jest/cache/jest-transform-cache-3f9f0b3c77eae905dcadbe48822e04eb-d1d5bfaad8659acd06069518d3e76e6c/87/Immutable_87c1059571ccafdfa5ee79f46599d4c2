42b5de2ac16fbf1c965f69d119c2cf3f
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.default = exports.test = exports.serialize = void 0;

var _collections = require("../collections");

var IS_ITERABLE_SENTINEL = '@@__IMMUTABLE_ITERABLE__@@';
var IS_LIST_SENTINEL = '@@__IMMUTABLE_LIST__@@';
var IS_KEYED_SENTINEL = '@@__IMMUTABLE_KEYED__@@';
var IS_MAP_SENTINEL = '@@__IMMUTABLE_MAP__@@';
var IS_ORDERED_SENTINEL = '@@__IMMUTABLE_ORDERED__@@';
var IS_RECORD_SENTINEL = '@@__IMMUTABLE_RECORD__@@';
var IS_SEQ_SENTINEL = '@@__IMMUTABLE_SEQ__@@';
var IS_SET_SENTINEL = '@@__IMMUTABLE_SET__@@';
var IS_STACK_SENTINEL = '@@__IMMUTABLE_STACK__@@';

var getImmutableName = function getImmutableName(name) {
  return 'Immutable.' + name;
};

var printAsLeaf = function printAsLeaf(name) {
  return '[' + name + ']';
};

var SPACE = ' ';
var LAZY = 'â€¦';

var printImmutableEntries = function printImmutableEntries(val, config, indentation, depth, refs, printer, type) {
  return ++depth > config.maxDepth ? printAsLeaf(getImmutableName(type)) : getImmutableName(type) + SPACE + '{' + (0, _collections.printIteratorEntries)(val.entries(), config, indentation, depth, refs, printer) + '}';
};

var getRecordEntries = function getRecordEntries(val) {
  var i = 0;
  return {
    next: function next() {
      if (i < val._keys.length) {
        var key = val._keys[i++];
        return {
          done: false,
          value: [key, val.get(key)]
        };
      }

      return {
        done: true
      };
    }
  };
};

var printImmutableRecord = function printImmutableRecord(val, config, indentation, depth, refs, printer) {
  var name = getImmutableName(val._name || 'Record');
  return ++depth > config.maxDepth ? printAsLeaf(name) : name + SPACE + '{' + (0, _collections.printIteratorEntries)(getRecordEntries(val), config, indentation, depth, refs, printer) + '}';
};

var printImmutableSeq = function printImmutableSeq(val, config, indentation, depth, refs, printer) {
  var name = getImmutableName('Seq');

  if (++depth > config.maxDepth) {
    return printAsLeaf(name);
  }

  if (val[IS_KEYED_SENTINEL]) {
    return name + SPACE + '{' + (val._iter || val._object ? (0, _collections.printIteratorEntries)(val.entries(), config, indentation, depth, refs, printer) : LAZY) + '}';
  }

  return name + SPACE + '[' + (val._iter || val._array || val._collection || val._iterable ? (0, _collections.printIteratorValues)(val.values(), config, indentation, depth, refs, printer) : LAZY) + ']';
};

var printImmutableValues = function printImmutableValues(val, config, indentation, depth, refs, printer, type) {
  return ++depth > config.maxDepth ? printAsLeaf(getImmutableName(type)) : getImmutableName(type) + SPACE + '[' + (0, _collections.printIteratorValues)(val.values(), config, indentation, depth, refs, printer) + ']';
};

var serialize = function serialize(val, config, indentation, depth, refs, printer) {
  if (val[IS_MAP_SENTINEL]) {
    return printImmutableEntries(val, config, indentation, depth, refs, printer, val[IS_ORDERED_SENTINEL] ? 'OrderedMap' : 'Map');
  }

  if (val[IS_LIST_SENTINEL]) {
    return printImmutableValues(val, config, indentation, depth, refs, printer, 'List');
  }

  if (val[IS_SET_SENTINEL]) {
    return printImmutableValues(val, config, indentation, depth, refs, printer, val[IS_ORDERED_SENTINEL] ? 'OrderedSet' : 'Set');
  }

  if (val[IS_STACK_SENTINEL]) {
    return printImmutableValues(val, config, indentation, depth, refs, printer, 'Stack');
  }

  if (val[IS_SEQ_SENTINEL]) {
    return printImmutableSeq(val, config, indentation, depth, refs, printer);
  }

  return printImmutableRecord(val, config, indentation, depth, refs, printer);
};

exports.serialize = serialize;

var test = function test(val) {
  return val && (val[IS_ITERABLE_SENTINEL] === true || val[IS_RECORD_SENTINEL] === true);
};

exports.test = test;
var plugin = {
  serialize: serialize,
  test: test
};
var _default = plugin;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkltbXV0YWJsZS5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJ0ZXN0Iiwic2VyaWFsaXplIiwiX2NvbGxlY3Rpb25zIiwicmVxdWlyZSIsIklTX0lURVJBQkxFX1NFTlRJTkVMIiwiSVNfTElTVF9TRU5USU5FTCIsIklTX0tFWUVEX1NFTlRJTkVMIiwiSVNfTUFQX1NFTlRJTkVMIiwiSVNfT1JERVJFRF9TRU5USU5FTCIsIklTX1JFQ09SRF9TRU5USU5FTCIsIklTX1NFUV9TRU5USU5FTCIsIklTX1NFVF9TRU5USU5FTCIsIklTX1NUQUNLX1NFTlRJTkVMIiwiZ2V0SW1tdXRhYmxlTmFtZSIsIm5hbWUiLCJwcmludEFzTGVhZiIsIlNQQUNFIiwiTEFaWSIsInByaW50SW1tdXRhYmxlRW50cmllcyIsInZhbCIsImNvbmZpZyIsImluZGVudGF0aW9uIiwiZGVwdGgiLCJyZWZzIiwicHJpbnRlciIsInR5cGUiLCJtYXhEZXB0aCIsInByaW50SXRlcmF0b3JFbnRyaWVzIiwiZW50cmllcyIsImdldFJlY29yZEVudHJpZXMiLCJpIiwibmV4dCIsIl9rZXlzIiwibGVuZ3RoIiwia2V5IiwiZG9uZSIsImdldCIsInByaW50SW1tdXRhYmxlUmVjb3JkIiwiX25hbWUiLCJwcmludEltbXV0YWJsZVNlcSIsIl9pdGVyIiwiX29iamVjdCIsIl9hcnJheSIsIl9jb2xsZWN0aW9uIiwiX2l0ZXJhYmxlIiwicHJpbnRJdGVyYXRvclZhbHVlcyIsInZhbHVlcyIsInByaW50SW1tdXRhYmxlVmFsdWVzIiwicGx1Z2luIiwiX2RlZmF1bHQiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQzNDQyxFQUFBQSxLQUFLLEVBQUU7QUFEb0MsQ0FBN0M7QUFHQUQsT0FBTyxDQUFDRSxPQUFSLEdBQWtCRixPQUFPLENBQUNH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QWY7QUFJQSxJQUFJaUQsUUFBUSxHQUFHRCxNQUFmO0FBQ0FuRCxPQUFPLENBQUNFLE9BQVIsR0FBa0JrRCxRQUFsQiIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmRlZmF1bHQgPSBleHBvcnRzLnRlc3QgPSBleHBvcnRzLnNlcmlhbGl6ZSA9IHZvaWQgMDtcblxudmFyIF9jb2xsZWN0aW9ucyA9IHJlcXVpcmUoJy4uL2NvbGxlY3Rpb25zJyk7XG5cbi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cbi8vIFNFTlRJTkVMIGNvbnN0YW50cyBhcmUgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svaW1tdXRhYmxlLWpzXG5jb25zdCBJU19JVEVSQUJMRV9TRU5USU5FTCA9ICdAQF9fSU1NVVRBQkxFX0lURVJBQkxFX19AQCc7XG5jb25zdCBJU19MSVNUX1NFTlRJTkVMID0gJ0BAX19JTU1VVEFCTEVfTElTVF9fQEAnO1xuY29uc3QgSVNfS0VZRURfU0VOVElORUwgPSAnQEBfX0lNTVVUQUJMRV9LRVlFRF9fQEAnO1xuY29uc3QgSVNfTUFQX1NFTlRJTkVMID0gJ0BAX19JTU1VVEFCTEVfTUFQX19AQCc7XG5jb25zdCBJU19PUkRFUkVEX1NFTlRJTkVMID0gJ0BAX19JTU1VVEFCTEVfT1JERVJFRF9fQEAnO1xuY29uc3QgSVNfUkVDT1JEX1NFTlRJTkVMID0gJ0BAX19JTU1VVEFCTEVfUkVDT1JEX19AQCc7IC8vIGltbXV0YWJsZSB2NFxuXG5jb25zdCBJU19TRVFfU0VOVElORUwgPSAnQEBfX0lNTVVUQUJMRV9TRVFfX0BAJztcbmNvbnN0IElTX1NFVF9TRU5USU5FTCA9ICdAQF9fSU1NVVRBQkxFX1NFVF9fQEAnO1xuY29uc3QgSVNfU1RBQ0tfU0VOVElORUwgPSAnQEBfX0lNTVVUQUJMRV9TVEFDS19fQEAnO1xuXG5jb25zdCBnZXRJbW11dGFibGVOYW1lID0gbmFtZSA9PiAnSW1tdXRhYmxlLicgKyBuYW1lO1xuXG5jb25zdCBwcmludEFzTGVhZiA9IG5hbWUgPT4gJ1snICsgbmFtZSArICddJztcblxuY29uc3QgU1BBQ0UgPSAnICc7XG5jb25zdCBMQVpZID0gJ+KApic7IC8vIFNlcSBpcyBsYXp5IGlmIGl0IGNhbGxzIGEgbWV0aG9kIGxpa2UgZmlsdGVyXG5cbmNvbnN0IHByaW50SW1tdXRhYmxlRW50cmllcyA9IChcbiAgdmFsLFxuICBjb25maWcsXG4gIGluZGVudGF0aW9uLFxuICBkZXB0aCxcbiAgcmVmcyxcbiAgcHJpbnRlcixcbiAgdHlwZVxuKSA9PlxuICArK2RlcHRoID4gY29uZmlnLm1heERlcHRoXG4gICAgPyBwcmludEFzTGVhZihnZXRJbW11dGFibGVOYW1lKHR5cGUpKVxuICAgIDogZ2V0SW1tdXRhYmxlTmFtZSh0eXBlKSArXG4gICAgICBTUEFDRSArXG4gICAgICAneycgK1xuICAgICAgKDAsIF9jb2xsZWN0aW9ucy5wcmludEl0ZXJhdG9yRW50cmllcykoXG4gICAgICAgIHZhbC5lbnRyaWVzKCksXG4gICAgICAgIGNvbmZpZyxcbiAgICAgICAgaW5kZW50YXRpb24sXG4gICAgICAgIGRlcHRoLFxuICAgICAgICByZWZzLFxuICAgICAgICBwcmludGVyXG4gICAgICApICtcbiAgICAgICd9JzsgLy8gUmVjb3JkIGhhcyBhbiBlbnRyaWVzIG1ldGhvZCBiZWNhdXNlIGl0IGlzIGEgY29sbGVjdGlvbiBpbiBpbW11dGFibGUgdjMuXG4vLyBSZXR1cm4gYW4gaXRlcmF0b3IgZm9yIEltbXV0YWJsZSBSZWNvcmQgZnJvbSB2ZXJzaW9uIHYzIG9yIHY0LlxuXG5jb25zdCBnZXRSZWNvcmRFbnRyaWVzID0gdmFsID0+IHtcbiAgbGV0IGkgPSAwO1xuICByZXR1cm4ge1xuICAgIG5leHQoKSB7XG4gICAgICBpZiAoaSA8IHZhbC5fa2V5cy5sZW5ndGgpIHtcbiAgICAgICAgY29uc3Qga2V5ID0gdmFsLl9rZXlzW2krK107XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZG9uZTogZmFsc2UsXG4gICAgICAgICAgdmFsdWU6IFtrZXksIHZhbC5nZXQoa2V5KV1cbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9uZTogdHJ1ZVxuICAgICAgfTtcbiAgICB9XG4gIH07XG59O1xuXG5jb25zdCBwcmludEltbXV0YWJsZVJlY29yZCA9IChcbiAgdmFsLFxuICBjb25maWcsXG4gIGluZGVudGF0aW9uLFxuICBkZXB0aCxcbiAgcmVmcyxcbiAgcHJpbnRlclxuKSA9PiB7XG4gIC8vIF9uYW1lIHByb3BlcnR5IGlzIGRlZmluZWQgb25seSBmb3IgYW4gSW1tdXRhYmxlIFJlY29yZCBpbnN0YW5jZVxuICAvLyB3aGljaCB3YXMgY29uc3RydWN0ZWQgd2l0aCBhIHNlY29uZCBvcHRpb25hbCBkZXNjcmlwdGl2ZSBuYW1lIGFyZ1xuICBjb25zdCBuYW1lID0gZ2V0SW1tdXRhYmxlTmFtZSh2YWwuX25hbWUgfHwgJ1JlY29yZCcpO1xuICByZXR1cm4gKytkZXB0aCA+IGNvbmZpZy5tYXhEZXB0aFxuICAgID8gcHJpbnRBc0xlYWYobmFtZSlcbiAgICA6IG5hbWUgK1xuICAgICAgICBTUEFDRSArXG4gICAgICAgICd7JyArXG4gICAgICAgICgwLCBfY29sbGVjdGlvbnMucHJpbnRJdGVyYXRvckVudHJpZXMpKFxuICAgICAgICAgIGdldFJlY29yZEVudHJpZXModmFsKSxcbiAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgaW5kZW50YXRpb24sXG4gICAgICAgICAgZGVwdGgsXG4gICAgICAgICAgcmVmcyxcbiAgICAgICAgICBwcmludGVyXG4gICAgICAgICkgK1xuICAgICAgICAnfSc7XG59O1xuXG5jb25zdCBwcmludEltbXV0YWJsZVNlcSA9ICh2YWwsIGNvbmZpZywgaW5kZW50YXRpb24sIGRlcHRoLCByZWZzLCBwcmludGVyKSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBnZXRJbW11dGFibGVOYW1lKCdTZXEnKTtcblxuICBpZiAoKytkZXB0aCA+IGNvbmZpZy5tYXhEZXB0aCkge1xuICAgIHJldHVybiBwcmludEFzTGVhZihuYW1lKTtcbiAgfVxuXG4gIGlmICh2YWxbSVNfS0VZRURfU0VOVElORUxdKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIG5hbWUgK1xuICAgICAgU1BBQ0UgK1xuICAgICAgJ3snICsgLy8gZnJvbSBJbW11dGFibGUgY29sbGVjdGlvbiBvZiBlbnRyaWVzIG9yIGZyb20gRUNNQVNjcmlwdCBvYmplY3RcbiAgICAgICh2YWwuX2l0ZXIgfHwgdmFsLl9vYmplY3RcbiAgICAgICAgPyAoMCwgX2NvbGxlY3Rpb25zLnByaW50SXRlcmF0b3JFbnRyaWVzKShcbiAgICAgICAgICAgIHZhbC5lbnRyaWVzKCksXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBpbmRlbnRhdGlvbixcbiAgICAgICAgICAgIGRlcHRoLFxuICAgICAgICAgICAgcmVmcyxcbiAgICAgICAgICAgIHByaW50ZXJcbiAgICAgICAgICApXG4gICAgICAgIDogTEFaWSkgK1xuICAgICAgJ30nXG4gICAgKTtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgbmFtZSArXG4gICAgU1BBQ0UgK1xuICAgICdbJyArXG4gICAgKHZhbC5faXRlciB8fCAvLyBmcm9tIEltbXV0YWJsZSBjb2xsZWN0aW9uIG9mIHZhbHVlc1xuICAgIHZhbC5fYXJyYXkgfHwgLy8gZnJvbSBFQ01BU2NyaXB0IGFycmF5XG4gICAgdmFsLl9jb2xsZWN0aW9uIHx8IC8vIGZyb20gRUNNQVNjcmlwdCBjb2xsZWN0aW9uIGluIGltbXV0YWJsZSB2NFxuICAgIHZhbC5faXRlcmFibGUgLy8gZnJvbSBFQ01BU2NyaXB0IGNvbGxlY3Rpb24gaW4gaW1tdXRhYmxlIHYzXG4gICAgICA/ICgwLCBfY29sbGVjdGlvbnMucHJpbnRJdGVyYXRvclZhbHVlcykoXG4gICAgICAgICAgdmFsLnZhbHVlcygpLFxuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICBpbmRlbnRhdGlvbixcbiAgICAgICAgICBkZXB0aCxcbiAgICAgICAgICByZWZzLFxuICAgICAgICAgIHByaW50ZXJcbiAgICAgICAgKVxuICAgICAgOiBMQVpZKSArXG4gICAgJ10nXG4gICk7XG59O1xuXG5jb25zdCBwcmludEltbXV0YWJsZVZhbHVlcyA9IChcbiAgdmFsLFxuICBjb25maWcsXG4gIGluZGVudGF0aW9uLFxuICBkZXB0aCxcbiAgcmVmcyxcbiAgcHJpbnRlcixcbiAgdHlwZVxuKSA9PlxuICArK2RlcHRoID4gY29uZmlnLm1heERlcHRoXG4gICAgPyBwcmludEFzTGVhZihnZXRJbW11dGFibGVOYW1lKHR5cGUpKVxuICAgIDogZ2V0SW1tdXRhYmxlTmFtZSh0eXBlKSArXG4gICAgICBTUEFDRSArXG4gICAgICAnWycgK1xuICAgICAgKDAsIF9jb2xsZWN0aW9ucy5wcmludEl0ZXJhdG9yVmFsdWVzKShcbiAgICAgICAgdmFsLnZhbHVlcygpLFxuICAgICAgICBjb25maWcsXG4gICAgICAgIGluZGVudGF0aW9uLFxuICAgICAgICBkZXB0aCxcbiAgICAgICAgcmVmcyxcbiAgICAgICAgcHJpbnRlclxuICAgICAgKSArXG4gICAgICAnXSc7XG5cbmNvbnN0IHNlcmlhbGl6ZSA9ICh2YWwsIGNvbmZpZywgaW5kZW50YXRpb24sIGRlcHRoLCByZWZzLCBwcmludGVyKSA9PiB7XG4gIGlmICh2YWxbSVNfTUFQX1NFTlRJTkVMXSkge1xuICAgIHJldHVybiBwcmludEltbXV0YWJsZUVudHJpZXMoXG4gICAgICB2YWwsXG4gICAgICBjb25maWcsXG4gICAgICBpbmRlbnRhdGlvbixcbiAgICAgIGRlcHRoLFxuICAgICAgcmVmcyxcbiAgICAgIHByaW50ZXIsXG4gICAgICB2YWxbSVNfT1JERVJFRF9TRU5USU5FTF0gPyAnT3JkZXJlZE1hcCcgOiAnTWFwJ1xuICAgICk7XG4gIH1cblxuICBpZiAodmFsW0lTX0xJU1RfU0VOVElORUxdKSB7XG4gICAgcmV0dXJuIHByaW50SW1tdXRhYmxlVmFsdWVzKFxuICAgICAgdmFsLFxuICAgICAgY29uZmlnLFxuICAgICAgaW5kZW50YXRpb24sXG4gICAgICBkZXB0aCxcbiAgICAgIHJlZnMsXG4gICAgICBwcmludGVyLFxuICAgICAgJ0xpc3QnXG4gICAgKTtcbiAgfVxuXG4gIGlmICh2YWxbSVNfU0VUX1NFTlRJTkVMXSkge1xuICAgIHJldHVybiBwcmludEltbXV0YWJsZVZhbHVlcyhcbiAgICAgIHZhbCxcbiAgICAgIGNvbmZpZyxcbiAgICAgIGluZGVudGF0aW9uLFxuICAgICAgZGVwdGgsXG4gICAgICByZWZzLFxuICAgICAgcHJpbnRlcixcbiAgICAgIHZhbFtJU19PUkRFUkVEX1NFTlRJTkVMXSA/ICdPcmRlcmVkU2V0JyA6ICdTZXQnXG4gICAgKTtcbiAgfVxuXG4gIGlmICh2YWxbSVNfU1RBQ0tfU0VOVElORUxdKSB7XG4gICAgcmV0dXJuIHByaW50SW1tdXRhYmxlVmFsdWVzKFxuICAgICAgdmFsLFxuICAgICAgY29uZmlnLFxuICAgICAgaW5kZW50YXRpb24sXG4gICAgICBkZXB0aCxcbiAgICAgIHJlZnMsXG4gICAgICBwcmludGVyLFxuICAgICAgJ1N0YWNrJ1xuICAgICk7XG4gIH1cblxuICBpZiAodmFsW0lTX1NFUV9TRU5USU5FTF0pIHtcbiAgICByZXR1cm4gcHJpbnRJbW11dGFibGVTZXEodmFsLCBjb25maWcsIGluZGVudGF0aW9uLCBkZXB0aCwgcmVmcywgcHJpbnRlcik7XG4gIH0gLy8gRm9yIGNvbXBhdGliaWxpdHkgd2l0aCBpbW11dGFibGUgdjMgYW5kIHY0LCBsZXQgcmVjb3JkIGJlIHRoZSBkZWZhdWx0LlxuXG4gIHJldHVybiBwcmludEltbXV0YWJsZVJlY29yZCh2YWwsIGNvbmZpZywgaW5kZW50YXRpb24sIGRlcHRoLCByZWZzLCBwcmludGVyKTtcbn07IC8vIEV4cGxpY2l0bHkgY29tcGFyaW5nIHNlbnRpbmVsIHByb3BlcnRpZXMgdG8gdHJ1ZSBhdm9pZHMgZmFsc2UgcG9zaXRpdmVcbi8vIHdoZW4gbW9jayBpZGVudGl0eS1vYmotcHJveHkgcmV0dXJucyB0aGUga2V5IGFzIHRoZSB2YWx1ZSBmb3IgYW55IGtleS5cblxuZXhwb3J0cy5zZXJpYWxpemUgPSBzZXJpYWxpemU7XG5cbmNvbnN0IHRlc3QgPSB2YWwgPT5cbiAgdmFsICYmXG4gICh2YWxbSVNfSVRFUkFCTEVfU0VOVElORUxdID09PSB0cnVlIHx8IHZhbFtJU19SRUNPUkRfU0VOVElORUxdID09PSB0cnVlKTtcblxuZXhwb3J0cy50ZXN0ID0gdGVzdDtcbmNvbnN0IHBsdWdpbiA9IHtcbiAgc2VyaWFsaXplLFxuICB0ZXN0XG59O1xudmFyIF9kZWZhdWx0ID0gcGx1Z2luO1xuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7XG4iXX0=