953653b42d7386264165f9ec3de18ee6
'use strict';

var $ = require("../internals/export");

var createIteratorConstructor = require("../internals/create-iterator-constructor");

var getPrototypeOf = require("../internals/object-get-prototype-of");

var setPrototypeOf = require("../internals/object-set-prototype-of");

var setToStringTag = require("../internals/set-to-string-tag");

var createNonEnumerableProperty = require("../internals/create-non-enumerable-property");

var redefine = require("../internals/redefine");

var wellKnownSymbol = require("../internals/well-known-symbol");

var IS_PURE = require("../internals/is-pure");

var Iterators = require("../internals/iterators");

var IteratorsCore = require("../internals/iterators-core");

var IteratorPrototype = IteratorsCore.IteratorPrototype;
var BUGGY_SAFARI_ITERATORS = IteratorsCore.BUGGY_SAFARI_ITERATORS;
var ITERATOR = wellKnownSymbol('iterator');
var KEYS = 'keys';
var VALUES = 'values';
var ENTRIES = 'entries';

var returnThis = function returnThis() {
  return this;
};

module.exports = function (Iterable, NAME, IteratorConstructor, next, DEFAULT, IS_SET, FORCED) {
  createIteratorConstructor(IteratorConstructor, NAME, next);

  var getIterationMethod = function getIterationMethod(KIND) {
    if (KIND === DEFAULT && defaultIterator) return defaultIterator;
    if (!BUGGY_SAFARI_ITERATORS && KIND in IterablePrototype) return IterablePrototype[KIND];

    switch (KIND) {
      case KEYS:
        return function keys() {
          return new IteratorConstructor(this, KIND);
        };

      case VALUES:
        return function values() {
          return new IteratorConstructor(this, KIND);
        };

      case ENTRIES:
        return function entries() {
          return new IteratorConstructor(this, KIND);
        };
    }

    return function () {
      return new IteratorConstructor(this);
    };
  };

  var TO_STRING_TAG = NAME + ' Iterator';
  var INCORRECT_VALUES_NAME = false;
  var IterablePrototype = Iterable.prototype;
  var nativeIterator = IterablePrototype[ITERATOR] || IterablePrototype['@@iterator'] || DEFAULT && IterablePrototype[DEFAULT];
  var defaultIterator = !BUGGY_SAFARI_ITERATORS && nativeIterator || getIterationMethod(DEFAULT);
  var anyNativeIterator = NAME == 'Array' ? IterablePrototype.entries || nativeIterator : nativeIterator;
  var CurrentIteratorPrototype, methods, KEY;

  if (anyNativeIterator) {
    CurrentIteratorPrototype = getPrototypeOf(anyNativeIterator.call(new Iterable()));

    if (IteratorPrototype !== Object.prototype && CurrentIteratorPrototype.next) {
      if (!IS_PURE && getPrototypeOf(CurrentIteratorPrototype) !== IteratorPrototype) {
        if (setPrototypeOf) {
          setPrototypeOf(CurrentIteratorPrototype, IteratorPrototype);
        } else if (typeof CurrentIteratorPrototype[ITERATOR] != 'function') {
          createNonEnumerableProperty(CurrentIteratorPrototype, ITERATOR, returnThis);
        }
      }

      setToStringTag(CurrentIteratorPrototype, TO_STRING_TAG, true, true);
      if (IS_PURE) Iterators[TO_STRING_TAG] = returnThis;
    }
  }

  if (DEFAULT == VALUES && nativeIterator && nativeIterator.name !== VALUES) {
    INCORRECT_VALUES_NAME = true;

    defaultIterator = function values() {
      return nativeIterator.call(this);
    };
  }

  if ((!IS_PURE || FORCED) && IterablePrototype[ITERATOR] !== defaultIterator) {
    createNonEnumerableProperty(IterablePrototype, ITERATOR, defaultIterator);
  }

  Iterators[NAME] = defaultIterator;

  if (DEFAULT) {
    methods = {
      values: getIterationMethod(VALUES),
      keys: IS_SET ? defaultIterator : getIterationMethod(KEYS),
      entries: getIterationMethod(ENTRIES)
    };
    if (FORCED) for (KEY in methods) {
      if (BUGGY_SAFARI_ITERATORS || INCORRECT_VALUES_NAME || !(KEY in IterablePrototype)) {
        redefine(IterablePrototype, KEY, methods[KEY]);
      }
    } else $({
      target: NAME,
      proto: true,
      forced: BUGGY_SAFARI_ITERATORS || INCORRECT_VALUES_NAME
    }, methods);
  }

  return methods;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlZmluZS1pdGVyYXRvci5qcyJdLCJuYW1lcyI6WyIkIiwicmVxdWlyZSIsImNyZWF0ZUl0ZXJhdG9yQ29uc3RydWN0b3IiLCJnZXRQcm90b3R5cGVPZiIsInNldFByb3RvdHlwZU9mIiwic2V0VG9TdHJpbmdUYWciLCJjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkiLCJyZWRlZmluZSIsIndlbGxLbm93blN5bWJvbCIsIklTX1BVUkUiLCJJdGVyYXRvcnMiLCJJdGVyYXRvcnNDb3JlIiwiSXRlcmF0b3JQcm90b3R5cGUiLCJCVUdHWV9TQUZBUklfSVRFUkFUT1JTIiwiSVRFUkFUT1IiLCJLRVlTIiwiVkFMVUVTIiwiRU5UUklFUyIsInJldHVyblRoaXMiLCJtb2R1bGUiLCJleHBvcnRzIiwiSXRlcmFibGUiLCJOQU1FIiwiSXRlcmF0b3JDb25zdHJ1Y3RvciIsIm5leHQiLCJERUZBVUxUIiwiSVNfU0VUIiwiRk9SQ0VEIiwiZ2V0SXRlcmF0aW9uTWV0aG9kIiwiS0lORCIsImRlZmF1bHRJdGVyYXRvciIsIkl0ZXJhYmxlUHJvdG90eXBlIiwia2V5cyIsInZhbHVlcyIsImVudHJpZXMiLCJUT19TVFJJTkdfVEFHIiwiSU5DT1JSRUNUX1ZBTFVFU19OQU1FIiwicHJvdG90eXBlIiwibmF0aXZlSXRlcmF0b3IiLCJhbnlOYXRpdmVJdGVyYXRvciIsIkN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSIsIm1ldGhvZHMiLCJLRVkiLCJjYWxsIiwiT2JqZWN0IiwibmFtZSIsInRhcmdldCIsInByb3RvIiwiZm9yY2VkIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQSxJQUFJQSxDQUFDLEdBQUdDLE9BQU8sdUJBQWY7O0FBQ0EsSUFBSUMseUJBQXlCLEdBQUdELE9BQU8sNENBQXZDOztBQUNBLElBQUlFLGNBQWMsR0FBR0YsT0FBTyx3Q0FBNUI7O0FBQ0EsSUFBSUcsY0FBYyxHQUFHSCxPQUFPLHdDQUE1Qjs7QUFDQSxJQUFJSSxjQUFjLEdBQUdKLE9BQU8sa0NBQTVC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QTJCLENBQUN5QixpQkFBRCxFQUFvQmpCLFFBQXBCLEVBQThCZ0IsZUFBOUIsQ0FBM0I7QUFDRDs7QUFDRHBCLEVBQUFBLFNBQVMsQ0FBQ1ksSUFBRCxDQUFULEdBQWtCUSxlQUFsQjs7QUFHQSxNQUFJTCxPQUFKLEVBQWE7QUFDWGdCLElBQUFBLE9BQU8sR0FBRztBQUNSUixNQUFBQSxNQUFNLEVBQUVMLGtCQUFrQixDQUFDWixNQUFELENBRGxCO0FBRVJnQixNQUFBQSxJQUFJLEVBQUVOLE1BQU0sR0FBR0ksZUFBSCxHQUFxQkYsa0JBQWtCLENBQUNiLElBQUQsQ0FGM0M7QUFHUm1CLE1BQUFBLE9BQU8sRUFBRU4sa0JBQWtCLENBQUNYLE9BQUQ7QUFIbkIsS0FBVjtBQUtBLFFBQUlVLE1BQUosRUFBWSxLQUFLZSxHQUFMLElBQVlELE9BQVosRUFBcUI7QUFDL0IsVUFBSTVCLHNCQUFzQixJQUFJdUIscUJBQTFCLElBQW1ELEVBQUVNLEdBQUcsSUFBSVgsaUJBQVQsQ0FBdkQsRUFBb0Y7QUFDbEZ4QixRQUFBQSxRQUFRLENBQUN3QixpQkFBRCxFQUFvQlcsR0FBcEIsRUFBeUJELE9BQU8sQ0FBQ0MsR0FBRCxDQUFoQyxDQUFSO0FBQ0Q7QUFDRixLQUpELE1BSU8xQyxDQUFDLENBQUM7QUFBRThDLE1BQUFBLE1BQU0sRUFBRXhCLElBQVY7QUFBZ0J5QixNQUFBQSxLQUFLLEVBQUUsSUFBdkI7QUFBNkJDLE1BQUFBLE1BQU0sRUFBRW5DLHNCQUFzQixJQUFJdUI7QUFBL0QsS0FBRCxFQUF5RkssT0FBekYsQ0FBRDtBQUNSOztBQUVELFNBQU9BLE9BQVA7QUFDRCxDQW5FRCIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciAkID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL2V4cG9ydCcpO1xudmFyIGNyZWF0ZUl0ZXJhdG9yQ29uc3RydWN0b3IgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvY3JlYXRlLWl0ZXJhdG9yLWNvbnN0cnVjdG9yJyk7XG52YXIgZ2V0UHJvdG90eXBlT2YgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvb2JqZWN0LWdldC1wcm90b3R5cGUtb2YnKTtcbnZhciBzZXRQcm90b3R5cGVPZiA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9vYmplY3Qtc2V0LXByb3RvdHlwZS1vZicpO1xudmFyIHNldFRvU3RyaW5nVGFnID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL3NldC10by1zdHJpbmctdGFnJyk7XG52YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5ID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL2NyZWF0ZS1ub24tZW51bWVyYWJsZS1wcm9wZXJ0eScpO1xudmFyIHJlZGVmaW5lID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL3JlZGVmaW5lJyk7XG52YXIgd2VsbEtub3duU3ltYm9sID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL3dlbGwta25vd24tc3ltYm9sJyk7XG52YXIgSVNfUFVSRSA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9pcy1wdXJlJyk7XG52YXIgSXRlcmF0b3JzID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL2l0ZXJhdG9ycycpO1xudmFyIEl0ZXJhdG9yc0NvcmUgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvaXRlcmF0b3JzLWNvcmUnKTtcblxudmFyIEl0ZXJhdG9yUHJvdG90eXBlID0gSXRlcmF0b3JzQ29yZS5JdGVyYXRvclByb3RvdHlwZTtcbnZhciBCVUdHWV9TQUZBUklfSVRFUkFUT1JTID0gSXRlcmF0b3JzQ29yZS5CVUdHWV9TQUZBUklfSVRFUkFUT1JTO1xudmFyIElURVJBVE9SID0gd2VsbEtub3duU3ltYm9sKCdpdGVyYXRvcicpO1xudmFyIEtFWVMgPSAna2V5cyc7XG52YXIgVkFMVUVTID0gJ3ZhbHVlcyc7XG52YXIgRU5UUklFUyA9ICdlbnRyaWVzJztcblxudmFyIHJldHVyblRoaXMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChJdGVyYWJsZSwgTkFNRSwgSXRlcmF0b3JDb25zdHJ1Y3RvciwgbmV4dCwgREVGQVVMVCwgSVNfU0VULCBGT1JDRUQpIHtcbiAgY3JlYXRlSXRlcmF0b3JDb25zdHJ1Y3RvcihJdGVyYXRvckNvbnN0cnVjdG9yLCBOQU1FLCBuZXh0KTtcblxuICB2YXIgZ2V0SXRlcmF0aW9uTWV0aG9kID0gZnVuY3Rpb24gKEtJTkQpIHtcbiAgICBpZiAoS0lORCA9PT0gREVGQVVMVCAmJiBkZWZhdWx0SXRlcmF0b3IpIHJldHVybiBkZWZhdWx0SXRlcmF0b3I7XG4gICAgaWYgKCFCVUdHWV9TQUZBUklfSVRFUkFUT1JTICYmIEtJTkQgaW4gSXRlcmFibGVQcm90b3R5cGUpIHJldHVybiBJdGVyYWJsZVByb3RvdHlwZVtLSU5EXTtcbiAgICBzd2l0Y2ggKEtJTkQpIHtcbiAgICAgIGNhc2UgS0VZUzogcmV0dXJuIGZ1bmN0aW9uIGtleXMoKSB7IHJldHVybiBuZXcgSXRlcmF0b3JDb25zdHJ1Y3Rvcih0aGlzLCBLSU5EKTsgfTtcbiAgICAgIGNhc2UgVkFMVUVTOiByZXR1cm4gZnVuY3Rpb24gdmFsdWVzKCkgeyByZXR1cm4gbmV3IEl0ZXJhdG9yQ29uc3RydWN0b3IodGhpcywgS0lORCk7IH07XG4gICAgICBjYXNlIEVOVFJJRVM6IHJldHVybiBmdW5jdGlvbiBlbnRyaWVzKCkgeyByZXR1cm4gbmV3IEl0ZXJhdG9yQ29uc3RydWN0b3IodGhpcywgS0lORCk7IH07XG4gICAgfSByZXR1cm4gZnVuY3Rpb24gKCkgeyByZXR1cm4gbmV3IEl0ZXJhdG9yQ29uc3RydWN0b3IodGhpcyk7IH07XG4gIH07XG5cbiAgdmFyIFRPX1NUUklOR19UQUcgPSBOQU1FICsgJyBJdGVyYXRvcic7XG4gIHZhciBJTkNPUlJFQ1RfVkFMVUVTX05BTUUgPSBmYWxzZTtcbiAgdmFyIEl0ZXJhYmxlUHJvdG90eXBlID0gSXRlcmFibGUucHJvdG90eXBlO1xuICB2YXIgbmF0aXZlSXRlcmF0b3IgPSBJdGVyYWJsZVByb3RvdHlwZVtJVEVSQVRPUl1cbiAgICB8fCBJdGVyYWJsZVByb3RvdHlwZVsnQEBpdGVyYXRvciddXG4gICAgfHwgREVGQVVMVCAmJiBJdGVyYWJsZVByb3RvdHlwZVtERUZBVUxUXTtcbiAgdmFyIGRlZmF1bHRJdGVyYXRvciA9ICFCVUdHWV9TQUZBUklfSVRFUkFUT1JTICYmIG5hdGl2ZUl0ZXJhdG9yIHx8IGdldEl0ZXJhdGlvbk1ldGhvZChERUZBVUxUKTtcbiAgdmFyIGFueU5hdGl2ZUl0ZXJhdG9yID0gTkFNRSA9PSAnQXJyYXknID8gSXRlcmFibGVQcm90b3R5cGUuZW50cmllcyB8fCBuYXRpdmVJdGVyYXRvciA6IG5hdGl2ZUl0ZXJhdG9yO1xuICB2YXIgQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlLCBtZXRob2RzLCBLRVk7XG5cbiAgLy8gZml4IG5hdGl2ZVxuICBpZiAoYW55TmF0aXZlSXRlcmF0b3IpIHtcbiAgICBDdXJyZW50SXRlcmF0b3JQcm90b3R5cGUgPSBnZXRQcm90b3R5cGVPZihhbnlOYXRpdmVJdGVyYXRvci5jYWxsKG5ldyBJdGVyYWJsZSgpKSk7XG4gICAgaWYgKEl0ZXJhdG9yUHJvdG90eXBlICE9PSBPYmplY3QucHJvdG90eXBlICYmIEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZS5uZXh0KSB7XG4gICAgICBpZiAoIUlTX1BVUkUgJiYgZ2V0UHJvdG90eXBlT2YoQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlKSAhPT0gSXRlcmF0b3JQcm90b3R5cGUpIHtcbiAgICAgICAgaWYgKHNldFByb3RvdHlwZU9mKSB7XG4gICAgICAgICAgc2V0UHJvdG90eXBlT2YoQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlLCBJdGVyYXRvclByb3RvdHlwZSk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZVtJVEVSQVRPUl0gIT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eShDdXJyZW50SXRlcmF0b3JQcm90b3R5cGUsIElURVJBVE9SLCByZXR1cm5UaGlzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gU2V0IEBAdG9TdHJpbmdUYWcgdG8gbmF0aXZlIGl0ZXJhdG9yc1xuICAgICAgc2V0VG9TdHJpbmdUYWcoQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlLCBUT19TVFJJTkdfVEFHLCB0cnVlLCB0cnVlKTtcbiAgICAgIGlmIChJU19QVVJFKSBJdGVyYXRvcnNbVE9fU1RSSU5HX1RBR10gPSByZXR1cm5UaGlzO1xuICAgIH1cbiAgfVxuXG4gIC8vIGZpeCBBcnJheS5wcm90b3R5cGUueyB2YWx1ZXMsIEBAaXRlcmF0b3IgfS5uYW1lIGluIFY4IC8gRkZcbiAgaWYgKERFRkFVTFQgPT0gVkFMVUVTICYmIG5hdGl2ZUl0ZXJhdG9yICYmIG5hdGl2ZUl0ZXJhdG9yLm5hbWUgIT09IFZBTFVFUykge1xuICAgIElOQ09SUkVDVF9WQUxVRVNfTkFNRSA9IHRydWU7XG4gICAgZGVmYXVsdEl0ZXJhdG9yID0gZnVuY3Rpb24gdmFsdWVzKCkgeyByZXR1cm4gbmF0aXZlSXRlcmF0b3IuY2FsbCh0aGlzKTsgfTtcbiAgfVxuXG4gIC8vIGRlZmluZSBpdGVyYXRvclxuICBpZiAoKCFJU19QVVJFIHx8IEZPUkNFRCkgJiYgSXRlcmFibGVQcm90b3R5cGVbSVRFUkFUT1JdICE9PSBkZWZhdWx0SXRlcmF0b3IpIHtcbiAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkoSXRlcmFibGVQcm90b3R5cGUsIElURVJBVE9SLCBkZWZhdWx0SXRlcmF0b3IpO1xuICB9XG4gIEl0ZXJhdG9yc1tOQU1FXSA9IGRlZmF1bHRJdGVyYXRvcjtcblxuICAvLyBleHBvcnQgYWRkaXRpb25hbCBtZXRob2RzXG4gIGlmIChERUZBVUxUKSB7XG4gICAgbWV0aG9kcyA9IHtcbiAgICAgIHZhbHVlczogZ2V0SXRlcmF0aW9uTWV0aG9kKFZBTFVFUyksXG4gICAgICBrZXlzOiBJU19TRVQgPyBkZWZhdWx0SXRlcmF0b3IgOiBnZXRJdGVyYXRpb25NZXRob2QoS0VZUyksXG4gICAgICBlbnRyaWVzOiBnZXRJdGVyYXRpb25NZXRob2QoRU5UUklFUylcbiAgICB9O1xuICAgIGlmIChGT1JDRUQpIGZvciAoS0VZIGluIG1ldGhvZHMpIHtcbiAgICAgIGlmIChCVUdHWV9TQUZBUklfSVRFUkFUT1JTIHx8IElOQ09SUkVDVF9WQUxVRVNfTkFNRSB8fCAhKEtFWSBpbiBJdGVyYWJsZVByb3RvdHlwZSkpIHtcbiAgICAgICAgcmVkZWZpbmUoSXRlcmFibGVQcm90b3R5cGUsIEtFWSwgbWV0aG9kc1tLRVldKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgJCh7IHRhcmdldDogTkFNRSwgcHJvdG86IHRydWUsIGZvcmNlZDogQlVHR1lfU0FGQVJJX0lURVJBVE9SUyB8fCBJTkNPUlJFQ1RfVkFMVUVTX05BTUUgfSwgbWV0aG9kcyk7XG4gIH1cblxuICByZXR1cm4gbWV0aG9kcztcbn07XG4iXX0=