205c10c3e8d78b609a1c133fe808db48
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var asMock = {
  __INTERNAL_MOCK_STORAGE__: {},
  setItem: jest.fn(function _callee(key, value, callback) {
    var setResult;
    return _regenerator.default.async(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.next = 2;
            return _regenerator.default.awrap(asMock.multiSet([[key, value]], undefined));

          case 2:
            setResult = _context.sent;
            callback && callback(setResult);
            return _context.abrupt("return", setResult);

          case 5:
          case "end":
            return _context.stop();
        }
      }
    }, null, null, null, Promise);
  }),
  getItem: jest.fn(function _callee2(key, callback) {
    var getResult, result;
    return _regenerator.default.async(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            _context2.next = 2;
            return _regenerator.default.awrap(asMock.multiGet([key], undefined));

          case 2:
            getResult = _context2.sent;
            result = getResult[0] ? getResult[0][1] : null;
            callback && callback(null, result);
            return _context2.abrupt("return", result);

          case 6:
          case "end":
            return _context2.stop();
        }
      }
    }, null, null, null, Promise);
  }),
  removeItem: jest.fn(function (key, callback) {
    return asMock.multiRemove([key], callback);
  }),
  mergeItem: jest.fn(function (key, value, callback) {
    return asMock.multiMerge([[key, value]], callback);
  }),
  clear: jest.fn(_clear),
  getAllKeys: jest.fn(_getAllKeys),
  flushGetRequests: jest.fn(),
  multiGet: jest.fn(_multiGet),
  multiSet: jest.fn(_multiSet),
  multiRemove: jest.fn(_multiRemove),
  multiMerge: jest.fn(_multiMerge),
  useAsyncStorage: jest.fn(function (key) {
    return {
      getItem: function getItem() {
        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
          args[_key] = arguments[_key];
        }

        return asMock.getItem.apply(asMock, [key].concat(args));
      },
      setItem: function setItem() {
        for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
          args[_key2] = arguments[_key2];
        }

        return asMock.setItem.apply(asMock, [key].concat(args));
      },
      mergeItem: function mergeItem() {
        for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
          args[_key3] = arguments[_key3];
        }

        return asMock.mergeItem.apply(asMock, [key].concat(args));
      },
      removeItem: function removeItem() {
        for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
          args[_key4] = arguments[_key4];
        }

        return asMock.removeItem.apply(asMock, [key].concat(args));
      }
    };
  })
};

function _multiSet(keyValuePairs, callback) {
  return _regenerator.default.async(function _multiSet$(_context3) {
    while (1) {
      switch (_context3.prev = _context3.next) {
        case 0:
          keyValuePairs.forEach(function (keyValue) {
            var key = keyValue[0];
            asMock.__INTERNAL_MOCK_STORAGE__[key] = keyValue[1];
          });
          callback && callback(null);
          return _context3.abrupt("return", null);

        case 3:
        case "end":
          return _context3.stop();
      }
    }
  }, null, null, null, Promise);
}

function _multiGet(keys, callback) {
  var values;
  return _regenerator.default.async(function _multiGet$(_context4) {
    while (1) {
      switch (_context4.prev = _context4.next) {
        case 0:
          values = keys.map(function (key) {
            return [key, asMock.__INTERNAL_MOCK_STORAGE__[key] || null];
          });
          callback && callback(null, values);
          return _context4.abrupt("return", values);

        case 3:
        case "end":
          return _context4.stop();
      }
    }
  }, null, null, null, Promise);
}

function _multiRemove(keys, callback) {
  return _regenerator.default.async(function _multiRemove$(_context5) {
    while (1) {
      switch (_context5.prev = _context5.next) {
        case 0:
          keys.forEach(function (key) {
            if (asMock.__INTERNAL_MOCK_STORAGE__[key]) {
              delete asMock.__INTERNAL_MOCK_STORAGE__[key];
            }
          });
          callback && callback(null);
          return _context5.abrupt("return", null);

        case 3:
        case "end":
          return _context5.stop();
      }
    }
  }, null, null, null, Promise);
}

function _clear(callback) {
  return _regenerator.default.async(function _clear$(_context6) {
    while (1) {
      switch (_context6.prev = _context6.next) {
        case 0:
          asMock.__INTERNAL_MOCK_STORAGE__ = {};
          callback && callback(null);
          return _context6.abrupt("return", null);

        case 3:
        case "end":
          return _context6.stop();
      }
    }
  }, null, null, null, Promise);
}

function _getAllKeys() {
  return _regenerator.default.async(function _getAllKeys$(_context7) {
    while (1) {
      switch (_context7.prev = _context7.next) {
        case 0:
          return _context7.abrupt("return", Object.keys(asMock.__INTERNAL_MOCK_STORAGE__));

        case 1:
        case "end":
          return _context7.stop();
      }
    }
  }, null, null, null, Promise);
}

function _multiMerge(keyValuePairs, callback) {
  return _regenerator.default.async(function _multiMerge$(_context8) {
    while (1) {
      switch (_context8.prev = _context8.next) {
        case 0:
          keyValuePairs.forEach(function (keyValue) {
            var key = keyValue[0];
            var value = JSON.parse(keyValue[1]);
            var oldValue = JSON.parse(asMock.__INTERNAL_MOCK_STORAGE__[key]);
            asMock.__INTERNAL_MOCK_STORAGE__[key] = JSON.stringify(_deepMergeInto(oldValue, value));
          });
          callback && callback(null);
          return _context8.abrupt("return", null);

        case 3:
        case "end":
          return _context8.stop();
      }
    }
  }, null, null, null, Promise);
}

var _isObject = function _isObject(obj) {
  return typeof obj === 'object' && !Array.isArray(obj);
};

var _deepMergeInto = function _deepMergeInto(oldObject, newObject) {
  var newKeys = Object.keys(newObject);
  var mergedObject = oldObject;
  newKeys.forEach(function (key) {
    var oldValue = mergedObject[key];
    var newValue = newObject[key];

    if (_isObject(oldValue) && _isObject(newValue)) {
      mergedObject[key] = _deepMergeInto(oldValue, newValue);
    } else {
      mergedObject[key] = newValue;
    }
  });
  return mergedObject;
};

module.exports = asMock;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jLXN0b3JhZ2UtbW9jay5qcyJdLCJuYW1lcyI6WyJhc01vY2siLCJfX0lOVEVSTkFMX01PQ0tfU1RPUkFHRV9fIiwic2V0SXRlbSIsImplc3QiLCJmbiIsImtleSIsInZhbHVlIiwiY2FsbGJhY2siLCJtdWx0aVNldCIsInVuZGVmaW5lZCIsInNldFJlc3VsdCIsImdldEl0ZW0iLCJtdWx0aUdldCIsImdldFJlc3VsdCIsInJlc3VsdCIsInJlbW92ZUl0ZW0iLCJtdWx0aVJlbW92ZSIsIm1lcmdlSXRlbSIsIm11bHRpTWVyZ2UiLCJjbGVhciIsIl9jbGVhciIsImdldEFsbEtleXMiLCJfZ2V0QWxsS2V5cyIsImZsdXNoR2V0UmVxdWVzdHMiLCJfbXVsdGlHZXQiLCJfbXVsdGlTZXQiLCJfbXVsdGlSZW1vdmUiLCJfbXVsdGlNZXJnZSIsInVzZUFzeW5jU3RvcmFnZSIsImFyZ3MiLCJrZXlWYWx1ZVBhaXJzIiwiZm9yRWFjaCIsImtleVZhbHVlIiwia2V5cyIsInZhbHVlcyIsIm1hcCIsIk9iamVjdCIsIkpTT04iLCJwYXJzZSIsIm9sZFZhbHVlIiwic3RyaW5naWZ5IiwiX2RlZXBNZXJnZUludG8iLCJfaXNPYmplY3QiLCJvYmoiLCJBcnJheSIsImlzQXJyYXkiLCJvbGRPYmplY3QiLCJuZXdPYmplY3QiLCJuZXdLZXlzIiwibWVyZ2VkT2JqZWN0IiwibmV3VmFsdWUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7O0FBSUEsSUFBTUEsTUFBTSxHQUFHO0FBQ2JDLEVBQUFBLHlCQUF5QixFQUFFLEVBRGQ7QUFHYkMsRUFBQUEsT0FBTyxFQUFFQyxJQUFJLENBQUNDLEVBQUwsQ0FBUSxpQkFBT0MsR0FBUCxFQUFZQyxLQUFaLEVBQW1CQyxRQUFuQjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLDhDQUNTUCxNQUFNLENBQUNRLFFBQVAsQ0FBZ0IsQ0FBQyxDQUFDSCxHQUFELEVBQU1DLEtBQU4sQ0FBRCxDQUFoQixF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QUFrQkFFLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnBELE1BQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZm9ybWF0XG4gKi9cblxuY29uc3QgYXNNb2NrID0ge1xuICBfX0lOVEVSTkFMX01PQ0tfU1RPUkFHRV9fOiB7fSxcblxuICBzZXRJdGVtOiBqZXN0LmZuKGFzeW5jIChrZXksIHZhbHVlLCBjYWxsYmFjaykgPT4ge1xuICAgIGNvbnN0IHNldFJlc3VsdCA9IGF3YWl0IGFzTW9jay5tdWx0aVNldChbW2tleSwgdmFsdWVdXSwgdW5kZWZpbmVkKTtcblxuICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKHNldFJlc3VsdCk7XG4gICAgcmV0dXJuIHNldFJlc3VsdDtcbiAgfSksXG5cbiAgZ2V0SXRlbTogamVzdC5mbihhc3luYyAoa2V5LCBjYWxsYmFjaykgPT4ge1xuICAgIGNvbnN0IGdldFJlc3VsdCA9IGF3YWl0IGFzTW9jay5tdWx0aUdldChba2V5XSwgdW5kZWZpbmVkKTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGdldFJlc3VsdFswXSA/IGdldFJlc3VsdFswXVsxXSA6IG51bGw7XG5cbiAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH0pLFxuXG4gIHJlbW92ZUl0ZW06IGplc3QuZm4oKGtleSwgY2FsbGJhY2spID0+IGFzTW9jay5tdWx0aVJlbW92ZShba2V5XSwgY2FsbGJhY2spKSxcbiAgbWVyZ2VJdGVtOiBqZXN0LmZuKChrZXksIHZhbHVlLCBjYWxsYmFjaykgPT5cbiAgICBhc01vY2subXVsdGlNZXJnZShbW2tleSwgdmFsdWVdXSwgY2FsbGJhY2spLFxuICApLFxuXG4gIGNsZWFyOiBqZXN0LmZuKF9jbGVhciksXG4gIGdldEFsbEtleXM6IGplc3QuZm4oX2dldEFsbEtleXMpLFxuICBmbHVzaEdldFJlcXVlc3RzOiBqZXN0LmZuKCksXG5cbiAgbXVsdGlHZXQ6IGplc3QuZm4oX211bHRpR2V0KSxcbiAgbXVsdGlTZXQ6IGplc3QuZm4oX211bHRpU2V0KSxcbiAgbXVsdGlSZW1vdmU6IGplc3QuZm4oX211bHRpUmVtb3ZlKSxcbiAgbXVsdGlNZXJnZTogamVzdC5mbihfbXVsdGlNZXJnZSksXG4gIHVzZUFzeW5jU3RvcmFnZTogamVzdC5mbihrZXkgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBnZXRJdGVtOiAoLi4uYXJncykgPT4gYXNNb2NrLmdldEl0ZW0oa2V5LCAuLi5hcmdzKSxcbiAgICAgIHNldEl0ZW06ICguLi5hcmdzKSA9PiBhc01vY2suc2V0SXRlbShrZXksIC4uLmFyZ3MpLFxuICAgICAgbWVyZ2VJdGVtOiAoLi4uYXJncykgPT4gYXNNb2NrLm1lcmdlSXRlbShrZXksIC4uLmFyZ3MpLFxuICAgICAgcmVtb3ZlSXRlbTogKC4uLmFyZ3MpID0+IGFzTW9jay5yZW1vdmVJdGVtKGtleSwgLi4uYXJncyksXG4gICAgfTtcbiAgfSksXG59O1xuXG5hc3luYyBmdW5jdGlvbiBfbXVsdGlTZXQoa2V5VmFsdWVQYWlycywgY2FsbGJhY2spIHtcbiAga2V5VmFsdWVQYWlycy5mb3JFYWNoKGtleVZhbHVlID0+IHtcbiAgICBjb25zdCBrZXkgPSBrZXlWYWx1ZVswXTtcblxuICAgIGFzTW9jay5fX0lOVEVSTkFMX01PQ0tfU1RPUkFHRV9fW2tleV0gPSBrZXlWYWx1ZVsxXTtcbiAgfSk7XG4gIGNhbGxiYWNrICYmIGNhbGxiYWNrKG51bGwpO1xuICByZXR1cm4gbnVsbDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX211bHRpR2V0KGtleXMsIGNhbGxiYWNrKSB7XG4gIGNvbnN0IHZhbHVlcyA9IGtleXMubWFwKGtleSA9PiBbXG4gICAga2V5LFxuICAgIGFzTW9jay5fX0lOVEVSTkFMX01PQ0tfU1RPUkFHRV9fW2tleV0gfHwgbnVsbCxcbiAgXSk7XG4gIGNhbGxiYWNrICYmIGNhbGxiYWNrKG51bGwsIHZhbHVlcyk7XG5cbiAgcmV0dXJuIHZhbHVlcztcbn1cblxuYXN5bmMgZnVuY3Rpb24gX211bHRpUmVtb3ZlKGtleXMsIGNhbGxiYWNrKSB7XG4gIGtleXMuZm9yRWFjaChrZXkgPT4ge1xuICAgIGlmIChhc01vY2suX19JTlRFUk5BTF9NT0NLX1NUT1JBR0VfX1trZXldKSB7XG4gICAgICBkZWxldGUgYXNNb2NrLl9fSU5URVJOQUxfTU9DS19TVE9SQUdFX19ba2V5XTtcbiAgICB9XG4gIH0pO1xuXG4gIGNhbGxiYWNrICYmIGNhbGxiYWNrKG51bGwpO1xuICByZXR1cm4gbnVsbDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX2NsZWFyKGNhbGxiYWNrKSB7XG4gIGFzTW9jay5fX0lOVEVSTkFMX01PQ0tfU1RPUkFHRV9fID0ge307XG5cbiAgY2FsbGJhY2sgJiYgY2FsbGJhY2sobnVsbCk7XG5cbiAgcmV0dXJuIG51bGw7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9nZXRBbGxLZXlzKCkge1xuICByZXR1cm4gT2JqZWN0LmtleXMoYXNNb2NrLl9fSU5URVJOQUxfTU9DS19TVE9SQUdFX18pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfbXVsdGlNZXJnZShrZXlWYWx1ZVBhaXJzLCBjYWxsYmFjaykge1xuICBrZXlWYWx1ZVBhaXJzLmZvckVhY2goa2V5VmFsdWUgPT4ge1xuICAgIGNvbnN0IGtleSA9IGtleVZhbHVlWzBdO1xuICAgIGNvbnN0IHZhbHVlID0gSlNPTi5wYXJzZShrZXlWYWx1ZVsxXSk7XG5cbiAgICBjb25zdCBvbGRWYWx1ZSA9IEpTT04ucGFyc2UoYXNNb2NrLl9fSU5URVJOQUxfTU9DS19TVE9SQUdFX19ba2V5XSk7XG5cbiAgICBhc01vY2suX19JTlRFUk5BTF9NT0NLX1NUT1JBR0VfX1trZXldID0gSlNPTi5zdHJpbmdpZnkoXG4gICAgICBfZGVlcE1lcmdlSW50byhvbGRWYWx1ZSwgdmFsdWUpLFxuICAgICk7XG4gIH0pO1xuXG4gIGNhbGxiYWNrICYmIGNhbGxiYWNrKG51bGwpO1xuICByZXR1cm4gbnVsbDtcbn1cblxuY29uc3QgX2lzT2JqZWN0ID0gb2JqID0+IHR5cGVvZiBvYmogPT09ICdvYmplY3QnICYmICFBcnJheS5pc0FycmF5KG9iaik7XG5jb25zdCBfZGVlcE1lcmdlSW50byA9IChvbGRPYmplY3QsIG5ld09iamVjdCkgPT4ge1xuICBjb25zdCBuZXdLZXlzID0gT2JqZWN0LmtleXMobmV3T2JqZWN0KTtcbiAgY29uc3QgbWVyZ2VkT2JqZWN0ID0gb2xkT2JqZWN0O1xuXG4gIG5ld0tleXMuZm9yRWFjaChrZXkgPT4ge1xuICAgIGNvbnN0IG9sZFZhbHVlID0gbWVyZ2VkT2JqZWN0W2tleV07XG4gICAgY29uc3QgbmV3VmFsdWUgPSBuZXdPYmplY3Rba2V5XTtcblxuICAgIGlmIChfaXNPYmplY3Qob2xkVmFsdWUpICYmIF9pc09iamVjdChuZXdWYWx1ZSkpIHtcbiAgICAgIG1lcmdlZE9iamVjdFtrZXldID0gX2RlZXBNZXJnZUludG8ob2xkVmFsdWUsIG5ld1ZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbWVyZ2VkT2JqZWN0W2tleV0gPSBuZXdWYWx1ZTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBtZXJnZWRPYmplY3Q7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGFzTW9jaztcbiJdfQ==