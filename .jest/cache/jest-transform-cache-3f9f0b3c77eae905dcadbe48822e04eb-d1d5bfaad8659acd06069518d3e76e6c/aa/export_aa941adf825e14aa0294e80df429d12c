10ec71a0e6c04525237073bf9f819486
'use strict';

var global = require("../internals/global");

var getOwnPropertyDescriptor = require("../internals/object-get-own-property-descriptor").f;

var isForced = require("../internals/is-forced");

var path = require("../internals/path");

var bind = require("../internals/function-bind-context");

var createNonEnumerableProperty = require("../internals/create-non-enumerable-property");

var has = require("../internals/has");

var wrapConstructor = function wrapConstructor(NativeConstructor) {
  var Wrapper = function Wrapper(a, b, c) {
    if (this instanceof NativeConstructor) {
      switch (arguments.length) {
        case 0:
          return new NativeConstructor();

        case 1:
          return new NativeConstructor(a);

        case 2:
          return new NativeConstructor(a, b);
      }

      return new NativeConstructor(a, b, c);
    }

    return NativeConstructor.apply(this, arguments);
  };

  Wrapper.prototype = NativeConstructor.prototype;
  return Wrapper;
};

module.exports = function (options, source) {
  var TARGET = options.target;
  var GLOBAL = options.global;
  var STATIC = options.stat;
  var PROTO = options.proto;
  var nativeSource = GLOBAL ? global : STATIC ? global[TARGET] : (global[TARGET] || {}).prototype;
  var target = GLOBAL ? path : path[TARGET] || (path[TARGET] = {});
  var targetPrototype = target.prototype;
  var FORCED, USE_NATIVE, VIRTUAL_PROTOTYPE;
  var key, sourceProperty, targetProperty, nativeProperty, resultProperty, descriptor;

  for (key in source) {
    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);
    USE_NATIVE = !FORCED && nativeSource && has(nativeSource, key);
    targetProperty = target[key];
    if (USE_NATIVE) if (options.noTargetGet) {
      descriptor = getOwnPropertyDescriptor(nativeSource, key);
      nativeProperty = descriptor && descriptor.value;
    } else nativeProperty = nativeSource[key];
    sourceProperty = USE_NATIVE && nativeProperty ? nativeProperty : source[key];
    if (USE_NATIVE && typeof targetProperty === typeof sourceProperty) continue;
    if (options.bind && USE_NATIVE) resultProperty = bind(sourceProperty, global);else if (options.wrap && USE_NATIVE) resultProperty = wrapConstructor(sourceProperty);else if (PROTO && typeof sourceProperty == 'function') resultProperty = bind(Function.call, sourceProperty);else resultProperty = sourceProperty;

    if (options.sham || sourceProperty && sourceProperty.sham || targetProperty && targetProperty.sham) {
      createNonEnumerableProperty(resultProperty, 'sham', true);
    }

    target[key] = resultProperty;

    if (PROTO) {
      VIRTUAL_PROTOTYPE = TARGET + 'Prototype';

      if (!has(path, VIRTUAL_PROTOTYPE)) {
        createNonEnumerableProperty(path, VIRTUAL_PROTOTYPE, {});
      }

      path[VIRTUAL_PROTOTYPE][key] = sourceProperty;

      if (options.real && targetPrototype && !targetPrototype[key]) {
        createNonEnumerableProperty(targetPrototype, key, sourceProperty);
      }
    }
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4cG9ydC5qcyJdLCJuYW1lcyI6WyJnbG9iYWwiLCJyZXF1aXJlIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZiIsImlzRm9yY2VkIiwicGF0aCIsImJpbmQiLCJjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkiLCJoYXMiLCJ3cmFwQ29uc3RydWN0b3IiLCJOYXRpdmVDb25zdHJ1Y3RvciIsIldyYXBwZXIiLCJhIiwiYiIsImMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJhcHBseSIsInByb3RvdHlwZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJvcHRpb25zIiwic291cmNlIiwiVEFSR0VUIiwidGFyZ2V0IiwiR0xPQkFMIiwiU1RBVElDIiwic3RhdCIsIlBST1RPIiwicHJvdG8iLCJuYXRpdmVTb3VyY2UiLCJ0YXJnZXRQcm90b3R5cGUiLCJGT1JDRUQiLCJVU0VfTkFUSVZFIiwiVklSVFVBTF9QUk9UT1RZUEUiLCJrZXkiLCJzb3VyY2VQcm9wZXJ0eSIsInRhcmdldFByb3BlcnR5IiwibmF0aXZlUHJvcGVydHkiLCJyZXN1bHRQcm9wZXJ0eSIsImRlc2NyaXB0b3IiLCJmb3JjZWQiLCJub1RhcmdldEdldCIsInZhbHVlIiwid3JhcCIsIkZ1bmN0aW9uIiwiY2FsbCIsInNoYW0iLCJyZWFsIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQSxJQUFJQSxNQUFNLEdBQUdDLE9BQU8sdUJBQXBCOztBQUNBLElBQUlDLHdCQUF3QixHQUFHRCxPQUFPLG1EQUFQLENBQTJERSxDQUExRjs7QUFDQSxJQUFJQyxRQUFRLEdBQUdILE9BQU8sMEJBQXRCOztBQUNBLElBQUlJLElBQUksR0FBR0osT0FBTyxxQkFBbEI7O0FBQ0EsSUFBSUssSUFBSSxHQUFHTCxPQUFPLHNDQUFsQjs7QUFDQSxJQUFJTSwyQkFBMkIsR0FBR04sT0FBTywrQ0FBekM7O0FBQ0EsSUFBSU8sR0FBRyxHQUFHUCxPQUFPLG9CQUFqQjs7QUFFQSxJQUFJUSxlQUFlLEdBQUcsU0FBbEJBLGVBQWtC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QSxlQUFlLENBQUNJLEdBQUQsQ0FBdkQsRUFBOEQ7QUFDNUQ1QixRQUFBQSwyQkFBMkIsQ0FBQ3dCLGVBQUQsRUFBa0JJLEdBQWxCLEVBQXVCQyxjQUF2QixDQUEzQjtBQUNEO0FBQ0Y7QUFDRjtBQUNGLENBNUREIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9nbG9iYWwnKTtcbnZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvb2JqZWN0LWdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcicpLmY7XG52YXIgaXNGb3JjZWQgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvaXMtZm9yY2VkJyk7XG52YXIgcGF0aCA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9wYXRoJyk7XG52YXIgYmluZCA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9mdW5jdGlvbi1iaW5kLWNvbnRleHQnKTtcbnZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvY3JlYXRlLW5vbi1lbnVtZXJhYmxlLXByb3BlcnR5Jyk7XG52YXIgaGFzID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL2hhcycpO1xuXG52YXIgd3JhcENvbnN0cnVjdG9yID0gZnVuY3Rpb24gKE5hdGl2ZUNvbnN0cnVjdG9yKSB7XG4gIHZhciBXcmFwcGVyID0gZnVuY3Rpb24gKGEsIGIsIGMpIHtcbiAgICBpZiAodGhpcyBpbnN0YW5jZW9mIE5hdGl2ZUNvbnN0cnVjdG9yKSB7XG4gICAgICBzd2l0Y2ggKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgY2FzZSAwOiByZXR1cm4gbmV3IE5hdGl2ZUNvbnN0cnVjdG9yKCk7XG4gICAgICAgIGNhc2UgMTogcmV0dXJuIG5ldyBOYXRpdmVDb25zdHJ1Y3RvcihhKTtcbiAgICAgICAgY2FzZSAyOiByZXR1cm4gbmV3IE5hdGl2ZUNvbnN0cnVjdG9yKGEsIGIpO1xuICAgICAgfSByZXR1cm4gbmV3IE5hdGl2ZUNvbnN0cnVjdG9yKGEsIGIsIGMpO1xuICAgIH0gcmV0dXJuIE5hdGl2ZUNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH07XG4gIFdyYXBwZXIucHJvdG90eXBlID0gTmF0aXZlQ29uc3RydWN0b3IucHJvdG90eXBlO1xuICByZXR1cm4gV3JhcHBlcjtcbn07XG5cbi8qXG4gIG9wdGlvbnMudGFyZ2V0ICAgICAgLSBuYW1lIG9mIHRoZSB0YXJnZXQgb2JqZWN0XG4gIG9wdGlvbnMuZ2xvYmFsICAgICAgLSB0YXJnZXQgaXMgdGhlIGdsb2JhbCBvYmplY3RcbiAgb3B0aW9ucy5zdGF0ICAgICAgICAtIGV4cG9ydCBhcyBzdGF0aWMgbWV0aG9kcyBvZiB0YXJnZXRcbiAgb3B0aW9ucy5wcm90byAgICAgICAtIGV4cG9ydCBhcyBwcm90b3R5cGUgbWV0aG9kcyBvZiB0YXJnZXRcbiAgb3B0aW9ucy5yZWFsICAgICAgICAtIHJlYWwgcHJvdG90eXBlIG1ldGhvZCBmb3IgdGhlIGBwdXJlYCB2ZXJzaW9uXG4gIG9wdGlvbnMuZm9yY2VkICAgICAgLSBleHBvcnQgZXZlbiBpZiB0aGUgbmF0aXZlIGZlYXR1cmUgaXMgYXZhaWxhYmxlXG4gIG9wdGlvbnMuYmluZCAgICAgICAgLSBiaW5kIG1ldGhvZHMgdG8gdGhlIHRhcmdldCwgcmVxdWlyZWQgZm9yIHRoZSBgcHVyZWAgdmVyc2lvblxuICBvcHRpb25zLndyYXAgICAgICAgIC0gd3JhcCBjb25zdHJ1Y3RvcnMgdG8gcHJldmVudGluZyBnbG9iYWwgcG9sbHV0aW9uLCByZXF1aXJlZCBmb3IgdGhlIGBwdXJlYCB2ZXJzaW9uXG4gIG9wdGlvbnMudW5zYWZlICAgICAgLSB1c2UgdGhlIHNpbXBsZSBhc3NpZ25tZW50IG9mIHByb3BlcnR5IGluc3RlYWQgb2YgZGVsZXRlICsgZGVmaW5lUHJvcGVydHlcbiAgb3B0aW9ucy5zaGFtICAgICAgICAtIGFkZCBhIGZsYWcgdG8gbm90IGNvbXBsZXRlbHkgZnVsbCBwb2x5ZmlsbHNcbiAgb3B0aW9ucy5lbnVtZXJhYmxlICAtIGV4cG9ydCBhcyBlbnVtZXJhYmxlIHByb3BlcnR5XG4gIG9wdGlvbnMubm9UYXJnZXRHZXQgLSBwcmV2ZW50IGNhbGxpbmcgYSBnZXR0ZXIgb24gdGFyZ2V0XG4qL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob3B0aW9ucywgc291cmNlKSB7XG4gIHZhciBUQVJHRVQgPSBvcHRpb25zLnRhcmdldDtcbiAgdmFyIEdMT0JBTCA9IG9wdGlvbnMuZ2xvYmFsO1xuICB2YXIgU1RBVElDID0gb3B0aW9ucy5zdGF0O1xuICB2YXIgUFJPVE8gPSBvcHRpb25zLnByb3RvO1xuXG4gIHZhciBuYXRpdmVTb3VyY2UgPSBHTE9CQUwgPyBnbG9iYWwgOiBTVEFUSUMgPyBnbG9iYWxbVEFSR0VUXSA6IChnbG9iYWxbVEFSR0VUXSB8fCB7fSkucHJvdG90eXBlO1xuXG4gIHZhciB0YXJnZXQgPSBHTE9CQUwgPyBwYXRoIDogcGF0aFtUQVJHRVRdIHx8IChwYXRoW1RBUkdFVF0gPSB7fSk7XG4gIHZhciB0YXJnZXRQcm90b3R5cGUgPSB0YXJnZXQucHJvdG90eXBlO1xuXG4gIHZhciBGT1JDRUQsIFVTRV9OQVRJVkUsIFZJUlRVQUxfUFJPVE9UWVBFO1xuICB2YXIga2V5LCBzb3VyY2VQcm9wZXJ0eSwgdGFyZ2V0UHJvcGVydHksIG5hdGl2ZVByb3BlcnR5LCByZXN1bHRQcm9wZXJ0eSwgZGVzY3JpcHRvcjtcblxuICBmb3IgKGtleSBpbiBzb3VyY2UpIHtcbiAgICBGT1JDRUQgPSBpc0ZvcmNlZChHTE9CQUwgPyBrZXkgOiBUQVJHRVQgKyAoU1RBVElDID8gJy4nIDogJyMnKSArIGtleSwgb3B0aW9ucy5mb3JjZWQpO1xuICAgIC8vIGNvbnRhaW5zIGluIG5hdGl2ZVxuICAgIFVTRV9OQVRJVkUgPSAhRk9SQ0VEICYmIG5hdGl2ZVNvdXJjZSAmJiBoYXMobmF0aXZlU291cmNlLCBrZXkpO1xuXG4gICAgdGFyZ2V0UHJvcGVydHkgPSB0YXJnZXRba2V5XTtcblxuICAgIGlmIChVU0VfTkFUSVZFKSBpZiAob3B0aW9ucy5ub1RhcmdldEdldCkge1xuICAgICAgZGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcihuYXRpdmVTb3VyY2UsIGtleSk7XG4gICAgICBuYXRpdmVQcm9wZXJ0eSA9IGRlc2NyaXB0b3IgJiYgZGVzY3JpcHRvci52YWx1ZTtcbiAgICB9IGVsc2UgbmF0aXZlUHJvcGVydHkgPSBuYXRpdmVTb3VyY2Vba2V5XTtcblxuICAgIC8vIGV4cG9ydCBuYXRpdmUgb3IgaW1wbGVtZW50YXRpb25cbiAgICBzb3VyY2VQcm9wZXJ0eSA9IChVU0VfTkFUSVZFICYmIG5hdGl2ZVByb3BlcnR5KSA/IG5hdGl2ZVByb3BlcnR5IDogc291cmNlW2tleV07XG5cbiAgICBpZiAoVVNFX05BVElWRSAmJiB0eXBlb2YgdGFyZ2V0UHJvcGVydHkgPT09IHR5cGVvZiBzb3VyY2VQcm9wZXJ0eSkgY29udGludWU7XG5cbiAgICAvLyBiaW5kIHRpbWVycyB0byBnbG9iYWwgZm9yIGNhbGwgZnJvbSBleHBvcnQgY29udGV4dFxuICAgIGlmIChvcHRpb25zLmJpbmQgJiYgVVNFX05BVElWRSkgcmVzdWx0UHJvcGVydHkgPSBiaW5kKHNvdXJjZVByb3BlcnR5LCBnbG9iYWwpO1xuICAgIC8vIHdyYXAgZ2xvYmFsIGNvbnN0cnVjdG9ycyBmb3IgcHJldmVudCBjaGFuZ3MgaW4gdGhpcyB2ZXJzaW9uXG4gICAgZWxzZSBpZiAob3B0aW9ucy53cmFwICYmIFVTRV9OQVRJVkUpIHJlc3VsdFByb3BlcnR5ID0gd3JhcENvbnN0cnVjdG9yKHNvdXJjZVByb3BlcnR5KTtcbiAgICAvLyBtYWtlIHN0YXRpYyB2ZXJzaW9ucyBmb3IgcHJvdG90eXBlIG1ldGhvZHNcbiAgICBlbHNlIGlmIChQUk9UTyAmJiB0eXBlb2Ygc291cmNlUHJvcGVydHkgPT0gJ2Z1bmN0aW9uJykgcmVzdWx0UHJvcGVydHkgPSBiaW5kKEZ1bmN0aW9uLmNhbGwsIHNvdXJjZVByb3BlcnR5KTtcbiAgICAvLyBkZWZhdWx0IGNhc2VcbiAgICBlbHNlIHJlc3VsdFByb3BlcnR5ID0gc291cmNlUHJvcGVydHk7XG5cbiAgICAvLyBhZGQgYSBmbGFnIHRvIG5vdCBjb21wbGV0ZWx5IGZ1bGwgcG9seWZpbGxzXG4gICAgaWYgKG9wdGlvbnMuc2hhbSB8fCAoc291cmNlUHJvcGVydHkgJiYgc291cmNlUHJvcGVydHkuc2hhbSkgfHwgKHRhcmdldFByb3BlcnR5ICYmIHRhcmdldFByb3BlcnR5LnNoYW0pKSB7XG4gICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkocmVzdWx0UHJvcGVydHksICdzaGFtJywgdHJ1ZSk7XG4gICAgfVxuXG4gICAgdGFyZ2V0W2tleV0gPSByZXN1bHRQcm9wZXJ0eTtcblxuICAgIGlmIChQUk9UTykge1xuICAgICAgVklSVFVBTF9QUk9UT1RZUEUgPSBUQVJHRVQgKyAnUHJvdG90eXBlJztcbiAgICAgIGlmICghaGFzKHBhdGgsIFZJUlRVQUxfUFJPVE9UWVBFKSkge1xuICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkocGF0aCwgVklSVFVBTF9QUk9UT1RZUEUsIHt9KTtcbiAgICAgIH1cbiAgICAgIC8vIGV4cG9ydCB2aXJ0dWFsIHByb3RvdHlwZSBtZXRob2RzXG4gICAgICBwYXRoW1ZJUlRVQUxfUFJPVE9UWVBFXVtrZXldID0gc291cmNlUHJvcGVydHk7XG4gICAgICAvLyBleHBvcnQgcmVhbCBwcm90b3R5cGUgbWV0aG9kc1xuICAgICAgaWYgKG9wdGlvbnMucmVhbCAmJiB0YXJnZXRQcm90b3R5cGUgJiYgIXRhcmdldFByb3RvdHlwZVtrZXldKSB7XG4gICAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSh0YXJnZXRQcm90b3R5cGUsIGtleSwgc291cmNlUHJvcGVydHkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcbiJdfQ==