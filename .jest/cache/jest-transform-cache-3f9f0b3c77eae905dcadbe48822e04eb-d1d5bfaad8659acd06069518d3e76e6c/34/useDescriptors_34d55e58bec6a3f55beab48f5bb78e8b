d1222a0250f9c8fc21d37aa10b97f083
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

var _slicedToArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/slicedToArray"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = useDescriptors;

var React = _interopRequireWildcard(require("react"));

var _SceneView = _interopRequireDefault(require("./SceneView"));

var _NavigationBuilderContext = _interopRequireDefault(require("./NavigationBuilderContext"));

var _useNavigationCache = _interopRequireDefault(require("./useNavigationCache"));

var _useRouteCache = _interopRequireDefault(require("./useRouteCache"));

var _NavigationContext = _interopRequireDefault(require("./NavigationContext"));

var _NavigationRouteContext = _interopRequireDefault(require("./NavigationRouteContext"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function useDescriptors(_ref) {
  var state = _ref.state,
      screens = _ref.screens,
      navigation = _ref.navigation,
      screenOptions = _ref.screenOptions,
      onAction = _ref.onAction,
      getState = _ref.getState,
      setState = _ref.setState,
      addListener = _ref.addListener,
      addKeyedListener = _ref.addKeyedListener,
      onRouteFocus = _ref.onRouteFocus,
      router = _ref.router,
      emitter = _ref.emitter;

  var _React$useState = React.useState({}),
      _React$useState2 = (0, _slicedToArray2.default)(_React$useState, 2),
      options = _React$useState2[0],
      setOptions = _React$useState2[1];

  var _React$useContext = React.useContext(_NavigationBuilderContext.default),
      onDispatchAction = _React$useContext.onDispatchAction,
      onOptionsChange = _React$useContext.onOptionsChange;

  var context = React.useMemo(function () {
    return {
      navigation: navigation,
      onAction: onAction,
      addListener: addListener,
      addKeyedListener: addKeyedListener,
      onRouteFocus: onRouteFocus,
      onDispatchAction: onDispatchAction,
      onOptionsChange: onOptionsChange
    };
  }, [navigation, onAction, addListener, addKeyedListener, onRouteFocus, onDispatchAction, onOptionsChange]);
  var navigations = (0, _useNavigationCache.default)({
    state: state,
    getState: getState,
    navigation: navigation,
    setOptions: setOptions,
    router: router,
    emitter: emitter
  });
  var routes = (0, _useRouteCache.default)(state.routes);
  return routes.reduce(function (acc, route, i) {
    var screen = screens[route.name];
    var navigation = navigations[route.key];
    var routeOptions = (0, _extends2.default)({}, typeof screenOptions === 'object' || screenOptions == null ? screenOptions : screenOptions({
      route: route,
      navigation: navigation
    }), typeof screen.options === 'object' || screen.options == null ? screen.options : screen.options({
      route: route,
      navigation: navigation
    }), options[route.key]);
    acc[route.key] = {
      navigation: navigation,
      render: function render() {
        return React.createElement(_NavigationBuilderContext.default.Provider, {
          key: route.key,
          value: context
        }, React.createElement(_NavigationContext.default.Provider, {
          value: navigation
        }, React.createElement(_NavigationRouteContext.default.Provider, {
          value: route
        }, React.createElement(_SceneView.default, {
          navigation: navigation,
          route: route,
          screen: screen,
          routeState: state.routes[i].state,
          getState: getState,
          setState: setState,
          options: routeOptions
        }))));
      },
      options: routeOptions
    };
    return acc;
  }, {});
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZURlc2NyaXB0b3JzLnRzeCJdLCJuYW1lcyI6WyJlbWl0dGVyIiwiUmVhY3QiLCJvbk9wdGlvbnNDaGFuZ2UiLCJOYXZpZ2F0aW9uQnVpbGRlckNvbnRleHQiLCJjb250ZXh0IiwibmF2aWdhdGlvbiIsIm9uQWN0aW9uIiwiYWRkTGlzdGVuZXIiLCJhZGRLZXllZExpc3RlbmVyIiwib25Sb3V0ZUZvY3VzIiwib25EaXNwYXRjaEFjdGlvbiIsIm5hdmlnYXRpb25zIiwic3RhdGUiLCJnZXRTdGF0ZSIsInNldE9wdGlvbnMiLCJyb3V0ZXIiLCJyb3V0ZXMiLCJzY3JlZW4iLCJzY3JlZW5zIiwicm91dGUiLCJyb3V0ZU9wdGlvbnMiLCJzY3JlZW5PcHRpb25zIiwib3B0aW9ucyIsImFjYyIsInJlbmRlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLElBQUEsS0FBQSxHQUFBLHVCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBOztBQU9BLElBQUEsVUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxlQUFBLENBQUE7O0FBQ0EsSUFBQSx5QkFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSw4QkFBQSxDQUFBOztBQUtBLElBQUEsbUJBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsd0JBQUEsQ0FBQTs7QUFDQSxJQUFBLGNBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsbUJBQUEsQ0FBQTs7QUFDQSxJQUFBLGtCQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLHVCQUFBLENBQUE7O0FBQ0EsSUFBQSx1QkFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSw0QkFBQSxDQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUErQ2UsU0FBQSxjQUFBLE9BaUI2QjtBQUFBLE1BYjFDLEtBYTBDLFFBYjFDLEtBYTBDO0FBQUEsTUFiMUMsT0FhMEMsUUFiMUMsT0FhMEM7QUFBQSxNQWIxQyxVQWEwQyxRQWIx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QUFBLFVBRGUsRUFDZkEsVUFEZTtBQUVmbUIsTUFBQUEsTUFGZSxvQkFFTjtBQUNQLGVBQ0UsS0FBQSxDQUFBLGFBQUEsQ0FBQyx5QkFBQSxDQUFELE9BQUMsQ0FBRCxRQUFBLEVBQUE7QUFBbUMsVUFBQSxHQUFHLEVBQUVMLEtBQUssQ0FBN0MsR0FBQTtBQUFtRCxVQUFBLEtBQUssRUFBRWY7QUFBMUQsU0FBQSxFQUNFLEtBQUEsQ0FBQSxhQUFBLENBQUMsa0JBQUEsQ0FBRCxPQUFDLENBQUQsUUFBQSxFQUFBO0FBQTRCLFVBQUEsS0FBSyxFQUFFQztBQUFuQyxTQUFBLEVBQ0UsS0FBQSxDQUFBLGFBQUEsQ0FBQyx1QkFBQSxDQUFELE9BQUMsQ0FBRCxRQUFBLEVBQUE7QUFBaUMsVUFBQSxLQUFLLEVBQUVjO0FBQXhDLFNBQUEsRUFDRSxLQUFBLENBQUEsYUFBQSxDQUFDLFVBQUEsQ0FBRCxPQUFBLEVBQUE7QUFDRSxVQUFBLFVBQVUsRUFEWixVQUFBO0FBRUUsVUFBQSxLQUFLLEVBRlAsS0FBQTtBQUdFLFVBQUEsTUFBTSxFQUhSLE1BQUE7QUFJRSxVQUFBLFVBQVUsRUFBRVAsS0FBSyxDQUFMQSxNQUFBQSxDQUFBQSxDQUFBQSxFQUpkLEtBQUE7QUFLRSxVQUFBLFFBQVEsRUFMVixRQUFBO0FBTUUsVUFBQSxRQUFRLEVBTlYsUUFBQTtBQU9FLFVBQUEsT0FBTyxFQUFFUTtBQVBYLFNBQUEsQ0FERixDQURGLENBREYsQ0FERjtBQUhhLE9BQUE7QUFxQmZFLE1BQUFBLE9BQU8sRUFBRUY7QUFyQk0sS0FBakJHO0FBd0JBLFdBQUEsR0FBQTtBQW5ESyxHQUFBLEVBQVAsRUFBTyxDQUFQO0FBcUREIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHR5cGUge1xuICBOYXZpZ2F0aW9uQWN0aW9uLFxuICBOYXZpZ2F0aW9uU3RhdGUsXG4gIFBhcmFtTGlzdEJhc2UsXG4gIFJvdXRlcixcbn0gZnJvbSAnQHJlYWN0LW5hdmlnYXRpb24vcm91dGVycyc7XG5pbXBvcnQgU2NlbmVWaWV3IGZyb20gJy4vU2NlbmVWaWV3JztcbmltcG9ydCBOYXZpZ2F0aW9uQnVpbGRlckNvbnRleHQsIHtcbiAgQWRkTGlzdGVuZXIsXG4gIEFkZEtleWVkTGlzdGVuZXIsXG59IGZyb20gJy4vTmF2aWdhdGlvbkJ1aWxkZXJDb250ZXh0JztcbmltcG9ydCB0eXBlIHsgTmF2aWdhdGlvbkV2ZW50RW1pdHRlciB9IGZyb20gJy4vdXNlRXZlbnRFbWl0dGVyJztcbmltcG9ydCB1c2VOYXZpZ2F0aW9uQ2FjaGUgZnJvbSAnLi91c2VOYXZpZ2F0aW9uQ2FjaGUnO1xuaW1wb3J0IHVzZVJvdXRlQ2FjaGUgZnJvbSAnLi91c2VSb3V0ZUNhY2hlJztcbmltcG9ydCBOYXZpZ2F0aW9uQ29udGV4dCBmcm9tICcuL05hdmlnYXRpb25Db250ZXh0JztcbmltcG9ydCBOYXZpZ2F0aW9uUm91dGVDb250ZXh0IGZyb20gJy4vTmF2aWdhdGlvblJvdXRlQ29udGV4dCc7XG5pbXBvcnQgdHlwZSB7XG4gIERlc2NyaXB0b3IsXG4gIE5hdmlnYXRpb25IZWxwZXJzLFxuICBSb3V0ZUNvbmZpZyxcbiAgUm91dGVQcm9wLFxuICBFdmVudE1hcEJhc2UsXG59IGZyb20gJy4vdHlwZXMnO1xuXG50eXBlIE9wdGlvbnM8XG4gIFN0YXRlIGV4dGVuZHMgTmF2aWdhdGlvblN0YXRlLFxuICBTY3JlZW5PcHRpb25zIGV4dGVuZHMge30sXG4gIEV2ZW50TWFwIGV4dGVuZHMgRXZlbnRNYXBCYXNlXG4+ID0ge1xuICBzdGF0ZTogU3RhdGU7XG4gIHNjcmVlbnM6IFJlY29yZDxcbiAgICBzdHJpbmcsXG4gICAgUm91dGVDb25maWc8UGFyYW1MaXN0QmFzZSwgc3RyaW5nLCBTdGF0ZSwgU2NyZWVuT3B0aW9ucywgRXZlbnRNYXA+XG4gID47XG4gIG5hdmlnYXRpb246IE5hdmlnYXRpb25IZWxwZXJzPFBhcmFtTGlzdEJhc2U+O1xuICBzY3JlZW5PcHRpb25zPzpcbiAgICB8IFNjcmVlbk9wdGlvbnNcbiAgICB8ICgocHJvcHM6IHtcbiAgICAgICAgcm91dGU6IFJvdXRlUHJvcDxQYXJhbUxpc3RCYXNlLCBzdHJpbmc+O1xuICAgICAgICBuYXZpZ2F0aW9uOiBhbnk7XG4gICAgICB9KSA9PiBTY3JlZW5PcHRpb25zKTtcbiAgb25BY3Rpb246IChcbiAgICBhY3Rpb246IE5hdmlnYXRpb25BY3Rpb24sXG4gICAgdmlzaXRlZE5hdmlnYXRvcnM/OiBTZXQ8c3RyaW5nPlxuICApID0+IGJvb2xlYW47XG4gIGdldFN0YXRlOiAoKSA9PiBTdGF0ZTtcbiAgc2V0U3RhdGU6IChzdGF0ZTogU3RhdGUpID0+IHZvaWQ7XG4gIGFkZExpc3RlbmVyOiBBZGRMaXN0ZW5lcjtcbiAgYWRkS2V5ZWRMaXN0ZW5lcjogQWRkS2V5ZWRMaXN0ZW5lcjtcbiAgb25Sb3V0ZUZvY3VzOiAoa2V5OiBzdHJpbmcpID0+IHZvaWQ7XG4gIHJvdXRlcjogUm91dGVyPFN0YXRlLCBOYXZpZ2F0aW9uQWN0aW9uPjtcbiAgZW1pdHRlcjogTmF2aWdhdGlvbkV2ZW50RW1pdHRlcjxhbnk+O1xufTtcblxuLyoqXG4gKiBIb29rIHRvIGNyZWF0ZSBkZXNjcmlwdG9yIG9iamVjdHMgZm9yIHRoZSBjaGlsZCByb3V0ZXMuXG4gKlxuICogQSBkZXNjcmlwdG9yIG9iamVjdCBwcm92aWRlcyAzIHRoaW5nczpcbiAqIC0gSGVscGVyIG1ldGhvZCB0byByZW5kZXIgYSBzY3JlZW5cbiAqIC0gT3B0aW9ucyBzcGVjaWZpZWQgYnkgdGhlIHNjcmVlbiBmb3IgdGhlIG5hdmlnYXRvclxuICogLSBOYXZpZ2F0aW9uIG9iamVjdCBpbnRlbmRlZCBmb3IgdGhlIHJvdXRlXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHVzZURlc2NyaXB0b3JzPFxuICBTdGF0ZSBleHRlbmRzIE5hdmlnYXRpb25TdGF0ZSxcbiAgU2NyZWVuT3B0aW9ucyBleHRlbmRzIHt9LFxuICBFdmVudE1hcCBleHRlbmRzIEV2ZW50TWFwQmFzZVxuPih7XG4gIHN0YXRlLFxuICBzY3JlZW5zLFxuICBuYXZpZ2F0aW9uLFxuICBzY3JlZW5PcHRpb25zLFxuICBvbkFjdGlvbixcbiAgZ2V0U3RhdGUsXG4gIHNldFN0YXRlLFxuICBhZGRMaXN0ZW5lcixcbiAgYWRkS2V5ZWRMaXN0ZW5lcixcbiAgb25Sb3V0ZUZvY3VzLFxuICByb3V0ZXIsXG4gIGVtaXR0ZXIsXG59OiBPcHRpb25zPFN0YXRlLCBTY3JlZW5PcHRpb25zLCBFdmVudE1hcD4pIHtcbiAgY29uc3QgW29wdGlvbnMsIHNldE9wdGlvbnNdID0gUmVhY3QudXNlU3RhdGU8UmVjb3JkPHN0cmluZywgb2JqZWN0Pj4oe30pO1xuICBjb25zdCB7IG9uRGlzcGF0Y2hBY3Rpb24sIG9uT3B0aW9uc0NoYW5nZSB9ID0gUmVhY3QudXNlQ29udGV4dChcbiAgICBOYXZpZ2F0aW9uQnVpbGRlckNvbnRleHRcbiAgKTtcblxuICBjb25zdCBjb250ZXh0ID0gUmVhY3QudXNlTWVtbyhcbiAgICAoKSA9PiAoe1xuICAgICAgbmF2aWdhdGlvbixcbiAgICAgIG9uQWN0aW9uLFxuICAgICAgYWRkTGlzdGVuZXIsXG4gICAgICBhZGRLZXllZExpc3RlbmVyLFxuICAgICAgb25Sb3V0ZUZvY3VzLFxuICAgICAgb25EaXNwYXRjaEFjdGlvbixcbiAgICAgIG9uT3B0aW9uc0NoYW5nZSxcbiAgICB9KSxcbiAgICBbXG4gICAgICBuYXZpZ2F0aW9uLFxuICAgICAgb25BY3Rpb24sXG4gICAgICBhZGRMaXN0ZW5lcixcbiAgICAgIGFkZEtleWVkTGlzdGVuZXIsXG4gICAgICBvblJvdXRlRm9jdXMsXG4gICAgICBvbkRpc3BhdGNoQWN0aW9uLFxuICAgICAgb25PcHRpb25zQ2hhbmdlLFxuICAgIF1cbiAgKTtcblxuICBjb25zdCBuYXZpZ2F0aW9ucyA9IHVzZU5hdmlnYXRpb25DYWNoZTxTdGF0ZSwgU2NyZWVuT3B0aW9ucz4oe1xuICAgIHN0YXRlLFxuICAgIGdldFN0YXRlLFxuICAgIG5hdmlnYXRpb24sXG4gICAgc2V0T3B0aW9ucyxcbiAgICByb3V0ZXIsXG4gICAgZW1pdHRlcixcbiAgfSk7XG5cbiAgY29uc3Qgcm91dGVzID0gdXNlUm91dGVDYWNoZShzdGF0ZS5yb3V0ZXMpO1xuXG4gIHJldHVybiByb3V0ZXMucmVkdWNlPFxuICAgIFJlY29yZDxzdHJpbmcsIERlc2NyaXB0b3I8UGFyYW1MaXN0QmFzZSwgc3RyaW5nLCBTdGF0ZSwgU2NyZWVuT3B0aW9ucz4+XG4gID4oKGFjYywgcm91dGUsIGkpID0+IHtcbiAgICBjb25zdCBzY3JlZW4gPSBzY3JlZW5zW3JvdXRlLm5hbWVdO1xuICAgIGNvbnN0IG5hdmlnYXRpb24gPSBuYXZpZ2F0aW9uc1tyb3V0ZS5rZXldO1xuXG4gICAgY29uc3Qgcm91dGVPcHRpb25zID0ge1xuICAgICAgLy8gVGhlIGRlZmF1bHQgYHNjcmVlbk9wdGlvbnNgIHBhc3NlZCB0byB0aGUgbmF2aWdhdG9yXG4gICAgICAuLi4odHlwZW9mIHNjcmVlbk9wdGlvbnMgPT09ICdvYmplY3QnIHx8IHNjcmVlbk9wdGlvbnMgPT0gbnVsbFxuICAgICAgICA/IHNjcmVlbk9wdGlvbnNcbiAgICAgICAgOiAvLyBAdHMtZXhwZWN0LWVycm9yOiB0aGlzIGlzIGEgZnVuY3Rpb24sIGJ1dCB0eXBlc2NyaXB0IGRvZXNuJ3QgdGhpbmsgc29cbiAgICAgICAgICBzY3JlZW5PcHRpb25zKHtcbiAgICAgICAgICAgIHJvdXRlLFxuICAgICAgICAgICAgbmF2aWdhdGlvbixcbiAgICAgICAgICB9KSksXG4gICAgICAvLyBUaGUgYG9wdGlvbnNgIHByb3AgcGFzc2VkIHRvIGBTY3JlZW5gIGVsZW1lbnRzXG4gICAgICAuLi4odHlwZW9mIHNjcmVlbi5vcHRpb25zID09PSAnb2JqZWN0JyB8fCBzY3JlZW4ub3B0aW9ucyA9PSBudWxsXG4gICAgICAgID8gc2NyZWVuLm9wdGlvbnNcbiAgICAgICAgOiAvLyBAdHMtZXhwZWN0LWVycm9yOiB0aGlzIGlzIGEgZnVuY3Rpb24sIGJ1dCB0eXBlc2NyaXB0IGRvZXNuJ3QgdGhpbmsgc29cbiAgICAgICAgICBzY3JlZW4ub3B0aW9ucyh7XG4gICAgICAgICAgICByb3V0ZSxcbiAgICAgICAgICAgIG5hdmlnYXRpb24sXG4gICAgICAgICAgfSkpLFxuICAgICAgLy8gVGhlIG9wdGlvbnMgc2V0IHZpYSBgbmF2aWdhdGlvbi5zZXRPcHRpb25zYFxuICAgICAgLi4ub3B0aW9uc1tyb3V0ZS5rZXldLFxuICAgIH07XG5cbiAgICBhY2Nbcm91dGUua2V5XSA9IHtcbiAgICAgIG5hdmlnYXRpb24sXG4gICAgICByZW5kZXIoKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgPE5hdmlnYXRpb25CdWlsZGVyQ29udGV4dC5Qcm92aWRlciBrZXk9e3JvdXRlLmtleX0gdmFsdWU9e2NvbnRleHR9PlxuICAgICAgICAgICAgPE5hdmlnYXRpb25Db250ZXh0LlByb3ZpZGVyIHZhbHVlPXtuYXZpZ2F0aW9ufT5cbiAgICAgICAgICAgICAgPE5hdmlnYXRpb25Sb3V0ZUNvbnRleHQuUHJvdmlkZXIgdmFsdWU9e3JvdXRlfT5cbiAgICAgICAgICAgICAgICA8U2NlbmVWaWV3XG4gICAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uPXtuYXZpZ2F0aW9ufVxuICAgICAgICAgICAgICAgICAgcm91dGU9e3JvdXRlfVxuICAgICAgICAgICAgICAgICAgc2NyZWVuPXtzY3JlZW59XG4gICAgICAgICAgICAgICAgICByb3V0ZVN0YXRlPXtzdGF0ZS5yb3V0ZXNbaV0uc3RhdGV9XG4gICAgICAgICAgICAgICAgICBnZXRTdGF0ZT17Z2V0U3RhdGV9XG4gICAgICAgICAgICAgICAgICBzZXRTdGF0ZT17c2V0U3RhdGV9XG4gICAgICAgICAgICAgICAgICBvcHRpb25zPXtyb3V0ZU9wdGlvbnN9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPC9OYXZpZ2F0aW9uUm91dGVDb250ZXh0LlByb3ZpZGVyPlxuICAgICAgICAgICAgPC9OYXZpZ2F0aW9uQ29udGV4dC5Qcm92aWRlcj5cbiAgICAgICAgICA8L05hdmlnYXRpb25CdWlsZGVyQ29udGV4dC5Qcm92aWRlcj5cbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBvcHRpb25zOiByb3V0ZU9wdGlvbnMgYXMgU2NyZWVuT3B0aW9ucyxcbiAgICB9O1xuXG4gICAgcmV0dXJuIGFjYztcbiAgfSwge30pO1xufVxuIl19