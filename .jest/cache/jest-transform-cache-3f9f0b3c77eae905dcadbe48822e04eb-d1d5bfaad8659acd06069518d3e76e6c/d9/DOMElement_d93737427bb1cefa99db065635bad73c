387dd63b5451075c5e4b2ac93001f477
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.default = exports.serialize = exports.test = void 0;

var _markup = require("./lib/markup");

var ELEMENT_NODE = 1;
var TEXT_NODE = 3;
var COMMENT_NODE = 8;
var FRAGMENT_NODE = 11;
var ELEMENT_REGEXP = /^((HTML|SVG)\w*)?Element$/;

var testNode = function testNode(nodeType, name) {
  return nodeType === ELEMENT_NODE && ELEMENT_REGEXP.test(name) || nodeType === TEXT_NODE && name === 'Text' || nodeType === COMMENT_NODE && name === 'Comment' || nodeType === FRAGMENT_NODE && name === 'DocumentFragment';
};

var test = function test(val) {
  return val && val.constructor && val.constructor.name && testNode(val.nodeType, val.constructor.name);
};

exports.test = test;

function nodeIsText(node) {
  return node.nodeType === TEXT_NODE;
}

function nodeIsComment(node) {
  return node.nodeType === COMMENT_NODE;
}

function nodeIsFragment(node) {
  return node.nodeType === FRAGMENT_NODE;
}

var serialize = function serialize(node, config, indentation, depth, refs, printer) {
  if (nodeIsText(node)) {
    return (0, _markup.printText)(node.data, config);
  }

  if (nodeIsComment(node)) {
    return (0, _markup.printComment)(node.data, config);
  }

  var type = nodeIsFragment(node) ? "DocumentFragment" : node.tagName.toLowerCase();

  if (++depth > config.maxDepth) {
    return (0, _markup.printElementAsLeaf)(type, config);
  }

  return (0, _markup.printElement)(type, (0, _markup.printProps)(nodeIsFragment(node) ? [] : Array.from(node.attributes).map(function (attr) {
    return attr.name;
  }).sort(), nodeIsFragment(node) ? [] : Array.from(node.attributes).reduce(function (props, attribute) {
    props[attribute.name] = attribute.value;
    return props;
  }, {}), config, indentation + config.indent, depth, refs, printer), (0, _markup.printChildren)(Array.prototype.slice.call(node.childNodes || node.children), config, indentation + config.indent, depth, refs, printer), config, indentation);
};

exports.serialize = serialize;
var plugin = {
  serialize: serialize,
  test: test
};
var _default = plugin;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRPTUVsZW1lbnQuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJkZWZhdWx0Iiwic2VyaWFsaXplIiwidGVzdCIsIl9tYXJrdXAiLCJyZXF1aXJlIiwiRUxFTUVOVF9OT0RFIiwiVEVYVF9OT0RFIiwiQ09NTUVOVF9OT0RFIiwiRlJBR01FTlRfTk9ERSIsIkVMRU1FTlRfUkVHRVhQIiwidGVzdE5vZGUiLCJub2RlVHlwZSIsIm5hbWUiLCJ2YWwiLCJjb25zdHJ1Y3RvciIsIm5vZGVJc1RleHQiLCJub2RlIiwibm9kZUlzQ29tbWVudCIsIm5vZGVJc0ZyYWdtZW50IiwiY29uZmlnIiwiaW5kZW50YXRpb24iLCJkZXB0aCIsInJlZnMiLCJwcmludGVyIiwicHJpbnRUZXh0IiwiZGF0YSIsInByaW50Q29tbWVudCIsInR5cGUiLCJ0YWdOYW1lIiwidG9Mb3dlckNhc2UiLCJtYXhEZXB0aCIsInByaW50RWxlbWVudEFzTGVhZiIsInByaW50RWxlbWVudCIsInByaW50UHJvcHMiLCJBcnJheSIsImZyb20iLCJhdHRyaWJ1dGVzIiwibWFwIiwiYXR0ciIsInNvcnQiLCJyZWR1Y2UiLCJwcm9wcyIsImF0dHJpYnV0ZSIsImluZGVudCIsInByaW50Q2hpbGRyZW4iLCJwcm90b3R5cGUiLCJzbGljZSIsImNhbGwiLCJjaGlsZE5vZGVzIiwiY2hpbGRyZW4iLCJwbHVnaW4iLCJfZGVmYXVsdCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLEVBQUFBLEtBQUssRUFBRTtBQURvQyxDQUE3QztBQUdBRCxPQUFPLENBQUNFLE9BQVIsR0FBa0JGLE9BQU8sQ0FBQ0csU0FBUixHQUFvQkgsT0FBTyxDQUFDSSxJQUFSLEdBQWUsS0FBSyxDQUExRDs7QUFFQSxJQUFJQyxPQUFPLEdBQUdDLE9BQU8sZ0JBQXJCOztBQVFBLElB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QUE1QixDQUFtQyxVQUFDQyxLQUFELEVBQVFDLFNBQVIsRUFBc0I7QUFDdkRELElBQUFBLEtBQUssQ0FBQ0MsU0FBUyxDQUFDOUIsSUFBWCxDQUFMLEdBQXdCOEIsU0FBUyxDQUFDM0MsS0FBbEM7QUFDQSxXQUFPMEMsS0FBUDtBQUNELEdBSEQsRUFHRyxFQUhILENBUk4sRUFZRXRCLE1BWkYsRUFhRUMsV0FBVyxHQUFHRCxNQUFNLENBQUN3QixNQWJ2QixFQWNFdEIsS0FkRixFQWVFQyxJQWZGLEVBZ0JFQyxPQWhCRixDQUZLLEVBb0JMLENBQUMsR0FBR3BCLE9BQU8sQ0FBQ3lDLGFBQVosRUFDRVYsS0FBSyxDQUFDVyxTQUFOLENBQWdCQyxLQUFoQixDQUFzQkMsSUFBdEIsQ0FBMkIvQixJQUFJLENBQUNnQyxVQUFMLElBQW1CaEMsSUFBSSxDQUFDaUMsUUFBbkQsQ0FERixFQUVFOUIsTUFGRixFQUdFQyxXQUFXLEdBQUdELE1BQU0sQ0FBQ3dCLE1BSHZCLEVBSUV0QixLQUpGLEVBS0VDLElBTEYsRUFNRUMsT0FORixDQXBCSyxFQTRCTEosTUE1QkssRUE2QkxDLFdBN0JLLENBQVA7QUErQkQsQ0FoREQ7O0FBa0RBdEIsT0FBTyxDQUFDRyxTQUFSLEdBQW9CQSxTQUFwQjtBQUNBLElBQU1pRCxNQUFNLEdBQUc7QUFDYmpELEVBQUFBLFNBQVMsRUFBVEEsU0FEYTtBQUViQyxFQUFBQSxJQUFJLEVBQUpBO0FBRmEsQ0FBZjtBQUlBLElBQUlpRCxRQUFRLEdBQUdELE1BQWY7QUFDQXBELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQm1ELFFBQWxCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IGV4cG9ydHMuc2VyaWFsaXplID0gZXhwb3J0cy50ZXN0ID0gdm9pZCAwO1xuXG52YXIgX21hcmt1cCA9IHJlcXVpcmUoJy4vbGliL21hcmt1cCcpO1xuXG4vKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5jb25zdCBFTEVNRU5UX05PREUgPSAxO1xuY29uc3QgVEVYVF9OT0RFID0gMztcbmNvbnN0IENPTU1FTlRfTk9ERSA9IDg7XG5jb25zdCBGUkFHTUVOVF9OT0RFID0gMTE7XG5jb25zdCBFTEVNRU5UX1JFR0VYUCA9IC9eKChIVE1MfFNWRylcXHcqKT9FbGVtZW50JC87XG5cbmNvbnN0IHRlc3ROb2RlID0gKG5vZGVUeXBlLCBuYW1lKSA9PlxuICAobm9kZVR5cGUgPT09IEVMRU1FTlRfTk9ERSAmJiBFTEVNRU5UX1JFR0VYUC50ZXN0KG5hbWUpKSB8fFxuICAobm9kZVR5cGUgPT09IFRFWFRfTk9ERSAmJiBuYW1lID09PSAnVGV4dCcpIHx8XG4gIChub2RlVHlwZSA9PT0gQ09NTUVOVF9OT0RFICYmIG5hbWUgPT09ICdDb21tZW50JykgfHxcbiAgKG5vZGVUeXBlID09PSBGUkFHTUVOVF9OT0RFICYmIG5hbWUgPT09ICdEb2N1bWVudEZyYWdtZW50Jyk7XG5cbmNvbnN0IHRlc3QgPSB2YWwgPT5cbiAgdmFsICYmXG4gIHZhbC5jb25zdHJ1Y3RvciAmJlxuICB2YWwuY29uc3RydWN0b3IubmFtZSAmJlxuICB0ZXN0Tm9kZSh2YWwubm9kZVR5cGUsIHZhbC5jb25zdHJ1Y3Rvci5uYW1lKTtcblxuZXhwb3J0cy50ZXN0ID0gdGVzdDtcblxuZnVuY3Rpb24gbm9kZUlzVGV4dChub2RlKSB7XG4gIHJldHVybiBub2RlLm5vZGVUeXBlID09PSBURVhUX05PREU7XG59XG5cbmZ1bmN0aW9uIG5vZGVJc0NvbW1lbnQobm9kZSkge1xuICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gQ09NTUVOVF9OT0RFO1xufVxuXG5mdW5jdGlvbiBub2RlSXNGcmFnbWVudChub2RlKSB7XG4gIHJldHVybiBub2RlLm5vZGVUeXBlID09PSBGUkFHTUVOVF9OT0RFO1xufVxuXG5jb25zdCBzZXJpYWxpemUgPSAobm9kZSwgY29uZmlnLCBpbmRlbnRhdGlvbiwgZGVwdGgsIHJlZnMsIHByaW50ZXIpID0+IHtcbiAgaWYgKG5vZGVJc1RleHQobm9kZSkpIHtcbiAgICByZXR1cm4gKDAsIF9tYXJrdXAucHJpbnRUZXh0KShub2RlLmRhdGEsIGNvbmZpZyk7XG4gIH1cblxuICBpZiAobm9kZUlzQ29tbWVudChub2RlKSkge1xuICAgIHJldHVybiAoMCwgX21hcmt1cC5wcmludENvbW1lbnQpKG5vZGUuZGF0YSwgY29uZmlnKTtcbiAgfVxuXG4gIGNvbnN0IHR5cGUgPSBub2RlSXNGcmFnbWVudChub2RlKVxuICAgID8gYERvY3VtZW50RnJhZ21lbnRgXG4gICAgOiBub2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcblxuICBpZiAoKytkZXB0aCA+IGNvbmZpZy5tYXhEZXB0aCkge1xuICAgIHJldHVybiAoMCwgX21hcmt1cC5wcmludEVsZW1lbnRBc0xlYWYpKHR5cGUsIGNvbmZpZyk7XG4gIH1cblxuICByZXR1cm4gKDAsIF9tYXJrdXAucHJpbnRFbGVtZW50KShcbiAgICB0eXBlLFxuICAgICgwLCBfbWFya3VwLnByaW50UHJvcHMpKFxuICAgICAgbm9kZUlzRnJhZ21lbnQobm9kZSlcbiAgICAgICAgPyBbXVxuICAgICAgICA6IEFycmF5LmZyb20obm9kZS5hdHRyaWJ1dGVzKVxuICAgICAgICAgICAgLm1hcChhdHRyID0+IGF0dHIubmFtZSlcbiAgICAgICAgICAgIC5zb3J0KCksXG4gICAgICBub2RlSXNGcmFnbWVudChub2RlKVxuICAgICAgICA/IFtdXG4gICAgICAgIDogQXJyYXkuZnJvbShub2RlLmF0dHJpYnV0ZXMpLnJlZHVjZSgocHJvcHMsIGF0dHJpYnV0ZSkgPT4ge1xuICAgICAgICAgICAgcHJvcHNbYXR0cmlidXRlLm5hbWVdID0gYXR0cmlidXRlLnZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHByb3BzO1xuICAgICAgICAgIH0sIHt9KSxcbiAgICAgIGNvbmZpZyxcbiAgICAgIGluZGVudGF0aW9uICsgY29uZmlnLmluZGVudCxcbiAgICAgIGRlcHRoLFxuICAgICAgcmVmcyxcbiAgICAgIHByaW50ZXJcbiAgICApLFxuICAgICgwLCBfbWFya3VwLnByaW50Q2hpbGRyZW4pKFxuICAgICAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwobm9kZS5jaGlsZE5vZGVzIHx8IG5vZGUuY2hpbGRyZW4pLFxuICAgICAgY29uZmlnLFxuICAgICAgaW5kZW50YXRpb24gKyBjb25maWcuaW5kZW50LFxuICAgICAgZGVwdGgsXG4gICAgICByZWZzLFxuICAgICAgcHJpbnRlclxuICAgICksXG4gICAgY29uZmlnLFxuICAgIGluZGVudGF0aW9uXG4gICk7XG59O1xuXG5leHBvcnRzLnNlcmlhbGl6ZSA9IHNlcmlhbGl6ZTtcbmNvbnN0IHBsdWdpbiA9IHtcbiAgc2VyaWFsaXplLFxuICB0ZXN0XG59O1xudmFyIF9kZWZhdWx0ID0gcGx1Z2luO1xuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7XG4iXX0=