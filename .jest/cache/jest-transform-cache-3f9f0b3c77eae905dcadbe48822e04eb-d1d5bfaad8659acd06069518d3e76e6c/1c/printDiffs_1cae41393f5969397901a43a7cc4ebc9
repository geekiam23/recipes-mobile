69bd79045bb07876d8dede1649db52b0
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.getStringDiff = exports.printMultilineStringDiffs = exports.createPatchMark = exports.printAnnotation = exports.hasCommonDiff = exports.computeStringDiffs = exports.printCommonLine = exports.printInsertLine = exports.printDeleteLine = exports.MULTILINE_REGEXP = exports.getReceivedString = exports.getExpectedString = exports.getHighlightedString = exports.RECEIVED_COLOR = exports.INVERTED_COLOR = exports.EXPECTED_COLOR = exports.DIM_COLOR = void 0;

var _chalk = _interopRequireDefault(require('chalk'));

var _cleanupSemantic = require("./cleanupSemantic");

var _diffStrings = _interopRequireDefault(require("./diffStrings"));

var _getAlignedDiffs = _interopRequireDefault(require("./getAlignedDiffs"));

var _joinAlignedDiffs = require("./joinAlignedDiffs");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

var DIM_COLOR = _chalk.default.dim;
exports.DIM_COLOR = DIM_COLOR;
var EXPECTED_COLOR = _chalk.default.green;
exports.EXPECTED_COLOR = EXPECTED_COLOR;
var INVERTED_COLOR = _chalk.default.inverse;
exports.INVERTED_COLOR = INVERTED_COLOR;
var RECEIVED_COLOR = _chalk.default.red;
exports.RECEIVED_COLOR = RECEIVED_COLOR;
var PATCH_COLOR = _chalk.default.yellow;

var getHighlightedString = function getHighlightedString(op, diffs) {
  return diffs.reduce(function (reduced, diff) {
    return reduced + (diff[0] === _cleanupSemantic.DIFF_EQUAL ? diff[1] : diff[0] === op ? INVERTED_COLOR(diff[1]) : '');
  }, '');
};

exports.getHighlightedString = getHighlightedString;

var getExpectedString = function getExpectedString(diffs) {
  return getHighlightedString(_cleanupSemantic.DIFF_DELETE, diffs);
};

exports.getExpectedString = getExpectedString;

var getReceivedString = function getReceivedString(diffs) {
  return getHighlightedString(_cleanupSemantic.DIFF_INSERT, diffs);
};

exports.getReceivedString = getReceivedString;
var MULTILINE_REGEXP = /\n/;
exports.MULTILINE_REGEXP = MULTILINE_REGEXP;
var NEWLINE_SYMBOL = "\u21B5";
var SPACE_SYMBOL = "\xB7";

var replaceSpacesAtEnd = function replaceSpacesAtEnd(line) {
  return line.replace(/\s+$/, function (spaces) {
    return SPACE_SYMBOL.repeat(spaces.length);
  });
};

var printDeleteLine = function printDeleteLine(line) {
  return EXPECTED_COLOR(line.length !== 0 ? '- ' + replaceSpacesAtEnd(line) : '-');
};

exports.printDeleteLine = printDeleteLine;

var printInsertLine = function printInsertLine(line) {
  return RECEIVED_COLOR(line.length !== 0 ? '+ ' + replaceSpacesAtEnd(line) : '+');
};

exports.printInsertLine = printInsertLine;

var printCommonLine = function printCommonLine(line) {
  var isFirstOrLast = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
  return line.length !== 0 ? DIM_COLOR('  ' + replaceSpacesAtEnd(line)) : isFirstOrLast ? DIM_COLOR('  ' + NEWLINE_SYMBOL) : '';
};

exports.printCommonLine = printCommonLine;

var computeStringDiffs = function computeStringDiffs(expected, received) {
  var isMultiline = MULTILINE_REGEXP.test(expected) || MULTILINE_REGEXP.test(received);

  if (isMultiline) {
    expected += '\n';
    received += '\n';
  }

  var diffs = (0, _diffStrings.default)(expected, received);
  (0, _cleanupSemantic.cleanupSemantic)(diffs);
  return {
    diffs: diffs,
    isMultiline: isMultiline
  };
};

exports.computeStringDiffs = computeStringDiffs;

var hasCommonDiff = function hasCommonDiff(diffs, isMultiline) {
  if (isMultiline) {
    var iLast = diffs.length - 1;
    return diffs.some(function (diff, i) {
      return diff[0] === _cleanupSemantic.DIFF_EQUAL && (i !== iLast || diff[1] !== '\n');
    });
  }

  return diffs.some(function (diff) {
    return diff[0] === _cleanupSemantic.DIFF_EQUAL;
  });
};

exports.hasCommonDiff = hasCommonDiff;

var printAnnotation = function printAnnotation(options) {
  return EXPECTED_COLOR('- ' + (options && options.aAnnotation || 'Expected')) + '\n' + RECEIVED_COLOR('+ ' + (options && options.bAnnotation || 'Received')) + '\n\n';
};

exports.printAnnotation = printAnnotation;

var createPatchMark = function createPatchMark(aStart, aEnd, bStart, bEnd) {
  return PATCH_COLOR("@@ -" + (aStart + 1) + "," + (aEnd - aStart) + " +" + (bStart + 1) + "," + (bEnd - bStart) + " @@");
};

exports.createPatchMark = createPatchMark;

var printMultilineStringDiffs = function printMultilineStringDiffs(diffs, expand) {
  var lines = (0, _getAlignedDiffs.default)(diffs);
  return expand ? (0, _joinAlignedDiffs.joinAlignedDiffsExpand)(lines) : (0, _joinAlignedDiffs.joinAlignedDiffsNoExpand)(lines);
};

exports.printMultilineStringDiffs = printMultilineStringDiffs;
var MAX_DIFF_STRING_LENGTH = 20000;

var getStringDiff = function getStringDiff(expected, received, options) {
  if (expected === received || expected.length === 0 || received.length === 0 || expected.length > MAX_DIFF_STRING_LENGTH || received.length > MAX_DIFF_STRING_LENGTH) {
    return null;
  }

  var _computeStringDiffs = computeStringDiffs(expected, received),
      diffs = _computeStringDiffs.diffs,
      isMultiline = _computeStringDiffs.isMultiline;

  if (!hasCommonDiff(diffs, isMultiline)) {
    return null;
  }

  return isMultiline ? {
    annotatedDiff: printAnnotation(options) + printMultilineStringDiffs(diffs, options === undefined || options.expand !== false),
    isMultiline: isMultiline
  } : {
    a: getExpectedString(diffs),
    b: getReceivedString(diffs),
    isMultiline: isMultiline
  };
};

exports.getStringDiff = getStringDiff;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByaW50RGlmZnMuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJnZXRTdHJpbmdEaWZmIiwicHJpbnRNdWx0aWxpbmVTdHJpbmdEaWZmcyIsImNyZWF0ZVBhdGNoTWFyayIsInByaW50QW5ub3RhdGlvbiIsImhhc0NvbW1vbkRpZmYiLCJjb21wdXRlU3RyaW5nRGlmZnMiLCJwcmludENvbW1vbkxpbmUiLCJwcmludEluc2VydExpbmUiLCJwcmludERlbGV0ZUxpbmUiLCJNVUxUSUxJTkVfUkVHRVhQIiwiZ2V0UmVjZWl2ZWRTdHJpbmciLCJnZXRFeHBlY3RlZFN0cmluZyIsImdldEhpZ2hsaWdodGVkU3RyaW5nIiwiUkVDRUlWRURfQ09MT1IiLCJJTlZFUlRFRF9DT0xPUiIsIkVYUEVDVEVEX0NPTE9SIiwiRElNX0NPTE9SIiwiX2NoYWxrIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfY2xlYW51cFNlbWFudGljIiwiX2RpZmZTdHJpbmdzIiwiX2dldEFsaWduZWREaWZmcyIsIl9qb2luQWxpZ25lZERpZmZzIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJkaW0iLCJncmVlbiIsImludmVyc2UiLCJyZWQiLCJQQVRDSF9DT0xPUiIsInllbGxvdyIsIm9wIiwiZGlmZnMiLCJyZWR1Y2UiLCJyZWR1Y2VkIiwiZGlmZiIsIkRJRkZfRVFVQUwiLCJESUZGX0RFTEVURSIsIkRJRkZfSU5TRVJUIiwiTkVXTElORV9TWU1CT0wiLCJTUEFDRV9TWU1CT0wiLCJyZXBsYWNlU3BhY2VzQXRFbmQiLCJsaW5lIiwicmVwbGFjZSIsInNwYWNlcyIsInJlcGVhdCIsImxlbmd0aCIsImlzRmlyc3RPckxhc3QiLCJleHBlY3RlZCIsInJlY2VpdmVkIiwiaXNNdWx0aWxpbmUiLCJ0ZXN0IiwiY2xlYW51cFNlbWFudGljIiwiaUxhc3QiLCJzb21lIiwiaSIsIm9wdGlvbnMiLCJhQW5ub3RhdGlvbiIsImJBbm5vdGF0aW9uIiwiYVN0YXJ0IiwiYUVuZCIsImJTdGFydCIsImJFbmQiLCJleHBhbmQiLCJsaW5lcyIsImpvaW5BbGlnbmVkRGlmZnNFeHBhbmQiLCJqb2luQWxpZ25lZERpZmZzTm9FeHBhbmQiLCJNQVhfRElGRl9TVFJJTkdfTEVOR1RIIiwiX2NvbXB1dGVTdHJpbmdEaWZmcyIsImFubm90YXRlZERpZmYiLCJ1bmRlZmluZWQiLCJhIiwiYiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLEVBQUFBLEtBQUssRUFBRTtBQURvQyxDQUE3QztBQUdBRCxPQUFPLENBQUNFLGFBQVIsR0FBd0JGLE9BQU8sQ0FBQ0cseUJBQVIsR0FBb0NILE9BQU8sQ0FBQ0ksZUFBUixHQUEwQkosT0FBTyxDQUFDSyxlQUFSLEdBQTBCTCxPQUFPLENBQUNNLGFBQVIsR0FBd0JOLE9BQU8sQ0FBQ08sa0JBQVIsR0FBNkJQLE9BQU8sQ0FBQ1EsZUFBUixHQUEwQlIsT0FBTyxDQUFDUyxlQUFSLEdBQTBCVCxPQUFPLENBQUNVLGVBQVIsR0FBMEJWLE9BQU8sQ0FBQ1csZ0JBQVIsR0FBMkJYLE9BQU8sQ0FBQ1ksaUJBQVIsR0FBNEJaLE9BQU8sQ0FBQ2EsaUJBQVIsR0FBNEJiLE9BQU8sQ0FBQ2Msb0JBQVIsR0FBK0JkLE9BQU8sQ0FBQ2UsY0FBUixHQUF5QmYsT0FBTyxDQUFDZ0IsY0FBUixHQUF5QmhCLE9BQU8sQ0FBQ2lCLGNBQVIsR0FBeUJqQixPQUFPLENBQUNrQixTQUFSLEdBQW9CLEtBQUssQ0FBemM7O0FBRUEsSUFBSUMsTUFBTSxHQUFHQyxzQkFBc0IsQ0FBQ0MsT0FBTyxDQUFDLE9BQUQsQ0FBUixDQUFuQzs7QUFFQSxJQUFJQyxnQkFBZ0IsR0FBR0QsT0FBTyxxQkFBOUI7O0FBRUEsSUFBSUUsWUFBWSxHQUFHSCxzQkFBc0IsQ0FBQ0MsT0FBTyxpQkFBUixDQUF6Qzs7QUFFQSxJQUFJRyxnQkFBZ0Is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RUFBV0MsUUFBWCxDQUE5QztBQUFBLE1BQ0VqQixLQUFLLEdBQUdvQyxtQkFBbUIsQ0FBQ3BDLEtBRDlCO0FBQUEsTUFFRWtCLFdBQVcsR0FBR2tCLG1CQUFtQixDQUFDbEIsV0FGcEM7O0FBSUEsTUFBSSxDQUFDaEQsYUFBYSxDQUFDOEIsS0FBRCxFQUFRa0IsV0FBUixDQUFsQixFQUF3QztBQUN0QyxXQUFPLElBQVA7QUFDRDs7QUFFRCxTQUFPQSxXQUFXLEdBQ2Q7QUFDRW1CLElBQUFBLGFBQWEsRUFDWHBFLGVBQWUsQ0FBQ3VELE9BQUQsQ0FBZixHQUNBekQseUJBQXlCLENBQ3ZCaUMsS0FEdUIsRUFFdkJ3QixPQUFPLEtBQUtjLFNBQVosSUFBeUJkLE9BQU8sQ0FBQ08sTUFBUixLQUFtQixLQUZyQixDQUg3QjtBQU9FYixJQUFBQSxXQUFXLEVBQVhBO0FBUEYsR0FEYyxHQVVkO0FBQ0VxQixJQUFBQSxDQUFDLEVBQUU5RCxpQkFBaUIsQ0FBQ3VCLEtBQUQsQ0FEdEI7QUFFRXdDLElBQUFBLENBQUMsRUFBRWhFLGlCQUFpQixDQUFDd0IsS0FBRCxDQUZ0QjtBQUdFa0IsSUFBQUEsV0FBVyxFQUFYQTtBQUhGLEdBVko7QUFlRCxDQWxDRDs7QUFvQ0F0RCxPQUFPLENBQUNFLGFBQVIsR0FBd0JBLGFBQXhCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZ2V0U3RyaW5nRGlmZiA9IGV4cG9ydHMucHJpbnRNdWx0aWxpbmVTdHJpbmdEaWZmcyA9IGV4cG9ydHMuY3JlYXRlUGF0Y2hNYXJrID0gZXhwb3J0cy5wcmludEFubm90YXRpb24gPSBleHBvcnRzLmhhc0NvbW1vbkRpZmYgPSBleHBvcnRzLmNvbXB1dGVTdHJpbmdEaWZmcyA9IGV4cG9ydHMucHJpbnRDb21tb25MaW5lID0gZXhwb3J0cy5wcmludEluc2VydExpbmUgPSBleHBvcnRzLnByaW50RGVsZXRlTGluZSA9IGV4cG9ydHMuTVVMVElMSU5FX1JFR0VYUCA9IGV4cG9ydHMuZ2V0UmVjZWl2ZWRTdHJpbmcgPSBleHBvcnRzLmdldEV4cGVjdGVkU3RyaW5nID0gZXhwb3J0cy5nZXRIaWdobGlnaHRlZFN0cmluZyA9IGV4cG9ydHMuUkVDRUlWRURfQ09MT1IgPSBleHBvcnRzLklOVkVSVEVEX0NPTE9SID0gZXhwb3J0cy5FWFBFQ1RFRF9DT0xPUiA9IGV4cG9ydHMuRElNX0NPTE9SID0gdm9pZCAwO1xuXG52YXIgX2NoYWxrID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCdjaGFsaycpKTtcblxudmFyIF9jbGVhbnVwU2VtYW50aWMgPSByZXF1aXJlKCcuL2NsZWFudXBTZW1hbnRpYycpO1xuXG52YXIgX2RpZmZTdHJpbmdzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCcuL2RpZmZTdHJpbmdzJykpO1xuXG52YXIgX2dldEFsaWduZWREaWZmcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgnLi9nZXRBbGlnbmVkRGlmZnMnKSk7XG5cbnZhciBfam9pbkFsaWduZWREaWZmcyA9IHJlcXVpcmUoJy4vam9pbkFsaWduZWREaWZmcycpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikge1xuICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDoge2RlZmF1bHQ6IG9ian07XG59XG5cbi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cbmNvbnN0IERJTV9DT0xPUiA9IF9jaGFsay5kZWZhdWx0LmRpbTtcbmV4cG9ydHMuRElNX0NPTE9SID0gRElNX0NPTE9SO1xuY29uc3QgRVhQRUNURURfQ09MT1IgPSBfY2hhbGsuZGVmYXVsdC5ncmVlbjtcbmV4cG9ydHMuRVhQRUNURURfQ09MT1IgPSBFWFBFQ1RFRF9DT0xPUjtcbmNvbnN0IElOVkVSVEVEX0NPTE9SID0gX2NoYWxrLmRlZmF1bHQuaW52ZXJzZTtcbmV4cG9ydHMuSU5WRVJURURfQ09MT1IgPSBJTlZFUlRFRF9DT0xPUjtcbmNvbnN0IFJFQ0VJVkVEX0NPTE9SID0gX2NoYWxrLmRlZmF1bHQucmVkO1xuZXhwb3J0cy5SRUNFSVZFRF9DT0xPUiA9IFJFQ0VJVkVEX0NPTE9SO1xuY29uc3QgUEFUQ0hfQ09MT1IgPSBfY2hhbGsuZGVmYXVsdC55ZWxsb3c7IC8vIEdpdmVuIGNoYW5nZSBvcCBhbmQgYXJyYXkgb2YgZGlmZnMsIHJldHVybiBjb25jYXRlbmF0ZWQgc3RyaW5nOlxuLy8gKiBpbmNsdWRlIGNvbW1vbiBzdHJpbmdzXG4vLyAqIGluY2x1ZGUgY2hhbmdlIHN0cmluZ3Mgd2hpY2ggaGF2ZSBhcmd1bWVudCBvcCAoaW52ZXJzZSBoaWdobGlnaHQpXG4vLyAqIGV4Y2x1ZGUgY2hhbmdlIHN0cmluZ3Mgd2hpY2ggaGF2ZSBvcHBvc2l0ZSBvcFxuXG5jb25zdCBnZXRIaWdobGlnaHRlZFN0cmluZyA9IChvcCwgZGlmZnMpID0+XG4gIGRpZmZzLnJlZHVjZShcbiAgICAocmVkdWNlZCwgZGlmZikgPT5cbiAgICAgIHJlZHVjZWQgK1xuICAgICAgKGRpZmZbMF0gPT09IF9jbGVhbnVwU2VtYW50aWMuRElGRl9FUVVBTFxuICAgICAgICA/IGRpZmZbMV1cbiAgICAgICAgOiBkaWZmWzBdID09PSBvcFxuICAgICAgICA/IElOVkVSVEVEX0NPTE9SKGRpZmZbMV0pXG4gICAgICAgIDogJycpLFxuICAgICcnXG4gICk7XG5cbmV4cG9ydHMuZ2V0SGlnaGxpZ2h0ZWRTdHJpbmcgPSBnZXRIaWdobGlnaHRlZFN0cmluZztcblxuY29uc3QgZ2V0RXhwZWN0ZWRTdHJpbmcgPSBkaWZmcyA9PlxuICBnZXRIaWdobGlnaHRlZFN0cmluZyhfY2xlYW51cFNlbWFudGljLkRJRkZfREVMRVRFLCBkaWZmcyk7XG5cbmV4cG9ydHMuZ2V0RXhwZWN0ZWRTdHJpbmcgPSBnZXRFeHBlY3RlZFN0cmluZztcblxuY29uc3QgZ2V0UmVjZWl2ZWRTdHJpbmcgPSBkaWZmcyA9PlxuICBnZXRIaWdobGlnaHRlZFN0cmluZyhfY2xlYW51cFNlbWFudGljLkRJRkZfSU5TRVJULCBkaWZmcyk7XG5cbmV4cG9ydHMuZ2V0UmVjZWl2ZWRTdHJpbmcgPSBnZXRSZWNlaXZlZFN0cmluZztcbmNvbnN0IE1VTFRJTElORV9SRUdFWFAgPSAvXFxuLztcbmV4cG9ydHMuTVVMVElMSU5FX1JFR0VYUCA9IE1VTFRJTElORV9SRUdFWFA7XG5jb25zdCBORVdMSU5FX1NZTUJPTCA9ICdcXHV7MjFCNX0nOyAvLyBkb3dud2FyZHMgYXJyb3cgd2l0aCBjb3JuZXIgbGVmdHdhcmRzXG5cbmNvbnN0IFNQQUNFX1NZTUJPTCA9ICdcXHV7MDBCN30nOyAvLyBtaWRkbGUgZG90XG4vLyBJbnN0ZWFkIG9mIGludmVyc2UgaGlnaGxpZ2h0IHdoaWNoIG5vdyBpbXBsaWVzIGEgY2hhbmdlLFxuLy8gcmVwbGFjZSBjb21tb24gc3BhY2VzIHdpdGggbWlkZGxlIGRvdCBhdCB0aGUgZW5kIG9mIHRoZSBsaW5lLlxuXG5jb25zdCByZXBsYWNlU3BhY2VzQXRFbmQgPSBsaW5lID0+XG4gIGxpbmUucmVwbGFjZSgvXFxzKyQvLCBzcGFjZXMgPT4gU1BBQ0VfU1lNQk9MLnJlcGVhdChzcGFjZXMubGVuZ3RoKSk7XG5cbmNvbnN0IHByaW50RGVsZXRlTGluZSA9IGxpbmUgPT5cbiAgRVhQRUNURURfQ09MT1IobGluZS5sZW5ndGggIT09IDAgPyAnLSAnICsgcmVwbGFjZVNwYWNlc0F0RW5kKGxpbmUpIDogJy0nKTtcblxuZXhwb3J0cy5wcmludERlbGV0ZUxpbmUgPSBwcmludERlbGV0ZUxpbmU7XG5cbmNvbnN0IHByaW50SW5zZXJ0TGluZSA9IGxpbmUgPT5cbiAgUkVDRUlWRURfQ09MT1IobGluZS5sZW5ndGggIT09IDAgPyAnKyAnICsgcmVwbGFjZVNwYWNlc0F0RW5kKGxpbmUpIDogJysnKTsgLy8gUHJldmVudCB2aXN1YWxseSBhbWJpZ3VvdXMgZW1wdHkgbGluZSBhcyB0aGUgZmlyc3Qgb3IgdGhlIGxhc3QuXG5cbmV4cG9ydHMucHJpbnRJbnNlcnRMaW5lID0gcHJpbnRJbnNlcnRMaW5lO1xuXG5jb25zdCBwcmludENvbW1vbkxpbmUgPSAobGluZSwgaXNGaXJzdE9yTGFzdCA9IGZhbHNlKSA9PlxuICBsaW5lLmxlbmd0aCAhPT0gMFxuICAgID8gRElNX0NPTE9SKCcgICcgKyByZXBsYWNlU3BhY2VzQXRFbmQobGluZSkpXG4gICAgOiBpc0ZpcnN0T3JMYXN0XG4gICAgPyBESU1fQ09MT1IoJyAgJyArIE5FV0xJTkVfU1lNQk9MKVxuICAgIDogJyc7XG5cbmV4cG9ydHMucHJpbnRDb21tb25MaW5lID0gcHJpbnRDb21tb25MaW5lO1xuXG5jb25zdCBjb21wdXRlU3RyaW5nRGlmZnMgPSAoZXhwZWN0ZWQsIHJlY2VpdmVkKSA9PiB7XG4gIGNvbnN0IGlzTXVsdGlsaW5lID1cbiAgICBNVUxUSUxJTkVfUkVHRVhQLnRlc3QoZXhwZWN0ZWQpIHx8IE1VTFRJTElORV9SRUdFWFAudGVzdChyZWNlaXZlZCk7IC8vIGdldEFsaWduZWREaWZmcyBhc3N1bWVzIHRoYXQgYSBuZXdsaW5lIHdhcyBhcHBlbmRlZCB0byB0aGUgc3RyaW5ncy5cblxuICBpZiAoaXNNdWx0aWxpbmUpIHtcbiAgICBleHBlY3RlZCArPSAnXFxuJztcbiAgICByZWNlaXZlZCArPSAnXFxuJztcbiAgfVxuXG4gIGNvbnN0IGRpZmZzID0gKDAsIF9kaWZmU3RyaW5ncy5kZWZhdWx0KShleHBlY3RlZCwgcmVjZWl2ZWQpO1xuICAoMCwgX2NsZWFudXBTZW1hbnRpYy5jbGVhbnVwU2VtYW50aWMpKGRpZmZzKTsgLy8gaW1wdXJlIGZ1bmN0aW9uXG5cbiAgcmV0dXJuIHtcbiAgICBkaWZmcyxcbiAgICBpc011bHRpbGluZVxuICB9O1xufTtcblxuZXhwb3J0cy5jb21wdXRlU3RyaW5nRGlmZnMgPSBjb21wdXRlU3RyaW5nRGlmZnM7XG5cbmNvbnN0IGhhc0NvbW1vbkRpZmYgPSAoZGlmZnMsIGlzTXVsdGlsaW5lKSA9PiB7XG4gIGlmIChpc011bHRpbGluZSkge1xuICAgIC8vIEltcG9ydGFudDogSWdub3JlIGNvbW1vbiBuZXdsaW5lIHRoYXQgd2FzIGFwcGVuZGVkIHRvIG11bHRpbGluZSBzdHJpbmdzIVxuICAgIGNvbnN0IGlMYXN0ID0gZGlmZnMubGVuZ3RoIC0gMTtcbiAgICByZXR1cm4gZGlmZnMuc29tZShcbiAgICAgIChkaWZmLCBpKSA9PlxuICAgICAgICBkaWZmWzBdID09PSBfY2xlYW51cFNlbWFudGljLkRJRkZfRVFVQUwgJiZcbiAgICAgICAgKGkgIT09IGlMYXN0IHx8IGRpZmZbMV0gIT09ICdcXG4nKVxuICAgICk7XG4gIH1cblxuICByZXR1cm4gZGlmZnMuc29tZShkaWZmID0+IGRpZmZbMF0gPT09IF9jbGVhbnVwU2VtYW50aWMuRElGRl9FUVVBTCk7XG59O1xuXG5leHBvcnRzLmhhc0NvbW1vbkRpZmYgPSBoYXNDb21tb25EaWZmO1xuXG5jb25zdCBwcmludEFubm90YXRpb24gPSBvcHRpb25zID0+XG4gIEVYUEVDVEVEX0NPTE9SKCctICcgKyAoKG9wdGlvbnMgJiYgb3B0aW9ucy5hQW5ub3RhdGlvbikgfHwgJ0V4cGVjdGVkJykpICtcbiAgJ1xcbicgK1xuICBSRUNFSVZFRF9DT0xPUignKyAnICsgKChvcHRpb25zICYmIG9wdGlvbnMuYkFubm90YXRpb24pIHx8ICdSZWNlaXZlZCcpKSArXG4gICdcXG5cXG4nOyAvLyBJbiBHTlUgZGlmZiBmb3JtYXQsIGluZGV4ZXMgYXJlIG9uZS1iYXNlZCBpbnN0ZWFkIG9mIHplcm8tYmFzZWQuXG5cbmV4cG9ydHMucHJpbnRBbm5vdGF0aW9uID0gcHJpbnRBbm5vdGF0aW9uO1xuXG5jb25zdCBjcmVhdGVQYXRjaE1hcmsgPSAoYVN0YXJ0LCBhRW5kLCBiU3RhcnQsIGJFbmQpID0+XG4gIFBBVENIX0NPTE9SKFxuICAgIGBAQCAtJHthU3RhcnQgKyAxfSwke2FFbmQgLSBhU3RhcnR9ICske2JTdGFydCArIDF9LCR7YkVuZCAtIGJTdGFydH0gQEBgXG4gICk7IC8vIFJldHVybiBmb3JtYXR0ZWQgZGlmZiBsaW5lcyB3aXRob3V0IGxhYmVscy5cblxuZXhwb3J0cy5jcmVhdGVQYXRjaE1hcmsgPSBjcmVhdGVQYXRjaE1hcms7XG5cbmNvbnN0IHByaW50TXVsdGlsaW5lU3RyaW5nRGlmZnMgPSAoZGlmZnMsIGV4cGFuZCkgPT4ge1xuICBjb25zdCBsaW5lcyA9ICgwLCBfZ2V0QWxpZ25lZERpZmZzLmRlZmF1bHQpKGRpZmZzKTtcbiAgcmV0dXJuIGV4cGFuZFxuICAgID8gKDAsIF9qb2luQWxpZ25lZERpZmZzLmpvaW5BbGlnbmVkRGlmZnNFeHBhbmQpKGxpbmVzKVxuICAgIDogKDAsIF9qb2luQWxpZ25lZERpZmZzLmpvaW5BbGlnbmVkRGlmZnNOb0V4cGFuZCkobGluZXMpO1xufTtcblxuZXhwb3J0cy5wcmludE11bHRpbGluZVN0cmluZ0RpZmZzID0gcHJpbnRNdWx0aWxpbmVTdHJpbmdEaWZmcztcbmNvbnN0IE1BWF9ESUZGX1NUUklOR19MRU5HVEggPSAyMDAwMDtcblxuLy8gUHJpbnQgc3BlY2lmaWMgc3Vic3RyaW5nIGRpZmYgZm9yIHN0cmluZ3Mgb25seTpcbi8vICogaWYgc3RyaW5ncyBhcmUgbm90IGVxdWFsXG4vLyAqIGlmIG5laXRoZXIgc3RyaW5nIGlzIGVtcHR5XG4vLyAqIGlmIG5laXRoZXIgc3RyaW5nIGlzIHRvbyBsb25nXG4vLyAqIGlmIHRoZXJlIGlzIGEgY29tbW9uIHN0cmluZyBhZnRlciBzZW1hbnRpYyBjbGVhbnVwXG5jb25zdCBnZXRTdHJpbmdEaWZmID0gKGV4cGVjdGVkLCByZWNlaXZlZCwgb3B0aW9ucykgPT4ge1xuICBpZiAoXG4gICAgZXhwZWN0ZWQgPT09IHJlY2VpdmVkIHx8XG4gICAgZXhwZWN0ZWQubGVuZ3RoID09PSAwIHx8XG4gICAgcmVjZWl2ZWQubGVuZ3RoID09PSAwIHx8XG4gICAgZXhwZWN0ZWQubGVuZ3RoID4gTUFYX0RJRkZfU1RSSU5HX0xFTkdUSCB8fFxuICAgIHJlY2VpdmVkLmxlbmd0aCA+IE1BWF9ESUZGX1NUUklOR19MRU5HVEhcbiAgKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBfY29tcHV0ZVN0cmluZ0RpZmZzID0gY29tcHV0ZVN0cmluZ0RpZmZzKGV4cGVjdGVkLCByZWNlaXZlZCksXG4gICAgZGlmZnMgPSBfY29tcHV0ZVN0cmluZ0RpZmZzLmRpZmZzLFxuICAgIGlzTXVsdGlsaW5lID0gX2NvbXB1dGVTdHJpbmdEaWZmcy5pc011bHRpbGluZTtcblxuICBpZiAoIWhhc0NvbW1vbkRpZmYoZGlmZnMsIGlzTXVsdGlsaW5lKSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcmV0dXJuIGlzTXVsdGlsaW5lXG4gICAgPyB7XG4gICAgICAgIGFubm90YXRlZERpZmY6XG4gICAgICAgICAgcHJpbnRBbm5vdGF0aW9uKG9wdGlvbnMpICtcbiAgICAgICAgICBwcmludE11bHRpbGluZVN0cmluZ0RpZmZzKFxuICAgICAgICAgICAgZGlmZnMsXG4gICAgICAgICAgICBvcHRpb25zID09PSB1bmRlZmluZWQgfHwgb3B0aW9ucy5leHBhbmQgIT09IGZhbHNlXG4gICAgICAgICAgKSxcbiAgICAgICAgaXNNdWx0aWxpbmVcbiAgICAgIH1cbiAgICA6IHtcbiAgICAgICAgYTogZ2V0RXhwZWN0ZWRTdHJpbmcoZGlmZnMpLFxuICAgICAgICBiOiBnZXRSZWNlaXZlZFN0cmluZyhkaWZmcyksXG4gICAgICAgIGlzTXVsdGlsaW5lXG4gICAgICB9O1xufTtcblxuZXhwb3J0cy5nZXRTdHJpbmdEaWZmID0gZ2V0U3RyaW5nRGlmZjtcbiJdfQ==